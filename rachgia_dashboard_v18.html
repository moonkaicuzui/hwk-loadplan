<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; img-src 'self' data: blob:; font-src 'self' data:;">
    <title>Rachgia Factory í†µí•© ìƒì‚°ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ v18</title>

    <!-- PWA: Progressive Web App (Phase 2) -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Rachgia">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">

    <!-- Phase 5-2: External Data File (ë°ì´í„° ì™¸ë¶€í™”) -->
    <script src="rachgia_data_v8.js"></script>

    <!-- Phase 1: Security & Performance (V01-V04) -->
    <script src="rachgia_v18_improvements.js"></script>

    <!-- Phase 2: PWA & UX Enhancements (W06-W08) -->
    <script src="keyboard-shortcuts.js"></script>
    <script src="notifications.js"></script>

    <!-- Phase 3: i18n Multi-language Support (W09) -->
    <script src="i18n.js"></script>

    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Agent Q01: PDF Export Libraries (Phase 4 - Step 5: Q01-2) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script>
        // V02: Initialize FilterCache (LRU cache for filter results)
        const filterCache = new FilterCache(50);

        // V03: Initialize ChartManager (Chart.js instance reuse)
        const chartManager = new ChartManager();

        // Chart.js ë‹¤í¬ëª¨ë“œ ê¸°ë³¸ ì„¤ì •
        Chart.defaults.color = getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim() || '#1f2937';
        Chart.defaults.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--border-color').trim() || '#e5e7eb';
    </script>
    <style>
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
        }
        .dark {
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --bg-card: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --border-color: #4b5563;
        }
        body { background: var(--bg-primary); color: var(--text-primary); transition: all 0.3s; }
        .bg-card { background: var(--bg-card); }
        .text-secondary { color: var(--text-secondary); }
        .border-theme { border-color: var(--border-color); }

        .tab-active { border-bottom: 3px solid #3b82f6; color: #3b82f6; font-weight: 600; }
        .card-hover { transition: all 0.2s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .delay-highlight { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); animation: pulse-red 2s infinite; }
        .dark .delay-highlight { background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%); }
        @keyframes pulse-red { 0%, 100% { opacity: 1; } 50% { opacity: 0.85; } }
        .warning-highlight { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
        .dark .warning-highlight { background: linear-gradient(135deg, #78350f 0%, #92400e 100%); }

        /* ì„ ì  ì™„ë£Œ PO ìŠ¤íƒ€ì¼ */
        .shipped-highlight {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            position: relative;
        }
        .dark .shipped-highlight {
            background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
        }
        .shipped-highlight td { color: #047857 !important; }
        .dark .shipped-highlight td { color: #6ee7b7 !important; }
        .shipped-badge {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            padding: 2px 6px;
            background: #059669;
            color: white;
            border-radius: 9999px;
            font-size: 0.65rem;
            font-weight: 600;
        }
        .dark .shipped-badge { background: #10b981; }

        table th { position: sticky; top: 0; background: var(--bg-secondary); z-index: 10; }
        .clickable-row { cursor: pointer; }
        .clickable-row:hover { background-color: rgba(59, 130, 246, 0.1) !important; }
        .modal-overlay { background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
        .progress-bar { height: 24px; border-radius: 12px; background: #e5e7eb; overflow: hidden; cursor: pointer; transition: transform 0.2s; }
        .dark .progress-bar { background: #4b5563; }
        .progress-bar:hover { transform: scaleY(1.1); }
        .progress-fill { height: 100%; border-radius: 12px; transition: width 0.5s ease; }

        .filter-chip { display: inline-flex; align-items: center; padding: 4px 12px; border-radius: 9999px; font-size: 0.875rem; margin: 2px; cursor: pointer; transition: all 0.2s; }
        .filter-chip.active { background-color: #3b82f6; color: white; }
        .filter-chip:not(.active) { background-color: #e5e7eb; color: #374151; }
        .dark .filter-chip:not(.active) { background-color: #4b5563; color: #e5e7eb; }

        /* Agent Q02: í•„í„° ë¡œì§ ë²„íŠ¼ (Phase 4 - Q02-2) */
        .filter-logic-btn { background-color: #e5e7eb; color: #374151; border: 2px solid transparent; }
        .dark .filter-logic-btn { background-color: #4b5563; color: #e5e7eb; }
        .filter-logic-btn:hover { background-color: #d1d5db; }
        .dark .filter-logic-btn:hover { background-color: #6b7280; }
        .filter-logic-btn.filter-logic-active { background-color: #3b82f6; color: white; border-color: #2563eb; font-weight: 600; }
        .dark .filter-logic-btn.filter-logic-active { background-color: #2563eb; border-color: #1d4ed8; }

        /* Agent Q06: ê°€ë¡œ/ì„¸ë¡œ ëª¨ë“œ ìµœì í™” (Phase 4 - Q06-6) */
        /* í…Œì´ë¸” ë ˆì´ì•„ì›ƒ */
        .mobile-compact { font-size: 0.875rem; }
        .mobile-compact th, .mobile-compact td { padding: 0.5rem; }
        .landscape-mode { font-size: 1rem; }
        .landscape-mode th, .landscape-mode td { padding: 0.75rem; }

        /* ëª¨ë‹¬ ë ˆì´ì•„ì›ƒ */
        .landscape-modal > div { max-width: 90vw; max-height: 80vh; }
        .portrait-modal > div { max-width: 95vw; max-height: 90vh; }

        /* ë¯¸ë””ì–´ ì¿¼ë¦¬: ê°€ë¡œ ëª¨ë“œ */
        @media (orientation: landscape) and (max-width: 1024px) {
            .grid.grid-cols-2.md\:grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
            .filter-section { grid-template-columns: repeat(3, 1fr); }
            .tab-button { font-size: 0.875rem; padding: 0.5rem 1rem; }
        }

        /* ë¯¸ë””ì–´ ì¿¼ë¦¬: ì„¸ë¡œ ëª¨ë“œ */
        @media (orientation: portrait) and (max-width: 768px) {
            .grid.grid-cols-2.md\:grid-cols-4 { grid-template-columns: repeat(2, 1fr); }
            .filter-section { grid-template-columns: repeat(1, 1fr); }
            .tab-button { font-size: 0.75rem; padding: 0.375rem 0.75rem; }
        }

        .chart-container { position: relative; height: 300px; }

        /* Sortable headers - ì ‘ê·¼ì„± ê°œì„  */
        .sort-header { cursor: pointer; user-select: none; position: relative; }
        .sort-header:focus { outline: 2px solid #3b82f6; outline-offset: 2px; }
        .sort-header:hover { background: rgba(59, 130, 246, 0.1); }
        .sort-header::after { content: 'â‡…'; margin-left: 4px; opacity: 0.3; font-size: 10px; }
        .sort-header.asc::after { content: 'â†‘'; opacity: 1; }
        .sort-header.desc::after { content: 'â†“'; opacity: 1; }

        .funnel-step { position: relative; text-align: center; padding: 8px; margin: 2px; border-radius: 4px; transition: all 0.2s; cursor: pointer; }
        .funnel-step:hover { transform: scale(1.02); }
        .bottleneck { animation: bottleneck-pulse 1.5s infinite; border: 2px solid #ef4444 !important; }
        @keyframes bottleneck-pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 50% { box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); } }

        .loading-spinner { border: 3px solid #f3f4f6; border-top: 3px solid #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .calendar-day { width: 40px; height: 40px; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .calendar-day:hover { background: rgba(59, 130, 246, 0.2); }
        .calendar-day.today { border: 2px solid #3b82f6; }
        .calendar-day.delayed { background: #fecaca; }
        .dark .calendar-day.delayed { background: #7f1d1d; }
        .calendar-day.warning { background: #fef3c7; }
        .dark .calendar-day.warning { background: #78350f; }

        .exec-kpi { font-size: 2.5rem; font-weight: 700; }

        /* Process timeline visual */
        .process-timeline { display: flex; align-items: center; gap: 4px; flex-wrap: wrap; }
        .process-step { display: flex; flex-direction: column; align-items: center; padding: 8px 12px; border-radius: 8px; min-width: 70px; }
        .process-step.completed { background: #dcfce7; border: 2px solid #22c55e; }
        .process-step.in-progress { background: #fef3c7; border: 2px solid #f59e0b; }
        .process-step.pending { background: #f3f4f6; border: 2px solid #d1d5db; }
        .dark .process-step.completed { background: #166534; border-color: #22c55e; }
        .dark .process-step.in-progress { background: #854d0e; border-color: #f59e0b; }
        .dark .process-step.pending { background: #374151; border-color: #6b7280; }
        .process-arrow { font-size: 20px; color: #9ca3af; }

        /* Date mode toggle */
        .date-mode-toggle { display: flex; border-radius: 8px; overflow: hidden; border: 2px solid #3b82f6; }
        .date-mode-btn { padding: 8px 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .date-mode-btn.active { background: #3b82f6; color: white; }
        .date-mode-btn:not(.active) { background: transparent; color: #3b82f6; }
        .date-mode-btn:not(.active):hover { background: rgba(59, 130, 246, 0.1); }

        /* Heatmap styles */
        .heatmap-cell { padding: 4px 8px; text-align: center; font-size: 11px; min-width: 50px; }

        /* Agent Q06: ë°˜ì‘í˜• ì°¨íŠ¸ í¬ê¸° ì¡°ì • (Phase 4 - Q06-4) */
        @media (max-width: 768px) {
            .chart-container {
                height: 250px;
            }
            canvas {
                max-height: 250px !important;
            }
        }
        @media (min-width: 769px) and (max-width: 1024px) {
            .chart-container {
                height: 350px;
            }
            canvas {
                max-height: 350px !important;
            }
        }
        @media (min-width: 1025px) {
            .chart-container {
                height: 450px;
            }
            canvas {
                max-height: 450px !important;
            }
        }

        /* Agent Q09: í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ íŒíŠ¸ ìŠ¤íƒ€ì¼ (Phase 4 - Q09-3) */
        .keyboard-hint {
            display: inline-block;
            padding: 2px 6px;
            margin-left: 8px;
            font-size: 11px;
            font-weight: 600;
            color: #6b7280;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        .dark .keyboard-hint {
            color: #9ca3af;
            background: #374151;
            border-color: #4b5563;
        }
        .shortcut-category {
            margin-bottom: 20px;
            padding: 16px;
            background: #f9fafb;
            border-radius: 8px;
        }
        .dark .shortcut-category {
            background: #1f2937;
        }
        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .dark .shortcut-item {
            border-bottom-color: #374151;
        }
        .shortcut-item:last-child {
            border-bottom: none;
        }
        .shortcut-keys {
            display: flex;
            gap: 4px;
        }
        .shortcut-key {
            display: inline-block;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: 700;
            color: #1f2937;
            background: white;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            box-shadow: 0 2px 0 #d1d5db;
            font-family: 'Courier New', monospace;
            min-width: 30px;
            text-align: center;
        }
        .dark .shortcut-key {
            color: #f9fafb;
            background: #374151;
            border-color: #4b5563;
            box-shadow: 0 2px 0 #4b5563;
        }
        .shortcut-plus {
            color: #6b7280;
            font-weight: bold;
        }
        .shortcut-active {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            background: rgba(59, 130, 246, 0.95);
            color: white;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 9999;
            animation: slideInUp 0.3s ease-out;
        }
        @keyframes slideInUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Agent Q05: ë³´ê³ ì„œ íˆìŠ¤í† ë¦¬ ì¹´ë“œ ìŠ¤íƒ€ì¼ (Phase 4 - Q05-5) */
        .report-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .report-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .report-badge {
            display: inline-block;
            padding: 2px 8px;
            font-size: 11px;
            font-weight: 600;
            border-radius: 12px;
        }
        .report-badge.recent {
            background: #dbeafe;
            color: #1e40af;
        }
        .dark .report-badge.recent {
            background: #1e3a8a;
            color: #bfdbfe;
        }
        .report-preview {
            max-height: 200px;
            overflow: hidden;
            position: relative;
        }
        .report-preview::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(to bottom, transparent, white);
        }
        .dark .report-preview::after {
            background: linear-gradient(to bottom, transparent, #1f2937);
        }

        @media print {
            .no-print { display: none !important; }
            body { font-size: 12px; }
            /* Agent Q05: ë³´ê³ ì„œ ì¸ì‡„ ìŠ¤íƒ€ì¼ (Phase 4 - Q05-1) */
            #dailyReportModal { position: static !important; background: white !important; }
            #dailyReportModal > div { max-width: 100% !important; box-shadow: none !important; }
            #reportContent { overflow: visible !important; }
            .report-section { page-break-inside: avoid; }
            .report-table { width: 100%; border-collapse: collapse; }
            .report-table th, .report-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            .report-kpi { border: 2px solid #3b82f6; padding: 12px; border-radius: 8px; }
        }

        .kbd { display: inline-block; padding: 2px 6px; font-size: 11px; background: #e5e7eb; border-radius: 4px; font-family: monospace; }
        .dark .kbd { background: #4b5563; }

        /* Agent Q09: ìŠ¤í¬ë¦° ë¦¬ë” ì „ìš© (ì ‘ê·¼ì„±) */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Agent Q06: ëª¨ë°”ì¼ í„°ì¹˜ ì œìŠ¤ì²˜ ìŠ¤íƒ€ì¼ */
        .mobile-filter-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 100;
            cursor: pointer;
            transition: all 0.3s;
        }
        .mobile-filter-toggle:active { transform: scale(0.9); }
        @media (max-width: 768px) {
            .mobile-filter-toggle { display: flex; }
            .filter-panel-desktop { display: none; }
            .filter-panel-mobile {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: var(--bg-card);
                z-index: 200;
                transform: translateY(100%);
                transition: transform 0.3s ease-out;
                overflow-y: auto;
            }
            .filter-panel-mobile.active { transform: translateY(0); }
        }
        @media (min-width: 769px) {
            .filter-panel-desktop { display: block; }
            .filter-panel-mobile { display: none; }
        }

        /* ìŠ¤ì™€ì´í”„ í”¼ë“œë°± ì• ë‹ˆë©”ì´ì…˜ */
        .swipe-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            opacity: 0;
            pointer-events: none;
            z-index: 300;
            transition: opacity 0.3s;
        }
        .swipe-indicator.show { opacity: 0.8; }

        /* í„°ì¹˜ ripple íš¨ê³¼ */
        .touch-ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.4);
            transform: scale(0);
            animation: ripple 0.6s ease-out;
            pointer-events: none;
        }
        @keyframes ripple {
            to { transform: scale(4); opacity: 0; }
        }

        /* Agent Q06: Bottom Sheet ëª¨ë‹¬ (ëª¨ë°”ì¼) */
        @media (max-width: 768px) {
            .modal-overlay {
                align-items: flex-end !important;
            }
            .modal-overlay > div {
                width: 100% !important;
                max-width: 100% !important;
                max-height: 85vh !important;
                margin: 0 !important;
                border-radius: 24px 24px 0 0 !important;
                transform: translateY(100%);
                transition: transform 0.3s ease-out;
            }
            .modal-overlay:not(.hidden) > div {
                transform: translateY(0);
            }
            /* ëª¨ë‹¬ ë“œë˜ê·¸ í•¸ë“¤ */
            .modal-drag-handle {
                width: 40px;
                height: 4px;
                background: #d1d5db;
                border-radius: 2px;
                margin: 12px auto 8px;
                cursor: grab;
            }
            .modal-drag-handle:active { cursor: grabbing; }
            .dark .modal-drag-handle { background: #6b7280; }

            /* ëª¨ë°”ì¼ ëª¨ë‹¬ ë‚´ ë²„íŠ¼ í¬ê¸° */
            .modal-overlay button {
                min-width: 44px !important;
                min-height: 44px !important;
                padding: 12px 16px !important;
                font-size: 16px !important;
            }
            /* ëª¨ë°”ì¼ ëª¨ë‹¬ ë‚´ input/select */
            .modal-overlay input,
            .modal-overlay select {
                min-height: 44px !important;
                font-size: 16px !important;
            }

            /* ========================================
               Agent Q06: í–„ë²„ê±° ë©”ë‰´ ë„¤ë¹„ê²Œì´ì…˜
               Phase 4 - Step 5: Q06-5 (MEDIUM)
               ======================================== */

            /* í–„ë²„ê±° ë²„íŠ¼ */
            .mobile-menu-toggle {
                display: flex;
                align-items: center;
                justify-center: center;
                width: 44px;
                height: 44px;
                background: transparent;
                border: none;
                cursor: pointer;
                z-index: 110;
            }

            /* í–„ë²„ê±° ì•„ì´ì½˜ (3ì¤„) */
            .hamburger-icon {
                display: flex;
                flex-direction: column;
                gap: 4px;
            }
            .hamburger-icon span {
                width: 24px;
                height: 3px;
                background: currentColor;
                transition: all 0.3s;
            }
            .hamburger-icon.active span:nth-child(1) {
                transform: rotate(45deg) translate(6px, 6px);
            }
            .hamburger-icon.active span:nth-child(2) {
                opacity: 0;
            }
            .hamburger-icon.active span:nth-child(3) {
                transform: rotate(-45deg) translate(6px, -6px);
            }

            /* ëª¨ë°”ì¼ ë©”ë‰´ ë“œë¡œì–´ */
            .mobile-menu-drawer {
                position: fixed;
                top: 0;
                left: -100%;
                width: 280px;
                height: 100vh;
                background: var(--bg-card);
                z-index: 105;
                transition: left 0.3s ease-out;
                box-shadow: 2px 0 12px rgba(0, 0, 0, 0.3);
                overflow-y: auto;
                padding: 20px;
            }
            .mobile-menu-drawer.active {
                left: 0;
            }

            /* ë©”ë‰´ ë°±ë“œë¡­ */
            .mobile-menu-backdrop {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.5);
                z-index: 104;
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s;
            }
            .mobile-menu-backdrop.active {
                opacity: 1;
                pointer-events: all;
            }

            /* ë©”ë‰´ í•­ëª© */
            .mobile-menu-item {
                display: flex;
                align-items: center;
                padding: 12px 16px;
                margin-bottom: 8px;
                border-radius: 8px;
                cursor: pointer;
                transition: background 0.2s;
                font-size: 16px;
                font-weight: 500;
            }
            .mobile-menu-item:hover,
            .mobile-menu-item.active {
                background: rgba(59, 130, 246, 0.1);
                color: #3b82f6;
            }

            /* ë°ìŠ¤í¬íƒ‘ì—ì„œ í–„ë²„ê±° ë©”ë‰´ ìˆ¨ê¹€ */
            @media (min-width: 769px) {
                .mobile-menu-toggle {
                    display: none !important;
                }
                .mobile-menu-drawer,
                .mobile-menu-backdrop {
                    display: none !important;
                }
            }

            /* ========================================
               Agent Q06: ëª¨ë°”ì¼ í…Œì´ë¸” ì¹´ë“œë·°
               Phase 4 - Step 5: Q06-3 (HIGH)
               ======================================== */

            /* ëª¨ë°”ì¼ì—ì„œ í…Œì´ë¸” ìˆ¨ê¹€ */
            #dataTable {
                display: none;
            }

            /* ëª¨ë°”ì¼ ì¹´ë“œ ì»¨í…Œì´ë„ˆ í‘œì‹œ */
            #dataCardsContainer {
                display: block;
            }

            /* ê°œë³„ ì˜¤ë” ì¹´ë“œ ìŠ¤íƒ€ì¼ */
            .order-card {
                background: var(--bg-card);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                padding: 16px;
                margin-bottom: 12px;
                cursor: pointer;
                transition: all 0.2s;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            }
            .order-card:active {
                transform: scale(0.98);
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            }

            /* ì¹´ë“œ í—¤ë” (ê³µì¥ + POë²ˆí˜¸) */
            .order-card-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 12px;
                padding-bottom: 12px;
                border-bottom: 1px solid var(--border-color);
            }
            .order-card-factory {
                font-size: 18px;
                font-weight: 700;
                color: #3b82f6;
            }
            .order-card-po {
                font-size: 13px;
                color: var(--text-secondary);
                font-family: monospace;
            }

            /* ì¹´ë“œ ë©”ì¸ ì •ë³´ */
            .order-card-main {
                margin-bottom: 12px;
            }
            .order-card-model {
                font-size: 16px;
                font-weight: 600;
                color: var(--text-primary);
                margin-bottom: 4px;
            }
            .order-card-destination {
                font-size: 14px;
                color: var(--text-secondary);
                display: flex;
                align-items: center;
                gap: 4px;
            }

            /* ì¹´ë“œ ìˆ˜ëŸ‰/ë‚ ì§œ ê·¸ë¦¬ë“œ */
            .order-card-details {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
                margin-bottom: 12px;
            }
            .order-card-detail-item {
                display: flex;
                flex-direction: column;
            }
            .order-card-detail-label {
                font-size: 11px;
                color: var(--text-secondary);
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 2px;
            }
            .order-card-detail-value {
                font-size: 15px;
                font-weight: 600;
                color: var(--text-primary);
            }

            /* ì¹´ë“œ í•˜ë‹¨ ìƒíƒœ ë°” */
            .order-card-status {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding-top: 12px;
                border-top: 1px solid var(--border-color);
            }
            .order-card-progress {
                display: flex;
                gap: 6px;
                align-items: center;
            }
            .order-card-status-badge {
                padding: 4px 10px;
                border-radius: 12px;
                font-size: 13px;
                font-weight: 600;
            }

            /* ì¹´ë“œ ìƒíƒœë³„ ìŠ¤íƒ€ì¼ (í…Œì´ë¸”ê³¼ ë™ì¼) */
            .order-card.delayed {
                background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
                border-color: #f87171;
            }
            .dark .order-card.delayed {
                background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%);
                border-color: #dc2626;
            }
            .order-card.warning {
                background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
                border-color: #facc15;
            }
            .dark .order-card.warning {
                background: linear-gradient(135deg, #78350f 0%, #92400e 100%);
                border-color: #eab308;
            }
            .order-card.shipped {
                background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
                border-color: #34d399;
            }
            .dark .order-card.shipped {
                background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
                border-color: #10b981;
            }

            /* ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ */
            .cards-empty-state {
                text-align: center;
                padding: 60px 20px;
                color: var(--text-secondary);
            }
            .cards-empty-state svg {
                width: 80px;
                height: 80px;
                margin: 0 auto 16px;
                opacity: 0.3;
            }
        }

        /* ë°ìŠ¤í¬í†± (768px ì´ˆê³¼) */
        @media (min-width: 769px) {
            /* ë°ìŠ¤í¬í†±ì—ì„œ í…Œì´ë¸” í‘œì‹œ, ì¹´ë“œ ìˆ¨ê¹€ */
            #dataTable {
                display: table;
            }
            #dataCardsContainer {
                display: none;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!--
    Rachgia Factory í†µí•© ìƒì‚°ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ v17
    Phase 5 ì„±ëŠ¥ ìµœì í™” ë° ì¶”ê°€ ê°œì„  (2026-01-03)

    v17 ë³€ê²½ì‚¬í•­ (Phase 5-3 - Virtual Scrolling):

    âš¡ í•µì‹¬ ì„±ëŠ¥ ê°œì„ :
    1. [Phase 5-3] Virtual Scrolling - ë¬´í•œ ìŠ¤í¬ë¡¤ ìµœì í™”
       - Intersection Observer API í™œìš©
       - ì´ˆê¸° 100í–‰ë§Œ ë Œë”ë§, ìŠ¤í¬ë¡¤ ì‹œ 50í–‰ì”© ë™ì  ì¶”ê°€
       - DOM ë…¸ë“œ ìˆ˜ ìµœì†Œí™”ë¡œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëŒ€í­ ê°ì†Œ
       - 10,000+ í–‰ ë°ì´í„°ë„ ë¶€ë“œëŸ½ê²Œ ì²˜ë¦¬ ê°€ëŠ¥

    ê¸°ìˆ ì  ê°œì„ :
    - renderTableVirtually() í•¨ìˆ˜ ì¶”ê°€ (Intersection Observer ê¸°ë°˜)
    - ì„¼í‹°ë„¬(sentinel) ìš”ì†Œë¥¼ ì‚¬ìš©í•œ ë¬´í•œ ìŠ¤í¬ë¡¤
    - ì´ˆê¸° ë Œë”ë§: 100í–‰ (ë¹ ë¥¸ ì´ˆê¸° í‘œì‹œ)
    - ì¶”ê°€ ë Œë”ë§: 50í–‰ì”© (ìŠ¤í¬ë¡¤ ê°ì§€ ì‹œ)
    - ë©”ëª¨ë¦¬ ìµœì í™”: í™”ë©´ì— ë³´ì´ëŠ” ìš”ì†Œë§Œ ìœ ì§€

    ì˜ˆìƒ íš¨ê³¼:
    - ì´ˆê¸° ë Œë”ë§ ì‹œê°„: 80% ë‹¨ì¶• (ì „ì²´ ë Œë”ë§ â†’ 100í–‰ë§Œ)
    - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: 70% ê°ì†Œ (í•„ìš”í•œ DOMë§Œ ìœ ì§€)
    - ëŒ€ìš©ëŸ‰ ë°ì´í„° ì§€ì›: 10,000+ í–‰ë„ ë¶€ë“œëŸ½ê²Œ ì²˜ë¦¬
    - ìŠ¤í¬ë¡¤ ì„±ëŠ¥: 60fps ìœ ì§€ (requestAnimationFrame + Intersection Observer)

    ---

    v16 ë³€ê²½ì‚¬í•­ (Phase 5-2 - ë°ì´í„° ì™¸ë¶€í™”):
    - HTMLê³¼ ë°ì´í„° ì™„ì „ ë¶„ë¦¬ (rachgia_data_v8.js)
    - ìë™ ë°ì´í„° ë¡œë“œ ë° ì´ˆê¸°í™”
    - ì´ˆê¸° ë¡œë”© 60% ë‹¨ì¶•, ì¬ë°©ë¬¸ 10ë°°+ ë¹ ë¦„

    v15 ë³€ê²½ì‚¬í•­ (Phase 5-1 - ì ì§„ì  ë Œë”ë§):
    - requestAnimationFrame + DocumentFragmentë¡œ í…Œì´ë¸” ë Œë”ë§ 50% ë‹¨ì¶•
    - ëŒ€ìš©ëŸ‰ ë°ì´í„° (1000+ í–‰) ë¶€ë“œëŸ¬ìš´ ë Œë”ë§

    v14 ë³€ê²½ì‚¬í•­ (Phase 4 - ì‚¬ìš©ì ê°€ì¹˜ ê·¹ëŒ€í™”):
    - 25ê°œ ì£¼ìš” ê¸°ëŠ¥ êµ¬í˜„ (SettingsManager, CSV/PDF ë‚´ë³´ë‚´ê¸°, ë¸Œë¼ìš°ì € ì•Œë¦¼ ë“±)

    ë‹´ë‹¹ ì—ì´ì „íŠ¸: Q08 (Performance), Q10 (Table Master)
    -->
    <!-- Login Overlay - z-60ìœ¼ë¡œ uploadOverlay ìœ„ì— í‘œì‹œ -->
    <div id="loginOverlay" class="fixed inset-0 bg-gradient-to-br from-slate-900 via-gray-900 to-zinc-900 z-[60] flex items-center justify-center hidden">
        <div class="max-w-md w-full mx-4">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">ğŸ”</div>
                <h1 class="text-3xl font-bold text-white mb-2">Rachgia Dashboard</h1>
                <p class="text-gray-400">Authorized Access Only</p>
            </div>

            <form id="loginForm" class="bg-white/10 backdrop-blur-lg rounded-2xl p-8">
                <div class="mb-6">
                    <label for="username" class="block text-sm font-medium text-gray-300 mb-2">ì‚¬ìš©ì ID</label>
                    <input type="text" id="username" name="username" required autocomplete="username"
                        class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="ì•„ì´ë”” ì…ë ¥">
                </div>

                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-gray-300 mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="password" name="password" required autocomplete="current-password"
                        class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                </div>

                <div id="loginError" class="hidden mb-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-300 text-sm text-center">
                    ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </div>

                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl transition-colors">
                    ë¡œê·¸ì¸
                </button>

                <p class="mt-4 text-center text-gray-500 text-xs">
                    Â© 2024 Rachgia Factory. All rights reserved.
                </p>
            </form>
        </div>
    </div>

    <!-- File Upload Overlay -->
    <div id="uploadOverlay" class="fixed inset-0 bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900 z-50 flex items-center justify-center hidden">
        <div class="max-w-2xl w-full mx-4">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-white mb-2">ğŸ“Š Rachgia Dashboard</h1>
                <p class="text-blue-200">Factory Production Management System v9</p>
            </div>

            <!-- Upload Area -->
            <div id="dropZone" class="bg-white/10 backdrop-blur-lg border-2 border-dashed border-white/30 rounded-2xl p-12 text-center cursor-pointer hover:bg-white/20 hover:border-white/50 transition-all duration-300">
                <div id="uploadContent">
                    <div class="text-6xl mb-4">ğŸ“</div>
                    <h2 class="text-2xl font-bold text-white mb-2">BAL ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</h2>
                    <p class="text-blue-200 mb-6">íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</p>
                    <input type="file" id="fileInput" accept=".xlsx,.xls" multiple class="hidden">
                    <button data-action="clickElement" data-target-id="fileInput" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold px-8 py-3 rounded-xl transition-colors">
                        ğŸ“‚ íŒŒì¼ ì„ íƒ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)
                    </button>
                    <p class="text-blue-300/70 text-sm mt-4">ì§€ì› í˜•ì‹: .xlsx, .xls (BAL íŒŒì¼) - ì—¬ëŸ¬ íŒŒì¼ ë™ì‹œ ì—…ë¡œë“œ ê°€ëŠ¥</p>
                    <div id="fileList" class="mt-4 text-left max-h-32 overflow-y-auto hidden"></div>
                </div>

                <!-- Loading State -->
                <div id="uploadLoading" class="hidden">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-white">íŒŒì¼ íŒŒì‹± ì¤‘...</p>
                </div>
            </div>

            <!-- File Format Guide -->
            <div class="mt-8 bg-white/5 rounded-xl p-4 text-sm text-blue-200">
                <h3 class="font-semibold text-white mb-2">ğŸ“‹ ì§€ì› íŒŒì¼ í˜•ì‹</h3>
                <ul class="space-y-1 text-xs">
                    <li>â€¢ BAL ì—‘ì…€ íŒŒì¼ (.xlsx) - ê³µì¥ë³„ ìƒì‚°í˜„í™©</li>
                    <li>â€¢ í•„ìˆ˜ ì»¬ëŸ¼: PO#, ARTICLE, QTY, CRD, SDD, ê³µì •ë³„ ì‹¤ì </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Loading Overlay (for subsequent loads) -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white dark:bg-gray-900 bg-opacity-90 z-40 hidden items-center justify-center">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600 dark:text-gray-300">ë°ì´í„° ì²˜ë¦¬ ì¤‘...</p>
        </div>
    </div>

    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-lg no-print" role="banner" aria-label="Rachgia Factory ëŒ€ì‹œë³´ë“œ í—¤ë”">
        <div class="max-w-[2000px] mx-auto px-4 py-4">
            <div class="flex items-center justify-between flex-wrap gap-2">
                <div class="flex items-center gap-3">
                    <!-- Agent Q06: í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ (Phase 4 - Q06-5) -->
                    <button class="mobile-menu-toggle" data-action="toggleMobileMenu" aria-label="ë©”ë‰´ ì—´ê¸°" aria-expanded="false">
                        <div class="hamburger-icon" id="hamburgerIcon">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </button>
                    <div>
                        <h1 class="text-2xl font-bold" data-i18n="header.title">ğŸ­ Rachgia Factory í†µí•© ìƒì‚°ê´€ë¦¬ <span class="text-sm font-normal bg-white/20 px-2 py-1 rounded">v11</span></h1>
                        <p class="text-blue-100 text-sm mt-1" data-i18n="header.subtitle">Factory A, B, C, D ìƒì‚° í˜„í™© ëª¨ë‹ˆí„°ë§</p>
                    </div>
                </div>
                <div class="flex items-center gap-3 flex-wrap">
                    <!-- Date Mode Toggle (SDD/CRD) -->
                    <div class="date-mode-toggle">
                        <div class="date-mode-btn active" data-mode="sdd" data-action="setDateMode" data-param="sdd" role="button" aria-pressed="true">SDD</div>
                        <div class="date-mode-btn" data-mode="crd" data-action="setDateMode" data-param="crd" role="button" aria-pressed="false">CRD</div>
                    </div>
                    <!-- Date Range Filter -->
                    <div class="flex items-center gap-2 bg-white/10 px-3 py-1 rounded-lg">
                        <label class="text-sm" data-i18n="filters.quickDate">ê¸°ê°„:</label>
                        <select id="dateRangeFilter" class="bg-white/20 text-white border-none rounded px-2 py-1 text-sm cursor-pointer" onchange="applyDateRangeFilter()">
                            <option value="all" style="color: #000;" data-i18n="filters.all">ì „ì²´</option>
                            <option value="week" style="color: #000;" data-i18n="filters.week">1ì£¼ì¼ ì´ë‚´</option>
                            <option value="month" style="color: #000;" data-i18n="filters.month">1ë‹¬ ì´ë‚´</option>
                        </select>
                    </div>
                    <!-- Auto Refresh -->
                    <div class="flex items-center gap-2 bg-white/10 px-3 py-1 rounded-lg">
                        <label class="text-sm" data-i18n="settings.autoRefresh">ìë™ ìƒˆë¡œê³ ì¹¨</label>
                        <input type="checkbox" id="autoRefreshToggle" class="w-4 h-4" checked>
                    </div>
                    <!-- File Upload Button -->
                    <button data-action="showUploadOverlay" class="bg-white/20 hover:bg-white/30 px-3 py-1 rounded-lg text-sm flex items-center gap-1" data-i18n-title="common.import">
                        ğŸ“ <span class="hidden md:inline" data-i18n="common.import">íŒŒì¼ ë³€ê²½</span>
                    </button>
                    <!-- Logout Button -->
                    <button data-action="handleLogout" class="bg-red-500/50 hover:bg-red-500/70 px-3 py-1 rounded-lg text-sm flex items-center gap-1" data-i18n-title="common.close">
                        ğŸšª <span class="hidden md:inline" data-i18n="common.close">ë¡œê·¸ì•„ì›ƒ</span>
                    </button>
                    <!-- Help Button -->
                    <button data-action="toggleHelpModal" class="bg-white/20 hover:bg-white/30 px-3 py-1 rounded-lg text-sm" data-i18n-title="common.help">
                        â“
                    </button>
                    <!-- Agent Q09: Keyboard Shortcuts (Phase 4 - Q09-3) -->
                    <button data-action="openKeyboardShortcutsModal" class="bg-white/20 hover:bg-white/30 px-3 py-1 rounded-lg text-sm" data-i18n-title="keyboard.title">
                        âŒ¨ï¸
                    </button>
                    <!-- Dark Mode Toggle -->
                    <button data-action="toggleDarkMode" class="bg-white/20 hover:bg-white/30 px-3 py-1 rounded-lg text-sm" aria-pressed="false" data-i18n-aria="header.darkMode">
                        <span id="darkModeIcon">ğŸŒ™</span>
                    </button>
                    <!-- Agent Q04: Notification Toggle -->
                    <button data-action="toggleNotifications" class="bg-white/20 hover:bg-white/30 px-3 py-1 rounded-lg text-sm" data-i18n-title="notifications.enable" aria-pressed="false" data-i18n-aria="notifications.enable">
                        <span id="notificationIcon">ğŸ”•</span>
                    </button>
                    <!-- Agent Q04: Notification Settings (Phase 4 - Q04-5) -->
                    <button data-action="showNotificationSettings" class="bg-white/20 hover:bg-white/30 px-3 py-1 rounded-lg text-sm" data-i18n-title="notifications.settings" data-i18n-aria="notifications.settings">
                        âš™ï¸
                    </button>
                    <!-- Agent Q04: Notification History (Phase 4 - Q04-6) -->
                    <button data-action="showNotificationHistory" class="bg-white/20 hover:bg-white/30 px-3 py-1 rounded-lg text-sm relative" data-i18n-title="notifications.title" data-i18n-aria="notifications.title">
                        ğŸ“¬
                        <span id="unreadNotificationBadge" class="hidden absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
                    </button>
                    <!-- Agent Q05: Report History (Phase 4 - Q05-5) -->
                    <button data-action="showReportHistory" class="bg-white/20 hover:bg-white/30 px-3 py-1 rounded-lg text-sm" data-i18n-title="export.title" data-i18n-aria="export.title">
                        ğŸ“‹
                    </button>
                    <!-- Delay Alert -->
                    <div id="delayAlert" class="hidden bg-red-500 text-white px-4 py-2 rounded-lg animate-pulse cursor-pointer" data-action="showDelayedOrders">
                        âš ï¸ <span data-i18n="filters.delayed">ì§€ì—°</span>: <span id="delayCount">0</span><span data-i18n="summary.orders">ê±´</span>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-blue-100" data-i18n="header.lastUpdate">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</div>
                        <div class="font-semibold text-sm" id="lastUpdateTime" data-i18n="common.loading">ë¡œë”© ì¤‘...</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- ì›”ìš” ì˜¤ë” í˜„í™© ìš”ì•½ - ìƒë‹¨ ê³ ì • -->
    <div id="weeklyOrderSummary" class="sticky top-0 z-40 bg-gradient-to-r from-slate-800 to-slate-900 text-white shadow-lg no-print">
        <div class="max-w-[2000px] mx-auto px-4 py-3">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <h2 class="text-lg font-bold flex items-center gap-2">
                    ğŸ“‹ <span data-i18n="summary.title">ì›”ìš” ì˜¤ë” í˜„í™© ìš”ì•½</span>
                    <span class="text-xs font-normal bg-white/20 px-2 py-0.5 rounded" id="summaryUpdateTime">-</span>
                </h2>
                <div class="flex flex-wrap items-center gap-6 text-sm">
                    <!-- SDD ê¸°ì¤€ -->
                    <div class="flex items-center gap-4 bg-blue-500/20 px-4 py-2 rounded-lg">
                        <span class="font-semibold text-blue-300">ğŸ“… <span data-i18n="table.sdd">SDD</span> <span data-i18n="filters.title">ê¸°ì¤€</span></span>
                        <div class="flex items-center gap-1">
                            <span class="text-red-400">ğŸš¨ <span data-i18n="filters.delayed">ì§€ì—°</span>:</span>
                            <span id="sddDelayCount" class="font-bold text-red-300">-</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <span class="text-amber-400">âš¡ <span data-i18n="filters.warning">ê²½ê³ </span>:</span>
                            <span id="sddWarningCount" class="font-bold text-amber-300">-</span>
                        </div>
                    </div>
                    <!-- CRD ê¸°ì¤€ -->
                    <div class="flex items-center gap-4 bg-purple-500/20 px-4 py-2 rounded-lg">
                        <span class="font-semibold text-purple-300">ğŸ¯ <span data-i18n="table.crd">CRD</span> <span data-i18n="filters.title">ê¸°ì¤€</span></span>
                        <div class="flex items-center gap-1">
                            <span class="text-red-400">ğŸš¨ <span data-i18n="filters.delayed">ì§€ì—°</span>:</span>
                            <span id="crdDelayCount" class="font-bold text-red-300">-</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <span class="text-amber-400">âš¡ <span data-i18n="filters.warning">ê²½ê³ </span>:</span>
                            <span id="crdWarningCount" class="font-bold text-amber-300">-</span>
                        </div>
                    </div>
                    <!-- ìƒì‚°/ì¶œê³  í˜„í™© -->
                    <div class="flex items-center gap-4 bg-green-500/20 px-4 py-2 rounded-lg">
                        <div class="flex items-center gap-1">
                            <span class="text-green-300">ğŸ‘Ÿ <span data-i18n="processes.sew_bal">ì œí™” ìƒì‚°</span> <span data-i18n="status.completed">ì™„ë£Œ</span>:</span>
                            <span id="sewingCompleteCount" class="font-bold text-green-200">-</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <span class="text-cyan-300">ğŸ“¦ <span data-i18n="processes.wh_out">ì°½ê³  ì¶œê³ </span> <span data-i18n="status.completed">ì™„ë£Œ</span>:</span>
                            <span id="warehouseOutCount" class="font-bold text-cyan-200">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-[2000px] mx-auto px-4 py-6">
        <!-- Executive Summary -->
        <div id="execSummary" class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl shadow-lg p-6 mb-6 text-white">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">ğŸ¯ <span data-i18n="summary.title">Executive Summary</span></h2>
                <div class="text-sm opacity-80"><span data-i18n="filters.title">ê¸°ì¤€</span>: <span id="dateModeLabel">SDD</span></div>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                <div class="bg-white/10 rounded-lg p-4 text-center">
                    <div class="text-white/80 text-sm" data-i18n="summary.completionRate">ì „ì²´ ì™„ë£Œìœ¨</div>
                    <div class="exec-kpi" id="execCompletionRate">-</div>
                </div>
                <div class="bg-white/10 rounded-lg p-4 text-center">
                    <div class="text-white/80 text-sm" data-i18n="summary.delayedOrders">ì§€ì—° ìœ„í—˜</div>
                    <div class="exec-kpi text-red-300" id="execDelayCount">-</div>
                </div>
                <div class="bg-white/10 rounded-lg p-4 text-center">
                    <div class="text-white/80 text-sm" data-i18n="filters.today">ì˜¤ëŠ˜ ì˜ˆì •</div>
                    <div class="exec-kpi text-yellow-300" id="execTodayCount">-</div>
                    <div class="text-sm opacity-80" id="execTodayQty">-</div>
                </div>
                <div class="bg-white/10 rounded-lg p-4 text-center">
                    <div class="text-white/80 text-sm" data-i18n="processes.wh_in">ì°½ê³  ì¬ê³ </div>
                    <div class="exec-kpi text-blue-300" id="execInventory">-</div>
                    <div class="text-sm opacity-80" id="execInventoryOrders">-</div>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white/10 rounded-lg p-3">
                    <div class="text-sm font-medium mb-2">ğŸ“Š <span data-i18n="summary.factoryCompletion">ê³µì¥ ìˆœìœ„</span></div>
                    <div id="execFactoryRanking" class="text-sm"></div>
                </div>
                <div class="bg-white/10 rounded-lg p-3">
                    <div class="text-sm font-medium mb-2">âš ï¸ <span data-i18n="status.warning">ì£¼ìš” ê²½ê³ </span></div>
                    <div id="execWarnings" class="text-sm"></div>
                </div>
            </div>
        </div>

        <!-- Executive Insights - ê²½ì˜ì§„ í•µì‹¬ ì¸ì‚¬ì´íŠ¸ -->
        <div id="execInsights" class="bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 rounded-xl shadow-lg p-6 mb-6 text-white">
            <div class="flex justify-between items-center mb-5">
                <h2 class="text-xl font-bold flex items-center gap-2">
                    ğŸ“Š <span data-i18n="summary.title">ê²½ì˜ì§„ ì¸ì‚¬ì´íŠ¸</span>
                    <span class="text-xs bg-green-500 text-white px-2 py-0.5 rounded animate-pulse">LIVE</span>
                </h2>
                <div class="flex items-center gap-3">
                    <span class="text-sm opacity-70"><span data-i18n="filters.title">ê¸°ì¤€</span>: SDD/CRD</span>
                    <button data-action="toggleInsightsHelp" class="text-xs bg-white/10 hover:bg-white/20 px-2 py-1 rounded transition">â“ <span data-i18n="common.help">ë„ì›€ë§</span></button>
                </div>
            </div>

            <!-- Primary KPIs Row -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-5">
                <!-- OTD Rate -->
                <div class="bg-white/10 rounded-xl p-4 border-l-4 border-green-400 hover:bg-white/15 transition cursor-pointer" data-action="showOTDDetail">
                    <div class="text-sm opacity-70 mb-1 flex items-center gap-1">ğŸ¯ <span data-i18n="summary.onTimeRate">ì •ì‹œ ë‚©ê¸°ìœ¨ (OTD)</span></div>
                    <div class="flex items-end gap-2">
                        <span class="text-3xl font-bold" id="kpiOtdRate">-</span>
                    </div>
                    <div class="text-xs opacity-60 mt-1"><span data-i18n="filters.title">ëª©í‘œ</span>: 95% | <span id="kpiOtdOrders">-</span></div>
                </div>

                <!-- Revenue at Risk -->
                <div class="bg-white/10 rounded-xl p-4 border-l-4 border-red-400 hover:bg-white/15 transition cursor-pointer" data-action="showRevenueRiskDetail">
                    <div class="text-sm opacity-70 mb-1 flex items-center gap-1">ğŸ’° <span data-i18n="summary.delayedOrders">ìœ„í—˜ ë§¤ì¶œì•¡</span></div>
                    <div class="text-3xl font-bold text-red-300" id="kpiRevenueRisk">-</div>
                    <div class="text-xs opacity-60 mt-1" id="kpiRiskOrders">-</div>
                </div>

                <!-- AQL Pass Rate -->
                <div class="bg-white/10 rounded-xl p-4 border-l-4 border-blue-400 hover:bg-white/15 transition cursor-pointer" data-action="showAQLDetail">
                    <div class="text-sm opacity-70 mb-1 flex items-center gap-1">âœ… <span data-i18n="summary.completionRate">í’ˆì§ˆ ê²€ì‚¬ í•©ê²©ë¥ </span></div>
                    <div class="text-3xl font-bold" id="kpiAqlRate">-</div>
                    <div class="text-xs opacity-60 mt-1" id="kpiAqlCount">-</div>
                </div>

                <!-- Bottleneck Prediction -->
                <div class="bg-white/10 rounded-xl p-4 border-l-4 border-amber-400 hover:bg-white/15 transition cursor-pointer" data-action="showBottleneckDetail">
                    <div class="text-sm opacity-70 mb-1 flex items-center gap-1">âš ï¸ <span data-i18n="processes.s_cut">ì˜ˆì¸¡ ë³‘ëª© ê³µì •</span></div>
                    <div class="text-2xl font-bold text-amber-300" id="kpiBottleneckStage">-</div>
                    <div class="text-xs text-amber-400 mt-1" id="kpiBottleneckRisk">-</div>
                </div>
            </div>

            <!-- Analysis Charts Row -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Delay Severity Distribution -->
                <div class="bg-white/5 rounded-lg p-4">
                    <h4 class="text-sm font-medium mb-3 flex items-center gap-2">ğŸ“‰ <span data-i18n="filters.delayed">ì§€ì—° ì‹¬ê°ë„ ë¶„í¬</span></h4>
                    <div class="h-32"><canvas id="delaySeverityChart"></canvas></div>
                    <div class="flex justify-around text-xs mt-3 pt-2 border-t border-white/10">
                        <div class="text-center">
                            <div class="text-green-400 font-medium" id="delayMild">-</div>
                            <div class="text-green-400/70"><span data-i18n="heatmap.low">ê²½ë¯¸</span>(1-3ì¼)</div>
                        </div>
                        <div class="text-center">
                            <div class="text-amber-400 font-medium" id="delayModerate">-</div>
                            <div class="text-amber-400/70"><span data-i18n="filters.warning">ì£¼ì˜</span>(4-7ì¼)</div>
                        </div>
                        <div class="text-center">
                            <div class="text-red-400 font-medium" id="delaySevere">-</div>
                            <div class="text-red-400/70"><span data-i18n="heatmap.high">ì‹¬ê°</span>(7ì¼+)</div>
                        </div>
                    </div>
                </div>

                <!-- Root Cause Analysis -->
                <div class="bg-white/5 rounded-lg p-4">
                    <h4 class="text-sm font-medium mb-3 flex items-center gap-2">ğŸ” <span data-i18n="filters.delayed">ì§€ì—° ì›ì¸ ë¶„ì„</span></h4>
                    <div class="h-32"><canvas id="rootCauseChart"></canvas></div>
                    <div class="text-xs mt-3 pt-2 border-t border-white/10">
                        <span data-i18n="filters.title">ì£¼ìš” ì›ì¸</span>: <span id="primaryRootCause" class="text-red-300 font-medium">-</span>
                        <span class="opacity-60">(<span id="primaryRootCauseCount">-</span><span data-i18n="summary.orders">ê±´</span>)</span>
                    </div>
                </div>

                <!-- Vendor Performance -->
                <div class="bg-white/5 rounded-lg p-4">
                    <h4 class="text-sm font-medium mb-3 flex items-center gap-2">ğŸ­ <span data-i18n="filters.vendor">ë²¤ë” ì„±ê³¼</span> TOP 5</h4>
                    <div id="vendorPerformanceList" class="space-y-2 text-sm"></div>
                </div>
            </div>
        </div>

        <!-- Alert Cards -->
        <div id="alertSection" class="hidden mb-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="delay-highlight rounded-xl shadow-sm p-4 cursor-pointer" data-action="showDelayedOrders">
                    <div class="flex items-center gap-3">
                        <span class="text-3xl">ğŸš¨</span>
                        <div>
                            <div class="text-red-700 dark:text-red-300 text-sm font-medium" data-i18n="summary.delayedOrders">ì§€ì—° ì˜¤ë”</div>
                            <div class="text-2xl font-bold text-red-800 dark:text-red-200" id="delayedOrderCount">0<span data-i18n="summary.orders">ê±´</span></div>
                            <div class="text-xs text-red-600 dark:text-red-400" id="delayedOrderQty">0<span data-i18n="summary.pairs">ì¡±</span></div>
                        </div>
                    </div>
                </div>
                <div class="warning-highlight rounded-xl shadow-sm p-4 cursor-pointer" data-action="showWarningOrders">
                    <div class="flex items-center gap-3">
                        <span class="text-3xl">âš¡</span>
                        <div>
                            <div class="text-amber-700 dark:text-amber-300 text-sm font-medium" data-i18n="summary.warningOrders">3ì¼ ë‚´ ì˜ˆì •</div>
                            <div class="text-2xl font-bold text-amber-800 dark:text-amber-200" id="warningOrderCount">0<span data-i18n="summary.orders">ê±´</span></div>
                            <div class="text-xs text-amber-600 dark:text-amber-400" id="warningOrderQty">0<span data-i18n="summary.pairs">ì¡±</span></div>
                        </div>
                    </div>
                </div>
                <div class="bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-400 rounded-xl shadow-sm p-4 cursor-pointer" data-action="showInventoryOrders">
                    <div class="flex items-center gap-3">
                        <span class="text-3xl">ğŸ“¦</span>
                        <div>
                            <div class="text-blue-700 dark:text-blue-300 text-sm font-medium" data-i18n="processes.wh_in">ì°½ê³  ì¬ê³ </div>
                            <div class="text-2xl font-bold text-blue-800 dark:text-blue-200" id="inventoryCount">0<span data-i18n="summary.pairs">ì¡±</span></div>
                            <div class="text-xs text-blue-600 dark:text-blue-400" id="inventoryOrders">0<span data-i18n="summary.orders">ê±´</span></div>
                        </div>
                    </div>
                </div>
                <div class="shipped-highlight rounded-xl shadow-sm p-4 cursor-pointer" data-action="showShippedOrders">
                    <div class="flex items-center gap-3">
                        <span class="text-3xl">ğŸš¢</span>
                        <div>
                            <div class="text-emerald-700 dark:text-emerald-300 text-sm font-medium" data-i18n="processes.wh_out">ì„ ì  ì™„ë£Œ</div>
                            <div class="text-2xl font-bold text-emerald-800 dark:text-emerald-200" id="shippedOrderCount">0<span data-i18n="summary.orders">ê±´</span></div>
                            <div class="text-xs text-emerald-600 dark:text-emerald-400" id="shippedOrderQty">0<span data-i18n="summary.pairs">ì¡±</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë‹´ë‹¹ì ê¶Œê³ ì‚¬í•­ (Action Recommendations) -->
        <div id="actionRecommendations" class="bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 rounded-xl shadow-lg p-6 mb-6 border-l-4 border-orange-500">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-bold flex items-center gap-2 text-orange-800 dark:text-orange-200">
                    ğŸ“‹ <span data-i18n="modal.orderDetails">ë‹´ë‹¹ì ê¶Œê³ ì‚¬í•­</span>
                    <span class="text-xs bg-orange-500 text-white px-2 py-0.5 rounded"><span data-i18n="summary.title">AI ë¶„ì„</span></span>
                </h2>
                <div class="text-sm text-orange-600 dark:text-orange-400" id="recommendationTime">-</div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- ê³„íš ë‹´ë‹¹ì ê¶Œê³  -->
                <div class="bg-white/80 dark:bg-gray-800/80 rounded-lg p-4">
                    <h3 class="font-bold text-blue-700 dark:text-blue-300 mb-3 flex items-center gap-2">
                        ğŸ“… <span data-i18n="table.factory">ê³„íš ë‹´ë‹¹ì</span>
                        <span class="text-xs font-normal text-gray-500"><span data-i18n="summary.processFlow">ìƒì‚°ê³„íš ìµœì í™”</span></span>
                    </h3>
                    <div id="planningRecommendations" class="space-y-2 text-sm">
                        <div class="text-gray-400" data-i18n="common.loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                    </div>
                </div>

                <!-- í’ˆì§ˆ ë‹´ë‹¹ì ê¶Œê³  -->
                <div class="bg-white/80 dark:bg-gray-800/80 rounded-lg p-4">
                    <h3 class="font-bold text-green-700 dark:text-green-300 mb-3 flex items-center gap-2">
                        âœ… <span data-i18n="summary.completionRate">í’ˆì§ˆ ë‹´ë‹¹ì</span>
                        <span class="text-xs font-normal text-gray-500"><span data-i18n="summary.completedQuantity">í’ˆì§ˆ ë¦¬ìŠ¤í¬ ê´€ë¦¬</span></span>
                    </h3>
                    <div id="qualityRecommendations" class="space-y-2 text-sm">
                        <div class="text-gray-400" data-i18n="common.loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                    </div>
                </div>
            </div>

            <!-- ë¦¬ìŠ¤í¬ ìŠ¤ì½”ì–´ -->
            <div class="mt-4 pt-4 border-t border-orange-200 dark:border-orange-700">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="text-sm text-gray-600 dark:text-gray-400" data-i18n="summary.totalQuantity">ì¢…í•© ë¦¬ìŠ¤í¬ ì ìˆ˜</div>
                        <div id="riskScore" class="text-2xl font-bold text-orange-600">-</div>
                        <div id="riskLevel" class="text-xs px-2 py-1 rounded">-</div>
                    </div>
                    <div id="riskBreakdown" class="text-xs text-gray-500 dark:text-gray-400"></div>
                </div>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-card rounded-xl shadow-sm p-4 card-hover border-l-4 border-blue-500">
                <div class="text-secondary text-sm" data-i18n="summary.totalOrders">ì´ ì˜¤ë” ê±´ìˆ˜</div>
                <div class="text-2xl font-bold" id="totalOrders">-</div>
            </div>
            <div class="bg-card rounded-xl shadow-sm p-4 card-hover border-l-4 border-indigo-500">
                <div class="text-secondary text-sm" data-i18n="summary.totalQuantity">ì´ ì£¼ë¬¸ ìˆ˜ëŸ‰</div>
                <div class="text-2xl font-bold" id="totalQty">-</div>
            </div>
            <div class="bg-card rounded-xl shadow-sm p-4 card-hover border-l-4 border-green-500">
                <div class="text-secondary text-sm" data-i18n="summary.completedOrders">ì°½ê³ ì…ê³  ì™„ë£Œ</div>
                <div class="text-2xl font-bold text-green-600" id="totalCompleted">-</div>
            </div>
            <div class="bg-card rounded-xl shadow-sm p-4 card-hover border-l-4 border-purple-500">
                <div class="flex justify-between items-center">
                    <div>
                        <div class="text-secondary text-sm" data-i18n="summary.completionRate">ì „ì²´ ì™„ë£Œìœ¨</div>
                        <div class="text-2xl font-bold text-purple-600" id="totalRate">-</div>
                    </div>
                    <div class="w-16 h-16"><canvas id="rateDonut"></canvas></div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- Production Flow -->
            <div class="lg:col-span-2 bg-card rounded-xl shadow-sm p-6">
                <h3 class="text-lg font-semibold mb-4">âš™ï¸ <span data-i18n="summary.processFlow">ê³µì •ë³„ ìƒì‚° í˜„í™©</span> <span class="text-sm font-normal text-secondary">(ğŸ”´ = <span data-i18n="processes.s_cut">ë³‘ëª©ê³µì •</span>)</span></h3>
                <div id="funnelChart" class="grid grid-cols-8 gap-1 mb-4"></div>
                <div id="processProgress" class="space-y-3"></div>
            </div>
            <div class="bg-card rounded-xl shadow-sm p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ­ <span data-i18n="summary.factoryCompletion">ê³µì¥ë³„ ì™„ë£Œìœ¨</span></h3>
                <div id="factoryCards" class="space-y-3"></div>
                <div class="mt-4 pt-4 border-t border-theme">
                    <h4 class="text-sm font-medium text-secondary mb-2" data-i18n="filters.factory">ê³µì¥ ë¹„êµ</h4>
                    <div style="height: 200px;"><canvas id="factoryRadar"></canvas></div>
                </div>
            </div>
        </div>

        <!-- Shipping Calendar -->
        <div class="bg-card rounded-xl shadow-sm p-6 mb-6">
            <h3 class="text-lg font-semibold mb-4">ğŸ“… <span data-i18n="filters.title">ì˜ˆì • ìº˜ë¦°ë”</span> <span class="text-sm font-normal text-secondary" id="calendarLabel">(<span data-i18n="table.sdd">SDD</span> <span data-i18n="filters.title">ê¸°ì¤€</span>)</span></h3>
            <div class="flex justify-between items-center mb-4">
                <button data-action="prevMonth" class="px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600">â—€ <span data-i18n="table.prev">ì´ì „</span></button>
                <span id="calendarMonth" class="font-semibold text-lg"></span>
                <button data-action="nextMonth" class="px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600"><span data-i18n="table.next">ë‹¤ìŒ</span> â–¶</button>
            </div>
            <div id="shippingCalendar" class="grid grid-cols-7 gap-2"></div>
            <div class="flex gap-4 mt-4 text-sm">
                <span><span class="inline-block w-3 h-3 bg-red-300 rounded mr-1"></span><span data-i18n="status.delayed">ì§€ì—°</span></span>
                <span><span class="inline-block w-3 h-3 bg-amber-200 rounded mr-1"></span><span data-i18n="summary.warningOrders">3ì¼ ì´ë‚´</span></span>
                <span><span class="inline-block w-3 h-3 bg-green-200 rounded mr-1"></span><span data-i18n="status.onTime">ì •ìƒ</span></span>
            </div>
        </div>

        <!-- Outsole Vendor Section -->
        <div class="bg-card rounded-xl shadow-sm p-6 mb-6">
            <h3 class="text-lg font-semibold mb-4">ğŸ‘Ÿ <span data-i18n="filters.vendor">ì•„ì›ƒì†” ë²¤ë”ë³„ í˜„í™©</span></h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div><div class="chart-container"><canvas id="vendorChart"></canvas></div></div>
                <div>
                    <div class="overflow-x-auto max-h-[300px]">
                        <table class="w-full text-sm" id="vendorTable">
                            <caption class="sr-only" data-i18n="filters.vendor">ì•„ì›ƒì†” ë²¤ë”ë³„ ì˜¤ë” í˜„í™© ìš”ì•½ í…Œì´ë¸”</caption>
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-3 py-2 text-left sort-header" data-sort="vendor" data-table="vendor"><span data-i18n="filters.vendor">ì•„ì›ƒì†” ë²¤ë”</span></th>
                                    <th class="px-3 py-2 text-right sort-header" data-sort="count" data-table="vendor"><span data-i18n="summary.orders">ì˜¤ë”</span></th>
                                    <th class="px-3 py-2 text-right sort-header" data-sort="qty" data-table="vendor"><span data-i18n="table.quantity">ìˆ˜ëŸ‰</span></th>
                                    <th class="px-3 py-2 text-right sort-header" data-sort="rate" data-table="vendor"><span data-i18n="summary.completionRate">ì™„ë£Œìœ¨</span></th>
                                </tr>
                            </thead>
                            <tbody id="vendorTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Important Destinations -->
        <div class="bg-card rounded-xl shadow-sm p-6 mb-6">
            <h3 class="text-lg font-semibold mb-4">ğŸ¯ <span data-i18n="filters.importantDestinations">ì¤‘ìš” í–‰ì„ ì§€</span></h3>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4" id="asiaCards"></div>
        </div>

        <!-- Filters (Desktop) -->
        <div class="filter-panel-desktop bg-card rounded-xl shadow-sm p-4 mb-6 no-print" role="search" aria-label="í•„í„° ì˜µì…˜">
            <div class="flex justify-between items-center mb-3">
                <h4 class="font-medium">ğŸ” <span data-i18n="filters.title">í•„í„°</span> <span class="kbd ml-2">F</span></h4>
                <div class="flex gap-2">
                    <button data-action="showFilterPresets" class="text-sm bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg transition">
                        ğŸ“‹ <span data-i18n="filters.title">í”„ë¦¬ì…‹</span>
                    </button>
                    <button data-action="saveCurrentFilterAsPreset" class="text-sm bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg transition">
                        ğŸ’¾ <span data-i18n="common.save">ì €ì¥</span>
                    </button>
                    <button data-action="resetAllFilters" class="text-sm bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-1 rounded-lg transition">
                        â†º <span data-i18n="filters.reset">ì´ˆê¸°í™”</span> <span class="kbd">R</span>
                    </button>
                </div>
            </div>
            <div class="flex flex-wrap items-center gap-4">
                <div class="flex-1 min-w-[120px]">
                    <label class="block text-sm font-medium mb-1" id="monthFilterLabel"><span data-i18n="filters.month">ì›”</span> (SDD)</label>
                    <select id="monthFilter" class="w-full border border-theme rounded-lg px-3 py-2 bg-card" onchange="onMonthFilterChange()"><option value="" data-i18n="common.all">ì „ì²´</option></select>
                </div>
                <div class="flex-1 min-w-[280px]">
                    <label class="block text-sm font-medium mb-1" id="dateRangeLabel">ğŸ“… <span data-i18n="filters.title">ë‚ ì§œ ë²”ìœ„</span> (SDD)</label>
                    <div class="flex items-center gap-2">
                        <input type="date" id="startDateFilter" class="flex-1 border border-theme rounded-lg px-2 py-2 bg-card text-sm" onchange="onDateRangeChange()">
                        <span class="text-secondary">~</span>
                        <input type="date" id="endDateFilter" class="flex-1 border border-theme rounded-lg px-2 py-2 bg-card text-sm" onchange="onDateRangeChange()">
                        <button data-action="clearDateRange" class="text-sm bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-2 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center" title="ë‚ ì§œ ì´ˆê¸°í™”" aria-label="ë‚ ì§œ ë²”ìœ„ ì´ˆê¸°í™”">âœ•</button>
                    </div>
                </div>
                <div class="flex-1 min-w-[120px]">
                    <label class="block text-sm font-medium mb-1" data-i18n="filters.quickDate">ë¹ ë¥¸ ì„ íƒ</label>
                    <select id="quickDateFilter" class="w-full border border-theme rounded-lg px-3 py-2 bg-card">
                        <option value="" data-i18n="common.all">ì „ì²´ ê¸°ê°„</option>
                        <option value="today" data-i18n="filters.today">ì˜¤ëŠ˜</option>
                        <option value="week" data-i18n="filters.week">ì´ë²ˆ ì£¼</option>
                        <option value="month" data-i18n="filters.month">ì´ë²ˆ ë‹¬</option>
                        <option value="delayed" data-i18n="filters.delayed">ì§€ì—°ë§Œ</option>
                        <option value="warning" data-i18n="filters.warning">3ì¼ ì´ë‚´</option>
                    </select>
                </div>
                <div class="flex-1 min-w-[120px]">
                    <label class="block text-sm font-medium mb-1" data-i18n="filters.destination">í–‰ì„ ì§€</label>
                    <select id="destFilter" class="w-full border border-theme rounded-lg px-3 py-2 bg-card">
                        <option value="" data-i18n="common.all">ì „ì²´</option>
                        <option value="asia" data-i18n="filters.importantDestinations">ì¤‘ìš” í–‰ì„ ì§€ë§Œ</option>
                    </select>
                </div>
                <div class="flex-1 min-w-[120px]">
                    <label class="block text-sm font-medium mb-1" data-i18n="filters.vendor">ì•„ì›ƒì†” ë²¤ë”</label>
                    <select id="vendorFilter" class="w-full border border-theme rounded-lg px-3 py-2 bg-card"><option value="" data-i18n="common.all">ì „ì²´</option></select>
                </div>
                <div class="flex-1 min-w-[120px]">
                    <label class="block text-sm font-medium mb-1" data-i18n="filters.status">ì™„ë£Œ ìƒíƒœ</label>
                    <select id="statusFilter" class="w-full border border-theme rounded-lg px-3 py-2 bg-card">
                        <option value="" data-i18n="common.all">ì „ì²´</option>
                        <option value="shipped">ğŸš¢ <span data-i18n="status.completed">ì„ ì  ì™„ë£Œ</span></option>
                        <option value="completed" data-i18n="status.completed">ì™„ë£Œ</option>
                        <option value="partial" data-i18n="status.partial">ì§„í–‰ ì¤‘</option>
                        <option value="pending" data-i18n="status.pending">ë¯¸ì‹œì‘</option>
                    </select>
                </div>
                <div class="flex-1 min-w-[180px]">
                    <label class="block text-sm font-medium mb-1" data-i18n="filters.factory">ê³µì¥</label>
                    <div id="factoryFilter" class="flex flex-wrap gap-1" role="group" aria-label="ê³µì¥ í•„í„°">
                        <span class="filter-chip active" data-factory="" role="button" tabindex="0" aria-pressed="true" aria-label="ì „ì²´ ê³µì¥ ì„ íƒ"><span data-i18n="common.all">ì „ì²´</span></span>
                        <span class="filter-chip" data-factory="A" role="button" tabindex="0" aria-pressed="false" aria-label="ê³µì¥ A ì„ íƒ">A</span>
                        <span class="filter-chip" data-factory="B" role="button" tabindex="0" aria-pressed="false" aria-label="ê³µì¥ B ì„ íƒ">B</span>
                        <span class="filter-chip" data-factory="C" role="button" tabindex="0" aria-pressed="false" aria-label="ê³µì¥ C ì„ íƒ">C</span>
                        <span class="filter-chip" data-factory="D" role="button" tabindex="0" aria-pressed="false" aria-label="ê³µì¥ D ì„ íƒ">D</span>
                    </div>
                </div>
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-sm font-medium mb-1">ğŸ“Š <span data-i18n="table.quantity">ìˆ˜ëŸ‰</span> <span data-i18n="filters.title">ë²”ìœ„</span></label>
                    <div class="flex items-center gap-2">
                        <input type="number" id="minQuantityFilter" placeholder="ìµœì†Œ" min="0" class="flex-1 border border-theme rounded-lg px-3 py-2 bg-card" onchange="applyFilters()" aria-label="ìµœì†Œ ìˆ˜ëŸ‰">
                        <span class="text-secondary">~</span>
                        <input type="number" id="maxQuantityFilter" placeholder="ìµœëŒ€" min="0" class="flex-1 border border-theme rounded-lg px-3 py-2 bg-card" onchange="applyFilters()" aria-label="ìµœëŒ€ ìˆ˜ëŸ‰">
                        <button data-action="clearQuantityRange" class="text-sm bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-2 rounded-lg min-w-[44px] min-h-[44px] flex items-center justify-center" title="ìˆ˜ëŸ‰ ì´ˆê¸°í™”" aria-label="ìˆ˜ëŸ‰ ë²”ìœ„ ì´ˆê¸°í™”">âœ•</button>
                    </div>
                </div>
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-sm font-medium mb-1"><span data-i18n="filters.search">í†µí•© ê²€ìƒ‰</span> <span class="kbd">S</span></label>
                    <input type="text" id="searchInput" data-i18n="filters.search" placeholder="ëª¨ë¸, PO, í–‰ì„ ì§€, ë²¤ë”..." data-i18n-aria="filters.search" aria-label="ì˜¤ë” í†µí•© ê²€ìƒ‰" class="w-full border border-theme rounded-lg px-3 py-2 bg-card">
                </div>
            </div>

            <!-- Agent Q02: í•„í„° ë¡œì§ ì œì–´ (Phase 4 - Q02-2) -->
            <div class="mt-4 flex items-center justify-between border-t border-theme pt-4">
                <div class="text-sm text-secondary">
                    <span class="font-medium"><span data-i18n="filters.title">í•„í„°</span> ì¡°ê±´ ê²°í•©:</span>
                    <span class="ml-2">ì—¬ëŸ¬ í•„í„°ë¥¼ ì–´ë–»ê²Œ ì ìš©í• ì§€ ì„ íƒí•˜ì„¸ìš”</span>
                </div>
                <div class="flex items-center gap-2" role="radiogroup" aria-label="í•„í„° ë¡œì§ ì„ íƒ">
                    <button id="filterLogicAND" data-action="setFilterLogic" data-param="AND"
                        class="filter-logic-btn filter-logic-active px-4 py-2 rounded-lg font-medium text-sm transition-all"
                        role="radio" aria-checked="true" tabindex="0">
                        âš¡ AND (ëª¨ë‘ ì¶©ì¡±)
                    </button>
                    <button id="filterLogicOR" data-action="setFilterLogic" data-param="OR"
                        class="filter-logic-btn px-4 py-2 rounded-lg font-medium text-sm transition-all"
                        role="radio" aria-checked="false" tabindex="-1">
                        ğŸ”€ OR (í•˜ë‚˜ ì´ìƒ ì¶©ì¡±)
                    </button>
                </div>
            </div>
        </div>

        <!-- Agent Q06: Mobile Filter Panel (Bottom Sheet) -->
        <div id="mobileFilterPanel" class="filter-panel-mobile">
            <div class="sticky top-0 bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-4 flex justify-between items-center z-10">
                <h3 class="text-lg font-semibold">ğŸ” <span data-i18n="filters.title">í•„í„°</span></h3>
                <button data-action="closeMobileFilters" class="text-2xl" data-i18n-aria="common.close" aria-label="í•„í„° ë‹«ê¸°">Ã—</button>
            </div>
            <div class="p-4 space-y-4" id="mobileFilterContent">
                <!-- í•„í„° ë‚´ìš©ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
            <div class="sticky bottom-0 bg-card p-4 border-t border-theme flex gap-2">
                <button data-action="applyMobileFilters" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-medium">
                    âœ“ <span data-i18n="filters.apply">ì ìš©</span>
                </button>
                <button data-action="resetAndCloseMobileFilters" class="flex-1 bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-white px-4 py-3 rounded-lg font-medium">
                    â†º <span data-i18n="filters.reset">ì´ˆê¸°í™”</span>
                </button>
            </div>
        </div>

        <!-- Agent Q03: ì»¬ëŸ¼ ì„¤ì • ëª¨ë‹¬ (Phase 4 - Q03-5) -->
        <div id="columnSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" role="dialog" aria-labelledby="columnSettingsTitle" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="columnSettingsTitle" class="text-lg font-semibold">âš™ï¸ <span data-i18n="settings.title">ì»¬ëŸ¼ í‘œì‹œ/ìˆ¨ê¹€ ì„¤ì •</span></h3>
                    <button data-action="closeColumnSettings" class="text-2xl text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" data-i18n-aria="common.close" aria-label="ëª¨ë‹¬ ë‹«ê¸°">Ã—</button>
                </div>
                <div class="space-y-2 mb-4">
                    <label class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                        <input type="checkbox" id="col_factory" checked onchange="toggleColumnPreview('factory')">
                        <span data-i18n="table.factory">ê³µì¥</span>
                    </label>
                    <label class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                        <input type="checkbox" id="col_poNumber" checked onchange="toggleColumnPreview('poNumber')">
                        <span data-i18n="table.poNumber">POë²ˆí˜¸</span>
                    </label>
                    <label class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                        <input type="checkbox" id="col_model" checked onchange="toggleColumnPreview('model')">
                        <span data-i18n="table.model">ëª¨ë¸</span>
                    </label>
                    <label class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                        <input type="checkbox" id="col_article" checked onchange="toggleColumnPreview('article')">
                        <span>Article</span>
                    </label>
                    <label class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                        <input type="checkbox" id="col_destination" checked onchange="toggleColumnPreview('destination')">
                        <span data-i18n="table.destination">í–‰ì„ ì§€</span>
                    </label>
                    <label class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                        <input type="checkbox" id="col_outsoleVendor" checked onchange="toggleColumnPreview('outsoleVendor')">
                        <span data-i18n="filters.vendor">ì•„ì›ƒì†” ë²¤ë”</span>
                    </label>
                    <label class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                        <input type="checkbox" id="col_quantity" checked onchange="toggleColumnPreview('quantity')">
                        <span data-i18n="table.quantity">ìˆ˜ëŸ‰</span>
                    </label>
                    <label class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                        <input type="checkbox" id="col_cutting" checked onchange="toggleColumnPreview('cutting')">
                        <span data-i18n="processes.s_cut">ì¬ë‹¨</span>
                    </label>
                    <label class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                        <input type="checkbox" id="col_sewing" checked onchange="toggleColumnPreview('sewing')">
                        <span data-i18n="processes.sew_bal">ì¬ë´‰</span>
                    </label>
                    <label class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                        <input type="checkbox" id="col_assembly" checked onchange="toggleColumnPreview('assembly')">
                        <span data-i18n="processes.ass">ì¡°ë¦½</span>
                    </label>
                    <label class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                        <input type="checkbox" id="col_warehouseIn" checked onchange="toggleColumnPreview('warehouseIn')">
                        <span data-i18n="processes.wh_in">ì…ê³ </span>
                    </label>
                    <label class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                        <input type="checkbox" id="col_crd" checked onchange="toggleColumnPreview('crd')">
                        <span data-i18n="table.crd">CRD</span>
                    </label>
                    <label class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                        <input type="checkbox" id="col_sdd" checked onchange="toggleColumnPreview('sdd')">
                        <span data-i18n="table.sdd">SDD</span>
                    </label>
                    <label class="flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                        <input type="checkbox" id="col_status" checked onchange="toggleColumnPreview('status')">
                        <span data-i18n="filters.status">ìƒíƒœ</span>
                    </label>
                </div>
                <div class="flex gap-2">
                    <button data-action="saveColumnSettings" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                        âœ“ <span data-i18n="common.save">ì €ì¥</span>
                    </button>
                    <button data-action="closeColumnSettings" class="flex-1 bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-white px-4 py-2 rounded-lg font-medium">
                        <span data-i18n="common.cancel">ì·¨ì†Œ</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Agent Q04: ì•Œë¦¼ ì„¤ì • ëª¨ë‹¬ (Phase 4 - Q04-5) -->
        <div id="notificationSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" role="dialog" aria-labelledby="notificationSettingsTitle" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="notificationSettingsTitle" class="text-lg font-semibold">ğŸ”” <span data-i18n="notifications.settings">ì•Œë¦¼ ì„¤ì •</span></h3>
                    <button data-action="closeNotificationSettings" class="text-2xl text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" data-i18n-aria="common.close" aria-label="ëª¨ë‹¬ ë‹«ê¸°">Ã—</button>
                </div>

                <div class="space-y-4">
                    <!-- ì•Œë¦¼ í™œì„±í™” -->
                    <div class="border-b border-gray-200 dark:border-gray-700 pb-4">
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="notif_enabled" class="w-5 h-5" onchange="updateNotificationPreview()">
                            <div>
                                <div class="font-medium" data-i18n="notifications.enableNotifications">ë¸Œë¼ìš°ì € ì•Œë¦¼ í™œì„±í™”</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">ì§€ì—°/ê²½ê³  ì˜¤ë” ë°œìƒ ì‹œ ì•Œë¦¼ í‘œì‹œ</div>
                            </div>
                        </label>
                    </div>

                    <!-- ì•Œë¦¼ ìœ í˜• -->
                    <div class="border-b border-gray-200 dark:border-gray-700 pb-4">
                        <div class="font-medium mb-3">ì•Œë¦¼ ìœ í˜•</div>
                        <div class="space-y-2 ml-4">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="notif_delayed" checked class="w-4 h-4" onchange="updateNotificationPreview()">
                                <span class="text-sm">ğŸš¨ ì§€ì—° ì˜¤ë” (SDD > CRD)</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="notif_warning" class="w-4 h-4" onchange="updateNotificationPreview()">
                                <span class="text-sm">âš¡ ê²½ê³  ì˜¤ë” (7ì¼ ì´ë‚´)</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="notif_critical" class="w-4 h-4" onchange="updateNotificationPreview()">
                                <span class="text-sm">ğŸ”¥ ê¸´ê¸‰ ì˜¤ë” (3ì¼ ì´ë‚´)</span>
                            </label>
                        </div>
                    </div>

                    <!-- ì²´í¬ ì£¼ê¸° -->
                    <div class="border-b border-gray-200 dark:border-gray-700 pb-4">
                        <label class="block mb-2">
                            <div class="font-medium mb-1">ì²´í¬ ì£¼ê¸°</div>
                            <select id="notif_interval" class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700" onchange="updateNotificationPreview()">
                                <option value="1">1ë¶„ë§ˆë‹¤</option>
                                <option value="5" selected>5ë¶„ë§ˆë‹¤</option>
                                <option value="10">10ë¶„ë§ˆë‹¤</option>
                                <option value="30">30ë¶„ë§ˆë‹¤</option>
                                <option value="60">1ì‹œê°„ë§ˆë‹¤</option>
                            </select>
                        </label>
                    </div>

                    <!-- ì•Œë¦¼ ìŒì†Œê±° ì‹œê°„ -->
                    <div class="border-b border-gray-200 dark:border-gray-700 pb-4">
                        <div class="font-medium mb-3">ìŒì†Œê±° ì‹œê°„ (ì„ íƒì‚¬í•­)</div>
                        <div class="flex gap-2 items-center">
                            <input type="time" id="notif_quiet_start" class="flex-1 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700" placeholder="ì‹œì‘">
                            <span>~</span>
                            <input type="time" id="notif_quiet_end" class="flex-1 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700" placeholder="ì¢…ë£Œ">
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">ì´ ì‹œê°„ëŒ€ì—ëŠ” ì•Œë¦¼ì´ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</div>
                    </div>

                    <!-- ì•Œë¦¼ ë¯¸ë¦¬ë³´ê¸° -->
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">
                        <div class="text-sm font-medium mb-2">ë¯¸ë¦¬ë³´ê¸°</div>
                        <div id="notif_preview" class="text-xs text-gray-600 dark:text-gray-400">
                            ì•Œë¦¼ ì„¤ì •ì„ ë³€ê²½í•˜ë©´ ì—¬ê¸°ì— ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                        </div>
                    </div>
                </div>

                <div class="flex gap-2 mt-6">
                    <button data-action="saveNotificationSettings" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                        âœ“ <span data-i18n="common.save">ì €ì¥</span>
                    </button>
                    <button data-action="closeNotificationSettings" class="flex-1 bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-white px-4 py-2 rounded-lg font-medium">
                        <span data-i18n="common.cancel">ì·¨ì†Œ</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Agent Q01: ì»¬ëŸ¼ ì„ íƒ ëª¨ë‹¬ (Phase 4 - Q01-3) -->
        <div id="columnSelectionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" role="dialog" aria-labelledby="columnSelectionTitle" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="columnSelectionTitle" class="text-lg font-semibold">ğŸ“‹ <span data-i18n="export.selectColumns">ë‚´ë³´ë‚´ê¸° ì»¬ëŸ¼ ì„ íƒ</span></h3>
                    <button data-action="closeColumnSelection" class="text-2xl text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" data-i18n-aria="common.close" aria-label="ëª¨ë‹¬ ë‹«ê¸°">Ã—</button>
                </div>

                <div class="space-y-4">
                    <!-- ë¹ ë¥¸ ì„ íƒ ë²„íŠ¼ -->
                    <div class="flex flex-wrap gap-2 border-b border-gray-200 dark:border-gray-700 pb-4">
                        <button data-action="selectAllColumns" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm">
                            âœ“ <span data-i18n="export.selectAll">ì „ì²´ ì„ íƒ</span>
                        </button>
                        <button data-action="deselectAllColumns" class="px-3 py-1 bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded text-sm">
                            âœ— <span data-i18n="export.deselectAll">ì „ì²´ í•´ì œ</span>
                        </button>
                        <button data-action="selectEssentialColumns" class="px-3 py-1 bg-green-600 hover:bg-green-700 text-white rounded text-sm">
                            â­ <span data-i18n="export.essentialOnly">í•„ìˆ˜ í•­ëª©ë§Œ</span>
                        </button>
                    </div>

                    <!-- ì»¬ëŸ¼ ì²´í¬ë°•ìŠ¤ ê·¸ë¦¬ë“œ -->
                    <div class="grid grid-cols-2 gap-3">
                        <!-- ê¸°ë³¸ ì •ë³´ -->
                        <div class="col-span-2">
                            <div class="font-medium text-sm mb-2 text-gray-700 dark:text-gray-300" data-i18n="export.basicInfo">ê¸°ë³¸ ì •ë³´</div>
                        </div>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_factory" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">ğŸ­ <span data-i18n="table.factory">ê³µì¥</span></span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_poNumber" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">ğŸ“ <span data-i18n="table.poNumber">POë²ˆí˜¸</span></span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_model" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">ğŸ‘Ÿ <span data-i18n="table.model">ëª¨ë¸</span></span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_article" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">ğŸ”– Article</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_destination" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">ğŸŒ <span data-i18n="table.destination">í–‰ì„ ì§€</span></span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_outsoleVendor" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">ğŸ”§ <span data-i18n="filters.vendor">ì•„ì›ƒì†” ë²¤ë”</span></span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_quantity" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">ğŸ“¦ <span data-i18n="table.quantity">ìˆ˜ëŸ‰</span></span>
                        </label>

                        <!-- ë‚ ì§œ ì •ë³´ -->
                        <div class="col-span-2 mt-2">
                            <div class="font-medium text-sm mb-2 text-gray-700 dark:text-gray-300" data-i18n="export.dateInfo">ë‚ ì§œ ì •ë³´</div>
                        </div>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_crd" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">ğŸ“… <span data-i18n="table.crd">CRD</span></span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_sdd" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">ğŸ“† <span data-i18n="table.sdd">SDD</span></span>
                        </label>

                        <!-- ìƒì‚° ê³µì • -->
                        <div class="col-span-2 mt-2">
                            <div class="font-medium text-sm mb-2 text-gray-700 dark:text-gray-300" data-i18n="export.productionProcess">ìƒì‚° ê³µì •</div>
                        </div>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_cutting" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">âœ‚ï¸ <span data-i18n="table.sCut">ì¬ë‹¨ì™„ë£Œ</span></span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_sewing" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">ğŸ§µ <span data-i18n="table.sewBal">ì¬ë´‰ì™„ë£Œ</span></span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_assembly" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">ğŸ”¨ <span data-i18n="processes.ass">ì¡°ë¦½ì™„ë£Œ</span></span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_warehouseIn" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">ğŸ“¥ <span data-i18n="processes.wh_in">ì…ê³ ì™„ë£Œ</span></span>
                        </label>

                        <!-- ìƒíƒœ ì •ë³´ -->
                        <div class="col-span-2 mt-2">
                            <div class="font-medium text-sm mb-2 text-gray-700 dark:text-gray-300" data-i18n="export.statusInfo">ìƒíƒœ ì •ë³´</div>
                        </div>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_status" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">ğŸ“Š <span data-i18n="filters.status">ìƒíƒœ</span></span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_delayed" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">ğŸš¨ <span data-i18n="filters.delayed">ì§€ì—° (Y/N)</span></span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="col_warning" class="export-col-checkbox w-4 h-4" checked>
                            <span class="text-sm">âš ï¸ <span data-i18n="filters.warning">ê²½ê³  (Y/N)</span></span>
                        </label>
                    </div>

                    <!-- í”„ë¦¬ì…‹ ê´€ë¦¬ -->
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                        <div class="font-medium text-sm mb-2" data-i18n="export.presetManagement">í”„ë¦¬ì…‹ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°</div>
                        <div class="flex gap-2">
                            <input type="text" id="presetName" data-i18n-placeholder="export.presetPlaceholder" placeholder="í”„ë¦¬ì…‹ ì´ë¦„ ì…ë ¥" class="flex-1 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-sm">
                            <button data-action="saveColumnPreset" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm">
                                ğŸ’¾ <span data-i18n="common.save">ì €ì¥</span>
                            </button>
                        </div>
                        <div id="columnPresetList" class="mt-2 space-y-1">
                            <!-- ë™ì ìœ¼ë¡œ í”„ë¦¬ì…‹ ëª©ë¡ í‘œì‹œ -->
                        </div>
                    </div>

                    <!-- ì„ íƒëœ ì»¬ëŸ¼ ìˆ˜ -->
                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3">
                        <div class="text-sm">
                            <span class="font-medium" data-i18n="export.selectedCount">ì„ íƒëœ ì»¬ëŸ¼:</span>
                            <span id="selectedColumnCount" class="text-blue-600 dark:text-blue-400 font-bold">16</span>ê°œ / 16ê°œ
                        </div>
                    </div>
                </div>

                <div class="flex gap-2 mt-6">
                    <button data-action="applyColumnSelection" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                        âœ“ <span data-i18n="common.apply">ì ìš©</span>
                    </button>
                    <button data-action="closeColumnSelection" class="flex-1 bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-white px-4 py-2 rounded-lg font-medium">
                        <span data-i18n="common.cancel">ì·¨ì†Œ</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Agent Q01: ì²­í¬ ì²˜ë¦¬ ì§„í–‰ ìƒí™© ëª¨ë‹¬ (Phase 4 - Q01-6) -->
        <div id="chunkProgressModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" role="dialog" aria-labelledby="chunkProgressTitle" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
                <h3 id="chunkProgressTitle" class="text-lg font-semibold mb-4">â³ <span data-i18n="export.processing">ë°ì´í„° ì²˜ë¦¬ ì¤‘...</span></h3>

                <div class="space-y-4">
                    <div class="text-sm text-gray-600 dark:text-gray-400">
                        <div class="flex justify-between mb-2">
                            <span data-i18n="export.progress">ì§„í–‰ë¥ :</span>
                            <span id="chunkProgressPercent" class="font-bold text-blue-600 dark:text-blue-400">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 overflow-hidden">
                            <div id="chunkProgressBar" class="bg-blue-600 h-4 transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="text-sm text-gray-600 dark:text-gray-400">
                        <div class="flex justify-between">
                            <span data-i18n="export.processed">ì²˜ë¦¬ ì™„ë£Œ:</span>
                            <span id="chunkProgressText">0 / 0</span>
                        </div>
                    </div>

                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 text-xs text-gray-600 dark:text-gray-400">
                        ğŸ’¡ <span data-i18n="export.chunkOptimization">ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ ì²­í¬ ë‹¨ìœ„ë¡œ ì²˜ë¦¬í•˜ì—¬ ë¸Œë¼ìš°ì € ì„±ëŠ¥ì„ ìµœì í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤.</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Agent Q05: ì¼ì¼ ë³´ê³ ì„œ ëª¨ë‹¬ (Phase 4 - Q05-1) -->
        <div id="dailyReportModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" role="dialog" aria-labelledby="dailyReportTitle" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col">
                <!-- ëª¨ë‹¬ í—¤ë” -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center gap-4">
                        <h3 id="dailyReportTitle" class="text-2xl font-bold flex items-center gap-2">
                            ğŸ“Š <span data-i18n="report.title">ìƒì‚° í˜„í™© ë³´ê³ ì„œ</span>
                            <span id="reportDate" class="text-lg font-normal text-gray-600 dark:text-gray-400"></span>
                        </h3>
                        <!-- Agent Q05: ë³´ê³ ì„œ íƒ€ì… ì„ íƒ (Q05-1, Q05-2, Q05-3) -->
                        <select id="reportTypeSelector" onchange="switchReportType()" class="px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm">
                            <option value="daily" data-i18n="report.daily">ì¼ì¼ ë³´ê³ ì„œ</option>
                            <option value="weekly" data-i18n="report.weekly">ì£¼ê°„ ë³´ê³ ì„œ</option>
                            <option value="monthly" data-i18n="report.monthly">ì›”ê°„ ë³´ê³ ì„œ</option>
                        </select>
                    </div>
                    <button data-action="closeDailyReport" class="text-3xl text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" data-i18n-aria="common.close" aria-label="ëª¨ë‹¬ ë‹«ê¸°">Ã—</button>
                </div>

                <!-- ëª¨ë‹¬ ë³¸ë¬¸ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) -->
                <div class="flex-1 overflow-y-auto p-6" id="reportContent">
                    <!-- ë³´ê³ ì„œ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
                </div>

                <!-- ëª¨ë‹¬ í‘¸í„° (ë²„íŠ¼) -->
                <div class="flex justify-between items-center p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
                    <div class="text-sm text-gray-600 dark:text-gray-400">
                        ğŸ’¡ <span data-i18n="report.printTip">ì¸ì‡„ ë²„íŠ¼ì„ ëˆŒëŸ¬ PDFë¡œ ì €ì¥í•˜ì„¸ìš”</span>
                    </div>
                    <div class="flex gap-3">
                        <button data-action="printDailyReport" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium">
                            ğŸ–¨ï¸ <span data-i18n="report.printPDF">ì¸ì‡„ / PDF ì €ì¥</span>
                        </button>
                        <button data-action="downloadReportHTML" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium">
                            ğŸ’¾ <span data-i18n="report.downloadHTML">HTML ë‹¤ìš´ë¡œë“œ</span>
                        </button>
                        <button data-action="closeDailyReport" class="bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-700 text-gray-800 dark:text-white px-6 py-2 rounded-lg font-medium">
                            <span data-i18n="common.close">ë‹«ê¸°</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Agent Q09: í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ë„ì›€ë§ ëª¨ë‹¬ (Phase 4 - Q09-3) -->
        <div id="keyboardShortcutsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" role="dialog" aria-labelledby="shortcutsModalTitle" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col">
                <!-- ëª¨ë‹¬ í—¤ë” -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700">
                    <h3 id="shortcutsModalTitle" class="text-2xl font-bold flex items-center gap-2">
                        âŒ¨ï¸ <span data-i18n="keyboard.title">í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤</span>
                    </h3>
                    <button data-action="closeKeyboardShortcutsModal" class="text-3xl text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" data-i18n-aria="common.close" aria-label="ëª¨ë‹¬ ë‹«ê¸°">Ã—</button>
                </div>

                <!-- ëª¨ë‹¬ ë³¸ë¬¸ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) -->
                <div class="flex-1 overflow-y-auto p-6" id="shortcutsContent">
                    <div class="text-sm text-gray-600 dark:text-gray-400 mb-6">
                        ğŸ’¡ <span data-i18n="keyboard.introTip">ë‹¨ì¶•í‚¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë” ë¹ ë¥´ê²Œ ëŒ€ì‹œë³´ë“œë¥¼ íƒìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
                    </div>

                    <!-- í•„í„° ë‹¨ì¶•í‚¤ -->
                    <div class="shortcut-category">
                        <h4 class="text-lg font-bold mb-4 text-gray-900 dark:text-white">ğŸ” <span data-i18n="keyboard.categoryFilter">í•„í„°</span></h4>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.toggleFilterPanel">í•„í„° íŒ¨ë„ í† ê¸€</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">F</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.resetFilters">ëª¨ë“  í•„í„° ì´ˆê¸°í™”</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">R</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.focusSearch">ê²€ìƒ‰ì°½ í¬ì»¤ìŠ¤</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">/</span>
                            </div>
                        </div>
                    </div>

                    <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
                    <div class="shortcut-category">
                        <h4 class="text-lg font-bold mb-4 text-gray-900 dark:text-white">ğŸ“‘ <span data-i18n="keyboard.categoryTabs">íƒ­ ë„¤ë¹„ê²Œì´ì…˜</span></h4>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.tabMonthly">ì›”ë³„ í˜„í™©</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Alt</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">1</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.tabDestination">í–‰ì„ ì§€ë³„ ë¶„ì„</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Alt</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">2</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.tabModel">ëª¨ë¸ë³„ ë¶„ì„</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Alt</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">3</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.tabFactory">ê³µì¥ë³„ í˜„í™©</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Alt</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">4</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.tabVendor">ì•„ì›ƒì†” ë²¤ë”</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Alt</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">5</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.tabHeatmap">íˆíŠ¸ë§µ ë¶„ì„</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Alt</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">6</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.tabData">ìƒì„¸ ë°ì´í„°</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Alt</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">7</span>
                            </div>
                        </div>
                    </div>

                    <!-- ë°ì´í„° ì¡°ì‘ -->
                    <div class="shortcut-category">
                        <h4 class="text-lg font-bold mb-4 text-gray-900 dark:text-white">ğŸ“Š <span data-i18n="keyboard.categoryData">ë°ì´í„° ì¡°ì‘</span></h4>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.exportExcel">Excel ë‚´ë³´ë‚´ê¸°</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">E</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.generateReport">ë³´ê³ ì„œ ìƒì„±</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">P</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.reportHistory">ë³´ê³ ì„œ íˆìŠ¤í† ë¦¬</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">H</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.detectOutliers">ì´ìƒì¹˜ íƒì§€</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">A</span>
                            </div>
                        </div>
                    </div>

                    <!-- UI ì„¤ì • -->
                    <div class="shortcut-category">
                        <h4 class="text-lg font-bold mb-4 text-gray-900 dark:text-white">ğŸ¨ <span data-i18n="keyboard.categoryUI">UI ì„¤ì •</span></h4>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.toggleDarkMode">ë‹¤í¬ëª¨ë“œ í† ê¸€</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">D</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.refreshPage">í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">F5</span>
                            </div>
                        </div>
                    </div>

                    <!-- ë„ì›€ë§ -->
                    <div class="shortcut-category">
                        <h4 class="text-lg font-bold mb-4 text-gray-900 dark:text-white">â“ <span data-i18n="keyboard.categoryHelp">ë„ì›€ë§</span></h4>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.openShortcuts">ë‹¨ì¶•í‚¤ ë„ì›€ë§ ì—´ê¸°</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">?</span>
                                <span class="text-gray-500 dark:text-gray-400 ml-2 text-sm" data-i18n="keyboard.or">ë˜ëŠ”</span>
                                <span class="shortcut-key ml-2">Ctrl</span>
                                <span class="shortcut-plus">+</span>
                                <span class="shortcut-key">/</span>
                            </div>
                        </div>
                        <div class="shortcut-item">
                            <span class="text-gray-700 dark:text-gray-300" data-i18n="keyboard.closeModal">ëª¨ë‹¬ ë‹«ê¸°</span>
                            <div class="shortcut-keys">
                                <span class="shortcut-key">Esc</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ëª¨ë‹¬ í‘¸í„° -->
                <div class="flex justify-end items-center p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
                    <button data-action="closeKeyboardShortcutsModal" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium">
                        <span data-i18n="common.confirm">í™•ì¸</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Agent Q04: ì•Œë¦¼ íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ (Phase 4 - Q04-6) -->
        <div id="notificationHistoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" role="dialog" aria-labelledby="notifHistoryTitle" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col">
                <!-- ëª¨ë‹¬ í—¤ë” -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700">
                    <h3 id="notifHistoryTitle" class="text-2xl font-bold flex items-center gap-2">
                        ğŸ“¬ <span data-i18n="notifications.historyTitle">ì•Œë¦¼ íˆìŠ¤í† ë¦¬</span>
                    </h3>
                    <button data-action="closeNotificationHistoryModal" class="text-3xl text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" data-i18n-aria="common.close" aria-label="ëª¨ë‹¬ ë‹«ê¸°">Ã—</button>
                </div>

                <!-- ëª¨ë‹¬ ë³¸ë¬¸ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) -->
                <div class="flex-1 overflow-y-auto p-6" id="notificationHistoryContent">
                    <!-- ì•Œë¦¼ íˆìŠ¤í† ë¦¬ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
                </div>

                <!-- ëª¨ë‹¬ í‘¸í„° -->
                <div class="flex justify-between items-center p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
                    <button data-action="clearNotificationHistory" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium">
                        ğŸ—‘ï¸ <span data-i18n="notifications.clearAll">ëª¨ë‘ ì‚­ì œ</span>
                    </button>
                    <button data-action="closeNotificationHistoryModal" class="bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-700 text-gray-800 dark:text-white px-6 py-2 rounded-lg font-medium">
                        <span data-i18n="common.close">ë‹«ê¸°</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Agent Q05: ë³´ê³ ì„œ íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ (Phase 4 - Q05-5) -->
        <div id="reportHistoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" role="dialog" aria-labelledby="reportHistoryTitle" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col">
                <!-- ëª¨ë‹¬ í—¤ë” -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700">
                    <h3 id="reportHistoryTitle" class="text-2xl font-bold flex items-center gap-2">
                        ğŸ“‹ <span data-i18n="report.historyTitle">ë³´ê³ ì„œ íˆìŠ¤í† ë¦¬</span>
                    </h3>
                    <button data-action="closeReportHistoryModal" class="text-3xl text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" data-i18n-aria="common.close" aria-label="ëª¨ë‹¬ ë‹«ê¸°">Ã—</button>
                </div>

                <!-- ëª¨ë‹¬ ë³¸ë¬¸ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) -->
                <div class="flex-1 overflow-y-auto p-6" id="reportHistoryContent">
                    <!-- ë³´ê³ ì„œ íˆìŠ¤í† ë¦¬ ë‚´ìš©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
                </div>

                <!-- ëª¨ë‹¬ í‘¸í„° -->
                <div class="flex justify-between items-center p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
                    <button data-action="clearReportHistory" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium">
                        ğŸ—‘ï¸ <span data-i18n="report.clearAll">ì „ì²´ ì‚­ì œ</span>
                    </button>
                    <button data-action="closeReportHistoryModal" class="bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-700 text-gray-800 dark:text-white px-6 py-2 rounded-lg font-medium">
                        <span data-i18n="common.close">ë‹«ê¸°</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Agent Q06: Mobile Filter Toggle Button -->
        <button class="mobile-filter-toggle" data-action="openMobileFilters" data-i18n-aria="mobile.openFilters" aria-label="í•„í„° ì—´ê¸°">
            <span class="text-2xl text-white">ğŸ”</span>
        </button>

        <!-- Agent Q06: Swipe Gesture Indicator -->
        <div id="swipeIndicator" class="swipe-indicator"></div>

        <!-- Agent Q06: í–„ë²„ê±° ë©”ë‰´ (Phase 4 - Q06-5) -->
        <div class="mobile-menu-backdrop" id="mobileMenuBackdrop" data-action="toggleMobileMenu"></div>
        <div class="mobile-menu-drawer" id="mobileMenuDrawer">
            <h3 class="text-lg font-bold mb-4 text-gray-900 dark:text-white">ğŸ“Š <span data-i18n="mobile.menuTitle">ëŒ€ì‹œë³´ë“œ ë©”ë‰´</span></h3>
            <div id="mobileMenuItems">
                <div class="mobile-menu-item" data-tab="monthly" data-action="switchTabFromMobileMenu" data-param="monthly">
                    ğŸ“… <span data-i18n="tabs.monthly">ì›”ë³„ í˜„í™©</span>
                </div>
                <div class="mobile-menu-item" data-tab="destination" data-action="switchTabFromMobileMenu" data-param="destination">
                    ğŸŒ <span data-i18n="tabs.destination">í–‰ì„ ì§€ë³„ ë¶„ì„</span>
                </div>
                <div class="mobile-menu-item" data-tab="model" data-action="switchTabFromMobileMenu" data-param="model">
                    ğŸ‘Ÿ <span data-i18n="tabs.model">ëª¨ë¸ë³„ ë¶„ì„</span>
                </div>
                <div class="mobile-menu-item" data-tab="factory" data-action="switchTabFromMobileMenu" data-param="factory">
                    ğŸ­ <span data-i18n="tabs.factory">ê³µì¥ë³„ í˜„í™©</span>
                </div>
                <div class="mobile-menu-item" data-tab="vendor" data-action="switchTabFromMobileMenu" data-param="vendor">
                    ğŸ”§ <span data-i18n="tabs.vendor">ì•„ì›ƒì†” ë²¤ë”</span>
                </div>
                <div class="mobile-menu-item" data-tab="heatmap" data-action="switchTabFromMobileMenu" data-param="heatmap">
                    ğŸ”¥ <span data-i18n="tabs.heatmap">íˆíŠ¸ë§µ ë¶„ì„</span>
                </div>
                <div class="mobile-menu-item" data-tab="data" data-action="switchTabFromMobileMenu" data-param="data">
                    ğŸ“‹ <span data-i18n="tabs.data">ìƒì„¸ ë°ì´í„°</span>
                </div>
                <div class="mobile-menu-item" data-tab="qms" data-action="switchTabFromMobileMenu" data-param="qms">
                    ğŸ¯ <span data-i18n="tabs.qms">í’ˆì§ˆê´€ë¦¬ (QMS)</span>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="bg-card rounded-xl shadow-sm mb-6">
            <div class="border-b border-theme overflow-x-auto">
                <nav class="flex -mb-px min-w-max" role="tablist" data-i18n-aria="tabs.navigationLabel" aria-label="ëŒ€ì‹œë³´ë“œ íƒ­ ë„¤ë¹„ê²Œì´ì…˜">
                    <button class="tab-btn tab-active px-6 py-3 text-sm font-medium whitespace-nowrap" data-tab="monthly" role="tab" aria-selected="true" tabindex="0">ğŸ“… <span data-i18n="tabs.monthly">ì›”ë³„</span></button>
                    <button class="tab-btn px-6 py-3 text-sm font-medium whitespace-nowrap" data-tab="destination" role="tab" aria-selected="false" tabindex="-1">ğŸŒ <span data-i18n="tabs.destination">í–‰ì„ ì§€ë³„</span></button>
                    <button class="tab-btn px-6 py-3 text-sm font-medium whitespace-nowrap" data-tab="model" role="tab" aria-selected="false" tabindex="-1">ğŸ‘Ÿ <span data-i18n="tabs.model">ëª¨ë¸ë³„</span></button>
                    <button class="tab-btn px-6 py-3 text-sm font-medium whitespace-nowrap" data-tab="factory" role="tab" aria-selected="false" tabindex="-1">ğŸ­ <span data-i18n="tabs.factory">ê³µì¥ë³„</span></button>
                    <button class="tab-btn px-6 py-3 text-sm font-medium whitespace-nowrap" data-tab="vendor" role="tab" aria-selected="false" tabindex="-1">ğŸ”§ <span data-i18n="tabs.vendor">ì•„ì›ƒì†” ë²¤ë”</span></button>
                    <button class="tab-btn px-6 py-3 text-sm font-medium whitespace-nowrap" data-tab="heatmap" role="tab" aria-selected="false" tabindex="-1">ğŸ”¥ <span data-i18n="tabs.heatmap">íˆíŠ¸ë§µ</span></button>
                    <button class="tab-btn px-6 py-3 text-sm font-medium whitespace-nowrap" data-tab="data" role="tab" aria-selected="false" tabindex="-1">ğŸ“‹ <span data-i18n="tabs.data">ìƒì„¸</span> <span class="kbd">D</span></button>
                    <button class="tab-btn px-6 py-3 text-sm font-medium whitespace-nowrap" data-tab="qms" role="tab" aria-selected="false" tabindex="-1">ğŸ¯ <span data-i18n="tabs.qms">í’ˆì§ˆê´€ë¦¬</span></button>
                </nav>
            </div>
            <div id="tabContents" class="p-6">
                <!-- Monthly Tab -->
                <div id="monthlyTab" class="tab-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div><h3 class="text-lg font-semibold mb-4"><span data-i18n="monthly.chartTitle">ì›”ë³„ ì˜¤ë” í˜„í™©</span></h3><div class="chart-container"><canvas id="monthlyChart"></canvas></div></div>
                        <div><h3 class="text-lg font-semibold mb-4"><span data-i18n="monthly.tableTitle">ì›”ë³„ ì™„ë£Œ í˜„í™©</span></h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm" id="monthlyTable">
                                    <caption class="sr-only" data-i18n="monthly.tableCaption">ì›”ë³„ ì˜¤ë” ì™„ë£Œ í˜„í™© ë° ì™„ë£Œìœ¨ í…Œì´ë¸”</caption>
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-4 py-2 text-left sort-header" data-sort="month" data-table="monthly"><span data-i18n="monthly.month">ì›”</span></th>
                                            <th class="px-4 py-2 text-right sort-header" data-sort="count" data-table="monthly"><span data-i18n="monthly.orders">ì˜¤ë”</span></th>
                                            <th class="px-4 py-2 text-right sort-header" data-sort="qty" data-table="monthly"><span data-i18n="monthly.quantity">ì£¼ë¬¸ëŸ‰</span></th>
                                            <th class="px-4 py-2 text-right sort-header" data-sort="completed" data-table="monthly"><span data-i18n="monthly.completed">ì™„ë£ŒëŸ‰</span></th>
                                            <th class="px-4 py-2 text-right sort-header" data-sort="rate" data-table="monthly"><span data-i18n="monthly.completionRate">ì™„ë£Œìœ¨</span></th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Agent Q08: ì›”ë³„ íŠ¸ë Œë“œ ë¶„ì„ ì°¨íŠ¸ (Phase 4 - Q08-1) -->
                    <div class="mt-6">
                        <div class="bg-card rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-4">ğŸ“ˆ <span data-i18n="monthly.trendTitle">ì›”ë³„ íŠ¸ë Œë“œ ë¶„ì„</span></h3>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="monthlyTrendChart"></canvas>
                            </div>
                            <div class="mt-4 text-sm text-gray-600 dark:text-gray-400">
                                <p data-i18n="monthly.trendDescription">ì£¼ë¬¸ëŸ‰, ì™„ë£ŒëŸ‰, ì§€ì—°ìœ¨ì˜ ì›”ë³„ ì¶”ì´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. íŠ¸ë Œë“œë¥¼ í†µí•´ ìƒì‚° íš¨ìœ¨ì„±ê³¼ ë¬¸ì œì ì„ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Destination Tab -->
                <div id="destinationTab" class="tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div><h3 class="text-lg font-semibold mb-4"><span data-i18n="destination.chartTitle">êµ­ê°€ë³„ ìˆ˜ëŸ‰ ë¶„í¬</span></h3><div class="chart-container"><canvas id="destChart"></canvas></div></div>
                        <div><h3 class="text-lg font-semibold mb-4"><span data-i18n="destination.tableTitle">í–‰ì„ ì§€ë³„ ìƒì„¸</span></h3>
                            <div class="overflow-x-auto max-h-[400px]">
                                <table class="w-full text-sm" id="destTable">
                                    <caption class="sr-only" data-i18n="destination.tableCaption">í–‰ì„ ì§€(êµ­ê°€)ë³„ ì˜¤ë” ìˆ˜ëŸ‰ ë° ì™„ë£Œìœ¨ í…Œì´ë¸”</caption>
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-4 py-2 text-left sort-header" data-sort="dest" data-table="dest"><span data-i18n="destination.country">êµ­ê°€</span></th>
                                            <th class="px-4 py-2 text-right sort-header" data-sort="count" data-table="dest"><span data-i18n="destination.count">ê±´ìˆ˜</span></th>
                                            <th class="px-4 py-2 text-right sort-header" data-sort="qty" data-table="dest"><span data-i18n="destination.quantity">ìˆ˜ëŸ‰</span></th>
                                            <th class="px-4 py-2 text-right sort-header" data-sort="completed" data-table="dest"><span data-i18n="destination.completed">ì™„ë£Œ</span></th>
                                            <th class="px-4 py-2 text-right sort-header" data-sort="rate" data-table="dest"><span data-i18n="destination.completionRate">ì™„ë£Œìœ¨</span></th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Model Tab -->
                <div id="modelTab" class="tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div><h3 class="text-lg font-semibold mb-4"><span data-i18n="model.chartTitle">ëª¨ë¸ë³„ ìˆ˜ëŸ‰ (Top 15)</span></h3><div class="chart-container" style="height:400px"><canvas id="modelChart"></canvas></div></div>
                        <div><h3 class="text-lg font-semibold mb-4"><span data-i18n="model.tableTitle">ëª¨ë¸ë³„ ìƒì„¸</span></h3>
                            <div class="overflow-x-auto max-h-[400px]">
                                <table class="w-full text-sm" id="modelTable">
                                    <caption class="sr-only" data-i18n="model.tableCaption">ì‹ ë°œ ëª¨ë¸ë³„ ì˜¤ë” ìˆ˜ëŸ‰ ë° ì™„ë£Œìœ¨ í…Œì´ë¸”</caption>
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-4 py-2 text-left sort-header" data-sort="model" data-table="model"><span data-i18n="model.model">ëª¨ë¸</span></th>
                                            <th class="px-4 py-2 text-right sort-header" data-sort="count" data-table="model"><span data-i18n="model.count">ê±´ìˆ˜</span></th>
                                            <th class="px-4 py-2 text-right sort-header" data-sort="qty" data-table="model"><span data-i18n="model.quantity">ìˆ˜ëŸ‰</span></th>
                                            <th class="px-4 py-2 text-right sort-header" data-sort="completed" data-table="model"><span data-i18n="model.completed">ì™„ë£Œ</span></th>
                                            <th class="px-4 py-2 text-right sort-header" data-sort="rate" data-table="model"><span data-i18n="model.completionRate">ì™„ë£Œìœ¨</span></th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Factory Tab -->
                <div id="factoryTab" class="tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div><h3 class="text-lg font-semibold mb-4"><span data-i18n="factory.chartTitle">ê³µì¥ë³„ ìˆ˜ëŸ‰ ë¹„êµ</span></h3><div class="chart-container"><canvas id="factoryChart"></canvas></div></div>
                        <div><h3 class="text-lg font-semibold mb-4"><span data-i18n="factory.processTitle">ê³µì¥ë³„ ê³µì • í˜„í™©</span></h3><div id="factoryProcessDetail" class="space-y-4"></div></div>
                    </div>
                </div>
                <!-- Vendor Tab (NEW) -->
                <div id="vendorTab" class="tab-content hidden">
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div><h3 class="text-lg font-semibold mb-4"><span data-i18n="vendor.chartTitle">ì•„ì›ƒì†” ë²¤ë”ë³„ ìˆ˜ëŸ‰</span></h3><div class="chart-container"><canvas id="vendorDetailChart"></canvas></div></div>
                            <div><h3 class="text-lg font-semibold mb-4"><span data-i18n="vendor.tableTitle">ì•„ì›ƒì†” ë²¤ë”ë³„ ìƒì„¸</span></h3>
                                <div class="overflow-x-auto max-h-[300px]">
                                    <table class="w-full text-sm" id="vendorDetailTable">
                                        <caption class="sr-only" data-i18n="vendor.tableCaption">ì•„ì›ƒì†” ë²¤ë”ë³„ ì˜¤ë” ìˆ˜ëŸ‰ ë° ì™„ë£Œìœ¨ ìƒì„¸ í…Œì´ë¸”</caption>
                                        <thead class="bg-gray-50 dark:bg-gray-700">
                                            <tr>
                                                <th class="px-3 py-2 text-left sort-header" data-sort="vendor" data-table="vendorDetail"><span data-i18n="vendor.vendor">ì•„ì›ƒì†” ë²¤ë”</span></th>
                                                <th class="px-3 py-2 text-right sort-header" data-sort="count" data-table="vendorDetail"><span data-i18n="vendor.orders">ì˜¤ë”</span></th>
                                                <th class="px-3 py-2 text-right sort-header" data-sort="qty" data-table="vendorDetail"><span data-i18n="vendor.quantity">ìˆ˜ëŸ‰</span></th>
                                                <th class="px-3 py-2 text-right sort-header" data-sort="completed" data-table="vendorDetail"><span data-i18n="vendor.completed">ì™„ë£Œ</span></th>
                                                <th class="px-3 py-2 text-right sort-header" data-sort="rate" data-table="vendorDetail"><span data-i18n="vendor.completionRate">ì™„ë£Œìœ¨</span></th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-4">ğŸ”¥ <span data-i18n="vendor.heatmapTitle">ëª¨ë¸ Ã— ì•„ì›ƒì†” ë²¤ë” íˆíŠ¸ë§µ</span></h3>
                            <div id="modelVendorHeatmap" class="overflow-x-auto"></div>
                        </div>
                    </div>
                </div>
                <!-- Heatmap Tab -->
                <div id="heatmapTab" class="tab-content hidden">
                    <div class="space-y-6">
                        <div><h3 class="text-lg font-semibold mb-4"><span data-i18n="heatmap.countryMonthTitle">ì¤‘ìš” í–‰ì„ ì§€ Ã— ì›”ë³„ íˆíŠ¸ë§µ</span></h3><div id="countryMonthHeatmap" class="overflow-x-auto"></div></div>
                        <div><h3 class="text-lg font-semibold mb-4"><span data-i18n="heatmap.modelDestTitle">ëª¨ë¸ Ã— í–‰ì„ ì§€ íˆíŠ¸ë§µ</span></h3><div id="modelDestHeatmap" class="overflow-x-auto"></div></div>
                    </div>
                </div>
                <!-- Data Tab -->
                <div id="dataTab" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-4 flex-wrap gap-2">
                        <div>
                            <h3 class="text-lg font-semibold"><span data-i18n="data.title">ìƒì„¸ ë°ì´í„°</span> <span id="dataCount" class="text-sm font-normal text-secondary"></span></h3>
                            <div id="pagination" class="text-sm text-secondary mt-1"></div>
                        </div>
                        <div class="flex gap-2 items-center">
                            <label class="text-sm text-secondary" data-i18n="data.rowsPerPage">í–‰/í˜ì´ì§€:</label>
                            <select id="pageSizeSelect" onchange="changePageSize()" class="bg-white dark:bg-gray-700 border border-theme rounded px-2 py-1 text-sm">
                                <option value="50">50</option>
                                <option value="100">100</option>
                                <option value="200">200</option>
                            </select>
                            <button data-action="prevPage" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-1 rounded text-sm" id="prevBtn" disabled><span data-i18n="data.previous">â† ì´ì „</span></button>
                            <button data-action="nextPage" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-1 rounded text-sm" id="nextBtn"><span data-i18n="data.next">ë‹¤ìŒ â†’</span></button>
                            <button data-action="showColumnSettings" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 text-sm font-medium" data-i18n-title="data.columnSettingsTitle" data-i18n-aria="data.columnSettingsAria">âš™ï¸ <span data-i18n="data.columns">ì»¬ëŸ¼</span></button>
                            <button data-action="showExportOptions" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 text-sm font-medium">ğŸ“¥ <span data-i18n="data.export">ë‚´ë³´ë‚´ê¸°</span></button>
                            <button data-action="generateDailyReport" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 text-sm font-medium" data-i18n-title="data.reportTitle" data-i18n-aria="data.reportAria">ğŸ“Š <span data-i18n="data.report">ë³´ê³ ì„œ</span></button>
                            <button data-action="showAnomalyReport" class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 text-sm font-medium" data-i18n-title="data.anomalyTitle" data-i18n-aria="data.anomalyAria">ğŸ” <span data-i18n="data.anomaly">ì´ìƒì¹˜</span></button>
                            <button data-action="showAnalyticsInsights" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 text-sm font-medium" data-i18n-title="data.analyticsTitle" data-i18n-aria="data.analyticsAria">ğŸ¤– <span data-i18n="data.analytics">AI ë¶„ì„</span></button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm" id="dataTable">
                            <caption class="sr-only" data-i18n="data.tableCaption">ì „ì²´ ì˜¤ë” ìƒì„¸ ë‚´ì—­ í…Œì´ë¸” (ê³µì¥, POë²ˆí˜¸, ëª¨ë¸, ì§„í–‰ ìƒíƒœ, ë‚©ê¸°ì¼ í¬í•¨)</caption>
                            <thead class="bg-gray-50 dark:bg-gray-700"><tr>
                                <th class="px-2 py-2 text-left sort-header" data-sort="factory" data-table="data"><span data-i18n="data.factory">ê³µì¥</span></th>
                                <th class="px-2 py-2 text-left sort-header" data-sort="po" data-table="data">PO</th>
                                <th class="px-2 py-2 text-left sort-header" data-sort="model" data-table="data"><span data-i18n="data.model">ëª¨ë¸</span></th>
                                <th class="px-2 py-2 text-left sort-header" data-sort="article" data-table="data">Article</th>
                                <th class="px-2 py-2 text-left sort-header" data-sort="destination" data-table="data"><span data-i18n="data.destination">í–‰ì„ ì§€</span></th>
                                <th class="px-2 py-2 text-left"><span data-i18n="data.outsoleVendor">ì•„ì›ƒì†” ë²¤ë”</span></th>
                                <th class="px-2 py-2 text-right sort-header" data-sort="quantity" data-table="data"><span data-i18n="data.quantity">ìˆ˜ëŸ‰</span></th>
                                <th class="px-2 py-2 text-center"><span data-i18n="data.cutting">ì¬ë‹¨</span></th>
                                <th class="px-2 py-2 text-center"><span data-i18n="data.sewing">ì¬ë´‰</span></th>
                                <th class="px-2 py-2 text-center"><span data-i18n="data.assembly">ì¡°ë¦½</span></th>
                                <th class="px-2 py-2 text-center"><span data-i18n="data.warehouse">ì…ê³ </span></th>
                                <th class="px-2 py-2 text-left sort-header" data-sort="crd" data-table="data">CRD</th>
                                <th class="px-2 py-2 text-left sort-header" data-sort="sdd" data-table="data">SDD</th>
                                <th class="px-2 py-2 text-center"><span data-i18n="data.status">ìƒíƒœ</span></th>
                            </tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <!-- Agent Q06: ëª¨ë°”ì¼ ì¹´ë“œë·° ì»¨í…Œì´ë„ˆ (768px ì´í•˜ì—ì„œ í‘œì‹œ) -->
                    <div id="dataCardsContainer" class="px-2 py-2">
                        <!-- ì¹´ë“œë“¤ì´ JavaScriptë¡œ ë Œë”ë§ë¨ -->
                    </div>
                </div>

                <!-- QMS (Quality Management Work Monitoring System) Tab -->
                <div id="qmsTab" class="tab-content hidden">
                    <!-- QMS ì¸ì¦ í•„ìš” ì•ˆë‚´ (ë¯¸ì¸ì¦ ì‹œ í‘œì‹œ) -->
                    <div id="qmsAuthRequired" class="p-6">
                        <div class="bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700 rounded-xl p-6 text-center max-w-xl mx-auto">
                            <div class="text-4xl mb-4">ğŸ”</div>
                            <h3 class="text-xl font-bold text-yellow-800 dark:text-yellow-200 mb-2" data-i18n="qms.authRequired">Google ì¸ì¦ í•„ìš”</h3>
                            <p class="text-yellow-700 dark:text-yellow-300 mb-4" data-i18n="qms.authDescription">
                                QMS ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤.<br>
                                Google Sheetsì— ë°ì´í„°ê°€ ì €ì¥ë©ë‹ˆë‹¤.
                            </p>
                            <button id="qmsSignInBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-3 rounded-lg transition-colors inline-flex items-center gap-2">
                                <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                                <span data-i18n="qms.signInWithGoogle">Googleë¡œ ë¡œê·¸ì¸</span>
                            </button>
                        </div>
                    </div>

                    <!-- QMS ë©”ì¸ ì»¨í…ì¸  (ì¸ì¦ í›„ í‘œì‹œ) -->
                    <div id="qmsMainContent" class="hidden">
                        <!-- QMS í—¤ë” -->
                        <div class="bg-card rounded-xl shadow-sm p-4 mb-4">
                            <div class="flex flex-wrap items-center justify-between gap-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
                                        <span class="text-xl">ğŸ¯</span>
                                    </div>
                                    <div>
                                        <h2 class="text-lg font-bold" data-i18n="qms.title">í’ˆì§ˆê´€ë¦¬ ì‘ì—… ëª¨ë‹ˆí„°ë§</h2>
                                        <p class="text-sm text-secondary" data-i18n="qms.subtitle">QMS (Quality Management Work Monitoring System)</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span id="qmsUserEmail" class="text-sm text-secondary"></span>
                                    <button id="qmsSignOutBtn" class="text-sm text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300" data-i18n="qms.signOut">ë¡œê·¸ì•„ì›ƒ</button>
                                    <button id="qmsSyncBtn" class="ml-2 p-2 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" title="ë™ê¸°í™”">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- QMS ì„œë¸Œíƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
                        <div class="bg-card rounded-xl shadow-sm mb-4">
                            <div class="flex overflow-x-auto border-b border-gray-200 dark:border-gray-700">
                                <button class="qms-subtab-btn px-4 py-3 text-sm font-medium whitespace-nowrap border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 transition-colors active" data-qms-tab="targets">
                                    ğŸ“‹ <span data-i18n="qms.tabs.targets">íƒ€ê²Ÿë“±ë¡</span>
                                </button>
                                <button class="qms-subtab-btn px-4 py-3 text-sm font-medium whitespace-nowrap border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 transition-colors" data-qms-tab="monitoring">
                                    ğŸ“Š <span data-i18n="qms.tabs.monitoring">ëª¨ë‹ˆí„°ë§í˜„í™©</span>
                                </button>
                                <button class="qms-subtab-btn px-4 py-3 text-sm font-medium whitespace-nowrap border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 transition-colors" data-qms-tab="assignment">
                                    ğŸ“ <span data-i18n="qms.tabs.assignment">ì‘ì—…ì§€ì‹œ</span>
                                </button>
                                <button class="qms-subtab-btn px-4 py-3 text-sm font-medium whitespace-nowrap border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 transition-colors" data-qms-tab="tasklist">
                                    ğŸ“‘ <span data-i18n="qms.tabs.tasklist">ì‘ì—…ëª©ë¡</span>
                                </button>
                                <button class="qms-subtab-btn px-4 py-3 text-sm font-medium whitespace-nowrap border-b-2 border-transparent hover:border-gray-300 dark:hover:border-gray-600 transition-colors" data-qms-tab="results">
                                    âœ… <span data-i18n="qms.tabs.results">ê²°ê³¼ê´€ë¦¬</span>
                                </button>
                            </div>
                        </div>

                        <!-- QMS ì„œë¸Œíƒ­ ì»¨í…ì¸  -->
                        <div id="qmsSubtabContents">
                            <!-- 1. íƒ€ê²Ÿë“±ë¡ íƒ­ -->
                            <div id="qmsTargetsTab" class="qms-subtab-content">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                    <!-- ì¢Œì¸¡: ì˜¤ë” ì„ íƒ -->
                                    <div class="bg-card rounded-xl shadow-sm p-4">
                                        <h3 class="font-bold mb-3 flex items-center gap-2">
                                            <span>ğŸ”</span>
                                            <span data-i18n="qms.targets.selectOrders">ì˜¤ë” ì„ íƒ</span>
                                        </h3>
                                        <!-- í•„í„° ì˜ì—­ -->
                                        <div class="grid grid-cols-2 gap-2 mb-3">
                                            <select id="qmsTargetDestFilter" class="input text-sm">
                                                <option value="">í–‰ì„ ì§€ ì „ì²´</option>
                                            </select>
                                            <select id="qmsTargetModelFilter" class="input text-sm">
                                                <option value="">ëª¨ë¸ ì „ì²´</option>
                                            </select>
                                            <select id="qmsTargetFactoryFilter" class="input text-sm">
                                                <option value="">ê³µì¥ ì „ì²´</option>
                                                <option value="A">Factory A</option>
                                                <option value="B">Factory B</option>
                                                <option value="C">Factory C</option>
                                                <option value="D">Factory D</option>
                                            </select>
                                            <input type="text" id="qmsTargetSearchInput" class="input text-sm" placeholder="PO/ëª¨ë¸ ê²€ìƒ‰...">
                                        </div>
                                        <!-- ì˜¤ë” ëª©ë¡ -->
                                        <div class="border dark:border-gray-700 rounded-lg overflow-hidden">
                                            <div class="max-h-[400px] overflow-y-auto">
                                                <table class="w-full text-sm">
                                                    <thead class="bg-gray-50 dark:bg-gray-800 sticky top-0">
                                                        <tr>
                                                            <th class="p-2 text-left w-8"><input type="checkbox" id="qmsSelectAllOrders" class="rounded"></th>
                                                            <th class="p-2 text-left">PO</th>
                                                            <th class="p-2 text-left">ëª¨ë¸</th>
                                                            <th class="p-2 text-left">í–‰ì„ ì§€</th>
                                                            <th class="p-2 text-right">ìˆ˜ëŸ‰</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="qmsOrdersTableBody">
                                                        <!-- JavaScriptë¡œ ë Œë”ë§ -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="mt-2 text-sm text-secondary">
                                            <span id="qmsSelectedCount">0</span>ê°œ ì„ íƒë¨
                                        </div>
                                    </div>

                                    <!-- ìš°ì¸¡: ë“±ë¡ ì–‘ì‹ -->
                                    <div class="bg-card rounded-xl shadow-sm p-4">
                                        <h3 class="font-bold mb-3 flex items-center gap-2">
                                            <span>ğŸ“</span>
                                            <span data-i18n="qms.targets.registerForm">íƒ€ê²Ÿ ë“±ë¡</span>
                                        </h3>
                                        <div class="space-y-3">
                                            <div>
                                                <label class="block text-sm font-medium mb-1" data-i18n="qms.targets.priority">ìš°ì„ ìˆœìœ„</label>
                                                <select id="qmsTargetPriority" class="input w-full">
                                                    <option value="high">ğŸ”´ ë†’ìŒ (High)</option>
                                                    <option value="medium" selected>ğŸŸ¡ ë³´í†µ (Medium)</option>
                                                    <option value="low">ğŸŸ¢ ë‚®ìŒ (Low)</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-1" data-i18n="qms.targets.notes">ë©”ëª¨</label>
                                                <textarea id="qmsTargetNotes" class="input w-full h-24 resize-none" placeholder="íƒ€ê²Ÿ ë“±ë¡ ì‚¬ìœ  ë˜ëŠ” ë©”ëª¨..."></textarea>
                                            </div>
                                            <button id="qmsRegisterTargetsBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                                <span data-i18n="qms.targets.register">ì„ íƒí•œ ì˜¤ë” íƒ€ê²Ÿìœ¼ë¡œ ë“±ë¡</span>
                                            </button>
                                        </div>

                                        <!-- ë“±ë¡ëœ íƒ€ê²Ÿ ëª©ë¡ -->
                                        <div class="mt-4 pt-4 border-t dark:border-gray-700">
                                            <h4 class="font-medium mb-2 flex items-center justify-between">
                                                <span data-i18n="qms.targets.registeredTargets">ë“±ë¡ëœ íƒ€ê²Ÿ</span>
                                                <span class="text-sm text-secondary" id="qmsRegisteredCount">0ê°œ</span>
                                            </h4>
                                            <div class="max-h-[200px] overflow-y-auto" id="qmsRegisteredTargetsList">
                                                <!-- JavaScriptë¡œ ë Œë”ë§ -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 2. ëª¨ë‹ˆí„°ë§í˜„í™© íƒ­ -->
                            <div id="qmsMonitoringTab" class="qms-subtab-content hidden">
                                <div class="bg-card rounded-xl shadow-sm p-4">
                                    <div class="flex items-center justify-between mb-4">
                                        <h3 class="font-bold flex items-center gap-2">
                                            <span>ğŸ“Š</span>
                                            <span data-i18n="qms.monitoring.title">ëª¨ë‹ˆí„°ë§ ëŒ€ìƒ í˜„í™©</span>
                                        </h3>
                                        <div class="flex gap-2">
                                            <select id="qmsMonitoringStatusFilter" class="input text-sm">
                                                <option value="">ìƒíƒœ ì „ì²´</option>
                                                <option value="active">í™œì„±</option>
                                                <option value="completed">ì™„ë£Œ</option>
                                                <option value="cancelled">ì·¨ì†Œ</option>
                                            </select>
                                        </div>
                                    </div>
                                    <!-- ìš”ì•½ ì¹´ë“œ -->
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                                        <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-3 text-center">
                                            <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="qmsMonitoringTotal">0</div>
                                            <div class="text-sm text-blue-700 dark:text-blue-300">ì „ì²´</div>
                                        </div>
                                        <div class="bg-green-50 dark:bg-green-900/30 rounded-lg p-3 text-center">
                                            <div class="text-2xl font-bold text-green-600 dark:text-green-400" id="qmsMonitoringActive">0</div>
                                            <div class="text-sm text-green-700 dark:text-green-300">í™œì„±</div>
                                        </div>
                                        <div class="bg-yellow-50 dark:bg-yellow-900/30 rounded-lg p-3 text-center">
                                            <div class="text-2xl font-bold text-yellow-600 dark:text-yellow-400" id="qmsMonitoringInProgress">0</div>
                                            <div class="text-sm text-yellow-700 dark:text-yellow-300">ì‘ì—…ì¤‘</div>
                                        </div>
                                        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-3 text-center">
                                            <div class="text-2xl font-bold text-gray-600 dark:text-gray-400" id="qmsMonitoringCompleted">0</div>
                                            <div class="text-sm text-gray-700 dark:text-gray-300">ì™„ë£Œ</div>
                                        </div>
                                    </div>
                                    <!-- ëª¨ë‹ˆí„°ë§ í…Œì´ë¸” -->
                                    <div class="border dark:border-gray-700 rounded-lg overflow-hidden">
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm">
                                                <thead class="bg-gray-50 dark:bg-gray-800">
                                                    <tr>
                                                        <th class="p-2 text-left">PO</th>
                                                        <th class="p-2 text-left">ëª¨ë¸</th>
                                                        <th class="p-2 text-left">í–‰ì„ ì§€</th>
                                                        <th class="p-2 text-center">ê³µì¥</th>
                                                        <th class="p-2 text-right">ìˆ˜ëŸ‰</th>
                                                        <th class="p-2 text-center">ì§„í–‰ë¥ </th>
                                                        <th class="p-2 text-center">ìƒíƒœ</th>
                                                        <th class="p-2 text-center">ì‘ì—…</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="qmsMonitoringTableBody">
                                                    <!-- JavaScriptë¡œ ë Œë”ë§ -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 3. ì‘ì—…ì§€ì‹œ íƒ­ -->
                            <div id="qmsAssignmentTab" class="qms-subtab-content hidden">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                    <!-- ì¢Œì¸¡: íƒ€ê²Ÿ ì„ íƒ -->
                                    <div class="bg-card rounded-xl shadow-sm p-4">
                                        <h3 class="font-bold mb-3 flex items-center gap-2">
                                            <span>ğŸ¯</span>
                                            <span data-i18n="qms.assignment.selectTarget">íƒ€ê²Ÿ ì„ íƒ</span>
                                        </h3>
                                        <div class="border dark:border-gray-700 rounded-lg overflow-hidden">
                                            <div class="max-h-[400px] overflow-y-auto">
                                                <table class="w-full text-sm">
                                                    <thead class="bg-gray-50 dark:bg-gray-800 sticky top-0">
                                                        <tr>
                                                            <th class="p-2 text-left w-8"><input type="radio" name="qmsAssignTarget" disabled></th>
                                                            <th class="p-2 text-left">PO</th>
                                                            <th class="p-2 text-left">ëª¨ë¸</th>
                                                            <th class="p-2 text-center">ìš°ì„ ìˆœìœ„</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="qmsAssignmentTargetsBody">
                                                        <!-- JavaScriptë¡œ ë Œë”ë§ -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ìš°ì¸¡: ì‘ì—… ì§€ì‹œ ì–‘ì‹ -->
                                    <div class="bg-card rounded-xl shadow-sm p-4">
                                        <h3 class="font-bold mb-3 flex items-center gap-2">
                                            <span>ğŸ“</span>
                                            <span data-i18n="qms.assignment.createTask">ì‘ì—… ì§€ì‹œ ìƒì„±</span>
                                        </h3>
                                        <div class="space-y-3">
                                            <div>
                                                <label class="block text-sm font-medium mb-1">ì‘ì—… ìœ í˜•</label>
                                                <select id="qmsTaskType" class="input w-full">
                                                    <option value="inspection">ğŸ” ê²€ìˆ˜ (Inspection)</option>
                                                    <option value="rework">ğŸ”§ ìˆ˜ì •/ì¬ì‘ì—… (Rework)</option>
                                                    <option value="custom">âš™ï¸ ì»¤ìŠ¤í…€ (Custom)</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-1">ì‘ì—… ì œëª©</label>
                                                <input type="text" id="qmsTaskTitle" class="input w-full" placeholder="ì‘ì—… ì œëª© ì…ë ¥...">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-1">ìƒì„¸ ì„¤ëª…</label>
                                                <textarea id="qmsTaskDescription" class="input w-full h-20 resize-none" placeholder="ì‘ì—… ìƒì„¸ ë‚´ìš©..."></textarea>
                                            </div>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label class="block text-sm font-medium mb-1">ë‹´ë‹¹ì</label>
                                                    <input type="email" id="qmsTaskAssignee" class="input w-full" placeholder="ë‹´ë‹¹ì ì´ë©”ì¼">
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium mb-1">ë§ˆê°ì¼</label>
                                                    <input type="date" id="qmsTaskDueDate" class="input w-full">
                                                </div>
                                            </div>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label class="block text-sm font-medium mb-1">ê³µì • ë‹¨ê³„</label>
                                                    <select id="qmsTaskProcessStage" class="input w-full">
                                                        <option value="">ì„ íƒ...</option>
                                                        <option value="s_cut">S_CUT (ì¬ë‹¨)</option>
                                                        <option value="pre_sew">PRE_SEW (ì„ ë´‰)</option>
                                                        <option value="sew_input">SEW_INPUT (ì¬ë´‰íˆ¬ì…)</option>
                                                        <option value="sew_bal">SEW_BAL (ì¬ë´‰)</option>
                                                        <option value="osc">OSC (ì™¸ì£¼)</option>
                                                        <option value="ass">ASS (ì¡°ë¦½)</option>
                                                        <option value="wh_in">WH_IN (ì…ê³ )</option>
                                                        <option value="wh_out">WH_OUT (ì¶œê³ )</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium mb-1">ì‘ì—… ìˆ˜ëŸ‰</label>
                                                    <input type="number" id="qmsTaskQuantity" class="input w-full" placeholder="ìˆ˜ëŸ‰" min="1">
                                                </div>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-1">ìš°ì„ ìˆœìœ„</label>
                                                <select id="qmsTaskPriority" class="input w-full">
                                                    <option value="high">ğŸ”´ ë†’ìŒ</option>
                                                    <option value="medium" selected>ğŸŸ¡ ë³´í†µ</option>
                                                    <option value="low">ğŸŸ¢ ë‚®ìŒ</option>
                                                </select>
                                            </div>
                                            <button id="qmsCreateTaskBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                                ì‘ì—… ì§€ì‹œ ìƒì„±
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 4. ì‘ì—…ëª©ë¡ íƒ­ -->
                            <div id="qmsTasklistTab" class="qms-subtab-content hidden">
                                <div class="bg-card rounded-xl shadow-sm p-4">
                                    <div class="flex items-center justify-between mb-4">
                                        <h3 class="font-bold flex items-center gap-2">
                                            <span>ğŸ“‘</span>
                                            <span data-i18n="qms.tasklist.title">ì‘ì—… ëª©ë¡</span>
                                        </h3>
                                        <div class="flex gap-2">
                                            <select id="qmsTasklistTypeFilter" class="input text-sm">
                                                <option value="">ìœ í˜• ì „ì²´</option>
                                                <option value="inspection">ê²€ìˆ˜</option>
                                                <option value="rework">ìˆ˜ì •/ì¬ì‘ì—…</option>
                                                <option value="custom">ì»¤ìŠ¤í…€</option>
                                            </select>
                                            <select id="qmsTasklistStatusFilter" class="input text-sm">
                                                <option value="">ìƒíƒœ ì „ì²´</option>
                                                <option value="pending">ëŒ€ê¸°ì¤‘</option>
                                                <option value="in_progress">ì§„í–‰ì¤‘</option>
                                                <option value="completed">ì™„ë£Œ</option>
                                                <option value="cancelled">ì·¨ì†Œ</option>
                                            </select>
                                        </div>
                                    </div>
                                    <!-- ì‘ì—… ëª©ë¡ í…Œì´ë¸” -->
                                    <div class="border dark:border-gray-700 rounded-lg overflow-hidden">
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm">
                                                <thead class="bg-gray-50 dark:bg-gray-800">
                                                    <tr>
                                                        <th class="p-2 text-left">ì‘ì—… ID</th>
                                                        <th class="p-2 text-left">ìœ í˜•</th>
                                                        <th class="p-2 text-left">ì œëª©</th>
                                                        <th class="p-2 text-left">ë‹´ë‹¹ì</th>
                                                        <th class="p-2 text-center">ë§ˆê°ì¼</th>
                                                        <th class="p-2 text-center">ìƒíƒœ</th>
                                                        <th class="p-2 text-center">ìš°ì„ ìˆœìœ„</th>
                                                        <th class="p-2 text-center">ì‘ì—…</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="qmsTasklistTableBody">
                                                    <!-- JavaScriptë¡œ ë Œë”ë§ -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 5. ê²°ê³¼ê´€ë¦¬ íƒ­ -->
                            <div id="qmsResultsTab" class="qms-subtab-content hidden">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                    <!-- ì¢Œì¸¡: ì™„ë£Œ ì‘ì—… ì„ íƒ -->
                                    <div class="bg-card rounded-xl shadow-sm p-4">
                                        <h3 class="font-bold mb-3 flex items-center gap-2">
                                            <span>ğŸ“‹</span>
                                            <span data-i18n="qms.results.selectTask">ì‘ì—… ì„ íƒ</span>
                                        </h3>
                                        <div class="border dark:border-gray-700 rounded-lg overflow-hidden">
                                            <div class="max-h-[350px] overflow-y-auto">
                                                <table class="w-full text-sm">
                                                    <thead class="bg-gray-50 dark:bg-gray-800 sticky top-0">
                                                        <tr>
                                                            <th class="p-2 text-left w-8"><input type="radio" name="qmsResultTask" disabled></th>
                                                            <th class="p-2 text-left">ì œëª©</th>
                                                            <th class="p-2 text-left">ìœ í˜•</th>
                                                            <th class="p-2 text-center">ìƒíƒœ</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="qmsResultsTasksBody">
                                                        <!-- JavaScriptë¡œ ë Œë”ë§ -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ìš°ì¸¡: ê²°ê³¼ ì…ë ¥ ì–‘ì‹ -->
                                    <div class="bg-card rounded-xl shadow-sm p-4">
                                        <h3 class="font-bold mb-3 flex items-center gap-2">
                                            <span>âœ…</span>
                                            <span data-i18n="qms.results.enterResult">ê²°ê³¼ ì…ë ¥</span>
                                        </h3>
                                        <div class="space-y-3">
                                            <div>
                                                <label class="block text-sm font-medium mb-1">ê²°ê³¼ ìƒíƒœ</label>
                                                <select id="qmsResultStatus" class="input w-full">
                                                    <option value="pass">âœ… í•©ê²© (Pass)</option>
                                                    <option value="fail">âŒ ë¶ˆí•©ê²© (Fail)</option>
                                                    <option value="partial">âš ï¸ ë¶€ë¶„í•©ê²© (Partial)</option>
                                                </select>
                                            </div>
                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label class="block text-sm font-medium mb-1">í•©ê²© ìˆ˜ëŸ‰</label>
                                                    <input type="number" id="qmsResultPassedQty" class="input w-full" min="0" value="0">
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium mb-1">ë¶ˆí•©ê²© ìˆ˜ëŸ‰</label>
                                                    <input type="number" id="qmsResultFailedQty" class="input w-full" min="0" value="0">
                                                </div>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-1">ë¶ˆí•©ê²© ì‚¬ìœ  (í•´ë‹¹ ì‹œ)</label>
                                                <div class="space-y-1" id="qmsFailureReasons">
                                                    <label class="flex items-center gap-2 text-sm">
                                                        <input type="checkbox" value="stitch" class="rounded"> ë´‰ì œ ë¶ˆëŸ‰
                                                    </label>
                                                    <label class="flex items-center gap-2 text-sm">
                                                        <input type="checkbox" value="material" class="rounded"> ì›ë‹¨ ê²°í•¨
                                                    </label>
                                                    <label class="flex items-center gap-2 text-sm">
                                                        <input type="checkbox" value="size" class="rounded"> ì¹˜ìˆ˜ ë¶ˆëŸ‰
                                                    </label>
                                                    <label class="flex items-center gap-2 text-sm">
                                                        <input type="checkbox" value="color" class="rounded"> ìƒ‰ìƒ ë¶ˆëŸ‰
                                                    </label>
                                                    <label class="flex items-center gap-2 text-sm">
                                                        <input type="checkbox" value="other" class="rounded"> ê¸°íƒ€
                                                    </label>
                                                </div>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-1">ë°œê²¬ ì‚¬í•­</label>
                                                <textarea id="qmsResultFindings" class="input w-full h-16 resize-none" placeholder="ê²€ìˆ˜ ì¤‘ ë°œê²¬ëœ ì‚¬í•­..."></textarea>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-1">ì¡°ì¹˜ ë‚´ìš©</label>
                                                <textarea id="qmsResultActions" class="input w-full h-16 resize-none" placeholder="ìˆ˜í–‰í•œ ì¡°ì¹˜ ë‚´ìš©..."></textarea>
                                            </div>
                                            <button id="qmsSaveResultBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                                ê²°ê³¼ ì €ì¥
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- ê²°ê³¼ íˆìŠ¤í† ë¦¬ -->
                                <div class="bg-card rounded-xl shadow-sm p-4 mt-4">
                                    <h3 class="font-bold mb-3 flex items-center gap-2">
                                        <span>ğŸ“œ</span>
                                        <span>ê²°ê³¼ íˆìŠ¤í† ë¦¬</span>
                                    </h3>
                                    <div class="border dark:border-gray-700 rounded-lg overflow-hidden">
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm">
                                                <thead class="bg-gray-50 dark:bg-gray-800">
                                                    <tr>
                                                        <th class="p-2 text-left">ì‘ì—…</th>
                                                        <th class="p-2 text-center">ê²°ê³¼</th>
                                                        <th class="p-2 text-right">í•©ê²©/ë¶ˆí•©ê²©</th>
                                                        <th class="p-2 text-left">ì™„ë£Œì</th>
                                                        <th class="p-2 text-left">ì™„ë£Œì¼ì‹œ</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="qmsResultsHistoryBody">
                                                    <!-- JavaScriptë¡œ ë Œë”ë§ -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Keyboard Shortcuts Help -->
        <div class="text-center text-sm text-secondary no-print">
            <span class="kbd">S</span> <span data-i18n="shortcuts.search">ê²€ìƒ‰</span> | <span class="kbd">F</span> <span data-i18n="shortcuts.filter">í•„í„°</span> | <span class="kbd">R</span> <span data-i18n="shortcuts.reset">ì´ˆê¸°í™”</span> | <span class="kbd">D</span> <span data-i18n="shortcuts.detailTab">ìƒì„¸íƒ­</span> | <span class="kbd">Esc</span> <span data-i18n="shortcuts.closeModal">ëª¨ë‹¬ë‹«ê¸°</span> | <span class="kbd">â†â†’</span> <span data-i18n="shortcuts.page">í˜ì´ì§€</span>
        </div>
    </div>

    <!-- Modal -->
    <div id="orderDetailModal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="bg-card rounded-xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden">
            <!-- Agent Q06: ëª¨ë°”ì¼ ë“œë˜ê·¸ í•¸ë“¤ -->
            <div class="modal-drag-handle" style="display: none;"></div>
            <div class="flex justify-between items-center p-4 border-b border-theme">
                <h3 class="text-lg font-semibold" id="modalTitle"><span data-i18n="modals.orderDetail">ìƒì„¸ ì •ë³´</span></h3>
                <button data-action="closeOrderModal" class="text-2xl hover:text-red-500">Ã—</button>
            </div>
            <div class="p-6 overflow-y-auto" style="max-height: calc(90vh - 120px);" id="modalContent"></div>
        </div>
    </div>

    <!-- Order Detail Modal (Process Visual) -->
    <div id="orderProcessModal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4">
        <div class="bg-card rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
            <!-- Agent Q06: ëª¨ë°”ì¼ ë“œë˜ê·¸ í•¸ë“¤ -->
            <div class="modal-drag-handle" style="display: none;"></div>
            <div class="flex justify-between items-center p-4 border-b border-theme">
                <h3 class="text-lg font-semibold" id="orderProcessTitle"><span data-i18n="modals.processDetail">ì˜¤ë” ìƒì„¸</span></h3>
                <button data-action="closeOrderProcessModal" class="text-2xl hover:text-red-500">Ã—</button>
            </div>
            <div class="p-6 overflow-y-auto" style="max-height: calc(90vh - 120px);" id="orderProcessContent"></div>
        </div>
    </div>

    <!-- Help Modal - ë„ì›€ë§ ëª¨ë‹¬ -->
    <div id="helpModal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4">
        <div class="bg-card rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
            <div class="flex justify-between items-center p-4 border-b border-theme bg-gradient-to-r from-blue-600 to-indigo-600 text-white">
                <h3 class="text-lg font-semibold"><span data-i18n="modals.helpTitle">ğŸ“– ëŒ€ì‹œë³´ë“œ ë¡œì§ ì„¤ëª…ì„œ</span></h3>
                <button data-action="closeHelpModal" class="text-2xl hover:text-red-300">Ã—</button>
            </div>
            <div class="p-6 overflow-y-auto text-sm" style="max-height: calc(90vh - 120px);">
                <!-- í•µì‹¬ ì§€í‘œ -->
                <section class="mb-6">
                    <h4 class="text-lg font-bold text-blue-600 dark:text-blue-400 mb-3 flex items-center gap-2"><span data-i18n="help.kpiTitle">ğŸ“Š ê²½ì˜ì§„ ì¸ì‚¬ì´íŠ¸ KPI</span></h4>

                    <div class="space-y-4">
                        <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border-l-4 border-green-500">
                            <h5 class="font-bold text-green-700 dark:text-green-400"><span data-i18n="help.kpi.otdTitle">ğŸ¯ ì •ì‹œ ë‚©ê¸°ìœ¨ (OTD - On-Time Delivery)</span></h5>
                            <p class="mt-1"><strong data-i18n="help.kpi.formula">ê³µì‹:</strong> (ì„ ì ì™„ë£Œ ì¤‘ SDD â‰¤ CRDì¸ ê±´ìˆ˜) / ì „ì²´ ì„ ì ì™„ë£Œ Ã— 100</p>
                            <p class="mt-1"><strong data-i18n="help.kpi.meaning">ì˜ë¯¸:</strong> ê³ ê° ìš”ì²­ì¼(CRD) ì´ì „ì— ì¶œê³ ëœ ë¹„ìœ¨</p>
                            <p class="mt-1"><strong data-i18n="help.kpi.goal">ëª©í‘œ:</strong> 95% ì´ìƒ (Green), 85-95% (Yellow), 85% ë¯¸ë§Œ (Red)</p>
                        </div>

                        <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border-l-4 border-red-500">
                            <h5 class="font-bold text-red-700 dark:text-red-400"><span data-i18n="help.kpi.revenueTitle">ğŸ’° ìœ„í—˜ ë§¤ì¶œì•¡ (Revenue at Risk)</span></h5>
                            <p class="mt-1"><strong data-i18n="help.kpi.formula">ê³µì‹:</strong> ì§€ì—° ì˜¤ë” ìˆ˜ëŸ‰ Ã— $10 (í‰ê·  ë‹¨ê°€)</p>
                            <p class="mt-1"><strong data-i18n="help.kpi.meaning">ì˜ë¯¸:</strong> ì§€ì—°ìœ¼ë¡œ ì¸í•´ ì†ì‹¤ ìœ„í—˜ì´ ìˆëŠ” ì˜ˆìƒ ë§¤ì¶œ</p>
                            <p class="mt-1"><strong data-i18n="help.kpi.goal">ëª©í‘œ:</strong> $0 (ëª¨ë“  ê¸ˆì•¡ì€ ìœ„í—˜ ì‹ í˜¸)</p>
                        </div>

                        <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border-l-4 border-blue-500">
                            <h5 class="font-bold text-blue-700 dark:text-blue-400"><span data-i18n="help.kpi.aqlTitle">âœ… í’ˆì§ˆ ê²€ì‚¬ í•©ê²©ë¥  (AQL Pass Rate)</span></h5>
                            <p class="mt-1"><strong data-i18n="help.kpi.formula">ê³µì‹:</strong> (aql=trueì¸ ê±´ìˆ˜) / AQL ë°ì´í„° ìˆëŠ” ì „ì²´ ê±´ìˆ˜ Ã— 100</p>
                            <p class="mt-1"><strong data-i18n="help.kpi.meaning">ì˜ë¯¸:</strong> í’ˆì§ˆ ê²€ì‚¬ë¥¼ í†µê³¼í•œ ì˜¤ë” ë¹„ìœ¨</p>
                            <p class="mt-1"><strong data-i18n="help.kpi.goal">ëª©í‘œ:</strong> 98% ì´ìƒ (Green), 95-98% (Yellow), 95% ë¯¸ë§Œ (Red)</p>
                        </div>

                        <div class="bg-amber-50 dark:bg-amber-900/20 p-4 rounded-lg border-l-4 border-amber-500">
                            <h5 class="font-bold text-amber-700 dark:text-amber-400"><span data-i18n="help.kpi.bottleneckTitle">âš ï¸ ì˜ˆì¸¡ ë³‘ëª© ê³µì •</span></h5>
                            <p class="mt-1"><strong data-i18n="help.kpi.formula">ê³µì‹:</strong> ê° ê³µì •ë³„ ì™„ë£Œìœ¨ ê³„ì‚° â†’ ìµœì € ì™„ë£Œìœ¨ ê³µì • ì‹ë³„</p>
                            <p class="mt-1"><strong data-i18n="help.kpi.meaning">ì˜ë¯¸:</strong> ê°€ì¥ ì§€ì—°ì´ ë§ì´ ë°œìƒí•  ê²ƒìœ¼ë¡œ ì˜ˆì¸¡ë˜ëŠ” ê³µì •</p>
                            <p class="mt-1"><strong data-i18n="help.kpi.action">ì¡°ì¹˜:</strong> í•´ë‹¹ ê³µì •ì— ìì› ì§‘ì¤‘ ë°°ì¹˜ í•„ìš”</p>
                        </div>
                    </div>
                </section>

                <!-- ì§€ì—° íŒì • ë¡œì§ -->
                <section class="mb-6">
                    <h4 class="text-lg font-bold text-red-600 dark:text-red-400 mb-3 flex items-center gap-2"><span data-i18n="help.delayLogicTitle">ğŸš¨ ì§€ì—° íŒì • ë¡œì§</span></h4>
                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                        <pre class="text-xs overflow-x-auto">
function isDelayed(d) {
    // Code04 ìŠ¹ì¸ëœ ê²½ìš° ì§€ì—° ì•„ë‹˜
    if (d.code04) return false;

    // SDDì™€ CRD ë¹„êµ
    const sdd = parseDate(d.sddValue);  // ì˜ˆì • ì¶œê³ ì¼
    const crd = parseDate(d.crd);        // ê³ ê° ìš”ì²­ì¼

    // SDDê°€ CRDë³´ë‹¤ ëŠ¦ìœ¼ë©´ ì§€ì—°
    return sdd > crd;
}</pre>
                        <p class="mt-2 text-secondary"><strong>í•µì‹¬:</strong> SDD(Scheduled Delivery Date) > CRD(Customer Required Date)ì´ë©´ ì§€ì—°</p>
                    </div>
                </section>

                <!-- ê²½ê³  íŒì • ë¡œì§ -->
                <section class="mb-6">
                    <h4 class="text-lg font-bold text-amber-600 dark:text-amber-400 mb-3 flex items-center gap-2"><span data-i18n="help.warningLogicTitle">âš¡ ê²½ê³  (3ì¼ ë‚´ ì˜ˆì •) íŒì • ë¡œì§</span></h4>
                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                        <pre class="text-xs overflow-x-auto">
function isWarning(d) {
    // ì´ë¯¸ ì§€ì—°ì´ë©´ ê²½ê³  ì•„ë‹˜ (ì§€ì—°ì´ ë” ì‹¬ê°)
    if (isDelayed(d)) return false;

    const today = new Date();
    const sdd = parseDate(d.sddValue);

    // 3ì¼ ì´ë‚´ ì˜ˆì •ì´ë©´ ê²½ê³ 
    const diffDays = (sdd - today) / (1000 * 60 * 60 * 24);
    return diffDays >= 0 && diffDays <= 3;
}</pre>
                    </div>
                </section>

                <!-- ì„ ì  ì™„ë£Œ íŒì • -->
                <section class="mb-6">
                    <h4 class="text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-3 flex items-center gap-2"><span data-i18n="help.shippedLogicTitle">ğŸš¢ ì„ ì  ì™„ë£Œ íŒì • ë¡œì§</span></h4>
                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                        <pre class="text-xs overflow-x-auto">
function isShipped(d) {
    const whOutCompleted = d.production?.wh_out?.completed || 0;
    const qty = d.quantity || 0;

    // ì°½ê³ ì¶œê³  ì™„ë£ŒëŸ‰ >= ì£¼ë¬¸ìˆ˜ëŸ‰ì´ë©´ ì„ ì  ì™„ë£Œ
    return qty > 0 && whOutCompleted >= qty;
}</pre>
                    </div>
                </section>

                <!-- ìƒì‚° ê³µì • ìˆœì„œ -->
                <section class="mb-6">
                    <h4 class="text-lg font-bold text-purple-600 dark:text-purple-400 mb-3 flex items-center gap-2"><span data-i18n="help.productionProcessTitle">ğŸ­ ìƒì‚° ê³µì • ìˆœì„œ</span></h4>
                    <div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg">
                        <div class="flex flex-wrap items-center gap-2 text-sm">
                            <span class="px-3 py-1 bg-purple-100 dark:bg-purple-800 rounded" data-i18n="help.processes.sCut">S_CUT (ì¬ë‹¨)</span>
                            <span>â†’</span>
                            <span class="px-3 py-1 bg-purple-100 dark:bg-purple-800 rounded" data-i18n="help.processes.preSew">PRE_SEW (ì„ ë´‰)</span>
                            <span>â†’</span>
                            <span class="px-3 py-1 bg-purple-100 dark:bg-purple-800 rounded" data-i18n="help.processes.sewInput">SEW_INPUT (ì¬ë´‰íˆ¬ì…)</span>
                            <span>â†’</span>
                            <span class="px-3 py-1 bg-purple-100 dark:bg-purple-800 rounded" data-i18n="help.processes.sewBal">SEW_BAL (ì¬ë´‰)</span>
                            <span>â†’</span>
                            <span class="px-3 py-1 bg-purple-100 dark:bg-purple-800 rounded" data-i18n="help.processes.osc">OSC (ì™¸ì£¼)</span>
                            <span>â†’</span>
                            <span class="px-3 py-1 bg-purple-100 dark:bg-purple-800 rounded" data-i18n="help.processes.ass">ASS (ì¡°ë¦½)</span>
                            <span>â†’</span>
                            <span class="px-3 py-1 bg-purple-100 dark:bg-purple-800 rounded" data-i18n="help.processes.whIn">WH_IN (ì°½ê³ ì…ê³ )</span>
                            <span>â†’</span>
                            <span class="px-3 py-1 bg-purple-100 dark:bg-purple-800 rounded" data-i18n="help.processes.whOut">WH_OUT (ì°½ê³ ì¶œê³ )</span>
                        </div>
                    </div>
                </section>

                <!-- ë²¤ë” ì„±ê³¼ ì ìˆ˜ -->
                <section class="mb-6">
                    <h4 class="text-lg font-bold text-indigo-600 dark:text-indigo-400 mb-3 flex items-center gap-2"><span data-i18n="help.vendorScoreTitle">ğŸ† ë²¤ë” ì„±ê³¼ ì ìˆ˜ ê³„ì‚°</span></h4>
                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                        <pre class="text-xs overflow-x-auto" data-i18n="help.vendorScoreCode">// ë²¤ë” ì„±ê³¼ ì ìˆ˜ = (ì™„ë£Œìœ¨ Ã— 0.7) - (ì§€ì—°ìœ¨ Ã— 0.3)
function calculateVendorScore(vendor) {
    const completionRate = (completed / total) * 100;
    const delayRate = (delayed / total) * 100;
    return (completionRate * 0.7) - (delayRate * 0.3);
}

// í•´ì„:
// 80ì  ì´ìƒ: ìš°ìˆ˜ (Green)
// 50-80ì : ë³´í†µ (Yellow)
// 50ì  ë¯¸ë§Œ: ê°œì„  í•„ìš” (Red)</pre>
                    </div>
                </section>

                <!-- ì§€ì—° ì‹¬ê°ë„ ë¶„ë¥˜ -->
                <section class="mb-6">
                    <h4 class="text-lg font-bold text-gray-600 dark:text-gray-400 mb-3 flex items-center gap-2"><span data-i18n="help.delaySeverityTitle">ğŸ“‰ ì§€ì—° ì‹¬ê°ë„ ë¶„ë¥˜</span></h4>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="bg-green-100 dark:bg-green-900/30 p-3 rounded text-center">
                            <div class="text-2xl mb-1">ğŸŸ¢</div>
                            <div class="font-bold text-green-700 dark:text-green-400" data-i18n="help.severity.minorTitle">ê²½ë¯¸</div>
                            <div class="text-xs" data-i18n="help.severity.minorDesc">1-3ì¼ ì§€ì—°</div>
                        </div>
                        <div class="bg-amber-100 dark:bg-amber-900/30 p-3 rounded text-center">
                            <div class="text-2xl mb-1">ğŸŸ¡</div>
                            <div class="font-bold text-amber-700 dark:text-amber-400" data-i18n="help.severity.moderateTitle">ì£¼ì˜</div>
                            <div class="text-xs" data-i18n="help.severity.moderateDesc">4-7ì¼ ì§€ì—°</div>
                        </div>
                        <div class="bg-red-100 dark:bg-red-900/30 p-3 rounded text-center">
                            <div class="text-2xl mb-1">ğŸ”´</div>
                            <div class="font-bold text-red-700 dark:text-red-400" data-i18n="help.severity.severeTitle">ì‹¬ê°</div>
                            <div class="text-xs" data-i18n="help.severity.severeDesc">7ì¼+ ì§€ì—°</div>
                        </div>
                    </div>
                </section>

                <!-- ì£¼ìš” í•„ë“œ ì„¤ëª… -->
                <section>
                    <h4 class="text-lg font-bold text-gray-600 dark:text-gray-400 mb-3 flex items-center gap-2"><span data-i18n="help.dataFieldsTitle">ğŸ“‹ ì£¼ìš” ë°ì´í„° í•„ë“œ</span></h4>
                    <table class="w-full text-xs">
                        <caption class="sr-only" data-i18n="help.fields.tableCaption">ëŒ€ì‹œë³´ë“œ ì£¼ìš” ë°ì´í„° í•„ë“œ ì„¤ëª… í…Œì´ë¸” (í•„ë“œëª…ê³¼ ì„¤ëª…)</caption>
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="p-2 text-left" data-i18n="help.fields.fieldHeader">í•„ë“œ</th>
                                <th class="p-2 text-left" data-i18n="help.fields.descHeader">ì„¤ëª…</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                            <tr><td class="p-2 font-mono">SDD</td><td class="p-2" data-i18n="help.fields.sddDesc">Scheduled Delivery Date - ì˜ˆì • ì¶œê³ ì¼</td></tr>
                            <tr><td class="p-2 font-mono">CRD</td><td class="p-2" data-i18n="help.fields.crdDesc">Customer Required Date - ê³ ê° ìš”ì²­ì¼</td></tr>
                            <tr><td class="p-2 font-mono">Code04</td><td class="p-2" data-i18n="help.fields.code04Desc">ì§€ì—° ìŠ¹ì¸ ì—¬ë¶€ (trueë©´ ì§€ì—°ìœ¼ë¡œ ë³´ì§€ ì•ŠìŒ)</td></tr>
                            <tr><td class="p-2 font-mono">AQL</td><td class="p-2" data-i18n="help.fields.aqlDesc">Acceptable Quality Level - í’ˆì§ˆ ê²€ì‚¬ í†µê³¼ ì—¬ë¶€</td></tr>
                            <tr><td class="p-2 font-mono">remaining</td><td class="p-2" data-i18n="help.fields.remainingDesc">ê° ê³µì •ë³„ ì”ëŸ‰ (quantity - completed)</td></tr>
                            <tr><td class="p-2 font-mono">outsoleVendor</td><td class="p-2" data-i18n="help.fields.outsoleVendorDesc">ì•„ì›ƒì†” ê³µê¸‰ ë²¤ë”</td></tr>
                        </tbody>
                    </table>
                </section>

                <!-- Agent Q04: ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¸°ëŠ¥ -->
                <section class="mb-6">
                    <h4 class="text-lg font-bold text-blue-600 dark:text-blue-400 mb-3 flex items-center gap-2"><span data-i18n="help.notificationTitle">ğŸ”” ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¸°ëŠ¥</span></h4>
                    <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border-l-4 border-blue-500">
                        <h5 class="font-bold text-blue-700 dark:text-blue-400 mb-2" data-i18n="help.notification.subtitle">ì‹¤ì‹œê°„ ì§€ì—° ì˜¤ë” ì•Œë¦¼</h5>
                        <p class="mb-2" data-i18n="help.notification.activation"><strong>í™œì„±í™” ë°©ë²•:</strong> í—¤ë”ì˜ ğŸ”• ë²„íŠ¼ í´ë¦­ â†’ ê¶Œí•œ í—ˆìš© â†’ ğŸ””ë¡œ ë³€ê²½</p>
                        <p class="mb-2" data-i18n="help.notification.conditionsLabel"><strong>ì•Œë¦¼ ì¡°ê±´:</strong></p>
                        <ul class="list-disc list-inside ml-4 space-y-1 text-sm">
                            <li data-i18n="help.notification.delayedCondition"><strong>ì§€ì—° ì˜¤ë”:</strong> SDDê°€ CRDë¥¼ ì´ˆê³¼í•œ ê²½ìš° (Code04 ì œì™¸)</li>
                            <li data-i18n="help.notification.warningCondition"><strong>ê²½ê³  ì˜¤ë”:</strong> CRDê¹Œì§€ 7ì¼ ì´ë‚´ ë‚¨ì€ ê²½ìš° (ì„ íƒ ì‚¬í•­)</li>
                        </ul>
                        <p class="mt-2" data-i18n="help.notification.checkInterval"><strong>ì²´í¬ ì£¼ê¸°:</strong> 5ë¶„ë§ˆë‹¤ ìë™ í™•ì¸ (ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰)</p>
                        <p class="mt-2 text-xs text-gray-600 dark:text-gray-400" data-i18n="help.notification.tip">ğŸ’¡ íŒ: ë¸Œë¼ìš°ì €ë¥¼ ë‹«ì•„ë„ ì•Œë¦¼ì€ ì‹œìŠ¤í…œ íŠ¸ë ˆì´ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script type="module">
        // ========================================
        // H06-8: MVC êµ¬ì¡° ë¦¬íŒ©í† ë§ - ChartModel ì„í¬íŠ¸
        // Agent A07: MVC Architect
        // ========================================
        import {
            analyzeDailyReport,
            analyzeWeeklyReport,
            analyzeMonthlyReport,
            calculateVendorPerformance,
            predictBottleneck,
            PROCESS_ORDER,
            PROCESS_LABELS,
            PROCESS_KEY_MAP
        } from './src/models/ChartModel.js';

        // Data and state
        let allData = [];
        let filteredData = [];
        let currentPage = 1;
        let PAGE_SIZE = 50;  // Dynamic page size (Agent #R04: Performance Optimizer)
        let currentCalendarDate = new Date();
        let charts = {};
        let dateMode = 'sdd'; // 'sdd' or 'crd'
        let dateRangeFilter = 'all'; // 'all', 'week', 'month'

        // Production mode flag (disable console in production)
        const IS_PRODUCTION = location.hostname !== 'localhost' && location.hostname !== '127.0.0.1';
        const DEBUG = !IS_PRODUCTION;

        // Conditional logging
        const log = {
            debug: (...args) => DEBUG && console.log('[DEBUG]', ...args),
            info: (...args) => DEBUG && console.info('[INFO]', ...args),
            warn: (...args) => console.warn('[WARN]', ...args),
            error: (...args) => console.error('[ERROR]', ...args)
        };

        // ========================================
        // Agent Q03: SettingsManager - ì‚¬ìš©ì ì„¤ì • ì˜êµ¬ ì €ì¥
        // Phase 4 - Step 5: Q03-1 (CRITICAL)
        // ========================================
        class SettingsManager {
            constructor() {
                this.storageKey = 'rachgia_dashboard_settings';
                this.defaults = {
                    pageSize: 50,
                    darkMode: false,
                    defaultTab: 'monthly',
                    // Agent Q03: ì»¬ëŸ¼ í‘œì‹œ/ìˆ¨ê¹€ ì„¤ì • (Phase 4 - Q03-5)
                    columns: {
                        factory: true,
                        poNumber: true,
                        model: true,
                        article: true,
                        destination: true,
                        outsoleVendor: true,
                        quantity: true,
                        cutting: true,      // ì¬ë‹¨
                        sewing: true,       // ì¬ë´‰
                        assembly: true,     // ì¡°ë¦½
                        warehouseIn: true,  // ì…ê³ 
                        crd: true,
                        sdd: true,
                        status: true
                    },
                    // Agent Q01: ë‚´ë³´ë‚´ê¸° ì»¬ëŸ¼ ì„ íƒ (Phase 4 - Q01-3)
                    exportColumns: {
                        factory: true,
                        poNumber: true,
                        model: true,
                        article: true,
                        destination: true,
                        outsoleVendor: true,
                        quantity: true,
                        crd: true,
                        sdd: true,
                        cutting: true,
                        sewing: true,
                        assembly: true,
                        warehouseIn: true,
                        status: true,
                        delayed: true,
                        warning: true
                    },
                    exportColumnPresets: {},  // ì»¬ëŸ¼ ì„ íƒ í”„ë¦¬ì…‹ ì €ì¥
                    filterPresets: {},
                    sortColumn: 'crd',
                    sortDirection: 'asc',
                    lastFilterState: {},
                    // Agent Q02: í•„í„° ë¡œì§ ì œì–´ (Phase 4 - Q02-2)
                    filterLogic: 'AND',  // 'AND' or 'OR'
                    // Agent Q02: í•„í„° íˆìŠ¤í† ë¦¬ (ìµœê·¼ 5ê°œ)
                    filterHistory: [],
                    // Agent Q04: ë¸Œë¼ìš°ì € ì•Œë¦¼ ì„¤ì • (Phase 4 - Q04-5 í™•ì¥)
                    notifications: {
                        enabled: false,
                        delayedOrders: true,
                        warningOrders: false,
                        criticalOrders: false,  // 3ì¼ ì´ë‚´ ê¸´ê¸‰ ì˜¤ë”
                        checkInterval: 300000,  // 5ë¶„ (ë°€ë¦¬ì´ˆ)
                        quietHoursStart: '',    // ìŒì†Œê±° ì‹œì‘ (HH:MM)
                        quietHoursEnd: ''       // ìŒì†Œê±° ì¢…ë£Œ (HH:MM)
                    }
                };
                this.settings = this.load();
                log.info('SettingsManager initialized:', this.settings);
            }

            // ì „ì²´ ì„¤ì • ë¡œë“œ
            load() {
                try {
                    const stored = localStorage.getItem(this.storageKey);
                    if (stored) {
                        const parsed = JSON.parse(stored);
                        // ê¸°ë³¸ê°’ê³¼ ë³‘í•© (ìƒˆë¡œìš´ ì„¤ì • í•­ëª© ëŒ€ì‘)
                        return { ...this.defaults, ...parsed };
                    }
                } catch (e) {
                    log.error('Settings load error:', e);
                }
                return { ...this.defaults };
            }

            // ì „ì²´ ì„¤ì • ì €ì¥
            save(settings = this.settings) {
                try {
                    this.settings = settings;
                    localStorage.setItem(this.storageKey, JSON.stringify(settings));
                    log.debug('Settings saved:', settings);
                    return true;
                } catch (e) {
                    log.error('Settings save error:', e);
                    return false;
                }
            }

            // ê°œë³„ ì„¤ì • ê°’ ê°€ì ¸ì˜¤ê¸°
            get(key) {
                return this.settings[key] !== undefined ? this.settings[key] : this.defaults[key];
            }

            // ê°œë³„ ì„¤ì • ê°’ ì €ì¥
            set(key, value) {
                this.settings[key] = value;
                return this.save();
            }

            // í•„í„° í”„ë¦¬ì…‹ ì €ì¥
            saveFilterPreset(name, filters) {
                if (!name || !filters) return false;
                const presets = this.get('filterPresets') || {};
                presets[name] = {
                    filters: filters,
                    created: new Date().toISOString(),
                    lastUsed: new Date().toISOString()
                };
                return this.set('filterPresets', presets);
            }

            // í•„í„° í”„ë¦¬ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°
            loadFilterPreset(name) {
                const presets = this.get('filterPresets') || {};
                if (presets[name]) {
                    presets[name].lastUsed = new Date().toISOString();
                    this.set('filterPresets', presets);
                    return presets[name].filters;
                }
                return null;
            }

            // í•„í„° í”„ë¦¬ì…‹ ì‚­ì œ
            deleteFilterPreset(name) {
                const presets = this.get('filterPresets') || {};
                if (presets[name]) {
                    delete presets[name];
                    return this.set('filterPresets', presets);
                }
                return false;
            }

            // í•„í„° í”„ë¦¬ì…‹ ëª©ë¡
            listFilterPresets() {
                const presets = this.get('filterPresets') || {};
                return Object.entries(presets).map(([name, data]) => ({
                    name,
                    created: data.created,
                    lastUsed: data.lastUsed,
                    filters: data.filters
                })).sort((a, b) => new Date(b.lastUsed) - new Date(a.lastUsed));
            }

            // í˜„ì¬ í•„í„° ìƒíƒœ ì €ì¥
            saveCurrentFilterState(filters) {
                return this.set('lastFilterState', filters);
            }

            // ë§ˆì§€ë§‰ í•„í„° ìƒíƒœ ë³µì›
            restoreFilterState() {
                return this.get('lastFilterState') || {};
            }

            // ========================================
            // Agent Q02: í•„í„° íˆìŠ¤í† ë¦¬ ê´€ë¦¬
            // Phase 4 - Step 5: Q02-5 (MEDIUM)
            // ========================================

            // í•„í„° íˆìŠ¤í† ë¦¬ì— í˜„ì¬ í•„í„° ì¶”ê°€ (ìµœê·¼ 5ê°œ ìœ ì§€)
            saveFilterHistory(filters) {
                const history = this.get('filterHistory') || [];

                // ë¹ˆ í•„í„°ëŠ” ì €ì¥í•˜ì§€ ì•ŠìŒ
                if (!filters.month && !filters.destination && !filters.vendor && !filters.status && !filters.search) {
                    return;
                }

                // íƒ€ì„ìŠ¤íƒ¬í”„ì™€ í•¨ê»˜ í•„í„° ìƒíƒœ ì €ì¥
                const entry = {
                    filters: { ...filters },
                    timestamp: new Date().toISOString(),
                    label: this._generateFilterLabel(filters)
                };

                // ë™ì¼í•œ í•„í„°ê°€ ì´ë¯¸ ìˆìœ¼ë©´ ì œê±° (ì¤‘ë³µ ë°©ì§€)
                const existingIndex = history.findIndex(h =>
                    JSON.stringify(h.filters) === JSON.stringify(filters)
                );
                if (existingIndex !== -1) {
                    history.splice(existingIndex, 1);
                }

                // ë§¨ ì•ì— ì¶”ê°€ (ìµœì‹ ìˆœ)
                history.unshift(entry);

                // ìµœëŒ€ 5ê°œë§Œ ìœ ì§€
                if (history.length > 5) {
                    history.splice(5);
                }

                this.set('filterHistory', history);
                log.debug(`Filter history saved: ${entry.label}`);
            }

            // í•„í„° íˆìŠ¤í† ë¦¬ ê°€ì ¸ì˜¤ê¸°
            getFilterHistory() {
                return this.get('filterHistory') || [];
            }

            // í•„í„° íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”
            clearFilterHistory() {
                this.set('filterHistory', []);
                log.info('Filter history cleared');
            }

            // í•„í„° ë ˆì´ë¸” ìƒì„± (ì‚¬ìš©ì ì¹œí™”ì  í‘œì‹œ)
            _generateFilterLabel(filters) {
                const parts = [];
                if (filters.month) parts.push(`ì›”:${filters.month}`);
                if (filters.destination) parts.push(`í–‰ì„ ì§€:${filters.destination}`);
                if (filters.vendor) parts.push(`ë²¤ë”:${filters.vendor}`);
                if (filters.status) parts.push(`ìƒíƒœ:${filters.status}`);
                if (filters.search) parts.push(`ê²€ìƒ‰:"${filters.search}"`);
                // Agent Q02: ìˆ˜ëŸ‰ ë²”ìœ„ ë ˆì´ë¸” (Phase 4 - Q02-3)
                if (filters.minQuantity && filters.maxQuantity) {
                    parts.push(`ìˆ˜ëŸ‰:${filters.minQuantity}~${filters.maxQuantity}`);
                } else if (filters.minQuantity) {
                    parts.push(`ìˆ˜ëŸ‰:${filters.minQuantity}+`);
                } else if (filters.maxQuantity) {
                    parts.push(`ìˆ˜ëŸ‰:~${filters.maxQuantity}`);
                }
                return parts.length > 0 ? parts.join(' + ') : 'ì „ì²´';
            }

            // ========================================
            // Agent Q03: ì»¬ëŸ¼ í‘œì‹œ/ìˆ¨ê¹€ ê´€ë¦¬
            // Phase 4 - Step 5: Q03-5 (MEDIUM)
            // ========================================

            // ì»¬ëŸ¼ ê°€ì‹œì„± ê°€ì ¸ì˜¤ê¸°
            getColumnVisibility(columnName) {
                const columns = this.get('columns') || {};
                return columns[columnName] !== false; // ê¸°ë³¸ê°’ true
            }

            // ì»¬ëŸ¼ ê°€ì‹œì„± ì„¤ì •
            setColumnVisibility(columnName, visible) {
                const columns = this.get('columns') || {};
                columns[columnName] = visible;
                this.set('columns', columns);
                log.debug(`Column "${columnName}" visibility set to ${visible}`);
            }

            // ëª¨ë“  ì»¬ëŸ¼ ê°€ì‹œì„± ê°€ì ¸ì˜¤ê¸°
            getAllColumnVisibility() {
                return this.get('columns') || {};
            }

            // ì—¬ëŸ¬ ì»¬ëŸ¼ ê°€ì‹œì„± ì¼ê´„ ì„¤ì •
            setAllColumnVisibility(columnsObj) {
                this.set('columns', columnsObj);
                log.info('All column visibility updated');
            }

            // ì„¤ì • ì´ˆê¸°í™”
            reset() {
                this.settings = { ...this.defaults };
                return this.save();
            }

            // ì„¤ì • ë‚´ë³´ë‚´ê¸° (ë°±ì—…ìš©)
            export() {
                return JSON.stringify(this.settings, null, 2);
            }

            // ì„¤ì • ê°€ì ¸ì˜¤ê¸° (ë³µì›ìš©)
            import(jsonString) {
                try {
                    const imported = JSON.parse(jsonString);
                    this.settings = { ...this.defaults, ...imported };
                    return this.save();
                } catch (e) {
                    log.error('Settings import error:', e);
                    return false;
                }
            }
        }

        // SettingsManager ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
        const settings = new SettingsManager();

        // ========================================
        // QMS (Quality Management Work Monitoring System)
        // Agent QMS: í’ˆì§ˆ ê´€ë¦¬ ì‘ì—… ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ
        // Google Sheets ì—°ë™ + ë‹¤ì¤‘ ì‚¬ìš©ì ì§€ì›
        // ========================================
        class QMSManager {
            constructor() {
                this.storageKey = 'rachgia_qms_settings';
                this.cacheKeys = {
                    targets: 'qms_targets_cache',
                    tasks: 'qms_tasks_cache',
                    results: 'qms_results_cache'
                };

                // Google Sheets API ì„¤ì •
                this.googleSheetsConfig = {
                    spreadsheetId: null,  // ì‚¬ìš©ìê°€ ì„¤ì •ì—ì„œ ì…ë ¥
                    clientId: null,        // Google Cloud Consoleì—ì„œ ë°œê¸‰
                    apiKey: null,          // Google Cloud Consoleì—ì„œ ë°œê¸‰
                    scopes: 'https://www.googleapis.com/auth/spreadsheets',
                    discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4']
                };

                // í˜„ì¬ ì‚¬ìš©ì ì •ë³´
                this.currentUser = null;
                this.userRole = 'viewer'; // admin, manager, inspector, viewer

                // ë™ê¸°í™” ì„¤ì •
                this.syncInterval = 30000; // 30ì´ˆ
                this.syncTimer = null;
                this.lastSync = null;

                // ìƒíƒœ í”Œë˜ê·¸
                this.isInitialized = false;
                this.isAuthenticated = false;
                this.isOnline = navigator.onLine;

                // ìºì‹œëœ ë°ì´í„°
                this.cachedTargets = [];
                this.cachedTasks = [];
                this.cachedResults = [];

                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                this._setupEventListeners();

                log.info('QMSManager constructor completed');
            }

            // ========================================
            // ì´ˆê¸°í™” ë° ì¸ì¦
            // ========================================

            /**
             * QMS ì‹œìŠ¤í…œ ì´ˆê¸°í™”
             * Google API ë¡œë“œ ë° ì¸ì¦ ìƒíƒœ í™•ì¸
             */
            async init() {
                try {
                    log.info('QMSManager initializing...');

                    // ì €ì¥ëœ ì„¤ì • ë¡œë“œ
                    this._loadSettings();

                    // Google API ë¡œë“œ
                    await this._loadGoogleAPI();

                    // ì¸ì¦ ìƒíƒœ í™•ì¸
                    await this.checkAuth();

                    // ì˜¤í”„ë¼ì¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                    this._setupOnlineOfflineListeners();

                    this.isInitialized = true;
                    log.info('QMSManager initialized successfully');

                    return true;
                } catch (error) {
                    log.error('QMSManager init error:', error);
                    return false;
                }
            }

            /**
             * Google API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
             */
            async _loadGoogleAPI() {
                return new Promise((resolve, reject) => {
                    // ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆìœ¼ë©´ ìŠ¤í‚µ
                    if (window.gapi && window.google) {
                        resolve();
                        return;
                    }

                    // Google API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
                    const gapiScript = document.createElement('script');
                    gapiScript.src = 'https://apis.google.com/js/api.js';
                    gapiScript.async = true;
                    gapiScript.defer = true;

                    gapiScript.onload = () => {
                        // Google Identity Services ë¡œë“œ
                        const gisScript = document.createElement('script');
                        gisScript.src = 'https://accounts.google.com/gsi/client';
                        gisScript.async = true;
                        gisScript.defer = true;

                        gisScript.onload = () => {
                            log.info('Google API scripts loaded');
                            resolve();
                        };
                        gisScript.onerror = () => reject(new Error('Failed to load GIS'));

                        document.head.appendChild(gisScript);
                    };
                    gapiScript.onerror = () => reject(new Error('Failed to load GAPI'));

                    document.head.appendChild(gapiScript);
                });
            }

            /**
             * ì¸ì¦ ìƒíƒœ í™•ì¸
             */
            async checkAuth() {
                try {
                    if (!window.gapi || !this.googleSheetsConfig.clientId) {
                        this.isAuthenticated = false;
                        this._updateAuthUI();
                        return false;
                    }

                    // gapi.client ì´ˆê¸°í™”
                    await new Promise((resolve, reject) => {
                        gapi.load('client', { callback: resolve, onerror: reject });
                    });

                    await gapi.client.init({
                        apiKey: this.googleSheetsConfig.apiKey,
                        discoveryDocs: this.googleSheetsConfig.discoveryDocs
                    });

                    // ì €ì¥ëœ í† í° í™•ì¸
                    const savedToken = this._getSavedToken();
                    if (savedToken && this._isTokenValid(savedToken)) {
                        gapi.client.setToken(savedToken);
                        this.isAuthenticated = true;
                        this.currentUser = savedToken.email || 'Unknown';
                        await this._loadUserRole();
                        this._updateAuthUI();
                        this.startSync();
                        return true;
                    }

                    this.isAuthenticated = false;
                    this._updateAuthUI();
                    return false;
                } catch (error) {
                    log.error('checkAuth error:', error);
                    this.isAuthenticated = false;
                    this._updateAuthUI();
                    return false;
                }
            }

            /**
             * Google ë¡œê·¸ì¸
             */
            async signIn() {
                try {
                    if (!this.googleSheetsConfig.clientId) {
                        showToast('QMS ì„¤ì •ì—ì„œ Google Client IDë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.', 'warning');
                        return false;
                    }

                    const tokenClient = google.accounts.oauth2.initTokenClient({
                        client_id: this.googleSheetsConfig.clientId,
                        scope: this.googleSheetsConfig.scopes,
                        callback: async (response) => {
                            if (response.error) {
                                log.error('Sign-in error:', response.error);
                                showToast('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                                return;
                            }

                            // í† í° ì €ì¥
                            const token = gapi.client.getToken();
                            token.expiry = Date.now() + (response.expires_in * 1000);
                            this._saveToken(token);

                            // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                            await this._fetchUserInfo();
                            await this._loadUserRole();

                            this.isAuthenticated = true;
                            this._updateAuthUI();
                            this.startSync();

                            showToast('QMSì— ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                            log.info('QMS sign-in successful');
                        }
                    });

                    tokenClient.requestAccessToken({ prompt: 'consent' });
                    return true;
                } catch (error) {
                    log.error('signIn error:', error);
                    showToast('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                    return false;
                }
            }

            /**
             * Google ë¡œê·¸ì•„ì›ƒ
             */
            async signOut() {
                try {
                    const token = gapi.client.getToken();
                    if (token) {
                        google.accounts.oauth2.revoke(token.access_token);
                        gapi.client.setToken(null);
                    }

                    this._clearSavedToken();
                    this.currentUser = null;
                    this.userRole = 'viewer';
                    this.isAuthenticated = false;
                    this.stopSync();
                    this._updateAuthUI();

                    showToast('QMSì—ì„œ ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
                    log.info('QMS sign-out successful');
                    return true;
                } catch (error) {
                    log.error('signOut error:', error);
                    return false;
                }
            }

            // ========================================
            // Google Sheets CRUD ì—°ì‚°
            // ========================================

            /**
             * ì‹œíŠ¸ì—ì„œ ë°ì´í„° ì½ê¸°
             * @param {string} sheetName - ì‹œíŠ¸ ì´ë¦„ (QMS_Targets, QMS_Tasks, QMS_Results)
             * @param {string} range - ë²”ìœ„ (ì˜ˆ: 'A:Z')
             */
            async fetchFromSheet(sheetName, range = 'A:Z') {
                try {
                    if (!this.isAuthenticated) {
                        throw new Error('Not authenticated');
                    }

                    const response = await gapi.client.sheets.spreadsheets.values.get({
                        spreadsheetId: this.googleSheetsConfig.spreadsheetId,
                        range: `${sheetName}!${range}`
                    });

                    const rows = response.result.values || [];
                    if (rows.length === 0) return [];

                    // ì²« ë²ˆì§¸ í–‰ì„ í—¤ë”ë¡œ ì‚¬ìš©í•˜ì—¬ ê°ì²´ ë°°ì—´ë¡œ ë³€í™˜
                    const headers = rows[0];
                    const data = rows.slice(1).map(row => {
                        const obj = {};
                        headers.forEach((header, index) => {
                            obj[header] = row[index] || '';
                        });
                        return obj;
                    });

                    log.debug(`Fetched ${data.length} rows from ${sheetName}`);
                    return data;
                } catch (error) {
                    log.error(`fetchFromSheet error (${sheetName}):`, error);
                    throw error;
                }
            }

            /**
             * ì‹œíŠ¸ì— ë°ì´í„° ì¶”ê°€
             * @param {string} sheetName - ì‹œíŠ¸ ì´ë¦„
             * @param {Array} values - ì¶”ê°€í•  í–‰ ë°ì´í„° ë°°ì—´
             */
            async appendToSheet(sheetName, values) {
                try {
                    if (!this.isAuthenticated) {
                        throw new Error('Not authenticated');
                    }

                    const response = await gapi.client.sheets.spreadsheets.values.append({
                        spreadsheetId: this.googleSheetsConfig.spreadsheetId,
                        range: `${sheetName}!A:A`,
                        valueInputOption: 'USER_ENTERED',
                        insertDataOption: 'INSERT_ROWS',
                        resource: { values: [values] }
                    });

                    log.debug(`Appended row to ${sheetName}`);
                    return response.result;
                } catch (error) {
                    log.error(`appendToSheet error (${sheetName}):`, error);
                    throw error;
                }
            }

            /**
             * ì‹œíŠ¸ì˜ íŠ¹ì • í–‰ ì—…ë°ì´íŠ¸
             * @param {string} sheetName - ì‹œíŠ¸ ì´ë¦„
             * @param {number} rowIndex - í–‰ ë²ˆí˜¸ (1ë¶€í„° ì‹œì‘, í—¤ë” ì œì™¸í•˜ë©´ 2ë¶€í„°)
             * @param {Array} values - ì—…ë°ì´íŠ¸í•  ê°’ ë°°ì—´
             */
            async updateSheetRow(sheetName, rowIndex, values) {
                try {
                    if (!this.isAuthenticated) {
                        throw new Error('Not authenticated');
                    }

                    const response = await gapi.client.sheets.spreadsheets.values.update({
                        spreadsheetId: this.googleSheetsConfig.spreadsheetId,
                        range: `${sheetName}!A${rowIndex}:Z${rowIndex}`,
                        valueInputOption: 'USER_ENTERED',
                        resource: { values: [values] }
                    });

                    log.debug(`Updated row ${rowIndex} in ${sheetName}`);
                    return response.result;
                } catch (error) {
                    log.error(`updateSheetRow error (${sheetName}):`, error);
                    throw error;
                }
            }

            /**
             * ì‹œíŠ¸ì˜ íŠ¹ì • í–‰ ì‚­ì œ (ì‹¤ì œë¡œëŠ” ë¹ˆ ê°’ìœ¼ë¡œ ëŒ€ì²´ ë˜ëŠ” ìƒíƒœ ë³€ê²½)
             * @param {string} sheetName - ì‹œíŠ¸ ì´ë¦„
             * @param {number} rowIndex - í–‰ ë²ˆí˜¸
             */
            async deleteSheetRow(sheetName, rowIndex) {
                try {
                    if (!this.isAuthenticated) {
                        throw new Error('Not authenticated');
                    }

                    // Google Sheets APIì—ì„œëŠ” í–‰ ì‚­ì œê°€ ë³µì¡í•˜ë¯€ë¡œ
                    // ìƒíƒœ í•„ë“œë¥¼ 'deleted'ë¡œ ë³€ê²½í•˜ëŠ” soft delete ë°©ì‹ ì‚¬ìš©
                    // ì‹¤ì œ ì‚­ì œê°€ í•„ìš”í•˜ë©´ batchUpdate ì‚¬ìš©

                    log.debug(`Marked row ${rowIndex} as deleted in ${sheetName}`);
                    return true;
                } catch (error) {
                    log.error(`deleteSheetRow error (${sheetName}):`, error);
                    throw error;
                }
            }

            // ========================================
            // íƒ€ê²Ÿ ê´€ë¦¬ (QMS_Targets)
            // ========================================

            /**
             * ëª¨ë‹ˆí„°ë§ íƒ€ê²Ÿ ë“±ë¡
             * @param {Object} orderData - ì˜¤ë” ë°ì´í„°
             */
            async registerTarget(orderData) {
                try {
                    this._checkPermission(['admin', 'manager']);

                    const targetId = this._generateUUID();
                    const now = new Date().toISOString();

                    const values = [
                        targetId,
                        orderData.poNumber || '',
                        orderData.article || '',
                        orderData.model || '',
                        orderData.factory || '',
                        orderData.destination || '',
                        orderData.quantity || 0,
                        orderData.crd || '',
                        orderData.sddValue || '',
                        this.currentUser,
                        now,
                        'active',  // status
                        orderData.notes || '',
                        orderData.priority || 'medium'
                    ];

                    await this.appendToSheet('QMS_Targets', values);
                    await this.refreshTargetsCache();

                    showToast('ëª¨ë‹ˆí„°ë§ íƒ€ê²Ÿì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    log.info(`Target registered: ${targetId}`);

                    return targetId;
                } catch (error) {
                    log.error('registerTarget error:', error);
                    showToast('íƒ€ê²Ÿ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    throw error;
                }
            }

            /**
             * íƒ€ê²Ÿ ëª©ë¡ ì¡°íšŒ
             * @param {Object} filters - í•„í„° ì¡°ê±´
             */
            async getTargets(filters = {}) {
                try {
                    // ìºì‹œëœ ë°ì´í„° ë°˜í™˜ (ìºì‹œê°€ ì—†ìœ¼ë©´ ìƒˆë¡œ ì¡°íšŒ)
                    if (this.cachedTargets.length === 0) {
                        await this.refreshTargetsCache();
                    }

                    let targets = [...this.cachedTargets];

                    // í•„í„° ì ìš©
                    if (filters.status) {
                        targets = targets.filter(t => t.status === filters.status);
                    }
                    if (filters.factory) {
                        targets = targets.filter(t => t.factory === filters.factory);
                    }
                    if (filters.destination) {
                        targets = targets.filter(t => t.destination === filters.destination);
                    }
                    if (filters.priority) {
                        targets = targets.filter(t => t.priority === filters.priority);
                    }

                    return targets;
                } catch (error) {
                    log.error('getTargets error:', error);
                    return [];
                }
            }

            /**
             * íƒ€ê²Ÿ ìƒíƒœ ì—…ë°ì´íŠ¸
             * @param {string} targetId - íƒ€ê²Ÿ ID
             * @param {string} status - ìƒˆ ìƒíƒœ (active, completed, cancelled)
             */
            async updateTargetStatus(targetId, status) {
                try {
                    this._checkPermission(['admin', 'manager']);

                    const rowIndex = await this._findRowIndex('QMS_Targets', 'targetId', targetId);
                    if (!rowIndex) {
                        throw new Error('Target not found');
                    }

                    // í•´ë‹¹ í–‰ì˜ status ì»¬ëŸ¼ ì—…ë°ì´íŠ¸
                    // TODO: ì •í™•í•œ ì»¬ëŸ¼ ì¸ë±ìŠ¤ë¡œ ì—…ë°ì´íŠ¸

                    await this.refreshTargetsCache();
                    showToast('íƒ€ê²Ÿ ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');

                    return true;
                } catch (error) {
                    log.error('updateTargetStatus error:', error);
                    showToast('ìƒíƒœ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    throw error;
                }
            }

            /**
             * íƒ€ê²Ÿ ì‚­ì œ (soft delete)
             * @param {string} targetId - íƒ€ê²Ÿ ID
             */
            async deleteTarget(targetId) {
                try {
                    this._checkPermission(['admin']);

                    await this.updateTargetStatus(targetId, 'deleted');
                    log.info(`Target deleted: ${targetId}`);

                    return true;
                } catch (error) {
                    log.error('deleteTarget error:', error);
                    throw error;
                }
            }

            // ========================================
            // ì‘ì—… ê´€ë¦¬ (QMS_Tasks)
            // ========================================

            /**
             * ì‘ì—… ìƒì„±
             * @param {Object} taskData - ì‘ì—… ë°ì´í„°
             */
            async createTask(taskData) {
                try {
                    this._checkPermission(['admin', 'manager']);

                    const taskId = this._generateUUID();
                    const now = new Date().toISOString();

                    const values = [
                        taskId,
                        taskData.targetId,
                        taskData.taskType || 'inspection',  // inspection, rework, custom
                        taskData.taskTitle || '',
                        taskData.taskDescription || '',
                        taskData.assignedTo || '',
                        this.currentUser,  // assignedBy
                        now,               // assignedAt
                        taskData.dueDate || '',
                        'pending',         // status
                        taskData.priority || 'medium',
                        taskData.processStage || '',
                        taskData.quantity || 0,
                        JSON.stringify(taskData.customFields || {})
                    ];

                    await this.appendToSheet('QMS_Tasks', values);
                    await this.refreshTasksCache();

                    showToast('ì‘ì—…ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    log.info(`Task created: ${taskId}`);

                    return taskId;
                } catch (error) {
                    log.error('createTask error:', error);
                    showToast('ì‘ì—… ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    throw error;
                }
            }

            /**
             * ì‘ì—… ëª©ë¡ ì¡°íšŒ
             * @param {Object} filters - í•„í„° ì¡°ê±´
             */
            async getTasks(filters = {}) {
                try {
                    if (this.cachedTasks.length === 0) {
                        await this.refreshTasksCache();
                    }

                    let tasks = [...this.cachedTasks];

                    // í•„í„° ì ìš©
                    if (filters.targetId) {
                        tasks = tasks.filter(t => t.targetId === filters.targetId);
                    }
                    if (filters.status) {
                        tasks = tasks.filter(t => t.status === filters.status);
                    }
                    if (filters.taskType) {
                        tasks = tasks.filter(t => t.taskType === filters.taskType);
                    }
                    if (filters.assignedTo) {
                        tasks = tasks.filter(t => t.assignedTo === filters.assignedTo);
                    }
                    if (filters.priority) {
                        tasks = tasks.filter(t => t.priority === filters.priority);
                    }

                    return tasks;
                } catch (error) {
                    log.error('getTasks error:', error);
                    return [];
                }
            }

            /**
             * ì‘ì—… ìƒíƒœ ì—…ë°ì´íŠ¸
             * @param {string} taskId - ì‘ì—… ID
             * @param {string} status - ìƒˆ ìƒíƒœ (pending, in_progress, completed, cancelled)
             */
            async updateTaskStatus(taskId, status) {
                try {
                    this._checkPermission(['admin', 'manager', 'inspector']);

                    const rowIndex = await this._findRowIndex('QMS_Tasks', 'taskId', taskId);
                    if (!rowIndex) {
                        throw new Error('Task not found');
                    }

                    // TODO: ì •í™•í•œ ì»¬ëŸ¼ ì¸ë±ìŠ¤ë¡œ status ì—…ë°ì´íŠ¸

                    await this.refreshTasksCache();
                    showToast('ì‘ì—… ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');

                    return true;
                } catch (error) {
                    log.error('updateTaskStatus error:', error);
                    showToast('ìƒíƒœ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    throw error;
                }
            }

            /**
             * ì‘ì—… ë‹´ë‹¹ì ì§€ì •
             * @param {string} taskId - ì‘ì—… ID
             * @param {string} assignee - ë‹´ë‹¹ì ì´ë©”ì¼
             */
            async assignTask(taskId, assignee) {
                try {
                    this._checkPermission(['admin', 'manager']);

                    const rowIndex = await this._findRowIndex('QMS_Tasks', 'taskId', taskId);
                    if (!rowIndex) {
                        throw new Error('Task not found');
                    }

                    // TODO: ì •í™•í•œ ì»¬ëŸ¼ ì¸ë±ìŠ¤ë¡œ assignedTo ì—…ë°ì´íŠ¸

                    await this.refreshTasksCache();
                    showToast(`ì‘ì—…ì´ ${assignee}ì—ê²Œ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');

                    return true;
                } catch (error) {
                    log.error('assignTask error:', error);
                    showToast('ì‘ì—… í• ë‹¹ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    throw error;
                }
            }

            // ========================================
            // ê²°ê³¼ ê´€ë¦¬ (QMS_Results)
            // ========================================

            /**
             * ì‘ì—… ê²°ê³¼ ì €ì¥
             * @param {Object} resultData - ê²°ê³¼ ë°ì´í„°
             */
            async saveResult(resultData) {
                try {
                    this._checkPermission(['admin', 'manager', 'inspector']);

                    const resultId = this._generateUUID();
                    const now = new Date().toISOString();

                    const values = [
                        resultId,
                        resultData.taskId,
                        resultData.targetId,
                        this.currentUser,  // completedBy
                        now,               // completedAt
                        resultData.resultStatus || 'pass',  // pass, fail, partial
                        resultData.passedQty || 0,
                        resultData.failedQty || 0,
                        JSON.stringify(resultData.failureReasons || []),
                        resultData.findings || '',
                        resultData.actions || '',
                        JSON.stringify(resultData.photos || []),
                        resultData.signature || '',
                        JSON.stringify({
                            createdAt: now,
                            createdBy: this.currentUser
                        })
                    ];

                    await this.appendToSheet('QMS_Results', values);
                    await this.refreshResultsCache();

                    // ê´€ë ¨ ì‘ì—… ìƒíƒœ ì—…ë°ì´íŠ¸
                    if (resultData.taskId) {
                        await this.updateTaskStatus(resultData.taskId, 'completed');
                    }

                    showToast('ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    log.info(`Result saved: ${resultId}`);

                    return resultId;
                } catch (error) {
                    log.error('saveResult error:', error);
                    showToast('ê²°ê³¼ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    throw error;
                }
            }

            /**
             * ê²°ê³¼ ëª©ë¡ ì¡°íšŒ
             * @param {Object} filters - í•„í„° ì¡°ê±´
             */
            async getResults(filters = {}) {
                try {
                    if (this.cachedResults.length === 0) {
                        await this.refreshResultsCache();
                    }

                    let results = [...this.cachedResults];

                    // í•„í„° ì ìš©
                    if (filters.taskId) {
                        results = results.filter(r => r.taskId === filters.taskId);
                    }
                    if (filters.targetId) {
                        results = results.filter(r => r.targetId === filters.targetId);
                    }
                    if (filters.resultStatus) {
                        results = results.filter(r => r.resultStatus === filters.resultStatus);
                    }
                    if (filters.completedBy) {
                        results = results.filter(r => r.completedBy === filters.completedBy);
                    }

                    return results;
                } catch (error) {
                    log.error('getResults error:', error);
                    return [];
                }
            }

            /**
             * ê²°ê³¼ ì—…ë°ì´íŠ¸
             * @param {string} resultId - ê²°ê³¼ ID
             * @param {Object} data - ì—…ë°ì´íŠ¸í•  ë°ì´í„°
             */
            async updateResult(resultId, data) {
                try {
                    this._checkPermission(['admin', 'manager']);

                    const rowIndex = await this._findRowIndex('QMS_Results', 'resultId', resultId);
                    if (!rowIndex) {
                        throw new Error('Result not found');
                    }

                    // TODO: ë°ì´í„° ì—…ë°ì´íŠ¸ ë¡œì§ êµ¬í˜„

                    await this.refreshResultsCache();
                    showToast('ê²°ê³¼ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');

                    return true;
                } catch (error) {
                    log.error('updateResult error:', error);
                    showToast('ê²°ê³¼ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    throw error;
                }
            }

            // ========================================
            // ìºì‹œ ê´€ë¦¬
            // ========================================

            /**
             * íƒ€ê²Ÿ ìºì‹œ ê°±ì‹ 
             */
            async refreshTargetsCache() {
                try {
                    this.cachedTargets = await this.fetchFromSheet('QMS_Targets');
                    this._saveCacheToStorage(this.cacheKeys.targets, this.cachedTargets);
                    log.debug(`Targets cache refreshed: ${this.cachedTargets.length} items`);
                } catch (error) {
                    log.error('refreshTargetsCache error:', error);
                    // ì˜¤í”„ë¼ì¸ ì‹œ ë¡œì»¬ ìºì‹œ ì‚¬ìš©
                    this.cachedTargets = this._loadCacheFromStorage(this.cacheKeys.targets) || [];
                }
            }

            /**
             * ì‘ì—… ìºì‹œ ê°±ì‹ 
             */
            async refreshTasksCache() {
                try {
                    this.cachedTasks = await this.fetchFromSheet('QMS_Tasks');
                    this._saveCacheToStorage(this.cacheKeys.tasks, this.cachedTasks);
                    log.debug(`Tasks cache refreshed: ${this.cachedTasks.length} items`);
                } catch (error) {
                    log.error('refreshTasksCache error:', error);
                    this.cachedTasks = this._loadCacheFromStorage(this.cacheKeys.tasks) || [];
                }
            }

            /**
             * ê²°ê³¼ ìºì‹œ ê°±ì‹ 
             */
            async refreshResultsCache() {
                try {
                    this.cachedResults = await this.fetchFromSheet('QMS_Results');
                    this._saveCacheToStorage(this.cacheKeys.results, this.cachedResults);
                    log.debug(`Results cache refreshed: ${this.cachedResults.length} items`);
                } catch (error) {
                    log.error('refreshResultsCache error:', error);
                    this.cachedResults = this._loadCacheFromStorage(this.cacheKeys.results) || [];
                }
            }

            /**
             * ìºì‹œ ë¬´íš¨í™”
             * @param {string} type - ìºì‹œ íƒ€ì… (targets, tasks, results, all)
             */
            invalidateCache(type = 'all') {
                if (type === 'all' || type === 'targets') {
                    this.cachedTargets = [];
                    localStorage.removeItem(this.cacheKeys.targets);
                }
                if (type === 'all' || type === 'tasks') {
                    this.cachedTasks = [];
                    localStorage.removeItem(this.cacheKeys.tasks);
                }
                if (type === 'all' || type === 'results') {
                    this.cachedResults = [];
                    localStorage.removeItem(this.cacheKeys.results);
                }
                log.info(`Cache invalidated: ${type}`);
            }

            // ========================================
            // ë™ê¸°í™” ê´€ë¦¬
            // ========================================

            /**
             * ìë™ ë™ê¸°í™” ì‹œì‘
             */
            startSync() {
                if (this.syncTimer) {
                    clearInterval(this.syncTimer);
                }

                this.syncTimer = setInterval(async () => {
                    if (this.isAuthenticated && this.isOnline) {
                        await this.syncAll();
                    }
                }, this.syncInterval);

                // ì¦‰ì‹œ ì²« ë™ê¸°í™” ì‹¤í–‰
                this.syncAll();

                log.info(`Auto-sync started (interval: ${this.syncInterval}ms)`);
            }

            /**
             * ìë™ ë™ê¸°í™” ì¤‘ì§€
             */
            stopSync() {
                if (this.syncTimer) {
                    clearInterval(this.syncTimer);
                    this.syncTimer = null;
                }
                log.info('Auto-sync stopped');
            }

            /**
             * ì „ì²´ ë°ì´í„° ë™ê¸°í™”
             */
            async syncAll() {
                try {
                    if (!this.isAuthenticated || !this.isOnline) {
                        log.debug('Sync skipped: not authenticated or offline');
                        return;
                    }

                    log.debug('Starting sync...');

                    await Promise.all([
                        this.refreshTargetsCache(),
                        this.refreshTasksCache(),
                        this.refreshResultsCache()
                    ]);

                    this.lastSync = new Date();
                    this._updateSyncStatus();

                    log.info('Sync completed at', this.lastSync.toLocaleTimeString());
                } catch (error) {
                    log.error('syncAll error:', error);
                }
            }

            // ========================================
            // ìœ í‹¸ë¦¬í‹° ë©”ì„œë“œ
            // ========================================

            /**
             * UUID ìƒì„±
             */
            _generateUUID() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    const r = Math.random() * 16 | 0;
                    const v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }

            /**
             * ê¶Œí•œ í™•ì¸
             * @param {Array} allowedRoles - í—ˆìš©ëœ ì—­í•  ë°°ì—´
             */
            _checkPermission(allowedRoles) {
                if (!allowedRoles.includes(this.userRole)) {
                    showToast('ì´ ì‘ì—…ì„ ìˆ˜í–‰í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    throw new Error(`Permission denied. Required: ${allowedRoles.join('/')}, Current: ${this.userRole}`);
                }
            }

            /**
             * ì‹œíŠ¸ì—ì„œ íŠ¹ì • ê°’ìœ¼ë¡œ í–‰ ì¸ë±ìŠ¤ ì°¾ê¸°
             * @param {string} sheetName - ì‹œíŠ¸ ì´ë¦„
             * @param {string} columnName - ì»¬ëŸ¼ ì´ë¦„
             * @param {string} value - ì°¾ì„ ê°’
             */
            async _findRowIndex(sheetName, columnName, value) {
                const data = await this.fetchFromSheet(sheetName);
                const index = data.findIndex(row => row[columnName] === value);
                return index >= 0 ? index + 2 : null; // +2: í—¤ë” í–‰ + 0-based index
            }

            /**
             * ì‚¬ìš©ì ì—­í•  ë¡œë“œ
             */
            async _loadUserRole() {
                // TODO: QMS_Users ì‹œíŠ¸ì—ì„œ ì—­í•  ì¡°íšŒ ë˜ëŠ” ê¸°ë³¸ê°’ ì‚¬ìš©
                // í˜„ì¬ëŠ” ê¸°ë³¸ê°’ 'manager'ë¡œ ì„¤ì •
                this.userRole = 'manager';
            }

            /**
             * ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
             */
            async _fetchUserInfo() {
                try {
                    // Google OAuth2 userinfo ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©
                    const response = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
                        headers: {
                            'Authorization': `Bearer ${gapi.client.getToken().access_token}`
                        }
                    });
                    const userInfo = await response.json();
                    this.currentUser = userInfo.email || userInfo.name || 'Unknown';
                } catch (error) {
                    log.error('Failed to fetch user info:', error);
                    this.currentUser = 'Unknown';
                }
            }

            /**
             * í† í° ì €ì¥
             */
            _saveToken(token) {
                try {
                    localStorage.setItem('qms_auth_token', JSON.stringify(token));
                } catch (e) {
                    log.error('Failed to save token:', e);
                }
            }

            /**
             * ì €ì¥ëœ í† í° ê°€ì ¸ì˜¤ê¸°
             */
            _getSavedToken() {
                try {
                    const token = localStorage.getItem('qms_auth_token');
                    return token ? JSON.parse(token) : null;
                } catch (e) {
                    return null;
                }
            }

            /**
             * ì €ì¥ëœ í† í° ì‚­ì œ
             */
            _clearSavedToken() {
                localStorage.removeItem('qms_auth_token');
            }

            /**
             * í† í° ìœ íš¨ì„± í™•ì¸
             */
            _isTokenValid(token) {
                if (!token || !token.expiry) return false;
                return Date.now() < token.expiry;
            }

            /**
             * ì„¤ì • ë¡œë“œ
             */
            _loadSettings() {
                try {
                    const stored = localStorage.getItem(this.storageKey);
                    if (stored) {
                        const config = JSON.parse(stored);
                        Object.assign(this.googleSheetsConfig, config);
                    }
                } catch (e) {
                    log.error('Failed to load QMS settings:', e);
                }
            }

            /**
             * ì„¤ì • ì €ì¥
             */
            saveSettings(config) {
                try {
                    Object.assign(this.googleSheetsConfig, config);
                    localStorage.setItem(this.storageKey, JSON.stringify(this.googleSheetsConfig));
                    log.info('QMS settings saved');
                    return true;
                } catch (e) {
                    log.error('Failed to save QMS settings:', e);
                    return false;
                }
            }

            /**
             * ìºì‹œë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
             */
            _saveCacheToStorage(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify({
                        data: data,
                        timestamp: Date.now()
                    }));
                } catch (e) {
                    log.error('Failed to save cache:', e);
                }
            }

            /**
             * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ìºì‹œ ë¡œë“œ
             */
            _loadCacheFromStorage(key) {
                try {
                    const stored = localStorage.getItem(key);
                    if (stored) {
                        const parsed = JSON.parse(stored);
                        return parsed.data;
                    }
                } catch (e) {
                    log.error('Failed to load cache:', e);
                }
                return null;
            }

            /**
             * ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
             */
            _setupEventListeners() {
                // QMS íƒ­ ì „í™˜ ì‹œ ë°ì´í„° ë¡œë“œ
                // (initQMSSubtabsì—ì„œ ì²˜ë¦¬)
            }

            /**
             * ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ìƒíƒœ ë¦¬ìŠ¤ë„ˆ
             */
            _setupOnlineOfflineListeners() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    log.info('QMS: Online');
                    if (this.isAuthenticated) {
                        this.syncAll();
                    }
                });

                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    log.warn('QMS: Offline - using cached data');
                    showToast('ì˜¤í”„ë¼ì¸ ìƒíƒœì…ë‹ˆë‹¤. ìºì‹œëœ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.', 'warning');
                });
            }

            /**
             * ì¸ì¦ UI ì—…ë°ì´íŠ¸
             */
            _updateAuthUI() {
                const authRequired = document.getElementById('qmsAuthRequired');
                const mainContent = document.getElementById('qmsMainContent');
                const userEmail = document.getElementById('qmsUserEmail');

                if (this.isAuthenticated) {
                    if (authRequired) authRequired.classList.add('hidden');
                    if (mainContent) mainContent.classList.remove('hidden');
                    if (userEmail) userEmail.textContent = this.currentUser || '';
                } else {
                    if (authRequired) authRequired.classList.remove('hidden');
                    if (mainContent) mainContent.classList.add('hidden');
                }
            }

            /**
             * ë™ê¸°í™” ìƒíƒœ UI ì—…ë°ì´íŠ¸
             */
            _updateSyncStatus() {
                const syncBtn = document.getElementById('qmsSyncBtn');
                if (syncBtn && this.lastSync) {
                    syncBtn.title = `ë§ˆì§€ë§‰ ë™ê¸°í™”: ${this.lastSync.toLocaleTimeString()}`;
                }
            }
        }

        // QMSManager ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
        let qmsManager = null;

        // QMS ì´ˆê¸°í™” í•¨ìˆ˜ (QMS íƒ­ ì²« ì§„ì… ì‹œ í˜¸ì¶œ)
        async function initQMS() {
            if (qmsManager && qmsManager.isInitialized) {
                return qmsManager;
            }

            qmsManager = new QMSManager();
            await qmsManager.init();

            // QMS ì„œë¸Œíƒ­ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
            initQMSSubtabs();

            return qmsManager;
        }

        // QMS ì„œë¸Œíƒ­ ì´ˆê¸°í™”
        function initQMSSubtabs() {
            const subtabBtns = document.querySelectorAll('.qms-subtab-btn');
            const subtabContents = document.querySelectorAll('.qms-subtab-content');

            subtabBtns.forEach(btn => {
                addManagedEventListener(btn, 'click', () => {
                    const targetTab = btn.dataset.qmsTab;

                    // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
                    subtabBtns.forEach(b => {
                        b.classList.remove('active', 'bg-blue-600', 'text-white');
                        b.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    });
                    btn.classList.add('active', 'bg-blue-600', 'text-white');
                    btn.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');

                    // ì»¨í…ì¸  í‘œì‹œ/ìˆ¨ê¹€
                    subtabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    const targetContent = document.getElementById(`qms${targetTab.charAt(0).toUpperCase() + targetTab.slice(1)}Tab`);
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                    }

                    // íƒ­ë³„ ë°ì´í„° ë¡œë“œ
                    loadQMSTabData(targetTab);
                });
            });

            // QMS ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
            const signInBtn = document.getElementById('qmsSignInBtn');
            const signOutBtn = document.getElementById('qmsSignOutBtn');
            const syncBtn = document.getElementById('qmsSyncBtn');

            if (signInBtn) {
                addManagedEventListener(signInBtn, 'click', () => {
                    if (qmsManager) {
                        qmsManager.signIn();
                    }
                });
            }

            if (signOutBtn) {
                addManagedEventListener(signOutBtn, 'click', () => {
                    if (qmsManager) {
                        qmsManager.signOut();
                    }
                });
            }

            if (syncBtn) {
                addManagedEventListener(syncBtn, 'click', () => {
                    if (qmsManager) {
                        qmsManager.syncAll();
                        showToast('ë™ê¸°í™”ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
                    }
                });
            }
        }

        // QMS íƒ­ë³„ ë°ì´í„° ë¡œë“œ
        async function loadQMSTabData(tabName) {
            if (!qmsManager || !qmsManager.isAuthenticated) {
                return;
            }

            switch (tabName) {
                case 'targets':
                    await loadQMSTargetsTab();
                    break;
                case 'monitoring':
                    await loadQMSMonitoringTab();
                    break;
                case 'assignment':
                    await loadQMSAssignmentTab();
                    break;
                case 'tasklist':
                    await loadQMSTasklistTab();
                    break;
                case 'results':
                    await loadQMSResultsTab();
                    break;
            }
        }

        // QMS íƒ€ê²Ÿë“±ë¡ ê´€ë ¨ ìƒíƒœ
        let qmsSelectedOrders = new Set();
        let qmsTargetsFilteredData = [];

        // íƒ€ê²Ÿë“±ë¡ íƒ­ ë¡œë“œ
        async function loadQMSTargetsTab() {
            log.debug('Loading QMS Targets tab...');

            // í•„í„° ì˜µì…˜ ì´ˆê¸°í™”
            initQMSTargetFilters();

            // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡
            setupQMSTargetEventHandlers();

            // ì˜¤ë” í…Œì´ë¸” ë Œë”ë§
            renderQMSOrdersTable();

            // ë“±ë¡ëœ íƒ€ê²Ÿ ëª©ë¡ ë¡œë“œ
            await loadRegisteredTargets();
        }

        // QMS íƒ€ê²Ÿ í•„í„° ì´ˆê¸°í™”
        function initQMSTargetFilters() {
            const destFilter = document.getElementById('qmsTargetDestFilter');
            const modelFilter = document.getElementById('qmsTargetModelFilter');

            if (!destFilter || !modelFilter) return;

            // í–‰ì„ ì§€ í•„í„° ì˜µì…˜
            const destinations = [...new Set(EMBEDDED_DATA.map(d => d.destination).filter(Boolean))].sort();
            destFilter.innerHTML = '<option value="">í–‰ì„ ì§€ ì „ì²´</option>' +
                destinations.map(d => `<option value="${escapeHtml(d)}">${escapeHtml(d)}</option>`).join('');

            // ëª¨ë¸ í•„í„° ì˜µì…˜
            const models = [...new Set(EMBEDDED_DATA.map(d => d.model).filter(Boolean))].sort();
            modelFilter.innerHTML = '<option value="">ëª¨ë¸ ì „ì²´</option>' +
                models.map(m => `<option value="${escapeHtml(m)}">${escapeHtml(m)}</option>`).join('');
        }

        // QMS íƒ€ê²Ÿ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
        function setupQMSTargetEventHandlers() {
            // í•„í„° ë³€ê²½ ì´ë²¤íŠ¸
            const destFilter = document.getElementById('qmsTargetDestFilter');
            const modelFilter = document.getElementById('qmsTargetModelFilter');
            const factoryFilter = document.getElementById('qmsTargetFactoryFilter');
            const searchInput = document.getElementById('qmsTargetSearchInput');

            [destFilter, modelFilter, factoryFilter].forEach(el => {
                if (el) {
                    el.removeEventListener('change', handleQMSTargetFilterChange);
                    el.addEventListener('change', handleQMSTargetFilterChange);
                }
            });

            if (searchInput) {
                searchInput.removeEventListener('input', handleQMSTargetSearchInput);
                searchInput.addEventListener('input', debounce(handleQMSTargetSearchInput, 300));
            }

            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤
            const selectAllCheckbox = document.getElementById('qmsSelectAllOrders');
            if (selectAllCheckbox) {
                selectAllCheckbox.removeEventListener('change', handleQMSSelectAllOrders);
                selectAllCheckbox.addEventListener('change', handleQMSSelectAllOrders);
            }

            // ë“±ë¡ ë²„íŠ¼
            const registerBtn = document.getElementById('qmsRegisterTargetsBtn');
            if (registerBtn) {
                registerBtn.removeEventListener('click', handleQMSRegisterTargets);
                registerBtn.addEventListener('click', handleQMSRegisterTargets);
            }
        }

        // í•„í„° ë³€ê²½ í•¸ë“¤ëŸ¬
        function handleQMSTargetFilterChange() {
            qmsSelectedOrders.clear();
            renderQMSOrdersTable();
            updateQMSSelectedCount();
        }

        // ê²€ìƒ‰ ì…ë ¥ í•¸ë“¤ëŸ¬
        function handleQMSTargetSearchInput() {
            qmsSelectedOrders.clear();
            renderQMSOrdersTable();
            updateQMSSelectedCount();
        }

        // ì „ì²´ ì„ íƒ í•¸ë“¤ëŸ¬
        function handleQMSSelectAllOrders(e) {
            const isChecked = e.target.checked;
            const checkboxes = document.querySelectorAll('#qmsOrdersTableBody input[type="checkbox"]');

            checkboxes.forEach(cb => {
                cb.checked = isChecked;
                const poNumber = cb.dataset.po;
                if (isChecked) {
                    qmsSelectedOrders.add(poNumber);
                } else {
                    qmsSelectedOrders.delete(poNumber);
                }
            });

            updateQMSSelectedCount();
        }

        // ê°œë³„ ì²´í¬ë°•ìŠ¤ í•¸ë“¤ëŸ¬
        function handleQMSOrderCheckbox(e) {
            const poNumber = e.target.dataset.po;
            if (e.target.checked) {
                qmsSelectedOrders.add(poNumber);
            } else {
                qmsSelectedOrders.delete(poNumber);
            }
            updateQMSSelectedCount();
        }

        // ì„ íƒ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        function updateQMSSelectedCount() {
            const countEl = document.getElementById('qmsSelectedCount');
            const registerBtn = document.getElementById('qmsRegisterTargetsBtn');

            if (countEl) {
                countEl.textContent = qmsSelectedOrders.size;
            }

            if (registerBtn) {
                registerBtn.disabled = qmsSelectedOrders.size === 0;
            }
        }

        // QMS ì˜¤ë” í…Œì´ë¸” ë Œë”ë§
        function renderQMSOrdersTable() {
            const tbody = document.getElementById('qmsOrdersTableBody');
            if (!tbody) return;

            // í•„í„° ê°’ ê°€ì ¸ì˜¤ê¸°
            const destFilter = document.getElementById('qmsTargetDestFilter')?.value || '';
            const modelFilter = document.getElementById('qmsTargetModelFilter')?.value || '';
            const factoryFilter = document.getElementById('qmsTargetFactoryFilter')?.value || '';
            const searchValue = document.getElementById('qmsTargetSearchInput')?.value?.toLowerCase() || '';

            // ì´ë¯¸ ë“±ë¡ëœ íƒ€ê²Ÿì˜ PO ë²ˆí˜¸ ëª©ë¡
            const registeredPOs = new Set(
                (qmsManager?.getCachedTargets() || []).map(t => t.poNumber)
            );

            // í•„í„°ë§
            qmsTargetsFilteredData = EMBEDDED_DATA.filter(d => {
                // ì´ë¯¸ ë“±ë¡ëœ íƒ€ê²Ÿ ì œì™¸
                if (registeredPOs.has(d.poNumber)) return false;

                if (destFilter && d.destination !== destFilter) return false;
                if (modelFilter && d.model !== modelFilter) return false;
                if (factoryFilter && d.factory !== factoryFilter) return false;
                if (searchValue) {
                    const searchStr = `${d.poNumber} ${d.model} ${d.destination} ${d.article}`.toLowerCase();
                    if (!searchStr.includes(searchValue)) return false;
                }
                return true;
            });

            // ìµœëŒ€ 100ê°œ í‘œì‹œ (ì„±ëŠ¥)
            const displayData = qmsTargetsFilteredData.slice(0, 100);

            if (displayData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="p-4 text-center text-secondary">
                            í‘œì‹œí•  ì˜¤ë”ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = displayData.map(d => `
                <tr class="border-t dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50">
                    <td class="p-2">
                        <input type="checkbox"
                               class="rounded qms-order-checkbox"
                               data-po="${escapeHtml(d.poNumber)}"
                               ${qmsSelectedOrders.has(d.poNumber) ? 'checked' : ''}>
                    </td>
                    <td class="p-2 font-mono text-xs">${escapeHtml(d.poNumber || '-')}</td>
                    <td class="p-2">${escapeHtml(d.model || '-')}</td>
                    <td class="p-2">${escapeHtml(d.destination || '-')}</td>
                    <td class="p-2 text-right">${(d.quantity || 0).toLocaleString()}</td>
                </tr>
            `).join('');

            // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡
            tbody.querySelectorAll('.qms-order-checkbox').forEach(cb => {
                cb.addEventListener('change', handleQMSOrderCheckbox);
            });

            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
            const selectAllCheckbox = document.getElementById('qmsSelectAllOrders');
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = displayData.length > 0 &&
                    displayData.every(d => qmsSelectedOrders.has(d.poNumber));
            }
        }

        // íƒ€ê²Ÿ ë“±ë¡ í•¸ë“¤ëŸ¬
        async function handleQMSRegisterTargets() {
            if (qmsSelectedOrders.size === 0) {
                showToast('ë“±ë¡í•  ì˜¤ë”ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            if (!qmsManager) {
                showToast('QMSê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            const priority = document.getElementById('qmsTargetPriority')?.value || 'medium';
            const notes = document.getElementById('qmsTargetNotes')?.value || '';

            const registerBtn = document.getElementById('qmsRegisterTargetsBtn');
            if (registerBtn) {
                registerBtn.disabled = true;
                registerBtn.innerHTML = '<span class="animate-spin">â³</span> ë“±ë¡ ì¤‘...';
            }

            try {
                const selectedOrders = EMBEDDED_DATA.filter(d => qmsSelectedOrders.has(d.poNumber));
                let successCount = 0;
                let failCount = 0;

                for (const order of selectedOrders) {
                    try {
                        await qmsManager.registerTarget({
                            poNumber: order.poNumber,
                            article: order.article,
                            model: order.model,
                            factory: order.factory,
                            destination: order.destination,
                            quantity: order.quantity,
                            crd: order.crd,
                            sddValue: order.sddValue,
                            priority: priority,
                            notes: notes
                        });
                        successCount++;
                    } catch (err) {
                        log.error(`Failed to register target: ${order.poNumber}`, err);
                        failCount++;
                    }
                }

                // ì„ íƒ ì´ˆê¸°í™”
                qmsSelectedOrders.clear();
                document.getElementById('qmsTargetNotes').value = '';

                // UI ì—…ë°ì´íŠ¸
                renderQMSOrdersTable();
                updateQMSSelectedCount();
                await loadRegisteredTargets();

                if (failCount === 0) {
                    showToast(`${successCount}ê°œì˜ íƒ€ê²Ÿì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                } else {
                    showToast(`${successCount}ê°œ ë“±ë¡ ì„±ê³µ, ${failCount}ê°œ ì‹¤íŒ¨`, 'warning');
                }

            } catch (err) {
                log.error('Failed to register targets', err);
                showToast('íƒ€ê²Ÿ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            } finally {
                if (registerBtn) {
                    registerBtn.disabled = qmsSelectedOrders.size === 0;
                    registerBtn.innerHTML = '<span data-i18n="qms.targets.register">ì„ íƒí•œ ì˜¤ë” íƒ€ê²Ÿìœ¼ë¡œ ë“±ë¡</span>';
                }
            }
        }

        // ë“±ë¡ëœ íƒ€ê²Ÿ ëª©ë¡ ë¡œë“œ
        async function loadRegisteredTargets() {
            const listEl = document.getElementById('qmsRegisteredTargetsList');
            const countEl = document.getElementById('qmsRegisteredCount');

            if (!listEl) return;

            let targets = [];

            if (qmsManager) {
                try {
                    targets = await qmsManager.getTargets({ status: 'active' });
                } catch (err) {
                    log.error('Failed to load registered targets', err);
                    // ìºì‹œì—ì„œ ê°€ì ¸ì˜¤ê¸° ì‹œë„
                    targets = qmsManager.getCachedTargets() || [];
                }
            }

            if (countEl) {
                countEl.textContent = `${targets.length}ê°œ`;
            }

            if (targets.length === 0) {
                listEl.innerHTML = `
                    <div class="text-center text-secondary text-sm py-4">
                        ë“±ë¡ëœ íƒ€ê²Ÿì´ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                `;
                return;
            }

            listEl.innerHTML = targets.map(t => `
                <div class="flex items-center justify-between p-2 border-b dark:border-gray-700 last:border-0 text-sm">
                    <div class="flex-1 min-w-0">
                        <div class="font-medium truncate">${escapeHtml(t.model || t.poNumber)}</div>
                        <div class="text-xs text-secondary truncate">${escapeHtml(t.destination || '')} | ${escapeHtml(t.factory || '')}</div>
                    </div>
                    <div class="flex items-center gap-2 ml-2">
                        <span class="text-xs px-2 py-0.5 rounded ${getPriorityClass(t.priority)}">
                            ${getPriorityLabel(t.priority)}
                        </span>
                        <button class="text-red-500 hover:text-red-700 p-1"
                                onclick="handleQMSRemoveTarget('${escapeHtml(t.targetId)}')"
                                title="ì‚­ì œ">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ìš°ì„ ìˆœìœ„ í´ë˜ìŠ¤
        function getPriorityClass(priority) {
            switch (priority) {
                case 'high': return 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400';
                case 'low': return 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400';
                default: return 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400';
            }
        }

        // ìš°ì„ ìˆœìœ„ ë¼ë²¨
        function getPriorityLabel(priority) {
            switch (priority) {
                case 'high': return 'ë†’ìŒ';
                case 'low': return 'ë‚®ìŒ';
                default: return 'ë³´í†µ';
            }
        }

        // íƒ€ê²Ÿ ì‚­ì œ í•¸ë“¤ëŸ¬
        async function handleQMSRemoveTarget(targetId) {
            if (!confirm('ì´ íƒ€ê²Ÿì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            if (!qmsManager) {
                showToast('QMSê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            try {
                await qmsManager.deleteTarget(targetId);
                renderQMSOrdersTable();
                await loadRegisteredTargets();
                showToast('íƒ€ê²Ÿì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (err) {
                log.error('Failed to delete target', err);
                showToast('íƒ€ê²Ÿ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ëª¨ë‹ˆí„°ë§í˜„í™© íƒ­ ë¡œë“œ
        async function loadQMSMonitoringTab() {
            log.debug('Loading QMS Monitoring tab...');

            if (!qmsManager) {
                showToast('QMSê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
            setupQMSMonitoringEventHandlers();

            // ëª¨ë‹ˆí„°ë§ ë°ì´í„° ë¡œë“œ
            await renderQMSMonitoringTable();
        }

        // ëª¨ë‹ˆí„°ë§ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
        function setupQMSMonitoringEventHandlers() {
            const statusFilter = document.getElementById('qmsMonitoringStatusFilter');
            if (statusFilter) {
                statusFilter.removeEventListener('change', renderQMSMonitoringTable);
                statusFilter.addEventListener('change', renderQMSMonitoringTable);
            }
        }

        // ëª¨ë‹ˆí„°ë§ í…Œì´ë¸” ë Œë”ë§
        async function renderQMSMonitoringTable() {
            const tbody = document.getElementById('qmsMonitoringTableBody');
            const statusFilter = document.getElementById('qmsMonitoringStatusFilter')?.value || '';

            if (!tbody) return;

            let targets = [];
            try {
                const filters = statusFilter ? { status: statusFilter } : {};
                targets = await qmsManager.getTargets(filters);
            } catch (err) {
                log.error('Failed to load monitoring data', err);
                targets = qmsManager?.getCachedTargets() || [];
            }

            // ìš”ì•½ ì¹´ë“œ ì—…ë°ì´íŠ¸
            updateQMSMonitoringSummary(targets);

            if (targets.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="p-4 text-center text-secondary">
                            ëª¨ë‹ˆí„°ë§ ëŒ€ìƒì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
                return;
            }

            // í˜„ì¬ ìƒì‚° ë°ì´í„°ì™€ ë§¤ì¹­
            tbody.innerHTML = targets.map(t => {
                const orderData = EMBEDDED_DATA.find(d => d.poNumber === t.poNumber);
                const progress = calculateProgress(orderData);
                const statusInfo = getQMSStatusInfo(t.status);

                return `
                    <tr class="border-t dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50">
                        <td class="p-2 font-mono text-xs">${escapeHtml(t.poNumber || '-')}</td>
                        <td class="p-2">${escapeHtml(t.model || '-')}</td>
                        <td class="p-2">${escapeHtml(t.destination || '-')}</td>
                        <td class="p-2 text-center">${escapeHtml(t.factory || '-')}</td>
                        <td class="p-2 text-right">${(t.quantity || 0).toLocaleString()}</td>
                        <td class="p-2">
                            <div class="flex items-center gap-2">
                                <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: ${progress}%"></div>
                                </div>
                                <span class="text-xs w-10 text-right">${progress}%</span>
                            </div>
                        </td>
                        <td class="p-2 text-center">
                            <span class="text-xs px-2 py-0.5 rounded ${statusInfo.class}">
                                ${statusInfo.label}
                            </span>
                        </td>
                        <td class="p-2 text-center">
                            <button class="text-blue-600 hover:text-blue-800 text-xs px-2 py-1 rounded hover:bg-blue-50 dark:hover:bg-blue-900/30"
                                    onclick="showQMSTargetDetail('${escapeHtml(t.targetId)}')">
                                ìƒì„¸
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ëª¨ë‹ˆí„°ë§ ìš”ì•½ ì—…ë°ì´íŠ¸
        function updateQMSMonitoringSummary(targets) {
            const totalEl = document.getElementById('qmsMonitoringTotal');
            const activeEl = document.getElementById('qmsMonitoringActive');
            const inProgressEl = document.getElementById('qmsMonitoringInProgress');
            const completedEl = document.getElementById('qmsMonitoringCompleted');

            const total = targets.length;
            const active = targets.filter(t => t.status === 'active').length;
            const completed = targets.filter(t => t.status === 'completed').length;
            const inProgress = total - active - completed;

            if (totalEl) totalEl.textContent = total;
            if (activeEl) activeEl.textContent = active;
            if (inProgressEl) inProgressEl.textContent = inProgress;
            if (completedEl) completedEl.textContent = completed;
        }

        // ì§„í–‰ë¥  ê³„ì‚°
        function calculateProgress(orderData) {
            if (!orderData || !orderData.production) return 0;
            const whOut = orderData.production.wh_out;
            if (!whOut) return 0;
            const completed = whOut.completed || 0;
            const total = orderData.quantity || 1;
            return Math.round((completed / total) * 100);
        }

        // QMS ìƒíƒœ ì •ë³´
        function getQMSStatusInfo(status) {
            switch (status) {
                case 'active':
                    return { label: 'í™œì„±', class: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' };
                case 'completed':
                    return { label: 'ì™„ë£Œ', class: 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300' };
                case 'cancelled':
                    return { label: 'ì·¨ì†Œ', class: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400' };
                default:
                    return { label: status || 'ì•Œ ìˆ˜ ì—†ìŒ', class: 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300' };
            }
        }

        // íƒ€ê²Ÿ ìƒì„¸ ë³´ê¸°
        function showQMSTargetDetail(targetId) {
            // TODO: ëª¨ë‹¬ë¡œ ìƒì„¸ ì •ë³´ í‘œì‹œ
            showToast('ìƒì„¸ ë³´ê¸° ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info');
        }

        // ì‘ì—…ì§€ì‹œ íƒ­ ë¡œë“œ
        async function loadQMSAssignmentTab() {
            log.debug('Loading QMS Assignment tab...');

            if (!qmsManager) {
                showToast('QMSê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            // íƒ€ê²Ÿ ëª©ë¡ ë¡œë“œ
            await renderQMSAssignmentTargets();
        }

        // ì‘ì—…ì§€ì‹œ íƒ€ê²Ÿ ëª©ë¡ ë Œë”ë§
        async function renderQMSAssignmentTargets() {
            const tbody = document.getElementById('qmsAssignmentTargetsBody');
            if (!tbody) return;

            let targets = [];
            try {
                targets = await qmsManager.getTargets({ status: 'active' });
            } catch (err) {
                log.error('Failed to load targets for assignment', err);
                targets = qmsManager?.getCachedTargets() || [];
            }

            if (targets.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="p-4 text-center text-secondary">
                            ì‘ì—… ì§€ì‹œí•  íƒ€ê²Ÿì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = targets.map(t => {
                const priorityInfo = getPriorityClass(t.priority);
                return `
                    <tr class="border-t dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50 cursor-pointer qms-assign-target-row"
                        data-target-id="${escapeHtml(t.targetId)}"
                        onclick="selectQMSAssignTarget(this, '${escapeHtml(t.targetId)}')">
                        <td class="p-2">
                            <input type="radio" name="qmsAssignTarget" value="${escapeHtml(t.targetId)}" class="rounded">
                        </td>
                        <td class="p-2 font-mono text-xs">${escapeHtml(t.poNumber || '-')}</td>
                        <td class="p-2">${escapeHtml(t.model || '-')}</td>
                        <td class="p-2">${escapeHtml(t.destination || '-')}</td>
                        <td class="p-2 text-right">${(t.quantity || 0).toLocaleString()}</td>
                        <td class="p-2 text-center">
                            <span class="text-xs px-2 py-0.5 rounded ${priorityInfo}">
                                ${getPriorityLabel(t.priority)}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');

            // íƒ€ê²Ÿ ì„ íƒ ì‹œ ì‘ì—…ì§€ì‹œ ë²„íŠ¼ í™œì„±í™”
            setupQMSAssignmentEventHandlers();
        }

        // ì‘ì—…ì§€ì‹œ íƒ€ê²Ÿ ì„ íƒ
        function selectQMSAssignTarget(row, targetId) {
            // ë¼ë””ì˜¤ ë²„íŠ¼ ì²´í¬
            const radio = row.querySelector('input[type="radio"]');
            if (radio) {
                radio.checked = true;
            }

            // ì„ íƒëœ í–‰ ê°•ì¡°
            document.querySelectorAll('.qms-assign-target-row').forEach(r => {
                r.classList.remove('bg-blue-50', 'dark:bg-blue-900/30');
            });
            row.classList.add('bg-blue-50', 'dark:bg-blue-900/30');

            // ì‘ì—…ì§€ì‹œ ë²„íŠ¼ í™œì„±í™”
            const createBtn = document.getElementById('qmsCreateTaskBtn');
            if (createBtn) {
                createBtn.disabled = false;
            }
        }

        // ì‘ì—…ì§€ì‹œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
        function setupQMSAssignmentEventHandlers() {
            const createBtn = document.getElementById('qmsCreateTaskBtn');
            if (createBtn && !createBtn.dataset.initialized) {
                createBtn.addEventListener('click', handleQMSCreateTask);
                createBtn.dataset.initialized = 'true';
            }
        }

        // ì‘ì—… ìƒì„± í•¸ë“¤ëŸ¬
        async function handleQMSCreateTask() {
            const selectedRadio = document.querySelector('input[name="qmsAssignTarget"]:checked');
            if (!selectedRadio) {
                showToast('ì‘ì—… ì§€ì‹œí•  íƒ€ê²Ÿì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            const targetId = selectedRadio.value;
            const taskType = document.getElementById('qmsTaskType')?.value || 'inspection';
            const taskTitle = document.getElementById('qmsTaskTitle')?.value?.trim();
            const taskDescription = document.getElementById('qmsTaskDescription')?.value?.trim();
            const assignedTo = document.getElementById('qmsTaskAssignee')?.value?.trim();
            const dueDate = document.getElementById('qmsTaskDueDate')?.value;
            const processStage = document.getElementById('qmsTaskProcessStage')?.value;
            const quantity = parseInt(document.getElementById('qmsTaskQuantity')?.value) || 0;
            const priority = document.getElementById('qmsTaskPriority')?.value || 'medium';

            if (!taskTitle) {
                showToast('ì‘ì—… ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            try {
                const taskData = {
                    targetId,
                    taskType,
                    taskTitle,
                    taskDescription,
                    assignedTo,
                    dueDate,
                    processStage,
                    quantity,
                    priority,
                    status: 'pending'
                };

                await qmsManager.createTask(taskData);
                showToast('ì‘ì—…ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');

                // í¼ ì´ˆê¸°í™”
                document.getElementById('qmsTaskTitle').value = '';
                document.getElementById('qmsTaskDescription').value = '';
                document.getElementById('qmsTaskAssignee').value = '';
                document.getElementById('qmsTaskDueDate').value = '';
                document.getElementById('qmsTaskProcessStage').value = '';
                document.getElementById('qmsTaskQuantity').value = '';
                document.getElementById('qmsTaskPriority').value = 'medium';

                // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ì„ íƒ í•´ì œ
                const createBtn = document.getElementById('qmsCreateTaskBtn');
                if (createBtn) createBtn.disabled = true;
                selectedRadio.checked = false;
                document.querySelectorAll('.qms-assign-target-row').forEach(r => {
                    r.classList.remove('bg-blue-50', 'dark:bg-blue-900/30');
                });

                // íƒ€ê²Ÿ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                await renderQMSAssignmentTargets();

            } catch (err) {
                log.error('Failed to create task', err);
                showToast('ì‘ì—… ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (err.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
            }
        }

        // ì‘ì—…ëª©ë¡ íƒ­ ë¡œë“œ
        async function loadQMSTasklistTab() {
            log.debug('Loading QMS Tasklist tab...');

            if (!qmsManager) {
                showToast('QMSê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            await renderQMSTasklist();
        }

        // ì‘ì—…ëª©ë¡ ë Œë”ë§
        async function renderQMSTasklist() {
            const tbody = document.getElementById('qmsTasklistTableBody');
            if (!tbody) return;

            let tasks = [];
            try {
                tasks = await qmsManager.getTasks({});
            } catch (err) {
                log.error('Failed to load tasklist', err);
                tasks = qmsManager?.getCachedTasks() || [];
            }

            // ìš”ì•½ ì—…ë°ì´íŠ¸
            updateQMSTasklistSummary(tasks);

            if (tasks.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="p-4 text-center text-secondary">
                            ë“±ë¡ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = tasks.map(t => {
                const statusInfo = getTaskStatusInfo(t.status);
                const typeInfo = getTaskTypeInfo(t.taskType);

                return `
                    <tr class="border-t dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50">
                        <td class="p-2 font-mono text-xs">${escapeHtml(t.taskId?.slice(0, 8) || '-')}</td>
                        <td class="p-2">
                            <span class="text-xs px-2 py-0.5 rounded ${typeInfo.class}">
                                ${typeInfo.label}
                            </span>
                        </td>
                        <td class="p-2">${escapeHtml(t.taskTitle || '-')}</td>
                        <td class="p-2">${escapeHtml(t.assignedTo || '-')}</td>
                        <td class="p-2">${formatDate(t.dueDate)}</td>
                        <td class="p-2 text-center">
                            <span class="text-xs px-2 py-0.5 rounded ${statusInfo.class}">
                                ${statusInfo.label}
                            </span>
                        </td>
                        <td class="p-2 text-center">
                            <button class="text-blue-600 hover:text-blue-800 text-xs px-2 py-1 rounded hover:bg-blue-50 dark:hover:bg-blue-900/30"
                                    onclick="showQMSTaskDetail('${escapeHtml(t.taskId)}')">
                                ìƒì„¸
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ì‘ì—…ëª©ë¡ ìš”ì•½ ì—…ë°ì´íŠ¸
        function updateQMSTasklistSummary(tasks) {
            const totalEl = document.getElementById('qmsTasklistTotal');
            const pendingEl = document.getElementById('qmsTasklistPending');
            const inProgressEl = document.getElementById('qmsTasklistInProgress');
            const completedEl = document.getElementById('qmsTasklistCompleted');

            const total = tasks.length;
            const pending = tasks.filter(t => t.status === 'pending').length;
            const inProgress = tasks.filter(t => t.status === 'in_progress').length;
            const completed = tasks.filter(t => t.status === 'completed').length;

            if (totalEl) totalEl.textContent = total;
            if (pendingEl) pendingEl.textContent = pending;
            if (inProgressEl) inProgressEl.textContent = inProgress;
            if (completedEl) completedEl.textContent = completed;
        }

        // ì‘ì—… ìƒíƒœ ì •ë³´
        function getTaskStatusInfo(status) {
            switch (status) {
                case 'pending':
                    return { label: 'ëŒ€ê¸°', class: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400' };
                case 'in_progress':
                    return { label: 'ì§„í–‰ì¤‘', class: 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400' };
                case 'completed':
                    return { label: 'ì™„ë£Œ', class: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' };
                case 'cancelled':
                    return { label: 'ì·¨ì†Œ', class: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400' };
                default:
                    return { label: status || 'ì•Œ ìˆ˜ ì—†ìŒ', class: 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300' };
            }
        }

        // ì‘ì—… ìœ í˜• ì •ë³´
        function getTaskTypeInfo(taskType) {
            switch (taskType) {
                case 'inspection':
                    return { label: 'ê²€ìˆ˜', class: 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400' };
                case 'rework':
                    return { label: 'ìˆ˜ì •/ì¬ì‘ì—…', class: 'bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400' };
                case 'custom':
                    return { label: 'ì»¤ìŠ¤í…€', class: 'bg-cyan-100 text-cyan-700 dark:bg-cyan-900/30 dark:text-cyan-400' };
                default:
                    return { label: taskType || 'ê¸°íƒ€', class: 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300' };
            }
        }

        // ì‘ì—… ìƒì„¸ ë³´ê¸°
        function showQMSTaskDetail(taskId) {
            // TODO: ëª¨ë‹¬ë¡œ ìƒì„¸ ì •ë³´ í‘œì‹œ
            showToast('ìƒì„¸ ë³´ê¸° ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info');
        }

        // ê²°ê³¼ê´€ë¦¬ íƒ­ ë¡œë“œ
        async function loadQMSResultsTab() {
            log.debug('Loading QMS Results tab...');

            if (!qmsManager) {
                showToast('QMSê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            await renderQMSResults();
        }

        // ê²°ê³¼ íƒ­ ì „ì²´ ë Œë”ë§
        async function renderQMSResults() {
            // ì‘ì—… ì„ íƒ ëª©ë¡ ë Œë”ë§
            await renderQMSResultsTasks();

            // ê²°ê³¼ íˆìŠ¤í† ë¦¬ ë Œë”ë§
            await renderQMSResultsHistory();

            // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
            setupQMSResultsEventHandlers();
        }

        // ê²°ê³¼ ì…ë ¥ìš© ì‘ì—… ëª©ë¡ ë Œë”ë§ (pending/in_progress ìƒíƒœì˜ ì‘ì—…)
        async function renderQMSResultsTasks() {
            const tbody = document.getElementById('qmsResultsTasksBody');
            if (!tbody) return;

            let tasks = [];
            try {
                // pending ë˜ëŠ” in_progress ìƒíƒœì˜ ì‘ì—…ë§Œ í‘œì‹œ
                const allTasks = await qmsManager.getTasks({});
                tasks = allTasks.filter(t => t.status === 'pending' || t.status === 'in_progress');
            } catch (err) {
                log.error('Failed to load tasks for results', err);
                tasks = [];
            }

            if (tasks.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" class="p-4 text-center text-secondary">
                            ê²°ê³¼ë¥¼ ì…ë ¥í•  ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = tasks.map(t => {
                const typeInfo = getTaskTypeInfo(t.taskType);
                const statusInfo = getTaskStatusInfo(t.status);

                return `
                    <tr class="border-t dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50 cursor-pointer qms-result-task-row"
                        data-task-id="${escapeHtml(t.taskId)}"
                        onclick="selectQMSResultTask(this, '${escapeHtml(t.taskId)}')">
                        <td class="p-2">
                            <input type="radio" name="qmsResultTask" value="${escapeHtml(t.taskId)}" class="rounded">
                        </td>
                        <td class="p-2">
                            <div class="font-medium">${escapeHtml(t.taskTitle || '-')}</div>
                            <div class="text-xs text-secondary">${escapeHtml(t.taskId?.slice(0, 8) || '')}</div>
                        </td>
                        <td class="p-2">
                            <span class="text-xs px-2 py-0.5 rounded ${typeInfo.class}">
                                ${typeInfo.label}
                            </span>
                        </td>
                        <td class="p-2 text-center">
                            <span class="text-xs px-2 py-0.5 rounded ${statusInfo.class}">
                                ${statusInfo.label}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // ê²°ê³¼ ì‘ì—… ì„ íƒ í•¸ë“¤ëŸ¬
        function selectQMSResultTask(row, taskId) {
            const radio = row.querySelector('input[type="radio"]');
            if (radio) radio.checked = true;

            // ì„ íƒ ìƒíƒœ ì‹œê°í™”
            document.querySelectorAll('.qms-result-task-row').forEach(r => {
                r.classList.remove('bg-blue-50', 'dark:bg-blue-900/30');
            });
            row.classList.add('bg-blue-50', 'dark:bg-blue-900/30');

            // ì €ì¥ ë²„íŠ¼ í™œì„±í™”
            const saveBtn = document.getElementById('qmsSaveResultBtn');
            if (saveBtn) saveBtn.disabled = false;
        }

        // ê²°ê³¼ íˆìŠ¤í† ë¦¬ ë Œë”ë§
        async function renderQMSResultsHistory() {
            const tbody = document.getElementById('qmsResultsHistoryBody');
            if (!tbody) return;

            let results = [];
            try {
                results = await qmsManager.getResults({});
            } catch (err) {
                log.error('Failed to load results', err);
                results = qmsManager?.getCachedResults() || [];
            }

            // ìš”ì•½ ì—…ë°ì´íŠ¸
            updateQMSResultsSummary(results);

            if (results.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="p-4 text-center text-secondary">
                            ë“±ë¡ëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = results.map(r => {
                const statusInfo = getResultStatusInfo(r.resultStatus);

                return `
                    <tr class="border-t dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50">
                        <td class="p-2">
                            <div class="font-medium">${escapeHtml(r.taskTitle || r.taskId?.slice(0, 8) || '-')}</div>
                            <div class="text-xs text-secondary">${escapeHtml(r.resultId?.slice(0, 8) || '')}</div>
                        </td>
                        <td class="p-2 text-center">
                            <span class="text-xs px-2 py-0.5 rounded ${statusInfo.class}">
                                ${statusInfo.label}
                            </span>
                        </td>
                        <td class="p-2 text-right">${(r.passedQty || 0).toLocaleString()} / ${(r.failedQty || 0).toLocaleString()}</td>
                        <td class="p-2">${escapeHtml(r.completedBy || '-')}</td>
                        <td class="p-2">${formatDate(r.completedAt)}</td>
                    </tr>
                `;
            }).join('');
        }

        // ê²°ê³¼ íƒ­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
        function setupQMSResultsEventHandlers() {
            const saveBtn = document.getElementById('qmsSaveResultBtn');
            if (saveBtn) {
                saveBtn.onclick = handleQMSSaveResult;
            }
        }

        // ê²°ê³¼ ì €ì¥ í•¸ë“¤ëŸ¬
        async function handleQMSSaveResult() {
            const selectedRadio = document.querySelector('input[name="qmsResultTask"]:checked');
            if (!selectedRadio) {
                showToast('ê²°ê³¼ë¥¼ ì…ë ¥í•  ì‘ì—…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            const taskId = selectedRadio.value;
            const resultStatus = document.getElementById('qmsResultStatus')?.value || 'pass';
            const passedQty = parseInt(document.getElementById('qmsResultPassedQty')?.value) || 0;
            const failedQty = parseInt(document.getElementById('qmsResultFailedQty')?.value) || 0;
            const findings = document.getElementById('qmsResultFindings')?.value?.trim() || '';
            const actions = document.getElementById('qmsResultActions')?.value?.trim() || '';

            // ë¶ˆí•©ê²© ì‚¬ìœ  ìˆ˜ì§‘
            const failureReasons = [];
            document.querySelectorAll('#qmsFailureReasons input[type="checkbox"]:checked').forEach(cb => {
                failureReasons.push(cb.value);
            });

            // ìœ íš¨ì„± ê²€ì‚¬
            if (passedQty === 0 && failedQty === 0) {
                showToast('í•©ê²© ìˆ˜ëŸ‰ ë˜ëŠ” ë¶ˆí•©ê²© ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            if (resultStatus === 'fail' && failureReasons.length === 0) {
                showToast('ë¶ˆí•©ê²© ì‚¬ìœ ë¥¼ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            try {
                const resultData = {
                    taskId,
                    resultStatus,
                    passedQty,
                    failedQty,
                    failureReasons: JSON.stringify(failureReasons),
                    findings,
                    actions,
                    completedAt: new Date().toISOString()
                };

                await qmsManager.saveResult(resultData);
                showToast('ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');

                // ì‘ì—… ìƒíƒœ ì—…ë°ì´íŠ¸ (completedë¡œ ë³€ê²½)
                try {
                    await qmsManager.updateTaskStatus(taskId, 'completed');
                } catch (taskUpdateErr) {
                    log.warn('Failed to update task status', taskUpdateErr);
                }

                // í¼ ì´ˆê¸°í™”
                resetQMSResultForm();

                // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                await renderQMSResults();
            } catch (err) {
                log.error('Failed to save result', err);
                showToast('ê²°ê³¼ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (err.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
            }
        }

        // ê²°ê³¼ ì…ë ¥ í¼ ì´ˆê¸°í™”
        function resetQMSResultForm() {
            const resultStatus = document.getElementById('qmsResultStatus');
            if (resultStatus) resultStatus.value = 'pass';

            const passedQty = document.getElementById('qmsResultPassedQty');
            if (passedQty) passedQty.value = '0';

            const failedQty = document.getElementById('qmsResultFailedQty');
            if (failedQty) failedQty.value = '0';

            const findings = document.getElementById('qmsResultFindings');
            if (findings) findings.value = '';

            const actions = document.getElementById('qmsResultActions');
            if (actions) actions.value = '';

            // ì²´í¬ë°•ìŠ¤ í•´ì œ
            document.querySelectorAll('#qmsFailureReasons input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });

            // ì‘ì—… ì„ íƒ í•´ì œ
            const selectedRadio = document.querySelector('input[name="qmsResultTask"]:checked');
            if (selectedRadio) selectedRadio.checked = false;

            document.querySelectorAll('.qms-result-task-row').forEach(r => {
                r.classList.remove('bg-blue-50', 'dark:bg-blue-900/30');
            });

            // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™”
            const saveBtn = document.getElementById('qmsSaveResultBtn');
            if (saveBtn) saveBtn.disabled = true;
        }

        // ê²°ê³¼ ìš”ì•½ ì—…ë°ì´íŠ¸
        function updateQMSResultsSummary(results) {
            const totalEl = document.getElementById('qmsResultsTotal');
            const passEl = document.getElementById('qmsResultsPass');
            const failEl = document.getElementById('qmsResultsFail');
            const partialEl = document.getElementById('qmsResultsPartial');

            const total = results.length;
            const pass = results.filter(r => r.resultStatus === 'pass').length;
            const fail = results.filter(r => r.resultStatus === 'fail').length;
            const partial = results.filter(r => r.resultStatus === 'partial').length;

            if (totalEl) totalEl.textContent = total;
            if (passEl) passEl.textContent = pass;
            if (failEl) failEl.textContent = fail;
            if (partialEl) partialEl.textContent = partial;
        }

        // ê²°ê³¼ ìƒíƒœ ì •ë³´
        function getResultStatusInfo(status) {
            switch (status) {
                case 'pass':
                    return { label: 'í•©ê²©', class: 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' };
                case 'fail':
                    return { label: 'ë¶ˆí•©ê²©', class: 'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400' };
                case 'partial':
                    return { label: 'ë¶€ë¶„í•©ê²©', class: 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400' };
                default:
                    return { label: status || 'ì•Œ ìˆ˜ ì—†ìŒ', class: 'bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300' };
            }
        }

        // ê²°ê³¼ ìƒì„¸ ë³´ê¸°
        function showQMSResultDetail(resultId) {
            // TODO: ëª¨ë‹¬ë¡œ ìƒì„¸ ì •ë³´ í‘œì‹œ
            showToast('ìƒì„¸ ë³´ê¸° ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info');
        }

        // ë‚ ì§œ í¬ë§·
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' });
            } catch {
                return dateStr;
            }
        }

        // ì•± ì‹œì‘ ì‹œ ì„¤ì • ë³µì›
        function restoreSettings() {
            // í˜ì´ì§€ í¬ê¸° ë³µì›
            const pageSize = settings.get('pageSize');
            const pageSizeSelect = document.getElementById('pageSize');
            if (pageSizeSelect) {
                pageSizeSelect.value = pageSize;
                PAGE_SIZE = pageSize;
            }

            // ë‹¤í¬ëª¨ë“œ ë³µì›
            const darkMode = settings.get('darkMode');
            if (darkMode) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }

            // ê¸°ë³¸ íƒ­ ë³µì›
            const defaultTab = settings.get('defaultTab');
            if (defaultTab) {
                const tabBtn = document.querySelector(`[data-tab="${defaultTab}"]`);
                if (tabBtn) {
                    tabBtn.click();
                }
            }

            // ì •ë ¬ ì„¤ì • ë³µì›
            const sortColumn = settings.get('sortColumn');
            const sortDirection = settings.get('sortDirection');
            if (sortColumn && sortDirection) {
                sortState[currentTab] = { column: sortColumn, direction: sortDirection };
            }

            // Agent Q03: ì»¬ëŸ¼ ê°€ì‹œì„± ë³µì› (Phase 4 - Q03-5)
            // í…Œì´ë¸”ì´ ë Œë”ë§ëœ í›„ ì ìš©ë˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
            // (updateDataTab()ì—ì„œ ìë™ í˜¸ì¶œë¨)

            log.info('Settings restored');
        }

        // ========================================
        // Agent Q03: ì»¬ëŸ¼ ê°€ì‹œì„± ì ìš©
        // Phase 4 - Step 5: Q03-5 (MEDIUM)
        // ========================================

        // ì»¬ëŸ¼ ë§¤í•‘ (data-column â†’ columnName)
        const COLUMN_MAPPING = {
            0: 'factory',
            1: 'poNumber',
            2: 'model',
            3: 'article',
            4: 'destination',
            5: 'outsoleVendor',
            6: 'quantity',
            7: 'cutting',
            8: 'sewing',
            9: 'assembly',
            10: 'warehouseIn',
            11: 'crd',
            12: 'sdd',
            13: 'status'
        };

        function applyColumnVisibility() {
            const columns = settings.getAllColumnVisibility();
            const table = document.getElementById('dataTable');
            if (!table) return;

            // í—¤ë” ì—´ ìˆ¨ê¸°ê¸°/í‘œì‹œ
            const headers = table.querySelectorAll('thead th');
            headers.forEach((th, index) => {
                const columnName = COLUMN_MAPPING[index];
                if (columnName && columns[columnName] === false) {
                    th.style.display = 'none';
                } else {
                    th.style.display = '';
                }
            });

            // ë°ì´í„° ì—´ ìˆ¨ê¸°ê¸°/í‘œì‹œ
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                cells.forEach((td, index) => {
                    const columnName = COLUMN_MAPPING[index];
                    if (columnName && columns[columnName] === false) {
                        td.style.display = 'none';
                    } else {
                        td.style.display = '';
                    }
                });
            });

            log.debug('Column visibility applied');
        }

        // ========================================
        // Agent Q04: ë¸Œë¼ìš°ì € ì•Œë¦¼ ì‹œìŠ¤í…œ
        // Phase 4 - Step 5: Q04-2 (CRITICAL)
        // ========================================
        let notificationCheckInterval = null;
        let lastNotifiedDelayedCount = 0;

        // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
        async function requestNotificationPermission() {
            if (!('Notification' in window)) {
                alert('âš ï¸ ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return false;
            }

            if (Notification.permission === 'granted') {
                return true;
            }

            if (Notification.permission !== 'denied') {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    log.info('Notification permission granted');
                    // í…ŒìŠ¤íŠ¸ ì•Œë¦¼
                    new Notification('Rachgia ëŒ€ì‹œë³´ë“œ', {
                        body: 'ì•Œë¦¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤! ì§€ì—° ì˜¤ë” ë°œìƒ ì‹œ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.',
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">ğŸ””</text></svg>',
                        tag: 'rachgia-welcome'
                    });
                    return true;
                }
            }

            alert('âš ï¸ ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì•Œë¦¼ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
            return false;
        }

        // ì§€ì—° ì˜¤ë” í™•ì¸ ë° ì•Œë¦¼ (Agent Q04 - Phase 4 - Q04-5 í™•ì¥)
        function checkDelayedOrders() {
            const notifSettings = settings.get('notifications');
            if (!notifSettings.enabled || Notification.permission !== 'granted') {
                return;
            }

            // Agent Q04-5: ìŒì†Œê±° ì‹œê°„ ì²´í¬
            const now = new Date();
            if (notifSettings.quietHoursStart && notifSettings.quietHoursEnd) {
                const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                if (currentTime >= notifSettings.quietHoursStart && currentTime <= notifSettings.quietHoursEnd) {
                    log.debug('In quiet hours, notifications suppressed');
                    return;
                }
            }

            const delayedOrders = [];
            const warningOrders = [];
            const criticalOrders = [];

            EMBEDDED_DATA.forEach(d => {
                if (notifSettings.delayedOrders && isDelayed(d)) {
                    delayedOrders.push(d);
                }
                if (notifSettings.warningOrders && isWarning(d)) {
                    warningOrders.push(d);
                }
                if (notifSettings.criticalOrders && isCritical(d)) {
                    criticalOrders.push(d);
                }
            });

            // ì§€ì—° ì˜¤ë” ì•Œë¦¼ (ì¹´ìš´íŠ¸ê°€ ì¦ê°€í–ˆì„ ë•Œë§Œ)
            if (delayedOrders.length > 0 && delayedOrders.length > lastNotifiedDelayedCount) {
                const newDelayedCount = delayedOrders.length - lastNotifiedDelayedCount;
                const notifBody = `${delayedOrders.length}ê±´ì˜ ì§€ì—° ì˜¤ë”ê°€ ìˆìŠµë‹ˆë‹¤. (ì‹ ê·œ: ${newDelayedCount}ê±´)`;

                new Notification('âš ï¸ ì§€ì—° ì˜¤ë” ë°œìƒ', {
                    body: notifBody,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">âš ï¸</text></svg>',
                    tag: 'rachgia-delayed',
                    requireInteraction: true  // ì‚¬ìš©ìê°€ ë‹«ì„ ë•Œê¹Œì§€ ìœ ì§€
                });

                // Agent Q04-6: íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
                addNotificationToHistory('delayed', 'âš ï¸ ì§€ì—° ì˜¤ë” ë°œìƒ', notifBody, {
                    count: delayedOrders.length,
                    newCount: newDelayedCount
                });

                lastNotifiedDelayedCount = delayedOrders.length;
                log.warn(`Notification sent: ${delayedOrders.length} delayed orders`);
            }

            // Agent Q04: ê²½ê³  ì˜¤ë” ì•Œë¦¼ (í•˜ë£¨ 1íšŒë§Œ, CRD-SDD ì°¨ì´ 3ì¼ ì´ë‚´)
            if (warningOrders.length > 0) {
                const lastWarningNotif = settings.get('lastWarningNotification');
                const today = now.toISOString().slice(0, 10);

                if (lastWarningNotif !== today) {
                    const notifBody = `${warningOrders.length}ê±´ì˜ ê²½ê³  ì˜¤ë”ê°€ ìˆìŠµë‹ˆë‹¤. (CRDê¹Œì§€ 3ì¼ ì´ë‚´)`;

                    new Notification('âš ï¸ ê²½ê³  ì˜¤ë” ì•Œë¦¼', {
                        body: notifBody,
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">âš ï¸</text></svg>',
                        tag: 'rachgia-warning',
                        requireInteraction: false  // ìë™ ë‹«í˜ (ì§€ì—°ë³´ë‹¤ ë‚®ì€ ìš°ì„ ìˆœìœ„)
                    });

                    // Agent Q04-6: íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
                    addNotificationToHistory('warning', 'âš ï¸ ê²½ê³  ì˜¤ë” ì•Œë¦¼', notifBody, {
                        count: warningOrders.length
                    });

                    settings.set('lastWarningNotification', today);
                    log.info(`Notification sent: ${warningOrders.length} warning orders`);
                }
            }

            // Agent Q04-5: ê¸´ê¸‰ ì˜¤ë” ì•Œë¦¼ (CRDê°€ 3ì¼ ì´ë‚´, í•˜ë£¨ 1íšŒë§Œ)
            if (criticalOrders.length > 0) {
                const lastCriticalNotif = settings.get('lastCriticalNotification');
                const today = now.toISOString().slice(0, 10);

                if (lastCriticalNotif !== today) {
                    const notifBody = `${criticalOrders.length}ê±´ì˜ ê¸´ê¸‰ ì˜¤ë”ê°€ ìˆìŠµë‹ˆë‹¤. (CRDê¹Œì§€ 3ì¼ ì´ë‚´)`;

                    new Notification('ğŸ”¥ ê¸´ê¸‰ ì˜¤ë” ì•Œë¦¼', {
                        body: notifBody,
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">ğŸ”¥</text></svg>',
                        tag: 'rachgia-critical',
                        requireInteraction: true  // ì¤‘ìš”í•˜ë¯€ë¡œ ì‚¬ìš©ìê°€ ì§ì ‘ ë‹«ë„ë¡
                    });

                    // Agent Q04-6: íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
                    addNotificationToHistory('critical', 'ğŸ”¥ ê¸´ê¸‰ ì˜¤ë” ì•Œë¦¼', notifBody, {
                        count: criticalOrders.length
                    });

                    settings.set('lastCriticalNotification', today);
                    log.warn(`Notification sent: ${criticalOrders.length} critical orders`);
                }
            }
        }

        // ========================================
        // Agent Q04: ì•Œë¦¼ íˆìŠ¤í† ë¦¬ ì‹œìŠ¤í…œ
        // Phase 4 - Step 5: Q04-6 (LOW)
        // ========================================

        // ì•Œë¦¼ íˆìŠ¤í† ë¦¬ì— ì•Œë¦¼ ì¶”ê°€ (ìµœëŒ€ 10ê°œ)
        function addNotificationToHistory(type, title, body, data = {}) {
            const history = settings.get('notificationHistory') || [];

            const notification = {
                id: Date.now().toString(),
                type, // 'delayed', 'warning', 'critical', 'refresh', 'system'
                title,
                body,
                timestamp: new Date().toISOString(),
                read: false,
                data
            };

            // ë§¨ ì•ì— ì¶”ê°€
            history.unshift(notification);

            // ìµœëŒ€ 10ê°œë§Œ ìœ ì§€
            if (history.length > 10) {
                history.splice(10);
            }

            settings.set('notificationHistory', history);
            updateNotificationBadge();

            log.info(`Notification added to history: ${type} - ${title}`);
        }

        // ì•Œë¦¼ ë°°ì§€ ì—…ë°ì´íŠ¸
        function updateNotificationBadge() {
            const history = settings.get('notificationHistory') || [];
            const unreadCount = history.filter(n => !n.read).length;

            const badge = document.getElementById('unreadNotificationBadge');
            if (badge) {
                if (unreadCount > 0) {
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            }
        }

        // ì•Œë¦¼ íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ ì—´ê¸°
        function showNotificationHistory() {
            const history = settings.get('notificationHistory') || [];

            if (history.length === 0) {
                document.getElementById('notificationHistoryContent').innerHTML = `
                    <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                        <div class="text-6xl mb-4">ğŸ“­</div>
                        <p class="text-lg">ì•Œë¦¼ íˆìŠ¤í† ë¦¬ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>
                        <p class="text-sm mt-2">ì•Œë¦¼ì´ ë°œìƒí•˜ë©´ ìµœê·¼ 10ê°œê¹Œì§€ ì €ì¥ë©ë‹ˆë‹¤.</p>
                    </div>
                `;
            } else {
                const historyHTML = history.map(notif => {
                    const typeIcons = {
                        delayed: 'âš ï¸',
                        warning: 'âš ï¸',
                        critical: 'ğŸ”¥',
                        refresh: 'ğŸ”„',
                        system: 'ğŸ””'
                    };

                    const typeColors = {
                        delayed: 'border-red-500 bg-red-50 dark:bg-red-900/20',
                        warning: 'border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20',
                        critical: 'border-orange-500 bg-orange-50 dark:bg-orange-900/20',
                        refresh: 'border-blue-500 bg-blue-50 dark:bg-blue-900/20',
                        system: 'border-green-500 bg-green-50 dark:bg-green-900/20'
                    };

                    const icon = typeIcons[notif.type] || 'ğŸ“¬';
                    const colorClass = typeColors[notif.type] || 'border-gray-500 bg-gray-50 dark:bg-gray-900/20';
                    const timeAgo = getTimeAgo(notif.timestamp);
                    const isUnread = !notif.read;

                    return `
                        <div class="border-l-4 ${colorClass} p-4 mb-4 rounded-lg ${isUnread ? 'font-bold' : ''}" data-notif-id="${notif.id}">
                            <div class="flex items-start gap-3">
                                <div class="text-3xl">${icon}</div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-1">
                                        <h4 class="text-lg font-bold text-gray-900 dark:text-white">${escapeHtml(notif.title)}</h4>
                                        ${isUnread ? '<span class="text-xs bg-red-500 text-white px-2 py-1 rounded-full">New</span>' : ''}
                                    </div>
                                    <p class="text-sm text-gray-700 dark:text-gray-300 mb-2">${escapeHtml(notif.body)}</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">${timeAgo}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                document.getElementById('notificationHistoryContent').innerHTML = historyHTML;

                // ëª¨ë“  ì•Œë¦¼ì„ ì½ìŒ ìƒíƒœë¡œ ë³€ê²½
                history.forEach(notif => notif.read = true);
                settings.set('notificationHistory', history);
                updateNotificationBadge();
            }

            document.getElementById('notificationHistoryModal').classList.remove('hidden');
            log.info('Notification history modal opened');
        }

        // ì•Œë¦¼ íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ ë‹«ê¸°
        function closeNotificationHistoryModal() {
            document.getElementById('notificationHistoryModal').classList.add('hidden');
            log.info('Notification history modal closed');
        }

        // ì•Œë¦¼ íˆìŠ¤í† ë¦¬ ëª¨ë‘ ì‚­ì œ
        function clearNotificationHistory() {
            if (confirm('ì •ë§ ëª¨ë“  ì•Œë¦¼ íˆìŠ¤í† ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                settings.set('notificationHistory', []);
                updateNotificationBadge();
                showNotificationHistory(); // ë¹ˆ ìƒíƒœ í‘œì‹œ
                log.info('Notification history cleared');
            }
        }

        // ìƒëŒ€ ì‹œê°„ ê³„ì‚° (ì˜ˆ: "5ë¶„ ì „", "2ì‹œê°„ ì „")
        function getTimeAgo(timestamp) {
            const now = new Date();
            const past = new Date(timestamp);
            const diffMs = now - past;
            const diffSec = Math.floor(diffMs / 1000);
            const diffMin = Math.floor(diffSec / 60);
            const diffHour = Math.floor(diffMin / 60);
            const diffDay = Math.floor(diffHour / 24);

            if (diffSec < 60) {
                return 'ë°©ê¸ˆ ì „';
            } else if (diffMin < 60) {
                return `${diffMin}ë¶„ ì „`;
            } else if (diffHour < 24) {
                return `${diffHour}ì‹œê°„ ì „`;
            } else if (diffDay < 7) {
                return `${diffDay}ì¼ ì „`;
            } else {
                return past.toLocaleString('ko-KR', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
            }
        }

        // ========================================
        // Agent Q05: ë³´ê³ ì„œ íˆìŠ¤í† ë¦¬ ì‹œìŠ¤í…œ
        // Phase 4 - Step 5: Q05-5 (LOW)
        // ========================================

        // í˜„ì¬ í•„í„° ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ëŠ” í—¬í¼ í•¨ìˆ˜
        function getCurrentFilters() {
            return {
                month: document.getElementById('monthFilter')?.value || '',
                destination: document.getElementById('destFilter')?.value || '',
                vendor: document.getElementById('vendorFilter')?.value || '',
                factory: document.getElementById('factoryFilter')?.value || '',
                status: document.getElementById('statusFilter')?.value || '',
                search: document.getElementById('searchText')?.value || ''
            };
        }

        // ë³´ê³ ì„œ íˆìŠ¤í† ë¦¬ì— ë³´ê³ ì„œ ì¶”ê°€ (ìµœëŒ€ 30ê°œ)
        function addReportToHistory(reportData) {
            const history = settings.get('reportHistory') || [];

            const report = {
                id: Date.now().toString(),
                title: reportData.title,
                date: reportData.date,
                generatedAt: new Date().toISOString(),
                filters: reportData.filters,
                summary: reportData.summary,
                htmlContent: reportData.htmlContent
            };

            // ë§¨ ì•ì— ì¶”ê°€
            history.unshift(report);

            // ìµœëŒ€ 30ê°œë§Œ ìœ ì§€
            if (history.length > 30) {
                history.splice(30);
            }

            settings.set('reportHistory', history);
            log.info(`Report added to history: ${reportData.title}`);
        }

        // ë³´ê³ ì„œ íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ ì—´ê¸°
        function showReportHistory() {
            const history = settings.get('reportHistory') || [];

            if (history.length === 0) {
                document.getElementById('reportHistoryContent').innerHTML = `
                    <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                        <div class="text-6xl mb-4">ğŸ“‹</div>
                        <p class="text-lg">ë³´ê³ ì„œ íˆìŠ¤í† ë¦¬ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>
                        <p class="text-sm mt-2">ì¼ì¼ ë³´ê³ ì„œë¥¼ ìƒì„±í•˜ë©´ ìµœê·¼ 30ê°œê¹Œì§€ ì €ì¥ë©ë‹ˆë‹¤.</p>
                    </div>
                `;
            } else {
                const historyHTML = history.map((report, index) => {
                    const timeAgo = getTimeAgo(report.generatedAt);
                    const isRecent = index < 3; // ìµœê·¼ 3ê°œëŠ” "Recent" ë°°ì§€ í‘œì‹œ

                    // í•„í„° ì •ë³´ ìš”ì•½
                    const activeFilters = [];
                    if (report.filters.month) activeFilters.push(`ì›”: ${report.filters.month}`);
                    if (report.filters.destination) activeFilters.push(`í–‰ì„ ì§€: ${report.filters.destination}`);
                    if (report.filters.vendor) activeFilters.push(`ë²¤ë”: ${report.filters.vendor}`);
                    if (report.filters.factory) activeFilters.push(`ê³µì¥: ${report.filters.factory}`);
                    if (report.filters.status) activeFilters.push(`ìƒíƒœ: ${report.filters.status}`);
                    if (report.filters.search) activeFilters.push(`ê²€ìƒ‰: ${report.filters.search}`);
                    const filterText = activeFilters.length > 0 ? activeFilters.join(', ') : 'ì „ì²´ ë°ì´í„°';

                    return `
                        <div class="report-card border border-gray-200 dark:border-gray-700 rounded-lg p-6 mb-4 bg-white dark:bg-gray-800">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-2">
                                        <h4 class="text-lg font-bold text-gray-900 dark:text-white">${escapeHtml(report.title)}</h4>
                                        ${isRecent ? '<span class="report-badge recent">New</span>' : ''}
                                    </div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">${timeAgo}</p>
                                    <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">ğŸ“… ${report.date}</p>
                                    <p class="text-xs text-gray-600 dark:text-gray-400">ğŸ” í•„í„°: ${escapeHtml(filterText)}</p>
                                </div>
                                <div class="flex gap-2">
                                    <button data-action="viewReport" data-param="${report.id}" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm font-medium">
                                        ğŸ‘ï¸ ë³´ê¸°
                                    </button>
                                    <button data-action="deleteReport" data-param="${report.id}" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm font-medium">
                                        ğŸ—‘ï¸
                                    </button>
                                </div>
                            </div>

                            <!-- ë³´ê³ ì„œ ìš”ì•½ ì •ë³´ -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 bg-gray-50 dark:bg-gray-900 p-4 rounded-lg">
                                <div>
                                    <div class="text-xs text-gray-600 dark:text-gray-400">ì „ì²´ ì˜¤ë”</div>
                                    <div class="text-xl font-bold text-blue-600 dark:text-blue-400">${report.summary.totalOrders}</div>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-600 dark:text-gray-400">ì§€ì—° ì˜¤ë”</div>
                                    <div class="text-xl font-bold text-red-600 dark:text-red-400">${report.summary.delayedOrders}</div>
                                    <div class="text-xs text-gray-500">(${report.summary.delayedRate}%)</div>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-600 dark:text-gray-400">ê²½ê³  ì˜¤ë”</div>
                                    <div class="text-xl font-bold text-yellow-600 dark:text-yellow-400">${report.summary.warningOrders}</div>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-600 dark:text-gray-400">ì™„ë£Œìœ¨</div>
                                    <div class="text-xl font-bold text-green-600 dark:text-green-400">${report.summary.completionRate}%</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                document.getElementById('reportHistoryContent').innerHTML = historyHTML;
            }

            document.getElementById('reportHistoryModal').classList.remove('hidden');
            log.info('Report history modal opened');
        }

        // ë³´ê³ ì„œ íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ ë‹«ê¸°
        function closeReportHistoryModal() {
            document.getElementById('reportHistoryModal').classList.add('hidden');
            log.info('Report history modal closed');
        }

        // íŠ¹ì • ë³´ê³ ì„œ ë³´ê¸°
        function viewReport(reportId) {
            const history = settings.get('reportHistory') || [];
            const report = history.find(r => r.id === reportId);

            if (!report) {
                alert('ë³´ê³ ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ì¼ì¼ ë³´ê³ ì„œ ëª¨ë‹¬ì— í•´ë‹¹ ë³´ê³ ì„œ ë‚´ìš©ì„ í‘œì‹œ
            document.getElementById('reportDate').textContent = `(${report.date})`;
            document.getElementById('reportContent').innerHTML = report.htmlContent;

            // íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ ë‹«ê¸°
            closeReportHistoryModal();

            // ë³´ê³ ì„œ ëª¨ë‹¬ ì—´ê¸°
            document.getElementById('dailyReportModal').classList.remove('hidden');

            log.info(`Report viewed: ${reportId}`);
        }

        // íŠ¹ì • ë³´ê³ ì„œ ì‚­ì œ
        function deleteReport(reportId) {
            if (!confirm('ì´ ë³´ê³ ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            const history = settings.get('reportHistory') || [];
            const newHistory = history.filter(r => r.id !== reportId);

            settings.set('reportHistory', newHistory);

            // íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ ìƒˆë¡œê³ ì¹¨
            showReportHistory();

            log.info(`Report deleted: ${reportId}`);
        }

        // ë³´ê³ ì„œ íˆìŠ¤í† ë¦¬ ëª¨ë‘ ì‚­ì œ
        function clearReportHistory() {
            if (!confirm('ì •ë§ ëª¨ë“  ë³´ê³ ì„œ íˆìŠ¤í† ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            settings.set('reportHistory', []);
            showReportHistory(); // ë¹ˆ ìƒíƒœ í‘œì‹œ
            log.info('Report history cleared');
        }

        // ì•Œë¦¼ ëª¨ë‹ˆí„°ë§ ì‹œì‘
        function startNotificationMonitor() {
            const notifSettings = settings.get('notifications');
            if (!notifSettings.enabled) {
                return;
            }

            // ê¸°ì¡´ ì¸í„°ë²Œ ì •ë¦¬
            if (notificationCheckInterval) {
                clearInterval(notificationCheckInterval);
            }

            // ì¦‰ì‹œ 1íšŒ ì²´í¬
            checkDelayedOrders();

            // ì£¼ê¸°ì  ì²´í¬ ì‹œì‘
            notificationCheckInterval = setInterval(() => {
                checkDelayedOrders();
            }, notifSettings.checkInterval);

            log.info(`Notification monitor started (interval: ${notifSettings.checkInterval}ms)`);
        }

        // ì•Œë¦¼ ëª¨ë‹ˆí„°ë§ ì¤‘ì§€
        function stopNotificationMonitor() {
            if (notificationCheckInterval) {
                clearInterval(notificationCheckInterval);
                notificationCheckInterval = null;
                lastNotifiedDelayedCount = 0;
                log.info('Notification monitor stopped');
            }
        }

        // ì•Œë¦¼ ì„¤ì • í† ê¸€
        async function toggleNotifications() {
            const notifSettings = settings.get('notifications');
            const newEnabled = !notifSettings.enabled;

            const notifBtn = document.querySelector('button[data-action="toggleNotifications"]');

            if (newEnabled) {
                // ì•Œë¦¼ ì¼œê¸°: ê¶Œí•œ ìš”ì²­
                const granted = await requestNotificationPermission();
                if (!granted) {
                    return;
                }
                notifSettings.enabled = true;
                settings.set('notifications', notifSettings);
                startNotificationMonitor();
                document.getElementById('notificationIcon').textContent = 'ğŸ””';
                // Agent Q09: aria-pressed ì—…ë°ì´íŠ¸
                if (notifBtn) notifBtn.setAttribute('aria-pressed', 'true');
                log.info('Notifications enabled');
            } else {
                // ì•Œë¦¼ ë„ê¸°
                notifSettings.enabled = false;
                settings.set('notifications', notifSettings);
                stopNotificationMonitor();
                document.getElementById('notificationIcon').textContent = 'ğŸ”•';
                // Agent Q09: aria-pressed ì—…ë°ì´íŠ¸
                if (notifBtn) notifBtn.setAttribute('aria-pressed', 'false');
                log.info('Notifications disabled');
            }
        }

        // ========================================
        // Agent Q06: ëª¨ë°”ì¼ í„°ì¹˜ ì œìŠ¤ì²˜ ì‹œìŠ¤í…œ
        // Phase 4 - Step 5: Q06-1 (CRITICAL)
        // ========================================
        let touchStartX = 0;
        let touchStartY = 0;
        let touchStartTime = 0;
        const SWIPE_THRESHOLD = 50;  // ìµœì†Œ ìŠ¤ì™€ì´í”„ ê±°ë¦¬ (px)
        const SWIPE_TIMEOUT = 300;   // ìµœëŒ€ ìŠ¤ì™€ì´í”„ ì‹œê°„ (ms)

        // ëª¨ë°”ì¼ í•„í„° íŒ¨ë„ ì—´ê¸°
        // ========================================
        // Agent Q06: í–„ë²„ê±° ë©”ë‰´ ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜
        // Phase 4 - Step 5: Q06-5 (MEDIUM)
        // ========================================

        function toggleMobileMenu() {
            const drawer = document.getElementById('mobileMenuDrawer');
            const backdrop = document.getElementById('mobileMenuBackdrop');
            const icon = document.getElementById('hamburgerIcon');
            const button = document.querySelector('.mobile-menu-toggle');

            const isActive = drawer.classList.contains('active');

            if (isActive) {
                // ë‹«ê¸°
                drawer.classList.remove('active');
                backdrop.classList.remove('active');
                icon.classList.remove('active');
                button.setAttribute('aria-expanded', 'false');
                log.debug('Mobile menu closed');
            } else {
                // ì—´ê¸°
                drawer.classList.add('active');
                backdrop.classList.add('active');
                icon.classList.add('active');
                button.setAttribute('aria-expanded', 'true');
                log.debug('Mobile menu opened');

                // í˜„ì¬ í™œì„± íƒ­ ê°•ì¡°
                const currentTab = document.querySelector('.tab-btn.tab-active')?.dataset.tab || 'monthly';
                document.querySelectorAll('.mobile-menu-item').forEach(item => {
                    if (item.dataset.tab === currentTab) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
            }
        }

        function switchTabFromMobileMenu(tabName) {
            // ê¸°ì¡´ íƒ­ ì „í™˜ ë¡œì§ í˜¸ì¶œ
            const tabBtn = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
            if (tabBtn) {
                tabBtn.click();
            }

            // ë©”ë‰´ ë‹«ê¸°
            toggleMobileMenu();

            log.info(`Switched to tab "${tabName}" from mobile menu`);
        }

        function openMobileFilters() {
            const panel = document.getElementById('mobileFilterPanel');
            const content = document.getElementById('mobileFilterContent');

            // í•„í„° ë‚´ìš© ë³µì‚¬ (ë°ìŠ¤í¬í†± í•„í„°ë¥¼ ëª¨ë°”ì¼ë¡œ)
            content.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">ì›” (SDD)</label>
                        <select id="mobileMonthFilter" class="w-full border border-theme rounded-lg px-4 py-3 bg-card text-base">
                            ${document.getElementById('monthFilter').innerHTML}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">ë¹ ë¥¸ ì„ íƒ</label>
                        <select id="mobileQuickFilter" class="w-full border border-theme rounded-lg px-4 py-3 bg-card text-base">
                            ${document.getElementById('quickDateFilter').innerHTML}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">í–‰ì„ ì§€</label>
                        <select id="mobileDestFilter" class="w-full border border-theme rounded-lg px-4 py-3 bg-card text-base">
                            ${document.getElementById('destFilter').innerHTML}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">ë²¤ë”</label>
                        <select id="mobileVendorFilter" class="w-full border border-theme rounded-lg px-4 py-3 bg-card text-base">
                            ${document.getElementById('vendorFilter').innerHTML}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">ì™„ë£Œ ìƒíƒœ</label>
                        <select id="mobileStatusFilter" class="w-full border border-theme rounded-lg px-4 py-3 bg-card text-base">
                            ${document.getElementById('statusFilter').innerHTML}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">í†µí•© ê²€ìƒ‰</label>
                        <input type="text" id="mobileSearchInput" placeholder="ëª¨ë¸, PO, í–‰ì„ ì§€, ë²¤ë”..."
                            class="w-full border border-theme rounded-lg px-4 py-3 bg-card text-base">
                    </div>
                </div>
            `;

            // í˜„ì¬ í•„í„° ê°’ ë™ê¸°í™”
            document.getElementById('mobileMonthFilter').value = document.getElementById('monthFilter').value;
            document.getElementById('mobileQuickFilter').value = document.getElementById('quickDateFilter').value;
            document.getElementById('mobileDestFilter').value = document.getElementById('destFilter').value;
            document.getElementById('mobileVendorFilter').value = document.getElementById('vendorFilter').value;
            document.getElementById('mobileStatusFilter').value = document.getElementById('statusFilter').value;
            document.getElementById('mobileSearchInput').value = document.getElementById('searchInput').value;

            panel.classList.add('active');
            log.info('Mobile filter panel opened');
        }

        // ëª¨ë°”ì¼ í•„í„° íŒ¨ë„ ë‹«ê¸°
        function closeMobileFilters() {
            const panel = document.getElementById('mobileFilterPanel');
            panel.classList.remove('active');
            log.info('Mobile filter panel closed');
        }

        // ëª¨ë°”ì¼ í•„í„° ì ìš©
        function applyMobileFilters() {
            // ëª¨ë°”ì¼ í•„í„° ê°’ì„ ë°ìŠ¤í¬í†± í•„í„°ë¡œ ë™ê¸°í™”
            document.getElementById('monthFilter').value = document.getElementById('mobileMonthFilter').value;
            document.getElementById('quickDateFilter').value = document.getElementById('mobileQuickFilter').value;
            document.getElementById('destFilter').value = document.getElementById('mobileDestFilter').value;
            document.getElementById('vendorFilter').value = document.getElementById('mobileVendorFilter').value;
            document.getElementById('statusFilter').value = document.getElementById('mobileStatusFilter').value;
            document.getElementById('searchInput').value = document.getElementById('mobileSearchInput').value;

            // í•„í„° ì ìš© ë° íŒ¨ë„ ë‹«ê¸°
            applyFilters();
            closeMobileFilters();
            log.info('Mobile filters applied');
        }

        // í„°ì¹˜ ì‹œì‘
        function handleTouchStart(e) {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            touchStartTime = Date.now();
        }

        // í„°ì¹˜ ì´ë™
        function handleTouchMove(e) {
            if (!touchStartX || !touchStartY) return;

            const touchEndX = e.touches[0].clientX;
            const touchEndY = e.touches[0].clientY;
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;

            // ìŠ¤ì™€ì´í”„ ì¸ë””ì¼€ì´í„° í‘œì‹œ
            const indicator = document.getElementById('swipeIndicator');
            if (Math.abs(deltaX) > SWIPE_THRESHOLD / 2) {
                indicator.textContent = deltaX > 0 ? 'â†’' : 'â†';
                indicator.classList.add('show');
            } else if (Math.abs(deltaY) > SWIPE_THRESHOLD / 2) {
                indicator.textContent = deltaY > 0 ? 'â†“' : 'â†‘';
                indicator.classList.add('show');
            }
        }

        // í„°ì¹˜ ì¢…ë£Œ - ìŠ¤ì™€ì´í”„ ê°ì§€
        function handleTouchEnd(e) {
            if (!touchStartX || !touchStartY) return;

            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            const deltaTime = Date.now() - touchStartTime;

            // ìŠ¤ì™€ì´í”„ ì¸ë””ì¼€ì´í„° ìˆ¨ê¸°ê¸°
            const indicator = document.getElementById('swipeIndicator');
            indicator.classList.remove('show');

            // ìŠ¤ì™€ì´í”„ íŒì •
            if (deltaTime < SWIPE_TIMEOUT) {
                // ì¢Œìš° ìŠ¤ì™€ì´í”„: í•„í„° íŒ¨ë„ ì—´ê¸°/ë‹«ê¸°
                if (Math.abs(deltaX) > SWIPE_THRESHOLD && Math.abs(deltaX) > Math.abs(deltaY)) {
                    if (deltaX > 0) {
                        // ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„: í•„í„° ë‹«ê¸°
                        closeMobileFilters();
                        showSwipeFeedback('â†’');
                    } else {
                        // ì™¼ìª½ ìŠ¤ì™€ì´í”„: (ì˜ˆì•½ - ë¯¸ì‚¬ìš©)
                        showSwipeFeedback('â†');
                    }
                }
                // ìœ„ì•„ë˜ ìŠ¤ì™€ì´í”„: í€µ í•„í„°
                else if (Math.abs(deltaY) > SWIPE_THRESHOLD && Math.abs(deltaY) > Math.abs(deltaX)) {
                    if (deltaY < -SWIPE_THRESHOLD) {
                        // ìœ„ë¡œ ìŠ¤ì™€ì´í”„: í•„í„° íŒ¨ë„ ì—´ê¸°
                        if (window.innerWidth <= 768) {
                            openMobileFilters();
                            showSwipeFeedback('â†‘ í•„í„°');
                        }
                    } else if (deltaY > SWIPE_THRESHOLD) {
                        // ì•„ë˜ë¡œ ìŠ¤ì™€ì´í”„: í•„í„° ì´ˆê¸°í™”
                        if (window.innerWidth <= 768) {
                            resetAllFilters();
                            showSwipeFeedback('â†“ ì´ˆê¸°í™”');
                        }
                    }
                }
            }

            // ì´ˆê¸°í™”
            touchStartX = 0;
            touchStartY = 0;
            touchStartTime = 0;
        }

        // ìŠ¤ì™€ì´í”„ í”¼ë“œë°± í‘œì‹œ
        function showSwipeFeedback(text) {
            const indicator = document.getElementById('swipeIndicator');
            indicator.textContent = text;
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 500);
        }

        // í„°ì¹˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        function initTouchGestures() {
            if ('ontouchstart' in window) {
                // Agent Q07: ê´€ë¦¬í˜• ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì‚¬ìš© (ìë™ ì •ë¦¬)
                addManagedEventListener(document.body, 'touchstart', handleTouchStart, { passive: true });
                addManagedEventListener(document.body, 'touchmove', handleTouchMove, { passive: true });
                addManagedEventListener(document.body, 'touchend', handleTouchEnd, { passive: true });
                log.info('Touch gesture system initialized (managed listeners)');
            }
        }

        // ========================================
        // Agent Q06: Bottom Sheet ëª¨ë‹¬ ë“œë˜ê·¸ ì‹œìŠ¤í…œ
        // Phase 4 - Step 5: Q06-2 (CRITICAL)
        // ========================================
        let modalDragStartY = 0;
        let modalDragCurrentY = 0;
        let modalDragActive = false;
        const MODAL_DRAG_THRESHOLD = 100;  // ëª¨ë‹¬ ë‹«ê¸° ì„ê³„ê°’ (px)

        // ëª¨ë°”ì¼ ë“œë˜ê·¸ í•¸ë“¤ í‘œì‹œ/ìˆ¨ê¹€
        function updateModalDragHandles() {
            const isMobile = window.innerWidth <= 768;
            const handles = document.querySelectorAll('.modal-drag-handle');
            handles.forEach(handle => {
                handle.style.display = isMobile ? 'block' : 'none';
            });
        }

        // ëª¨ë‹¬ ë“œë˜ê·¸ ì‹œì‘
        function handleModalDragStart(e, modal) {
            const target = e.target;
            // ë“œë˜ê·¸ í•¸ë“¤ ë˜ëŠ” í—¤ë”ì—ì„œë§Œ ë“œë˜ê·¸ ê°€ëŠ¥
            if (!target.classList.contains('modal-drag-handle') &&
                !target.closest('.modal-drag-handle') &&
                !target.closest('.border-b.border-theme')) {
                return;
            }

            modalDragStartY = e.touches[0].clientY;
            modalDragActive = true;
            modal.style.transition = 'none';
        }

        // ëª¨ë‹¬ ë“œë˜ê·¸ ì¤‘
        function handleModalDragMove(e, modal) {
            if (!modalDragActive) return;

            modalDragCurrentY = e.touches[0].clientY;
            const deltaY = modalDragCurrentY - modalDragStartY;

            // ì•„ë˜ë¡œë§Œ ë“œë˜ê·¸ í—ˆìš©
            if (deltaY > 0) {
                const modalContent = modal.querySelector('.bg-card');
                modalContent.style.transform = `translateY(${deltaY}px)`;
            }
        }

        // ëª¨ë‹¬ ë“œë˜ê·¸ ì¢…ë£Œ
        function handleModalDragEnd(e, modal, closeFunction) {
            if (!modalDragActive) return;

            const deltaY = modalDragCurrentY - modalDragStartY;
            const modalContent = modal.querySelector('.bg-card');

            modalDragActive = false;
            modal.style.transition = '';
            modalContent.style.transition = 'transform 0.3s ease-out';

            // ì„ê³„ê°’ ì´ìƒ ë“œë˜ê·¸ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
            if (deltaY > MODAL_DRAG_THRESHOLD) {
                modalContent.style.transform = 'translateY(100%)';
                setTimeout(() => {
                    closeFunction();
                    modalContent.style.transform = '';
                    modalContent.style.transition = '';
                }, 300);
            } else {
                // ì›ë˜ ìœ„ì¹˜ë¡œ ë³µê·€
                modalContent.style.transform = '';
                setTimeout(() => {
                    modalContent.style.transition = '';
                }, 300);
            }

            modalDragStartY = 0;
            modalDragCurrentY = 0;
        }

        // ëª¨ë‹¬ë³„ ë“œë˜ê·¸ ì´ë²¤íŠ¸ ë“±ë¡
        function initModalDragGestures() {
            if (!('ontouchstart' in window)) return;

            // Agent Q07: ê´€ë¦¬í˜• ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì‚¬ìš© (ìë™ ì •ë¦¬)

            // orderDetailModal
            const detailModal = document.getElementById('orderDetailModal');
            if (detailModal) {
                addManagedEventListener(detailModal, 'touchstart', (e) => handleModalDragStart(e, detailModal), { passive: true });
                addManagedEventListener(detailModal, 'touchmove', (e) => handleModalDragMove(e, detailModal), { passive: true });
                addManagedEventListener(detailModal, 'touchend', (e) => handleModalDragEnd(e, detailModal, closeOrderModal), { passive: true });
            }

            // orderProcessModal
            const processModal = document.getElementById('orderProcessModal');
            if (processModal) {
                addManagedEventListener(processModal, 'touchstart', (e) => handleModalDragStart(e, processModal), { passive: true });
                addManagedEventListener(processModal, 'touchmove', (e) => handleModalDragMove(e, processModal), { passive: true });
                addManagedEventListener(processModal, 'touchend', (e) => handleModalDragEnd(e, processModal, closeOrderProcessModal), { passive: true });
            }

            // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ í•¸ë“¤ ì—…ë°ì´íŠ¸
            addManagedEventListener(window, 'resize', updateModalDragHandles);
            updateModalDragHandles();

            log.info('Modal drag gesture system initialized (managed listeners)');
        }

        // ========================================
        // Agent Q07: ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì™„ì „ ì¬ì‚¬ìš© ì‹œìŠ¤í…œ
        // Phase 4 - Step 5: Q07-2 (CRITICAL)
        // ========================================

        // Chart instance reuse helper - prevents memory leaks
        function updateOrCreateChart(chartKey, ctx, config) {
            if (charts[chartKey]) {
                charts[chartKey].data = config.data;
                if (config.options) {
                    charts[chartKey].options = config.options;
                }
                charts[chartKey].update('none');
                return charts[chartKey];
            } else {
                charts[chartKey] = chartManager.createOrUpdate(chartKey, ctx, config, true);
                return charts[chartKey];
            }
        }

        // ëª¨ë“  ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬ (ë©”ëª¨ë¦¬ í•´ì œ)
        function destroyAllCharts() {
            // charts ê°ì²´ì˜ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤
            Object.values(charts).forEach(chart => {
                if (chart && typeof chart.destroy === 'function') {
                    chart.destroy();
                }
            });

            // ì „ì—­ ì°¨íŠ¸ ë³€ìˆ˜ë“¤
            if (delaySeverityChart) {
                delaySeverityChart.destroy();
                delaySeverityChart = null;
            }
            if (rootCauseChart) {
                rootCauseChart.destroy();
                rootCauseChart = null;
            }

            log.info('All chart instances destroyed');
        }

        // ========================================
        // Agent Q07: IntersectionObserver ì§€ì—° ë¡œë”©
        // Phase 4 - Step 5: Q07-4 (MEDIUM)
        // ========================================

        class LazyChartObserver {
            constructor() {
                this.observer = null;
                this.pendingCharts = new Map(); // chartKey -> renderFunction
                this.init();
            }

            init() {
                if (!('IntersectionObserver' in window)) {
                    log.warn('IntersectionObserver not supported, charts will load immediately');
                    return;
                }

                this.observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const chartKey = entry.target.dataset.lazyChart;
                            const renderFn = this.pendingCharts.get(chartKey);

                            if (renderFn) {
                                log.debug(`Lazy loading chart: ${chartKey}`);
                                renderFn();
                                this.pendingCharts.delete(chartKey);
                                this.observer.unobserve(entry.target);
                            }
                        }
                    });
                }, {
                    rootMargin: '50px',  // ë·°í¬íŠ¸ ì§„ì… 50px ì „ì— ë¡œë“œ ì‹œì‘
                    threshold: 0.1       // 10% ë³´ì´ë©´ ë¡œë“œ ì‹œì‘
                });

                log.info('LazyChartObserver initialized');
            }

            observe(element, chartKey, renderFunction) {
                if (!this.observer) {
                    // IntersectionObserver ë¯¸ì§€ì› ë¸Œë¼ìš°ì €: ì¦‰ì‹œ ë Œë”ë§
                    renderFunction();
                    return;
                }

                element.dataset.lazyChart = chartKey;
                this.pendingCharts.set(chartKey, renderFunction);
                this.observer.observe(element);
                log.debug(`Chart "${chartKey}" registered for lazy loading`);
            }

            disconnect() {
                if (this.observer) {
                    this.observer.disconnect();
                    this.pendingCharts.clear();
                    log.info('LazyChartObserver disconnected');
                }
            }
        }

        // ì „ì—­ ì§€ì—° ë¡œë”© ì˜µì €ë²„ ì¸ìŠ¤í„´ìŠ¤
        let lazyChartObserver = null;

        // ì§€ì—° ë¡œë”© ì´ˆê¸°í™”
        function initLazyChartLoading() {
            lazyChartObserver = new LazyChartObserver();
            log.info('Lazy chart loading initialized');
        }

        // ì°¨íŠ¸ ì§€ì—° ë Œë”ë§ í—¬í¼ í•¨ìˆ˜
        function lazyRenderChart(elementId, chartKey, renderFunction) {
            const element = document.getElementById(elementId);
            if (!element) {
                log.warn(`Element not found for lazy chart: ${elementId}`);
                return;
            }

            if (!lazyChartObserver) {
                // ì˜µì €ë²„ ë¯¸ì´ˆê¸°í™” ì‹œ ì¦‰ì‹œ ë Œë”ë§
                renderFunction();
                return;
            }

            lazyChartObserver.observe(element, chartKey, renderFunction);
        }

        // ========================================
        // Agent Q01: ì²­í¬ ì²˜ë¦¬ ì‹œìŠ¤í…œ
        // Phase 4 - Step 5: Q01-6 (MEDIUM)
        // ========================================

        class ChunkProcessor {
            constructor(options = {}) {
                this.chunkSize = options.chunkSize || 500;  // ì²­í¬ë‹¹ ì²˜ë¦¬í•  í–‰ ìˆ˜
                this.delay = options.delay || 10;  // ì²­í¬ ê°„ ì§€ì—° ì‹œê°„ (ms)
                this.onProgress = options.onProgress || null;  // ì§„í–‰ ìƒí™© ì½œë°±
                this.onComplete = options.onComplete || null;  // ì™„ë£Œ ì½œë°±
                this.onError = options.onError || null;  // ì˜¤ë¥˜ ì½œë°±
            }

            /**
             * ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ ì²­í¬ ë‹¨ìœ„ë¡œ ì²˜ë¦¬
             * @param {Array} data - ì²˜ë¦¬í•  ë°ì´í„° ë°°ì—´
             * @param {Function} processor - ê° ì²­í¬ë¥¼ ì²˜ë¦¬í•  í•¨ìˆ˜ (chunk, chunkIndex) => processedChunk
             * @returns {Promise<Array>} - ì²˜ë¦¬ëœ ì „ì²´ ë°ì´í„°
             */
            async process(data, processor) {
                const totalChunks = Math.ceil(data.length / this.chunkSize);
                const results = [];

                log.info(`ChunkProcessor: Processing ${data.length} items in ${totalChunks} chunks (size: ${this.chunkSize})`);

                try {
                    for (let i = 0; i < totalChunks; i++) {
                        const start = i * this.chunkSize;
                        const end = Math.min(start + this.chunkSize, data.length);
                        const chunk = data.slice(start, end);

                        // ì²­í¬ ì²˜ë¦¬
                        const processedChunk = await processor(chunk, i);
                        results.push(...processedChunk);

                        // ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
                        const progress = {
                            current: i + 1,
                            total: totalChunks,
                            percentage: Math.round(((i + 1) / totalChunks) * 100),
                            processedItems: end
                        };

                        if (this.onProgress) {
                            this.onProgress(progress);
                        }

                        // UI ì—…ë°ì´íŠ¸ ì‹œê°„ í™•ë³´ (ë¸Œë¼ìš°ì € í”„ë¦¬ì§• ë°©ì§€)
                        if (i < totalChunks - 1) {
                            await this.sleep(this.delay);
                        }
                    }

                    log.info(`ChunkProcessor: Successfully processed ${results.length} items`);

                    if (this.onComplete) {
                        this.onComplete(results);
                    }

                    return results;

                } catch (error) {
                    log.error('ChunkProcessor: Error during processing', error);

                    if (this.onError) {
                        this.onError(error);
                    }

                    throw error;
                }
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // ì²­í¬ ì§„í–‰ ìƒí™© ëª¨ë‹¬ í‘œì‹œ
        function showChunkProgress() {
            document.getElementById('chunkProgressModal').classList.remove('hidden');
        }

        // ì²­í¬ ì§„í–‰ ìƒí™© ëª¨ë‹¬ ìˆ¨ê¹€
        function hideChunkProgress() {
            document.getElementById('chunkProgressModal').classList.add('hidden');
        }

        // ì²­í¬ ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
        function updateChunkProgress(progress) {
            document.getElementById('chunkProgressPercent').textContent = `${progress.percentage}%`;
            document.getElementById('chunkProgressBar').style.width = `${progress.percentage}%`;
            document.getElementById('chunkProgressText').textContent = `${progress.current} / ${progress.total}`;
        }

        // ========================================
        // Agent Q05: ì¼ì¼ ë³´ê³ ì„œ ìƒì„± ì‹œìŠ¤í…œ
        // Phase 4 - Step 5: Q05-1 (MEDIUM)
        // ========================================

        function generateDailyReport() {
            const today = new Date().toISOString().slice(0, 10);
            document.getElementById('reportDate').textContent = `(${today})`;

            // ë³´ê³ ì„œ ë°ì´í„° ë¶„ì„
            const reportData = analyzeDailyReport(filteredData);

            // ë³´ê³ ì„œ HTML ìƒì„±
            const reportHTML = buildDailyReportHTML(reportData, today);

            // ëª¨ë‹¬ì— ì‚½ì…
            document.getElementById('reportContent').innerHTML = reportHTML;

            // Agent Q05: ë³´ê³ ì„œ íˆìŠ¤í† ë¦¬ì— ì €ì¥ (Phase 4 - Q05-5)
            addReportToHistory({
                title: `ì¼ì¼ ìƒì‚° ë³´ê³ ì„œ (${today})`,
                date: today,
                filters: getCurrentFilters(),
                summary: reportData.summary,
                htmlContent: reportHTML
            });

            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('dailyReportModal').classList.remove('hidden');

            log.info(`Daily report generated for ${today}`);
        }


        function buildDailyReportHTML(reportData, date) {
            const { summary, processStats, bottlenecks, urgentOrders, topDelayedDest, factoryDelayed } = reportData;

            return `
                <!-- Executive Summary -->
                <div class="report-section mb-8">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ“Š ê²½ì˜ì§„ ìš”ì•½ (Executive Summary)
                    </h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="report-kpi bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                            <div class="text-sm text-gray-600 dark:text-gray-400">ì „ì²´ ì˜¤ë”</div>
                            <div class="text-3xl font-bold text-blue-600 dark:text-blue-400">${summary.totalOrders}</div>
                        </div>
                        <div class="report-kpi bg-red-50 dark:bg-red-900/20 p-4 rounded-lg">
                            <div class="text-sm text-gray-600 dark:text-gray-400">ì§€ì—° ì˜¤ë”</div>
                            <div class="text-3xl font-bold text-red-600 dark:text-red-400">${summary.delayedOrders}</div>
                            <div class="text-xs text-gray-600 dark:text-gray-400">(${summary.delayedRate}%)</div>
                        </div>
                        <div class="report-kpi bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg">
                            <div class="text-sm text-gray-600 dark:text-gray-400">ê²½ê³  ì˜¤ë”</div>
                            <div class="text-3xl font-bold text-yellow-600 dark:text-yellow-400">${summary.warningOrders}</div>
                        </div>
                        <div class="report-kpi bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                            <div class="text-sm text-gray-600 dark:text-gray-400">ì™„ë£Œìœ¨</div>
                            <div class="text-3xl font-bold text-green-600 dark:text-green-400">${summary.completionRate}%</div>
                        </div>
                    </div>
                </div>

                <!-- ê³µì •ë³„ ë³‘ëª© ì§€ì  -->
                <div class="report-section mb-8">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸš¨ ê³µì •ë³„ ë³‘ëª© ì§€ì  (Process Bottlenecks)
                    </h4>
                    ${bottlenecks.length > 0 ? `
                        <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg mb-4">
                            <p class="text-sm text-red-800 dark:text-red-200 font-medium">âš ï¸ ë‹¤ìŒ ê³µì •ì—ì„œ ì‹¬ê°í•œ ì§€ì—°ì´ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤:</p>
                        </div>
                        <table class="report-table w-full">
                            <thead>
                                <tr class="bg-gray-100 dark:bg-gray-700">
                                    <th class="px-4 py-2 text-left">ê³µì •</th>
                                    <th class="px-4 py-2 text-right">ì™„ë£Œ ê±´ìˆ˜</th>
                                    <th class="px-4 py-2 text-right">ì „ì²´ ê±´ìˆ˜</th>
                                    <th class="px-4 py-2 text-right">ì™„ë£Œìœ¨</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${bottlenecks.map(p => `
                                    <tr class="border-b dark:border-gray-700">
                                        <td class="px-4 py-2 font-medium">${p.name}</td>
                                        <td class="px-4 py-2 text-right">${p.completed}</td>
                                        <td class="px-4 py-2 text-right">${p.total}</td>
                                        <td class="px-4 py-2 text-right font-bold text-red-600 dark:text-red-400">${p.rate}%</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : `
                        <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                            <p class="text-sm text-green-800 dark:text-green-200">âœ… ëª¨ë“  ê³µì •ì´ ì •ìƒ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤ (ì™„ë£Œìœ¨ 70% ì´ìƒ)</p>
                        </div>
                    `}
                </div>

                <!-- ì „ì²´ ê³µì • í˜„í™© -->
                <div class="report-section mb-8">
                    <h4 class="text-xl font-bold mb-4">ğŸ“ˆ ì „ì²´ ê³µì • í˜„í™©</h4>
                    <table class="report-table w-full">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="px-4 py-2 text-left">ê³µì •</th>
                                <th class="px-4 py-2 text-right">ì™„ë£Œ ê±´ìˆ˜</th>
                                <th class="px-4 py-2 text-right">ì™„ë£Œìœ¨</th>
                                <th class="px-4 py-2 text-left">ì§„í–‰ ë°”</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${processStats.map(p => `
                                <tr class="border-b dark:border-gray-700">
                                    <td class="px-4 py-2 font-medium">${p.name}</td>
                                    <td class="px-4 py-2 text-right">${p.completed} / ${p.total}</td>
                                    <td class="px-4 py-2 text-right font-bold ${p.rate >= 70 ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}">${p.rate}%</td>
                                    <td class="px-4 py-2">
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 overflow-hidden">
                                            <div class="h-4 ${p.rate >= 70 ? 'bg-green-600' : 'bg-red-600'} transition-all" style="width: ${p.rate}%"></div>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- ê¸´ê¸‰ ì¡°ì¹˜ í•„ìš” ì˜¤ë” -->
                <div class="report-section mb-8">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ”¥ ê¸´ê¸‰ ì¡°ì¹˜ í•„ìš” ì˜¤ë” (Urgent Orders)
                    </h4>
                    ${urgentOrders.length > 0 ? `
                        <div class="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg mb-4">
                            <p class="text-sm text-orange-800 dark:text-orange-200 font-medium">âš ï¸ CRDê¹Œì§€ 7ì¼ ì´ë‚´ì´ë©´ì„œ ì§€ì—° ì¤‘ì¸ ì˜¤ë” (ìƒìœ„ 10ê±´)</p>
                        </div>
                        <table class="report-table w-full">
                            <thead>
                                <tr class="bg-gray-100 dark:bg-gray-700">
                                    <th class="px-4 py-2 text-left">ê³µì¥</th>
                                    <th class="px-4 py-2 text-left">POë²ˆí˜¸</th>
                                    <th class="px-4 py-2 text-left">ëª¨ë¸</th>
                                    <th class="px-4 py-2 text-left">í–‰ì„ ì§€</th>
                                    <th class="px-4 py-2 text-right">ìˆ˜ëŸ‰</th>
                                    <th class="px-4 py-2 text-left">CRD</th>
                                    <th class="px-4 py-2 text-left">SDD</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${urgentOrders.map(d => {
                                    const crd = new Date(d.crd);
                                    const today = new Date();
                                    const daysUntilCRD = Math.ceil((crd - today) / (1000 * 60 * 60 * 24));
                                    return `
                                        <tr class="border-b dark:border-gray-700 ${daysUntilCRD <= 3 ? 'bg-red-50 dark:bg-red-900/10' : ''}">
                                            <td class="px-4 py-2">${escapeHtml(d.factory)}</td>
                                            <td class="px-4 py-2 font-mono text-sm">${escapeHtml(d.poNumber)}</td>
                                            <td class="px-4 py-2">${escapeHtml(d.model)}</td>
                                            <td class="px-4 py-2">${escapeHtml(d.destination)}</td>
                                            <td class="px-4 py-2 text-right">${d.quantity?.toLocaleString() || 0}</td>
                                            <td class="px-4 py-2 font-medium ${daysUntilCRD <= 3 ? 'text-red-600 dark:text-red-400' : ''}">${d.crd} (D-${daysUntilCRD})</td>
                                            <td class="px-4 py-2">${d.sddValue || '-'}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    ` : `
                        <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                            <p class="text-sm text-green-800 dark:text-green-200">âœ… ê¸´ê¸‰ ì¡°ì¹˜ê°€ í•„ìš”í•œ ì˜¤ë”ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        </div>
                    `}
                </div>

                <!-- í–‰ì„ ì§€ë³„ ì§€ì—° í˜„í™© -->
                <div class="report-section mb-8">
                    <h4 class="text-xl font-bold mb-4">ğŸŒ í–‰ì„ ì§€ë³„ ì§€ì—° í˜„í™© (Top 5)</h4>
                    ${topDelayedDest.length > 0 ? `
                        <table class="report-table w-full">
                            <thead>
                                <tr class="bg-gray-100 dark:bg-gray-700">
                                    <th class="px-4 py-2 text-left">í–‰ì„ ì§€</th>
                                    <th class="px-4 py-2 text-right">ì§€ì—° ê±´ìˆ˜</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${topDelayedDest.map(item => `
                                    <tr class="border-b dark:border-gray-700">
                                        <td class="px-4 py-2 font-medium">${escapeHtml(item.dest)}</td>
                                        <td class="px-4 py-2 text-right text-red-600 dark:text-red-400 font-bold">${item.count}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : `
                        <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                            <p class="text-sm text-green-800 dark:text-green-200">âœ… ì§€ì—°ëœ ì˜¤ë”ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                        </div>
                    `}
                </div>

                <!-- ê³µì¥ë³„ ì§€ì—° í˜„í™© -->
                <div class="report-section mb-8">
                    <h4 class="text-xl font-bold mb-4">ğŸ­ ê³µì¥ë³„ ì§€ì—° í˜„í™©</h4>
                    <table class="report-table w-full">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="px-4 py-2 text-left">ê³µì¥</th>
                                <th class="px-4 py-2 text-right">ì§€ì—° ê±´ìˆ˜</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(factoryDelayed).map(([factory, count]) => `
                                <tr class="border-b dark:border-gray-700">
                                    <td class="px-4 py-2 font-medium">Factory ${escapeHtml(factory)}</td>
                                    <td class="px-4 py-2 text-right text-red-600 dark:text-red-400 font-bold">${count}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- ë³´ê³ ì„œ ë©”íƒ€ë°ì´í„° -->
                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-sm text-gray-600 dark:text-gray-400">
                    <p>ë³´ê³ ì„œ ìƒì„± ì¼ì‹œ: ${new Date().toLocaleString('ko-KR')}</p>
                    <p>ë°ì´í„° ê¸°ì¤€: ${date}</p>
                    <p>í•„í„° ì ìš©: ${filteredData.length}ê±´ / ì „ì²´ ${allData.length}ê±´</p>
                </div>
            `;
        }

        function switchReportType() {
            const reportType = document.getElementById('reportTypeSelector').value;
            const today = new Date().toISOString().slice(0, 10);

            if (reportType === 'daily') {
                generateDailyReport();
            } else if (reportType === 'weekly') {
                generateWeeklyReport();
            } else if (reportType === 'monthly') {
                generateMonthlyReport();
            }

            log.info(`Report type switched to: ${reportType}`);
        }

        // ========================================
        // Agent Q05: ì£¼ê°„ ë³´ê³ ì„œ ìƒì„± ì‹œìŠ¤í…œ
        // Phase 4 - Step 5: Q05-2 (MEDIUM)
        // ========================================

        function generateWeeklyReport() {
            const today = new Date();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay()); // ì´ë²ˆ ì£¼ ì¼ìš”ì¼

            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6); // ì´ë²ˆ ì£¼ í† ìš”ì¼

            const dateRange = `${weekStart.toISOString().slice(0, 10)} ~ ${weekEnd.toISOString().slice(0, 10)}`;
            document.getElementById('reportDate').textContent = `(${dateRange})`;

            // ë³´ê³ ì„œ ë°ì´í„° ë¶„ì„
            const reportData = analyzeWeeklyReport(filteredData, weekStart, weekEnd);

            // ë³´ê³ ì„œ HTML ìƒì„±
            const reportHTML = buildWeeklyReportHTML(reportData, dateRange);

            // ëª¨ë‹¬ì— ì‚½ì…
            document.getElementById('reportContent').innerHTML = reportHTML;

            // ë³´ê³ ì„œ íƒ€ì… ì„ íƒê¸° ì—…ë°ì´íŠ¸
            document.getElementById('reportTypeSelector').value = 'weekly';

            log.info(`Weekly report generated for ${dateRange}`);
        }


        function buildWeeklyReportHTML(reportData, dateRange) {
            const { summary, dailyProduction, topDest, vendorIssues, completionTrend } = reportData;

            return `
                <!-- Executive Summary -->
                <div class="report-section mb-8">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ“Š ì£¼ê°„ ìš”ì•½ (Weekly Summary)
                    </h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="report-kpi bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                            <div class="text-sm text-gray-600 dark:text-gray-400">ì „ì²´ ì˜¤ë”</div>
                            <div class="text-3xl font-bold text-blue-600 dark:text-blue-400">${summary.totalOrders}</div>
                        </div>
                        <div class="report-kpi bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg">
                            <div class="text-sm text-gray-600 dark:text-gray-400">ì´ë²ˆ ì£¼ ì˜¤ë”</div>
                            <div class="text-3xl font-bold text-purple-600 dark:text-purple-400">${summary.weekOrders}</div>
                        </div>
                        <div class="report-kpi bg-red-50 dark:bg-red-900/20 p-4 rounded-lg">
                            <div class="text-sm text-gray-600 dark:text-gray-400">ì§€ì—° ì˜¤ë”</div>
                            <div class="text-3xl font-bold text-red-600 dark:text-red-400">${summary.delayedOrders}</div>
                        </div>
                        <div class="report-kpi bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                            <div class="text-sm text-gray-600 dark:text-gray-400">ì£¼ê°„ ì™„ë£Œìœ¨</div>
                            <div class="text-3xl font-bold text-green-600 dark:text-green-400">${summary.weekCompletionRate}%</div>
                        </div>
                    </div>
                </div>

                <!-- ì£¼ê°„ ìƒì‚°ëŸ‰ íŠ¸ë Œë“œ -->
                <div class="report-section mb-8">
                    <h4 class="text-xl font-bold mb-4">ğŸ“ˆ ì£¼ê°„ ìƒì‚°ëŸ‰ íŠ¸ë Œë“œ (ì¼ë³„)</h4>
                    <table class="report-table w-full">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="px-4 py-2 text-left">ë‚ ì§œ</th>
                                <th class="px-4 py-2 text-left">ìš”ì¼</th>
                                <th class="px-4 py-2 text-right">ì „ì²´ ì˜¤ë”</th>
                                <th class="px-4 py-2 text-right">ì™„ë£Œ ê±´ìˆ˜</th>
                                <th class="px-4 py-2 text-right">ì™„ë£Œìœ¨</th>
                                <th class="px-4 py-2 text-left">ì§„í–‰ ë°”</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(dailyProduction).map(([date, stats]) => `
                                <tr class="border-b dark:border-gray-700">
                                    <td class="px-4 py-2 font-medium">${date}</td>
                                    <td class="px-4 py-2">${stats.dayName}</td>
                                    <td class="px-4 py-2 text-right">${stats.total}</td>
                                    <td class="px-4 py-2 text-right">${stats.completed}</td>
                                    <td class="px-4 py-2 text-right font-bold ${parseFloat(stats.rate) >= 70 ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}">${stats.rate}%</td>
                                    <td class="px-4 py-2">
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 overflow-hidden">
                                            <div class="h-4 ${parseFloat(stats.rate) >= 70 ? 'bg-green-600' : 'bg-red-600'} transition-all" style="width: ${stats.rate}%"></div>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- í–‰ì„ ì§€ë³„ ì¶œí•˜ í˜„í™© -->
                <div class="report-section mb-8">
                    <h4 class="text-xl font-bold mb-4">ğŸŒ í–‰ì„ ì§€ë³„ ì¶œí•˜ í˜„í™© (Top 10)</h4>
                    <table class="report-table w-full">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="px-4 py-2 text-left">í–‰ì„ ì§€</th>
                                <th class="px-4 py-2 text-right">ì „ì²´</th>
                                <th class="px-4 py-2 text-right">ì™„ë£Œ</th>
                                <th class="px-4 py-2 text-right">ì§€ì—°</th>
                                <th class="px-4 py-2 text-right">ìˆ˜ëŸ‰</th>
                                <th class="px-4 py-2 text-right">ì™„ë£Œìœ¨</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${topDest.map(d => `
                                <tr class="border-b dark:border-gray-700">
                                    <td class="px-4 py-2 font-medium">${escapeHtml(d.dest)}</td>
                                    <td class="px-4 py-2 text-right">${d.total}</td>
                                    <td class="px-4 py-2 text-right text-green-600 dark:text-green-400">${d.completed}</td>
                                    <td class="px-4 py-2 text-right text-red-600 dark:text-red-400">${d.delayed}</td>
                                    <td class="px-4 py-2 text-right">${d.quantity.toLocaleString()}</td>
                                    <td class="px-4 py-2 text-right font-bold ${parseFloat(d.completionRate) >= 70 ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}">${d.completionRate}%</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- ë²¤ë”ë³„ í’ˆì§ˆ ì´ìŠˆ -->
                <div class="report-section mb-8">
                    <h4 class="text-xl font-bold mb-4">âš ï¸ ë²¤ë”ë³„ í’ˆì§ˆ ì´ìŠˆ (ì§€ì—°ìœ¨ 10% ì´ìƒ)</h4>
                    ${vendorIssues.length > 0 ? `
                        <div class="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg mb-4">
                            <p class="text-sm text-orange-800 dark:text-orange-200 font-medium">âš ï¸ ë‹¤ìŒ ë²¤ë”ë“¤ì´ ë†’ì€ ì§€ì—°ìœ¨ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤:</p>
                        </div>
                        <table class="report-table w-full">
                            <thead>
                                <tr class="bg-gray-100 dark:bg-gray-700">
                                    <th class="px-4 py-2 text-left">ë²¤ë”</th>
                                    <th class="px-4 py-2 text-right">ì „ì²´</th>
                                    <th class="px-4 py-2 text-right">ì§€ì—°</th>
                                    <th class="px-4 py-2 text-right">ì™„ë£Œ</th>
                                    <th class="px-4 py-2 text-right">ì§€ì—°ìœ¨</th>
                                    <th class="px-4 py-2 text-right">ì™„ë£Œìœ¨</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${vendorIssues.map(v => `
                                    <tr class="border-b dark:border-gray-700 ${parseFloat(v.delayRate) >= 30 ? 'bg-red-50 dark:bg-red-900/10' : ''}">
                                        <td class="px-4 py-2 font-medium">${escapeHtml(v.vendor)}</td>
                                        <td class="px-4 py-2 text-right">${v.total}</td>
                                        <td class="px-4 py-2 text-right text-red-600 dark:text-red-400 font-bold">${v.delayed}</td>
                                        <td class="px-4 py-2 text-right text-green-600 dark:text-green-400">${v.completed}</td>
                                        <td class="px-4 py-2 text-right font-bold ${parseFloat(v.delayRate) >= 30 ? 'text-red-600 dark:text-red-400' : 'text-orange-600 dark:text-orange-400'}">${v.delayRate}%</td>
                                        <td class="px-4 py-2 text-right">${v.completionRate}%</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : `
                        <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                            <p class="text-sm text-green-800 dark:text-green-200">âœ… ëª¨ë“  ë²¤ë”ê°€ ì •ìƒ ë²”ìœ„ ë‚´ì—ì„œ ìš´ì˜ë˜ê³  ìˆìŠµë‹ˆë‹¤ (ì§€ì—°ìœ¨ 10% ë¯¸ë§Œ)</p>
                        </div>
                    `}
                </div>

                <!-- ì£¼ê°„ ì™„ë£Œ íŠ¸ë Œë“œ ì°¨íŠ¸ -->
                <div class="report-section mb-8">
                    <h4 class="text-xl font-bold mb-4">ğŸ“Š ì£¼ê°„ ì™„ë£Œ íŠ¸ë Œë“œ (ì¼ë³„ ì¶œê³  ê±´ìˆ˜)</h4>
                    <table class="report-table w-full">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="px-4 py-2 text-left">ë‚ ì§œ</th>
                                <th class="px-4 py-2 text-left">ìš”ì¼</th>
                                <th class="px-4 py-2 text-right">ì¶œê³  ì™„ë£Œ</th>
                                <th class="px-4 py-2 text-left">íŠ¸ë Œë“œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${completionTrend.map(c => {
                                const maxCount = Math.max(...completionTrend.map(t => t.count));
                                const barWidth = maxCount > 0 ? (c.count / maxCount * 100) : 0;
                                return `
                                    <tr class="border-b dark:border-gray-700">
                                        <td class="px-4 py-2 font-medium">${c.date}</td>
                                        <td class="px-4 py-2">${c.dayName}</td>
                                        <td class="px-4 py-2 text-right font-bold">${c.count}</td>
                                        <td class="px-4 py-2">
                                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-6 overflow-hidden">
                                                <div class="h-6 bg-blue-600 transition-all flex items-center justify-end pr-2 text-white text-xs font-bold" style="width: ${barWidth}%">
                                                    ${c.count > 0 ? c.count : ''}
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- ë³´ê³ ì„œ ë©”íƒ€ë°ì´í„° -->
                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-sm text-gray-600 dark:text-gray-400">
                    <p>ë³´ê³ ì„œ ìƒì„± ì¼ì‹œ: ${new Date().toLocaleString('ko-KR')}</p>
                    <p>ë°ì´í„° ê¸°ì¤€: ${dateRange}</p>
                    <p>í•„í„° ì ìš©: ${filteredData.length}ê±´ / ì „ì²´ ${allData.length}ê±´</p>
                </div>
            `;
        }

        // ========================================
        // Agent Q05: ì›”ê°„ ë³´ê³ ì„œ ìƒì„± ì‹œìŠ¤í…œ
        // Phase 4 - Step 5: Q05-3 (MEDIUM)
        // ========================================

        function generateMonthlyReport() {
            const today = new Date();
            const currentMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const monthStr = currentMonth.toISOString().slice(0, 7); // YYYY-MM

            document.getElementById('reportDate').textContent = `(${monthStr})`;

            const reportData = analyzeMonthlyReport(filteredData, currentMonth);
            const reportHTML = buildMonthlyReportHTML(reportData, monthStr);

            document.getElementById('reportContent').innerHTML = reportHTML;
            document.getElementById('reportTypeSelector').value = 'monthly';

            log.info(`Monthly report generated for ${monthStr}`);
        }


        function buildMonthlyReportHTML(reportData, monthStr) {
            const { summary, monthlyTrends, factoryStats, topModels, topDest, vendorIssues, processStats } = reportData;

            return `
                <!-- ì›”ê°„ ìš”ì•½ -->
                <div class="mb-8">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ“Š ì›”ê°„ ìš”ì•½ (${monthStr})
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="report-kpi bg-blue-50 dark:bg-blue-900/30 border-blue-500">
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">ì´ ì£¼ë¬¸</div>
                            <div class="text-3xl font-bold text-blue-600 dark:text-blue-400">${summary.totalOrders.toLocaleString()}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">ê±´</div>
                        </div>
                        <div class="report-kpi bg-green-50 dark:bg-green-900/30 border-green-500">
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">ì™„ë£Œ</div>
                            <div class="text-3xl font-bold text-green-600 dark:text-green-400">${summary.completedOrders.toLocaleString()}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">${summary.completionRate}%</div>
                        </div>
                        <div class="report-kpi bg-red-50 dark:bg-red-900/30 border-red-500">
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">ì§€ì—°</div>
                            <div class="text-3xl font-bold text-red-600 dark:text-red-400">${summary.delayedOrders.toLocaleString()}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">${summary.totalOrders > 0 ? ((summary.delayedOrders / summary.totalOrders) * 100).toFixed(1) : '0.0'}%</div>
                        </div>
                        <div class="report-kpi bg-yellow-50 dark:bg-yellow-900/30 border-yellow-500">
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">ê²½ê³ </div>
                            <div class="text-3xl font-bold text-yellow-600 dark:text-yellow-400">${summary.warningOrders.toLocaleString()}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">${summary.totalOrders > 0 ? ((summary.warningOrders / summary.totalOrders) * 100).toFixed(1) : '0.0'}%</div>
                        </div>
                    </div>
                </div>

                <!-- 6ê°œì›” íŠ¸ë Œë“œ -->
                <div class="mb-8 report-section">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ“ˆ 6ê°œì›” ìƒì‚° íŠ¸ë Œë“œ
                    </h4>
                    <table class="report-table w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">ì›”</th>
                                <th class="px-4 py-3 text-right">ì´ ì£¼ë¬¸</th>
                                <th class="px-4 py-3 text-right">ì™„ë£Œ</th>
                                <th class="px-4 py-3 text-right">ì§€ì—°</th>
                                <th class="px-4 py-3 text-right">ì™„ë£Œìœ¨</th>
                                <th class="px-4 py-3 text-left">íŠ¸ë Œë“œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${monthlyTrends.map((trend, idx) => `
                                <tr class="border-t border-gray-200 dark:border-gray-700 ${idx === monthlyTrends.length - 1 ? 'bg-blue-50 dark:bg-blue-900/20 font-semibold' : ''}">
                                    <td class="px-4 py-3">${trend.month}</td>
                                    <td class="px-4 py-3 text-right">${trend.totalOrders.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right text-green-600 dark:text-green-400">${trend.completed.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right text-red-600 dark:text-red-400">${trend.delayed.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right">
                                        <span class="${parseFloat(trend.completionRate) >= 80 ? 'text-green-600 dark:text-green-400' : parseFloat(trend.completionRate) >= 60 ? 'text-yellow-600 dark:text-yellow-400' : 'text-red-600 dark:text-red-400'}">${trend.completionRate}%</span>
                                    </td>
                                    <td class="px-4 py-3">
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                            <div class="bg-blue-600 h-2 rounded-full" style="width: ${trend.completionRate}%"></div>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- ê³µì¥ë³„ ì„±ê³¼ ë¹„êµ -->
                <div class="mb-8 report-section">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ­ ê³µì¥ë³„ ì„±ê³¼ ë¹„êµ
                    </h4>
                    <table class="report-table w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">ê³µì¥</th>
                                <th class="px-4 py-3 text-right">ì´ ì£¼ë¬¸</th>
                                <th class="px-4 py-3 text-right">ì™„ë£Œ</th>
                                <th class="px-4 py-3 text-right">ì§€ì—°</th>
                                <th class="px-4 py-3 text-right">ì™„ë£Œìœ¨</th>
                                <th class="px-4 py-3 text-right">ì§€ì—°ìœ¨</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(factoryStats).map(([factory, stats]) => `
                                <tr class="border-t border-gray-200 dark:border-gray-700">
                                    <td class="px-4 py-3 font-semibold">Factory ${factory}</td>
                                    <td class="px-4 py-3 text-right">${stats.total.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right text-green-600 dark:text-green-400">${stats.completed.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right text-red-600 dark:text-red-400">${stats.delayed.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right">
                                        <span class="${parseFloat(stats.completionRate) >= 80 ? 'text-green-600 dark:text-green-400' : parseFloat(stats.completionRate) >= 60 ? 'text-yellow-600 dark:text-yellow-400' : 'text-red-600 dark:text-red-400'}">${stats.completionRate}%</span>
                                    </td>
                                    <td class="px-4 py-3 text-right">
                                        <span class="${parseFloat(stats.delayRate) <= 10 ? 'text-green-600 dark:text-green-400' : parseFloat(stats.delayRate) <= 20 ? 'text-yellow-600 dark:text-yellow-400' : 'text-red-600 dark:text-red-400'}">${stats.delayRate}%</span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- ëª¨ë¸ë³„ ìƒì‚°ëŸ‰ Top 10 -->
                <div class="mb-8 report-section">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ‘Ÿ ëª¨ë¸ë³„ ìƒì‚°ëŸ‰ Top 10
                    </h4>
                    <table class="report-table w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">ìˆœìœ„</th>
                                <th class="px-4 py-3 text-left">ëª¨ë¸</th>
                                <th class="px-4 py-3 text-right">ì£¼ë¬¸ ê±´ìˆ˜</th>
                                <th class="px-4 py-3 text-right">ì´ ìˆ˜ëŸ‰</th>
                                <th class="px-4 py-3 text-right">ì™„ë£Œ ê±´ìˆ˜</th>
                                <th class="px-4 py-3 text-right">ì™„ë£Œìœ¨</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${topModels.map((model, idx) => `
                                <tr class="border-t border-gray-200 dark:border-gray-700 ${idx < 3 ? 'bg-yellow-50 dark:bg-yellow-900/20' : ''}">
                                    <td class="px-4 py-3 font-semibold">${idx + 1}</td>
                                    <td class="px-4 py-3">${escapeHtml(model.model)}</td>
                                    <td class="px-4 py-3 text-right">${model.total.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right font-semibold">${model.quantity.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right text-green-600 dark:text-green-400">${model.completed.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right">
                                        <span class="${parseFloat(model.completionRate) >= 80 ? 'text-green-600 dark:text-green-400' : parseFloat(model.completionRate) >= 60 ? 'text-yellow-600 dark:text-yellow-400' : 'text-red-600 dark:text-red-400'}">${model.completionRate}%</span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- í–‰ì„ ì§€ë³„ ì¶œê³ ëŸ‰ Top 10 -->
                <div class="mb-8 report-section">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸŒ í–‰ì„ ì§€ë³„ ì¶œê³ ëŸ‰ Top 10
                    </h4>
                    <table class="report-table w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">ìˆœìœ„</th>
                                <th class="px-4 py-3 text-left">í–‰ì„ ì§€</th>
                                <th class="px-4 py-3 text-right">ì£¼ë¬¸ ê±´ìˆ˜</th>
                                <th class="px-4 py-3 text-right">ì´ ìˆ˜ëŸ‰</th>
                                <th class="px-4 py-3 text-right">ì™„ë£Œ</th>
                                <th class="px-4 py-3 text-right">ì§€ì—°</th>
                                <th class="px-4 py-3 text-right">ì™„ë£Œìœ¨</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${topDest.map((dest, idx) => `
                                <tr class="border-t border-gray-200 dark:border-gray-700 ${idx < 3 ? 'bg-blue-50 dark:bg-blue-900/20' : ''}">
                                    <td class="px-4 py-3 font-semibold">${idx + 1}</td>
                                    <td class="px-4 py-3">${escapeHtml(dest.destination)}</td>
                                    <td class="px-4 py-3 text-right">${dest.total.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right font-semibold">${dest.quantity.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right text-green-600 dark:text-green-400">${dest.completed.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right text-red-600 dark:text-red-400">${dest.delayed.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right">
                                        <span class="${parseFloat(dest.completionRate) >= 80 ? 'text-green-600 dark:text-green-400' : parseFloat(dest.completionRate) >= 60 ? 'text-yellow-600 dark:text-yellow-400' : 'text-red-600 dark:text-red-400'}">${dest.completionRate}%</span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- ë²¤ë”ë³„ í’ˆì§ˆ ë¶„ì„ -->
                ${vendorIssues.length > 0 ? `
                <div class="mb-8 report-section">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        âš ï¸ ë²¤ë” í’ˆì§ˆ ì´ìŠˆ (ì§€ì—°ìœ¨ &gt; 10%)
                    </h4>
                    <table class="report-table w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">ë²¤ë”</th>
                                <th class="px-4 py-3 text-right">ì´ ì£¼ë¬¸</th>
                                <th class="px-4 py-3 text-right">ì§€ì—° ê±´ìˆ˜</th>
                                <th class="px-4 py-3 text-right">ì§€ì—°ìœ¨</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${vendorIssues.map(vendor => `
                                <tr class="border-t border-gray-200 dark:border-gray-700 ${parseFloat(vendor.delayRate) > 30 ? 'bg-red-50 dark:bg-red-900/20' : 'bg-yellow-50 dark:bg-yellow-900/20'}">
                                    <td class="px-4 py-3 font-semibold">${escapeHtml(vendor.vendor)}</td>
                                    <td class="px-4 py-3 text-right">${vendor.total.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right text-red-600 dark:text-red-400">${vendor.delayed.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right">
                                        <span class="${parseFloat(vendor.delayRate) > 30 ? 'text-red-600 dark:text-red-400 font-bold' : 'text-yellow-600 dark:text-yellow-400'}">${vendor.delayRate}%</span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ` : ''}

                <!-- ê³µì •ë³„ í‰ê·  ì™„ë£Œìœ¨ -->
                <div class="mb-8 report-section">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ”§ ê³µì •ë³„ í‰ê·  ì™„ë£Œìœ¨
                    </h4>
                    <table class="report-table w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">ê³µì •</th>
                                <th class="px-4 py-3 text-right">ì™„ë£Œìœ¨</th>
                                <th class="px-4 py-3 text-left">ì§„í–‰ ìƒíƒœ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${processStats.map(proc => `
                                <tr class="border-t border-gray-200 dark:border-gray-700">
                                    <td class="px-4 py-3 font-semibold">${proc.process}</td>
                                    <td class="px-4 py-3 text-right">
                                        <span class="${parseFloat(proc.completionRate) >= 80 ? 'text-green-600 dark:text-green-400' : parseFloat(proc.completionRate) >= 60 ? 'text-yellow-600 dark:text-yellow-400' : 'text-red-600 dark:text-red-400'}">${proc.completionRate}%</span>
                                    </td>
                                    <td class="px-4 py-3">
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3">
                                            <div class="${parseFloat(proc.completionRate) >= 80 ? 'bg-green-600' : parseFloat(proc.completionRate) >= 60 ? 'bg-yellow-600' : 'bg-red-600'} h-3 rounded-full" style="width: ${proc.completionRate}%"></div>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- ë³´ê³ ì„œ ë©”íƒ€ë°ì´í„° -->
                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-sm text-gray-600 dark:text-gray-400">
                    <p>ë³´ê³ ì„œ ìƒì„± ì¼ì‹œ: ${new Date().toLocaleString('ko-KR')}</p>
                    <p>ë°ì´í„° ê¸°ì¤€: ${monthStr}</p>
                    <p>í•„í„° ì ìš©: ${filteredData.length}ê±´ / ì „ì²´ ${allData.length}ê±´</p>
                </div>
            `;
        }

        function closeDailyReport() {
            document.getElementById('dailyReportModal').classList.add('hidden');
            // ë³´ê³ ì„œ íƒ€ì…ì„ ì¼ì¼ë¡œ ë¦¬ì…‹
            document.getElementById('reportTypeSelector').value = 'daily';
        }

        function printDailyReport() {
            window.print();
        }

        // ========================================
        // Agent Q08: ì´ìƒì¹˜ ìë™ íƒì§€
        // Phase 4 - Step 5: Q08-3 (MEDIUM)
        // ========================================

        function detectAnomalies(data) {
            const anomalies = {
                quantityOutliers: [],
                processDelays: [],
                dateAnomalies: [],
                duplicatePO: [],
                missingDestination: [],
                vendorIssues: []
            };

            // 1. ìˆ˜ëŸ‰ ì´ìƒì¹˜ íƒì§€ (Z-score > 3)
            const quantities = data.map(d => parseInt(d.quantity) || 0).filter(q => q > 0);
            if (quantities.length > 0) {
                const mean = quantities.reduce((a, b) => a + b, 0) / quantities.length;
                const stdDev = Math.sqrt(quantities.reduce((sq, n) => sq + Math.pow(n - mean, 2), 0) / quantities.length);

                data.forEach(d => {
                    const qty = parseInt(d.quantity) || 0;
                    const zScore = Math.abs((qty - mean) / stdDev);
                    if (zScore > 3) {
                        anomalies.quantityOutliers.push({
                            po: d.poNumber,
                            model: d.model,
                            quantity: qty,
                            zScore: zScore.toFixed(2),
                            severity: zScore > 5 ? 'critical' : 'warning'
                        });
                    }
                });
            }

            // 2. ê³µì • ì§€ì—° ì´ìƒì¹˜ íƒì§€
            const processStages = ['scut', 'presew', 'sewinput', 'sewbal', 'osc', 'ass', 'whin', 'whout'];
            data.forEach(d => {
                const completedStages = processStages.filter(stage => d.production[stage]?.status === 'completed').length;
                const totalStages = processStages.length;
                const completionRate = (completedStages / totalStages) * 100;

                // 50% ë¯¸ë§Œ ì™„ë£Œ + CRD ì„ë°• (7ì¼ ì´ë‚´)
                if (completionRate < 50 && d.crd) {
                    const daysUntilCRD = Math.ceil((new Date(d.crd) - new Date()) / (1000 * 60 * 60 * 24));
                    if (daysUntilCRD <= 7 && daysUntilCRD >= 0) {
                        anomalies.processDelays.push({
                            po: d.poNumber,
                            model: d.model,
                            completionRate: completionRate.toFixed(1),
                            daysUntilCRD,
                            severity: daysUntilCRD <= 3 ? 'critical' : 'warning'
                        });
                    }
                }
            });

            // 3. CRD/SDD ê°„ê²© ì´ìƒì¹˜ íƒì§€
            data.forEach(d => {
                if (d.crd && d.sddValue) {
                    const daysDiff = Math.ceil((new Date(d.sddValue) - new Date(d.crd)) / (1000 * 60 * 60 * 24));

                    // ê°„ê²©ì´ ë¹„ì •ìƒì ìœ¼ë¡œ ê¸´ ê²½ìš° (>180ì¼)
                    if (daysDiff > 180) {
                        anomalies.dateAnomalies.push({
                            po: d.poNumber,
                            model: d.model,
                            crd: d.crd,
                            sdd: d.sddValue,
                            daysDiff,
                            type: 'too_long',
                            severity: 'warning'
                        });
                    }

                    // ê°„ê²©ì´ ë¹„ì •ìƒì ìœ¼ë¡œ ì§§ì€ ê²½ìš° (<-30ì¼, SDDê°€ CRDë³´ë‹¤ í•œì°¸ ë¹ ë¦„)
                    if (daysDiff < -30) {
                        anomalies.dateAnomalies.push({
                            po: d.poNumber,
                            model: d.model,
                            crd: d.crd,
                            sdd: d.sddValue,
                            daysDiff,
                            type: 'too_early',
                            severity: 'critical'
                        });
                    }
                }
            });

            // 4. ì¤‘ë³µ PO ë²ˆí˜¸ íƒì§€
            const poCount = {};
            data.forEach(d => {
                if (d.poNumber) {
                    poCount[d.poNumber] = (poCount[d.poNumber] || 0) + 1;
                }
            });

            Object.entries(poCount).forEach(([po, count]) => {
                if (count > 1) {
                    const duplicates = data.filter(d => d.poNumber === po);
                    anomalies.duplicatePO.push({
                        po,
                        count,
                        models: [...new Set(duplicates.map(d => d.model))].join(', '),
                        factories: [...new Set(duplicates.map(d => d.factory))].join(', '),
                        severity: count > 3 ? 'critical' : 'warning'
                    });
                }
            });

            // 5. í–‰ì„ ì§€ ì´ìƒ íƒì§€
            data.forEach(d => {
                if (!d.destination || d.destination.trim() === '' || d.destination === 'Unknown') {
                    anomalies.missingDestination.push({
                        po: d.poNumber,
                        model: d.model,
                        factory: d.factory,
                        severity: 'warning'
                    });
                }
            });

            // 6. ë²¤ë” í’ˆì§ˆ ì´ìƒ íƒì§€ (ì§€ì—°ìœ¨ >30%)
            const vendorStats = {};
            data.forEach(d => {
                const vendor = d.outsoleVendor || 'Unknown';
                if (!vendorStats[vendor]) {
                    vendorStats[vendor] = { total: 0, delayed: 0 };
                }
                vendorStats[vendor].total++;
                if (isDelayed(d)) {
                    vendorStats[vendor].delayed++;
                }
            });

            Object.entries(vendorStats).forEach(([vendor, stats]) => {
                const delayRate = (stats.delayed / stats.total) * 100;
                if (delayRate > 30 && stats.total >= 5) {  // ìµœì†Œ 5ê±´ ì´ìƒ
                    anomalies.vendorIssues.push({
                        vendor,
                        total: stats.total,
                        delayed: stats.delayed,
                        delayRate: delayRate.toFixed(1),
                        severity: delayRate > 50 ? 'critical' : 'warning'
                    });
                }
            });

            return anomalies;
        }

        function showAnomalyReport() {
            const anomalies = detectAnomalies(filteredData);
            const totalAnomalies =
                anomalies.quantityOutliers.length +
                anomalies.processDelays.length +
                anomalies.dateAnomalies.length +
                anomalies.duplicatePO.length +
                anomalies.missingDestination.length +
                anomalies.vendorIssues.length;

            if (totalAnomalies === 0) {
                alert('âœ… ì´ìƒì¹˜ê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë°ì´í„° í’ˆì§ˆì´ ì–‘í˜¸í•©ë‹ˆë‹¤.');
                log.info('No anomalies detected');
                return;
            }

            const reportHTML = buildAnomalyReportHTML(anomalies, totalAnomalies);
            document.getElementById('reportDate').textContent = `(${totalAnomalies}ê±´ ë°œê²¬)`;
            document.getElementById('reportContent').innerHTML = reportHTML;
            document.getElementById('dailyReportModal').classList.remove('hidden');
            document.getElementById('reportTypeSelector').style.display = 'none';  // ë³´ê³ ì„œ íƒ€ì… ì„ íƒê¸° ìˆ¨ê¹€

            log.info(`Anomaly report generated: ${totalAnomalies} issues found`);
        }

        function buildAnomalyReportHTML(anomalies, totalAnomalies) {
            const criticalCount = [
                ...anomalies.quantityOutliers,
                ...anomalies.processDelays,
                ...anomalies.dateAnomalies,
                ...anomalies.duplicatePO,
                ...anomalies.vendorIssues
            ].filter(a => a.severity === 'critical').length;

            return `
                <!-- ì´ìƒì¹˜ ìš”ì•½ -->
                <div class="mb-8">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸš¨ ì´ìƒì¹˜ íƒì§€ ìš”ì•½
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="report-kpi bg-red-50 dark:bg-red-900/30 border-red-500">
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">ì´ ì´ìƒì¹˜</div>
                            <div class="text-3xl font-bold text-red-600 dark:text-red-400">${totalAnomalies.toLocaleString()}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">ê±´</div>
                        </div>
                        <div class="report-kpi bg-orange-50 dark:bg-orange-900/30 border-orange-500">
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">ì‹¬ê° (Critical)</div>
                            <div class="text-3xl font-bold text-orange-600 dark:text-orange-400">${criticalCount.toLocaleString()}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”</div>
                        </div>
                        <div class="report-kpi bg-yellow-50 dark:bg-yellow-900/30 border-yellow-500">
                            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">ê²½ê³  (Warning)</div>
                            <div class="text-3xl font-bold text-yellow-600 dark:text-yellow-400">${(totalAnomalies - criticalCount).toLocaleString()}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">ê²€í†  ê¶Œì¥</div>
                        </div>
                    </div>
                </div>

                <!-- ìˆ˜ëŸ‰ ì´ìƒì¹˜ -->
                ${anomalies.quantityOutliers.length > 0 ? `
                <div class="mb-8 report-section">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ“Š ìˆ˜ëŸ‰ ì´ìƒì¹˜ (Z-score > 3)
                    </h4>
                    <table class="report-table w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">PO ë²ˆí˜¸</th>
                                <th class="px-4 py-3 text-left">ëª¨ë¸</th>
                                <th class="px-4 py-3 text-right">ìˆ˜ëŸ‰</th>
                                <th class="px-4 py-3 text-right">Z-Score</th>
                                <th class="px-4 py-3 text-center">ì‹¬ê°ë„</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${anomalies.quantityOutliers.slice(0, 20).map(a => `
                                <tr class="border-t border-gray-200 dark:border-gray-700 ${a.severity === 'critical' ? 'bg-red-50 dark:bg-red-900/20' : 'bg-yellow-50 dark:bg-yellow-900/20'}">
                                    <td class="px-4 py-3 font-mono">${escapeHtml(a.po)}</td>
                                    <td class="px-4 py-3">${escapeHtml(a.model)}</td>
                                    <td class="px-4 py-3 text-right font-semibold">${a.quantity.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right text-red-600 dark:text-red-400">${a.zScore}</td>
                                    <td class="px-4 py-3 text-center">
                                        <span class="px-2 py-1 rounded text-xs font-semibold ${a.severity === 'critical' ? 'bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200' : 'bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200'}">${a.severity === 'critical' ? 'ì‹¬ê°' : 'ê²½ê³ '}</span>
                                    </td>
                                </tr>
                            `).join('')}
                            ${anomalies.quantityOutliers.length > 20 ? `<tr><td colspan="5" class="px-4 py-3 text-center text-gray-500">... ì™¸ ${anomalies.quantityOutliers.length - 20}ê±´</td></tr>` : ''}
                        </tbody>
                    </table>
                </div>
                ` : ''}

                <!-- ê³µì • ì§€ì—° ì´ìƒì¹˜ -->
                ${anomalies.processDelays.length > 0 ? `
                <div class="mb-8 report-section">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        â±ï¸ ê³µì • ì§€ì—° ì´ìƒì¹˜ (ì™„ë£Œìœ¨ &lt; 50% + CRD ì„ë°•)
                    </h4>
                    <table class="report-table w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">PO ë²ˆí˜¸</th>
                                <th class="px-4 py-3 text-left">ëª¨ë¸</th>
                                <th class="px-4 py-3 text-right">ì™„ë£Œìœ¨</th>
                                <th class="px-4 py-3 text-right">CRDê¹Œì§€</th>
                                <th class="px-4 py-3 text-center">ì‹¬ê°ë„</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${anomalies.processDelays.slice(0, 20).map(a => `
                                <tr class="border-t border-gray-200 dark:border-gray-700 ${a.severity === 'critical' ? 'bg-red-50 dark:bg-red-900/20' : 'bg-yellow-50 dark:bg-yellow-900/20'}">
                                    <td class="px-4 py-3 font-mono">${escapeHtml(a.po)}</td>
                                    <td class="px-4 py-3">${escapeHtml(a.model)}</td>
                                    <td class="px-4 py-3 text-right text-red-600 dark:text-red-400">${a.completionRate}%</td>
                                    <td class="px-4 py-3 text-right font-semibold">${a.daysUntilCRD}ì¼</td>
                                    <td class="px-4 py-3 text-center">
                                        <span class="px-2 py-1 rounded text-xs font-semibold ${a.severity === 'critical' ? 'bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200' : 'bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200'}">${a.severity === 'critical' ? 'ì‹¬ê°' : 'ê²½ê³ '}</span>
                                    </td>
                                </tr>
                            `).join('')}
                            ${anomalies.processDelays.length > 20 ? `<tr><td colspan="5" class="px-4 py-3 text-center text-gray-500">... ì™¸ ${anomalies.processDelays.length - 20}ê±´</td></tr>` : ''}
                        </tbody>
                    </table>
                </div>
                ` : ''}

                <!-- CRD/SDD ê°„ê²© ì´ìƒì¹˜ -->
                ${anomalies.dateAnomalies.length > 0 ? `
                <div class="mb-8 report-section">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ“… ë‚ ì§œ ê°„ê²© ì´ìƒì¹˜
                    </h4>
                    <table class="report-table w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">PO ë²ˆí˜¸</th>
                                <th class="px-4 py-3 text-left">ëª¨ë¸</th>
                                <th class="px-4 py-3 text-left">CRD</th>
                                <th class="px-4 py-3 text-left">SDD</th>
                                <th class="px-4 py-3 text-right">ê°„ê²©</th>
                                <th class="px-4 py-3 text-center">ìœ í˜•</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${anomalies.dateAnomalies.slice(0, 20).map(a => `
                                <tr class="border-t border-gray-200 dark:border-gray-700 ${a.severity === 'critical' ? 'bg-red-50 dark:bg-red-900/20' : 'bg-yellow-50 dark:bg-yellow-900/20'}">
                                    <td class="px-4 py-3 font-mono">${escapeHtml(a.po)}</td>
                                    <td class="px-4 py-3">${escapeHtml(a.model)}</td>
                                    <td class="px-4 py-3">${a.crd}</td>
                                    <td class="px-4 py-3">${a.sdd}</td>
                                    <td class="px-4 py-3 text-right font-semibold">${a.daysDiff}ì¼</td>
                                    <td class="px-4 py-3 text-center">
                                        <span class="px-2 py-1 rounded text-xs font-semibold ${a.type === 'too_early' ? 'bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200' : 'bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200'}">${a.type === 'too_early' ? 'SDD ë„ˆë¬´ ë¹ ë¦„' : 'SDD ë„ˆë¬´ ëŠ¦ìŒ'}</span>
                                    </td>
                                </tr>
                            `).join('')}
                            ${anomalies.dateAnomalies.length > 20 ? `<tr><td colspan="6" class="px-4 py-3 text-center text-gray-500">... ì™¸ ${anomalies.dateAnomalies.length - 20}ê±´</td></tr>` : ''}
                        </tbody>
                    </table>
                </div>
                ` : ''}

                <!-- ì¤‘ë³µ PO ë²ˆí˜¸ -->
                ${anomalies.duplicatePO.length > 0 ? `
                <div class="mb-8 report-section">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ”„ ì¤‘ë³µ PO ë²ˆí˜¸
                    </h4>
                    <table class="report-table w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">PO ë²ˆí˜¸</th>
                                <th class="px-4 py-3 text-right">ì¤‘ë³µ ê±´ìˆ˜</th>
                                <th class="px-4 py-3 text-left">ëª¨ë¸</th>
                                <th class="px-4 py-3 text-left">ê³µì¥</th>
                                <th class="px-4 py-3 text-center">ì‹¬ê°ë„</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${anomalies.duplicatePO.map(a => `
                                <tr class="border-t border-gray-200 dark:border-gray-700 ${a.severity === 'critical' ? 'bg-red-50 dark:bg-red-900/20' : 'bg-yellow-50 dark:bg-yellow-900/20'}">
                                    <td class="px-4 py-3 font-mono font-semibold">${escapeHtml(a.po)}</td>
                                    <td class="px-4 py-3 text-right text-red-600 dark:text-red-400">${a.count}ê±´</td>
                                    <td class="px-4 py-3">${escapeHtml(a.models)}</td>
                                    <td class="px-4 py-3">${escapeHtml(a.factories)}</td>
                                    <td class="px-4 py-3 text-center">
                                        <span class="px-2 py-1 rounded text-xs font-semibold ${a.severity === 'critical' ? 'bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200' : 'bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200'}">${a.severity === 'critical' ? 'ì‹¬ê°' : 'ê²½ê³ '}</span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ` : ''}

                <!-- í–‰ì„ ì§€ ëˆ„ë½ -->
                ${anomalies.missingDestination.length > 0 ? `
                <div class="mb-8 report-section">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸŒ í–‰ì„ ì§€ ëˆ„ë½/ì´ìƒ
                    </h4>
                    <table class="report-table w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">PO ë²ˆí˜¸</th>
                                <th class="px-4 py-3 text-left">ëª¨ë¸</th>
                                <th class="px-4 py-3 text-left">ê³µì¥</th>
                                <th class="px-4 py-3 text-center">ë¬¸ì œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${anomalies.missingDestination.slice(0, 20).map(a => `
                                <tr class="border-t border-gray-200 dark:border-gray-700 bg-yellow-50 dark:bg-yellow-900/20">
                                    <td class="px-4 py-3 font-mono">${escapeHtml(a.po)}</td>
                                    <td class="px-4 py-3">${escapeHtml(a.model)}</td>
                                    <td class="px-4 py-3">Factory ${a.factory}</td>
                                    <td class="px-4 py-3 text-center">
                                        <span class="px-2 py-1 rounded text-xs font-semibold bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200">í–‰ì„ ì§€ ëˆ„ë½</span>
                                    </td>
                                </tr>
                            `).join('')}
                            ${anomalies.missingDestination.length > 20 ? `<tr><td colspan="4" class="px-4 py-3 text-center text-gray-500">... ì™¸ ${anomalies.missingDestination.length - 20}ê±´</td></tr>` : ''}
                        </tbody>
                    </table>
                </div>
                ` : ''}

                <!-- ë²¤ë” í’ˆì§ˆ ì´ìŠˆ -->
                ${anomalies.vendorIssues.length > 0 ? `
                <div class="mb-8 report-section">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ­ ë²¤ë” í’ˆì§ˆ ì´ìŠˆ (ì§€ì—°ìœ¨ &gt; 30%)
                    </h4>
                    <table class="report-table w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">ë²¤ë”</th>
                                <th class="px-4 py-3 text-right">ì´ ì£¼ë¬¸</th>
                                <th class="px-4 py-3 text-right">ì§€ì—° ê±´ìˆ˜</th>
                                <th class="px-4 py-3 text-right">ì§€ì—°ìœ¨</th>
                                <th class="px-4 py-3 text-center">ì‹¬ê°ë„</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${anomalies.vendorIssues.map(a => `
                                <tr class="border-t border-gray-200 dark:border-gray-700 ${a.severity === 'critical' ? 'bg-red-50 dark:bg-red-900/20' : 'bg-yellow-50 dark:bg-yellow-900/20'}">
                                    <td class="px-4 py-3 font-semibold">${escapeHtml(a.vendor)}</td>
                                    <td class="px-4 py-3 text-right">${a.total.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right text-red-600 dark:text-red-400">${a.delayed.toLocaleString()}</td>
                                    <td class="px-4 py-3 text-right font-semibold">${a.delayRate}%</td>
                                    <td class="px-4 py-3 text-center">
                                        <span class="px-2 py-1 rounded text-xs font-semibold ${a.severity === 'critical' ? 'bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200' : 'bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200'}">${a.severity === 'critical' ? 'ì‹¬ê°' : 'ê²½ê³ '}</span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ` : ''}

                <!-- ë³´ê³ ì„œ ë©”íƒ€ë°ì´í„° -->
                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-sm text-gray-600 dark:text-gray-400">
                    <p>ì´ìƒì¹˜ íƒì§€ ì¼ì‹œ: ${new Date().toLocaleString('ko-KR')}</p>
                    <p>ë¶„ì„ ë°ì´í„°: ${filteredData.length}ê±´ / ì „ì²´ ${allData.length}ê±´</p>
                    <p>ì‹¬ê°ë„ ê¸°ì¤€: Critical (ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”), Warning (ê²€í†  ê¶Œì¥)</p>
                </div>
            `;
        }

        // ========================================
        // Agent W05: Data Analytics & Insights
        // Phase 3 - Step 5-5: Advanced Analytics
        // ========================================

        /**
         * DataAnalytics í´ë˜ìŠ¤
         * ì˜ˆì¸¡ ëª¨ë¸ë§, íŠ¸ë Œë“œ ë¶„ì„, í†µê³„ ë¶„ì„ ê¸°ëŠ¥ ì œê³µ
         */
        class DataAnalytics {
            constructor(data) {
                this.data = data || [];
                this.cache = new Map();
            }

            // ========================================
            // 1. Predictive Analytics (ì˜ˆì¸¡ ë¶„ì„)
            // ========================================

            /**
             * ì„ í˜• íšŒê·€ ë¶„ì„
             * @param {Array} xValues - Xì¶• ê°’ (ì‹œê°„ ì¸ë±ìŠ¤)
             * @param {Array} yValues - Yì¶• ê°’ (ì§€ì—° ê±´ìˆ˜, ìˆ˜ëŸ‰ ë“±)
             * @returns {Object} { slope, intercept, predict, r2 }
             */
            linearRegression(xValues, yValues) {
                const cacheKey = `lr_${xValues.join(',')}_${yValues.join(',')}`;
                if (this.cache.has(cacheKey)) {
                    return this.cache.get(cacheKey);
                }

                const n = xValues.length;
                if (n === 0) return { slope: 0, intercept: 0, predict: () => 0, r2: 0 };

                const sumX = xValues.reduce((a, b) => a + b, 0);
                const sumY = yValues.reduce((a, b) => a + b, 0);
                const sumXY = xValues.reduce((sum, x, i) => sum + x * yValues[i], 0);
                const sumXX = xValues.reduce((sum, x) => sum + x * x, 0);
                const sumYY = yValues.reduce((sum, y) => sum + y * y, 0);

                const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
                const intercept = (sumY - slope * sumX) / n;

                // RÂ² (ê²°ì • ê³„ìˆ˜) ê³„ì‚°
                const yMean = sumY / n;
                const ssTotal = yValues.reduce((sum, y) => sum + Math.pow(y - yMean, 2), 0);
                const ssResidual = yValues.reduce((sum, y, i) => {
                    const predicted = slope * xValues[i] + intercept;
                    return sum + Math.pow(y - predicted, 2);
                }, 0);
                const r2 = 1 - (ssResidual / ssTotal);

                const result = {
                    slope,
                    intercept,
                    r2: r2.toFixed(3),
                    predict: (x) => slope * x + intercept
                };

                this.cache.set(cacheKey, result);
                return result;
            }

            /**
             * í–¥í›„ Nì¼ê°„ ì§€ì—° ê±´ìˆ˜ ì˜ˆì¸¡
             * @param {number} days - ì˜ˆì¸¡í•  ì¼ìˆ˜ (ê¸°ë³¸ 7ì¼)
             * @returns {Array} [{ date, predicted, confidence }]
             */
            predictDelays(days = 7) {
                // ë‚ ì§œë³„ ì§€ì—° ê±´ìˆ˜ ì§‘ê³„
                const delaysByDate = {};
                this.data.filter(d => isDelayed(d)).forEach(d => {
                    const date = d.crd;
                    if (date) {
                        delaysByDate[date] = (delaysByDate[date] || 0) + 1;
                    }
                });

                const sortedDates = Object.keys(delaysByDate).sort();
                const recentDates = sortedDates.slice(-30); // ìµœê·¼ 30ì¼
                const counts = recentDates.map(d => delaysByDate[d]);

                if (counts.length < 7) {
                    log.warn('Insufficient data for prediction (< 7 days)');
                    return [];
                }

                // ì„ í˜• íšŒê·€ ëª¨ë¸ ìƒì„±
                const xValues = counts.map((_, i) => i);
                const model = this.linearRegression(xValues, counts);

                // í–¥í›„ Nì¼ ì˜ˆì¸¡
                const predictions = [];
                const today = new Date();

                for (let i = 1; i <= days; i++) {
                    const futureX = counts.length + i;
                    const predicted = Math.max(0, Math.round(model.predict(futureX)));
                    const futureDate = new Date(today);
                    futureDate.setDate(today.getDate() + i);

                    // ì‹ ë¢° êµ¬ê°„ ê³„ì‚° (ë‹¨ìˆœí™”: RÂ²ì— ê¸°ë°˜)
                    const confidence = model.r2 > 0.7 ? 'high' : model.r2 > 0.4 ? 'medium' : 'low';

                    predictions.push({
                        date: futureDate.toISOString().slice(0, 10),
                        predicted,
                        confidence,
                        r2: model.r2
                    });
                }

                log.info(`Delay prediction completed: ${predictions.length} days, RÂ²=${model.r2}`);
                return predictions;
            }

            /**
             * ë³‘ëª© ê³µì • ì˜ˆì¸¡
             * @returns {Array} [{ process, severity, trend, recommendation }]
             */
            predictBottlenecks() {
                const processes = ['s_cut', 'pre_sew', 'sew_input', 'sew_bal', 'osc', 'ass', 'wh_in', 'wh_out'];
                const bottlenecks = [];

                processes.forEach(proc => {
                    const rates = this.data.map(d => {
                        const completed = d.production?.[proc]?.completed || 0;
                        return (completed / d.quantity) * 100;
                    });

                    if (rates.length === 0) return;

                    const avgCompletion = rates.reduce((a, b) => a + b, 0) / rates.length;
                    const variance = this.variance(rates);
                    const stdDev = Math.sqrt(variance);

                    // ë³‘ëª© ì‹¬ê°ë„ íŒì •
                    let severity = 'normal';
                    let trend = 'stable';

                    if (avgCompletion < 50) {
                        severity = 'critical';
                    } else if (avgCompletion < 70) {
                        severity = 'warning';
                    }

                    // íŠ¸ë Œë“œ ë¶„ì„ (ìµœê·¼ 15ì¼ vs ì´ì „ 15ì¼)
                    if (rates.length >= 30) {
                        const recent = rates.slice(-15);
                        const previous = rates.slice(-30, -15);
                        const recentAvg = recent.reduce((a, b) => a + b, 0) / recent.length;
                        const previousAvg = previous.reduce((a, b) => a + b, 0) / previous.length;

                        if (recentAvg < previousAvg - 5) {
                            trend = 'deteriorating';
                        } else if (recentAvg > previousAvg + 5) {
                            trend = 'improving';
                        }
                    }

                    bottlenecks.push({
                        process: proc.toUpperCase(),
                        avgCompletion: avgCompletion.toFixed(1),
                        stdDev: stdDev.toFixed(1),
                        severity,
                        trend,
                        recommendation: this.getBottleneckRecommendation(proc, avgCompletion, trend)
                    });
                });

                // ì‹¬ê°ë„ ìˆœìœ¼ë¡œ ì •ë ¬
                const severityOrder = { critical: 0, warning: 1, normal: 2 };
                bottlenecks.sort((a, b) => severityOrder[a.severity] - severityOrder[b.severity]);

                return bottlenecks;
            }

            getBottleneckRecommendation(process, avgCompletion, trend) {
                if (avgCompletion < 50) {
                    if (trend === 'deteriorating') {
                        return `ê¸´ê¸‰ ê°œì… í•„ìš”: ${process} ê³µì •ì˜ ì™„ë£Œìœ¨ì´ ê¸‰ê²©íˆ í•˜ë½í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë¦¬ì†ŒìŠ¤ ì¬ë°°ì¹˜ ê¶Œì¥.`;
                    }
                    return `ì£¼ì˜ í•„ìš”: ${process} ê³µì •ì˜ ì™„ë£Œìœ¨ì´ ë‚®ìŠµë‹ˆë‹¤. ìƒì‚° ê³„íš ì¬ê²€í†  ê¶Œì¥.`;
                } else if (avgCompletion < 70) {
                    return `ëª¨ë‹ˆí„°ë§ ê°•í™”: ${process} ê³µì •ì˜ íš¨ìœ¨ ê°œì„  ë°©ì•ˆ ê²€í†  ê¶Œì¥.`;
                } else if (trend === 'improving') {
                    return `ì–‘í˜¸: ${process} ê³µì •ì˜ ì™„ë£Œìœ¨ì´ ê°œì„ ë˜ê³  ìˆìŠµë‹ˆë‹¤. í˜„ì¬ ê´€ë¦¬ ë°©ì‹ ìœ ì§€.`;
                }
                return `ì •ìƒ: ${process} ê³µì •ì´ ì›í™œí•˜ê²Œ ìš´ì˜ë˜ê³  ìˆìŠµë‹ˆë‹¤.`;
            }

            // ========================================
            // 2. Trend Analysis (íŠ¸ë Œë“œ ë¶„ì„)
            // ========================================

            /**
             * ì´ë™ í‰ê·  ê³„ì‚°
             * @param {Array} values - ê°’ ë°°ì—´
             * @param {number} period - í‰ê·  ê¸°ê°„ (ê¸°ë³¸ 7ì¼)
             * @returns {Array} ì´ë™ í‰ê·  ê°’
             */
            movingAverage(values, period = 7) {
                const result = [];
                for (let i = 0; i < values.length; i++) {
                    const start = Math.max(0, i - period + 1);
                    const window = values.slice(start, i + 1);
                    const avg = window.reduce((a, b) => a + b, 0) / window.length;
                    result.push(avg);
                }
                return result;
            }

            /**
             * ì„±ì¥ë¥  ê³„ì‚°
             * @param {Array} values - ê°’ ë°°ì—´
             * @returns {Array} ì„±ì¥ë¥  (%)
             */
            growthRate(values) {
                const rates = [];
                for (let i = 1; i < values.length; i++) {
                    const rate = values[i - 1] === 0 ? 0 : ((values[i] - values[i - 1]) / values[i - 1]) * 100;
                    rates.push(rate.toFixed(1));
                }
                return rates;
            }

            /**
             * ê³„ì ˆì„± ë¶„ì„
             * @returns {Object} { monthly: {}, weekday: {} }
             */
            analyzeSeasonality() {
                const monthly = {};
                const weekday = {};

                this.data.forEach(d => {
                    if (!d.crd) return;

                    const date = new Date(d.crd);
                    const month = date.getMonth() + 1;
                    const day = date.getDay();

                    monthly[month] = (monthly[month] || 0) + 1;
                    weekday[day] = (weekday[day] || 0) + 1;
                });

                return {
                    monthly,
                    weekday,
                    peakMonth: Object.keys(monthly).reduce((a, b) => monthly[a] > monthly[b] ? a : b, 1),
                    peakWeekday: Object.keys(weekday).reduce((a, b) => weekday[a] > weekday[b] ? a : b, 0)
                };
            }

            // ========================================
            // 3. Statistical Analysis (í†µê³„ ë¶„ì„)
            // ========================================

            /**
             * ìƒê´€ê´€ê³„ ë¶„ì„
             * @param {Array} x - X ë³€ìˆ˜
             * @param {Array} y - Y ë³€ìˆ˜
             * @returns {number} ìƒê´€ê³„ìˆ˜ (-1 ~ 1)
             */
            correlation(x, y) {
                const n = Math.min(x.length, y.length);
                if (n === 0) return 0;

                const sumX = x.slice(0, n).reduce((a, b) => a + b, 0);
                const sumY = y.slice(0, n).reduce((a, b) => a + b, 0);
                const sumXY = x.slice(0, n).reduce((sum, xi, i) => sum + xi * y[i], 0);
                const sumXX = x.slice(0, n).reduce((sum, xi) => sum + xi * xi, 0);
                const sumYY = y.slice(0, n).reduce((sum, yi) => sum + yi * yi, 0);

                const numerator = n * sumXY - sumX * sumY;
                const denominator = Math.sqrt((n * sumXX - sumX * sumX) * (n * sumYY - sumY * sumY));

                return denominator === 0 ? 0 : (numerator / denominator).toFixed(3);
            }

            /**
             * ë¶„ì‚° ê³„ì‚°
             * @param {Array} values - ê°’ ë°°ì—´
             * @returns {number} ë¶„ì‚°
             */
            variance(values) {
                if (values.length === 0) return 0;
                const mean = values.reduce((a, b) => a + b, 0) / values.length;
                return values.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / values.length;
            }

            /**
             * í‘œì¤€í¸ì°¨ ê³„ì‚°
             * @param {Array} values - ê°’ ë°°ì—´
             * @returns {number} í‘œì¤€í¸ì°¨
             */
            stdDev(values) {
                return Math.sqrt(this.variance(values));
            }

            /**
             * ìƒê´€ê´€ê³„ ë§¤íŠ¸ë¦­ìŠ¤ ìƒì„±
             * @returns {Object} { quantityDelay, factoryPerformance, vendorQuality }
             */
            correlationMatrix() {
                // 1. ìˆ˜ëŸ‰ vs ì§€ì—° ìƒê´€ê´€ê³„
                const quantities = this.data.map(d => d.quantity);
                const delays = this.data.map(d => isDelayed(d) ? 1 : 0);
                const quantityDelayCorr = this.correlation(quantities, delays);

                // 2. ê³µì¥ ì„±ê³¼ ë¶„ì„
                const factories = ['A', 'B', 'C', 'D'];
                const factoryPerformance = factories.map(factory => {
                    const factoryData = this.data.filter(d => d.factory === factory);
                    if (factoryData.length === 0) return { factory, avgCompletion: 0, count: 0 };

                    const avgCompletion = factoryData.reduce((sum, d) => {
                        return sum + ((d.production?.wh_out?.completed || 0) / d.quantity);
                    }, 0) / factoryData.length * 100;

                    return {
                        factory,
                        avgCompletion: avgCompletion.toFixed(1),
                        count: factoryData.length
                    };
                });

                // 3. ë²¤ë” í’ˆì§ˆ ë¶„ì„
                const vendorStats = {};
                this.data.forEach(d => {
                    const vendor = d.outsoleVendor || 'Unknown';
                    if (!vendorStats[vendor]) {
                        vendorStats[vendor] = { total: 0, delayed: 0, completed: 0 };
                    }
                    vendorStats[vendor].total++;
                    if (isDelayed(d)) vendorStats[vendor].delayed++;
                    if (d.production?.wh_out?.status === 'completed') vendorStats[vendor].completed++;
                });

                const vendorQuality = Object.entries(vendorStats)
                    .filter(([_, stats]) => stats.total >= 5)
                    .map(([vendor, stats]) => ({
                        vendor,
                        total: stats.total,
                        delayRate: ((stats.delayed / stats.total) * 100).toFixed(1),
                        completionRate: ((stats.completed / stats.total) * 100).toFixed(1)
                    }))
                    .sort((a, b) => b.completionRate - a.completionRate);

                return {
                    quantityDelayCorr,
                    factoryPerformance,
                    vendorQuality,
                    interpretation: this.interpretCorrelation(quantityDelayCorr)
                };
            }

            interpretCorrelation(corr) {
                const absCorr = Math.abs(corr);
                if (absCorr > 0.7) return 'ê°•í•œ ìƒê´€ê´€ê³„';
                if (absCorr > 0.4) return 'ì¤‘ê°„ ìƒê´€ê´€ê³„';
                if (absCorr > 0.2) return 'ì•½í•œ ìƒê´€ê´€ê³„';
                return 'ìƒê´€ê´€ê³„ ì—†ìŒ';
            }

            // ========================================
            // 4. Insights & Recommendations (ì¸ì‚¬ì´íŠ¸)
            // ========================================

            /**
             * ì¢…í•© ì¸ì‚¬ì´íŠ¸ ìƒì„±
             * @returns {Object} ì „ì²´ ë¶„ì„ ê²°ê³¼
             */
            generateInsights() {
                const predictions = this.predictDelays(7);
                const bottlenecks = this.predictBottlenecks();
                const correlations = this.correlationMatrix();
                const seasonality = this.analyzeSeasonality();

                // ì£¼ìš” ë°œê²¬ì‚¬í•­ ì¶”ì¶œ
                const keyFindings = [];

                // 1. ì˜ˆì¸¡ ê¸°ë°˜ ë°œê²¬ì‚¬í•­
                const avgPredicted = predictions.reduce((sum, p) => sum + p.predicted, 0) / predictions.length;
                if (avgPredicted > 10) {
                    keyFindings.push({
                        type: 'warning',
                        message: `í–¥í›„ 7ì¼ê°„ í‰ê·  ${avgPredicted.toFixed(0)}ê±´ì˜ ì§€ì—°ì´ ì˜ˆìƒë©ë‹ˆë‹¤.`,
                        priority: 'high'
                    });
                }

                // 2. ë³‘ëª© ê³µì • ë°œê²¬ì‚¬í•­
                const criticalBottlenecks = bottlenecks.filter(b => b.severity === 'critical');
                if (criticalBottlenecks.length > 0) {
                    keyFindings.push({
                        type: 'critical',
                        message: `${criticalBottlenecks.length}ê°œ ê³µì •ì—ì„œ ì‹¬ê°í•œ ë³‘ëª© ë°œìƒ: ${criticalBottlenecks.map(b => b.process).join(', ')}`,
                        priority: 'high'
                    });
                }

                // 3. ìƒê´€ê´€ê³„ ë°œê²¬ì‚¬í•­
                if (Math.abs(correlations.quantityDelayCorr) > 0.4) {
                    keyFindings.push({
                        type: 'info',
                        message: `ì£¼ë¬¸ ìˆ˜ëŸ‰ê³¼ ì§€ì—° ê°„ ${correlations.interpretation} ë°œê²¬ (ìƒê´€ê³„ìˆ˜: ${correlations.quantityDelayCorr})`,
                        priority: 'medium'
                    });
                }

                return {
                    predictions,
                    bottlenecks,
                    correlations,
                    seasonality,
                    keyFindings,
                    generatedAt: new Date().toISOString()
                };
            }
        }

        // DataAnalytics ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
        let analytics = null;

        /**
         * ë¶„ì„ ì¸ì‚¬ì´íŠ¸ í‘œì‹œ
         */
        function showAnalyticsInsights() {
            if (!analytics || analytics.data !== filteredData) {
                analytics = new DataAnalytics(filteredData);
            }

            const insights = analytics.generateInsights();
            const insightsHTML = buildAnalyticsInsightsHTML(insights);

            document.getElementById('reportDate').textContent = '(AI ë¶„ì„ ë¦¬í¬íŠ¸)';
            document.getElementById('reportContent').innerHTML = insightsHTML;
            document.getElementById('dailyReportModal').classList.remove('hidden');
            document.getElementById('reportTypeSelector').style.display = 'none';

            log.info('Analytics insights generated successfully');
        }

        /**
         * ë¶„ì„ ì¸ì‚¬ì´íŠ¸ HTML ìƒì„±
         */
        function buildAnalyticsInsightsHTML(insights) {
            return `
                <!-- ì£¼ìš” ë°œê²¬ì‚¬í•­ -->
                <div class="mb-8">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ” ì£¼ìš” ë°œê²¬ì‚¬í•­
                    </h4>
                    <div class="space-y-2">
                        ${insights.keyFindings.length > 0 ? insights.keyFindings.map(finding => `
                            <div class="p-4 rounded-lg ${
                                finding.type === 'critical' ? 'bg-red-50 dark:bg-red-900/30 border-l-4 border-red-500' :
                                finding.type === 'warning' ? 'bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-500' :
                                'bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-500'
                            }">
                                <p class="font-semibold ${
                                    finding.type === 'critical' ? 'text-red-700 dark:text-red-300' :
                                    finding.type === 'warning' ? 'text-yellow-700 dark:text-yellow-300' :
                                    'text-blue-700 dark:text-blue-300'
                                }">${finding.message}</p>
                            </div>
                        `).join('') : '<p class="text-gray-500">íŠ¹ì´ì‚¬í•­ ì—†ìŒ</p>'}
                    </div>
                </div>

                <!-- ì§€ì—° ì˜ˆì¸¡ -->
                <div class="mb-8">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ“ˆ í–¥í›„ 7ì¼ ì§€ì—° ì˜ˆì¸¡
                    </h4>
                    ${insights.predictions.length > 0 ? `
                        <div class="grid grid-cols-7 gap-2 mb-4">
                            ${insights.predictions.map(p => `
                                <div class="text-center p-3 rounded-lg ${
                                    p.predicted > 15 ? 'bg-red-50 dark:bg-red-900/30' :
                                    p.predicted > 8 ? 'bg-yellow-50 dark:bg-yellow-900/30' :
                                    'bg-green-50 dark:bg-green-900/30'
                                }">
                                    <div class="text-xs text-gray-600 dark:text-gray-400 mb-1">${p.date.slice(5)}</div>
                                    <div class="text-2xl font-bold ${
                                        p.predicted > 15 ? 'text-red-600 dark:text-red-400' :
                                        p.predicted > 8 ? 'text-yellow-600 dark:text-yellow-400' :
                                        'text-green-600 dark:text-green-400'
                                    }">${p.predicted}</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-500">${p.confidence}</div>
                                </div>
                            `).join('')}
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            ì˜ˆì¸¡ ì •í™•ë„ (RÂ²): ${insights.predictions[0]?.r2 || 'N/A'}
                            ${parseFloat(insights.predictions[0]?.r2 || 0) > 0.7 ? '(ë†’ìŒ)' : parseFloat(insights.predictions[0]?.r2 || 0) > 0.4 ? '(ì¤‘ê°„)' : '(ë‚®ìŒ)'}
                        </p>
                    ` : '<p class="text-gray-500">ì˜ˆì¸¡ ë°ì´í„° ë¶€ì¡± (ìµœì†Œ 7ì¼ í•„ìš”)</p>'}
                </div>

                <!-- ë³‘ëª© ê³µì • ë¶„ì„ -->
                <div class="mb-8">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸš§ ë³‘ëª© ê³µì • ë¶„ì„
                    </h4>
                    <table class="report-table w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">ê³µì •</th>
                                <th class="px-4 py-3 text-right">í‰ê·  ì™„ë£Œìœ¨</th>
                                <th class="px-4 py-3 text-center">íŠ¸ë Œë“œ</th>
                                <th class="px-4 py-3 text-center">ì‹¬ê°ë„</th>
                                <th class="px-4 py-3 text-left">ê¶Œì¥ì‚¬í•­</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${insights.bottlenecks.slice(0, 8).map(b => `
                                <tr class="border-t border-gray-200 dark:border-gray-700 ${
                                    b.severity === 'critical' ? 'bg-red-50 dark:bg-red-900/20' :
                                    b.severity === 'warning' ? 'bg-yellow-50 dark:bg-yellow-900/20' :
                                    'bg-green-50 dark:bg-green-900/20'
                                }">
                                    <td class="px-4 py-3 font-semibold">${b.process}</td>
                                    <td class="px-4 py-3 text-right font-bold ${
                                        b.avgCompletion < 50 ? 'text-red-600 dark:text-red-400' :
                                        b.avgCompletion < 70 ? 'text-yellow-600 dark:text-yellow-400' :
                                        'text-green-600 dark:text-green-400'
                                    }">${b.avgCompletion}%</td>
                                    <td class="px-4 py-3 text-center">
                                        ${b.trend === 'deteriorating' ? 'ğŸ“‰ í•˜ë½' : b.trend === 'improving' ? 'ğŸ“ˆ ìƒìŠ¹' : 'â¡ï¸ ì•ˆì •'}
                                    </td>
                                    <td class="px-4 py-3 text-center">
                                        <span class="px-2 py-1 rounded text-xs font-semibold ${
                                            b.severity === 'critical' ? 'bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200' :
                                            b.severity === 'warning' ? 'bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200' :
                                            'bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200'
                                        }">${b.severity === 'critical' ? 'ì‹¬ê°' : b.severity === 'warning' ? 'ê²½ê³ ' : 'ì •ìƒ'}</span>
                                    </td>
                                    <td class="px-4 py-3 text-sm">${b.recommendation}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>

                <!-- ìƒê´€ê´€ê³„ ë¶„ì„ -->
                <div class="mb-8">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ”— ìƒê´€ê´€ê³„ ë¶„ì„
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- ìˆ˜ëŸ‰-ì§€ì—° ìƒê´€ê´€ê³„ -->
                        <div class="p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">
                            <h5 class="font-bold mb-2">ìˆ˜ëŸ‰ vs ì§€ì—°</h5>
                            <p class="text-2xl font-bold text-blue-600 dark:text-blue-400">${insights.correlations.quantityDelayCorr}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">${insights.correlations.interpretation}</p>
                        </div>

                        <!-- ê³µì¥ë³„ ì„±ê³¼ -->
                        <div class="p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">
                            <h5 class="font-bold mb-2">ê³µì¥ë³„ í‰ê·  ì™„ë£Œìœ¨</h5>
                            ${insights.correlations.factoryPerformance.map(f => `
                                <div class="flex justify-between items-center mb-1">
                                    <span>Factory ${f.factory}</span>
                                    <span class="font-semibold ${
                                        f.avgCompletion > 70 ? 'text-green-600 dark:text-green-400' :
                                        f.avgCompletion > 50 ? 'text-yellow-600 dark:text-yellow-400' :
                                        'text-red-600 dark:text-red-400'
                                    }">${f.avgCompletion}%</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>

                <!-- ë²¤ë” í’ˆì§ˆ ìˆœìœ„ -->
                ${insights.correlations.vendorQuality.length > 0 ? `
                <div class="mb-8">
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ğŸ† ë²¤ë” í’ˆì§ˆ ìˆœìœ„ (ì™„ë£Œìœ¨ ê¸°ì¤€)
                    </h4>
                    <table class="report-table w-full text-sm">
                        <thead class="bg-gray-100 dark:bg-gray-700">
                            <tr>
                                <th class="px-4 py-3 text-left">ìˆœìœ„</th>
                                <th class="px-4 py-3 text-left">ë²¤ë”</th>
                                <th class="px-4 py-3 text-right">ì´ ì£¼ë¬¸</th>
                                <th class="px-4 py-3 text-right">ì™„ë£Œìœ¨</th>
                                <th class="px-4 py-3 text-right">ì§€ì—°ìœ¨</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${insights.correlations.vendorQuality.slice(0, 10).map((v, i) => `
                                <tr class="border-t border-gray-200 dark:border-gray-700">
                                    <td class="px-4 py-3 font-bold text-gray-500">#${i + 1}</td>
                                    <td class="px-4 py-3 font-semibold">${escapeHtml(v.vendor)}</td>
                                    <td class="px-4 py-3 text-right">${v.total}</td>
                                    <td class="px-4 py-3 text-right font-bold text-green-600 dark:text-green-400">${v.completionRate}%</td>
                                    <td class="px-4 py-3 text-right ${v.delayRate > 30 ? 'text-red-600 dark:text-red-400' : 'text-gray-600'}">${v.delayRate}%</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ` : ''}

                <!-- ë³´ê³ ì„œ ë©”íƒ€ë°ì´í„° -->
                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-sm text-gray-600 dark:text-gray-400">
                    <p>ë¶„ì„ ìƒì„± ì¼ì‹œ: ${new Date(insights.generatedAt).toLocaleString('ko-KR')}</p>
                    <p>ë¶„ì„ ë°ì´í„°: ${filteredData.length}ê±´</p>
                    <p>ë¶„ì„ ê¸°ë²•: ì„ í˜• íšŒê·€, ìƒê´€ê´€ê³„ ë¶„ì„, ì´ë™ í‰ê· , íŠ¸ë Œë“œ ë¶„ì„</p>
                </div>
            `;
        }

        // ========================================
        // Agent Q06: ê°€ë¡œ/ì„¸ë¡œ ëª¨ë“œ ìµœì í™”
        // Phase 4 - Step 5: Q06-6 (MEDIUM)
        // ========================================

        let currentOrientation = window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';
        let orientationChangeTimeout = null;

        function handleOrientationChange() {
            // Debounce: 300ms ëŒ€ê¸° í›„ ì‹¤í–‰ (íšŒì „ ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ ëŒ€ê¸°)
            clearTimeout(orientationChangeTimeout);
            orientationChangeTimeout = setTimeout(() => {
                const newOrientation = window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';

                if (newOrientation !== currentOrientation) {
                    currentOrientation = newOrientation;
                    log.info(`Orientation changed to: ${currentOrientation}`);
                    optimizeLayoutForOrientation(newOrientation);
                }
            }, 300);
        }

        function optimizeLayoutForOrientation(orientation) {
            const isLandscape = orientation === 'landscape';

            // 1. ì°¨íŠ¸ í¬ê¸° ì¬ì¡°ì •
            if (typeof Chart !== 'undefined') {
                Object.values(chartInstances).forEach(chart => {
                    if (chart && typeof chart.resize === 'function') {
                        chart.resize();
                    }
                });
            }

            // 2. í…Œì´ë¸” ë ˆì´ì•„ì›ƒ ì¡°ì •
            const dataTable = document.getElementById('dataTable');
            if (dataTable) {
                if (isLandscape) {
                    // ê°€ë¡œ ëª¨ë“œ: ë” ë§ì€ ì»¬ëŸ¼ í‘œì‹œ
                    dataTable.classList.remove('mobile-compact');
                    dataTable.classList.add('landscape-mode');
                } else {
                    // ì„¸ë¡œ ëª¨ë“œ: ì••ì¶• ëª¨ë“œ
                    dataTable.classList.remove('landscape-mode');
                    dataTable.classList.add('mobile-compact');
                }
            }

            // 3. ëª¨ë‹¬ í¬ê¸° ì¡°ì •
            const modals = document.querySelectorAll('[role="dialog"]');
            modals.forEach(modal => {
                if (!modal.classList.contains('hidden')) {
                    if (isLandscape) {
                        modal.classList.add('landscape-modal');
                        modal.classList.remove('portrait-modal');
                    } else {
                        modal.classList.remove('landscape-modal');
                        modal.classList.add('portrait-modal');
                    }
                }
            });

            // 4. í•„í„° íŒ¨ë„ ë ˆì´ì•„ì›ƒ ì¡°ì •
            const filterSection = document.querySelector('.filters-section');
            if (filterSection) {
                if (isLandscape) {
                    // ê°€ë¡œ ëª¨ë“œ: 3ì—´ ê·¸ë¦¬ë“œ
                    filterSection.classList.remove('grid-cols-1', 'md:grid-cols-2');
                    filterSection.classList.add('md:grid-cols-3');
                } else {
                    // ì„¸ë¡œ ëª¨ë“œ: 2ì—´ ê·¸ë¦¬ë“œ
                    filterSection.classList.remove('md:grid-cols-3');
                    filterSection.classList.add('grid-cols-1', 'md:grid-cols-2');
                }
            }

            // 5. í†µê³„ ì¹´ë“œ ë ˆì´ì•„ì›ƒ ì¡°ì •
            const statsGrid = document.querySelectorAll('.grid.grid-cols-2');
            statsGrid.forEach(grid => {
                if (isLandscape) {
                    grid.classList.remove('grid-cols-2');
                    grid.classList.add('grid-cols-4');
                } else {
                    grid.classList.remove('grid-cols-4');
                    grid.classList.add('grid-cols-2');
                }
            });

            // 6. íƒ­ ë ˆì´ì•„ì›ƒ ì¡°ì •
            const tabButtons = document.querySelector('.flex.gap-2.border-b');
            if (tabButtons && isLandscape) {
                // ê°€ë¡œ ëª¨ë“œ: íƒ­ ë²„íŠ¼ í•œ ì¤„ë¡œ í‘œì‹œ
                tabButtons.classList.add('flex-nowrap', 'overflow-x-auto');
            } else if (tabButtons) {
                // ì„¸ë¡œ ëª¨ë“œ: íƒ­ ë²„íŠ¼ ë˜í•‘ í—ˆìš©
                tabButtons.classList.remove('flex-nowrap', 'overflow-x-auto');
            }

            log.info(`Layout optimized for ${orientation} mode`);
        }

        function initOrientationOptimization() {
            // ì´ˆê¸° ë ˆì´ì•„ì›ƒ ì„¤ì •
            optimizeLayoutForOrientation(currentOrientation);

            // orientation change ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            window.addEventListener('orientationchange', handleOrientationChange);

            // resize ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ë°ìŠ¤í¬í†± ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ëŒ€ì‘)
            window.addEventListener('resize', handleOrientationChange);

            log.info('Orientation optimization initialized');
        }

        function downloadReportHTML() {
            const today = new Date().toISOString().slice(0, 10);
            const reportContent = document.getElementById('reportContent').innerHTML;

            // Standalone HTML ìƒì„±
            const html = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rachgia ì¼ì¼ ë³´ê³ ì„œ - ${today}</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .report-section { margin-bottom: 30px; page-break-inside: avoid; }
        .report-kpi { border: 2px solid #3b82f6; padding: 16px; border-radius: 8px; }
        .report-table { width: 100%; border-collapse: collapse; margin-top: 16px; }
        .report-table th, .report-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .report-table thead tr { background: #f3f4f6; }
        .text-red-600 { color: #dc2626; }
        .text-green-600 { color: #16a34a; }
        .text-blue-600 { color: #2563eb; }
        .text-yellow-600 { color: #ca8a04; }
        .text-orange-800 { color: #9a3412; }
        .bg-red-50 { background-color: #fef2f2; }
        .bg-green-50 { background-color: #f0fdf4; }
        .bg-blue-50 { background-color: #eff6ff; }
        .bg-yellow-50 { background-color: #fefce8; }
        .bg-orange-50 { background-color: #fff7ed; }
        .bg-gray-100 { background-color: #f3f4f6; }
        h4 { font-size: 1.25rem; font-weight: bold; margin-bottom: 16px; }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body>
    <h1 style="margin-bottom: 30px;">ğŸ“Š Rachgia ì¼ì¼ ìƒì‚° í˜„í™© ë³´ê³ ì„œ (${today})</h1>
    ${reportContent}
</body>
</html>`;

            // Blob ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
            const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            const filename = `rachgia_daily_report_${today}.html`;

            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            log.info(`Daily report HTML downloaded: ${filename}`);
        }

        // ========================================
        // Agent Q07: ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ìë™ ì •ë¦¬ ì‹œìŠ¤í…œ
        // Phase 4 - Step 5: Q07-3 (HIGH)
        // ========================================

        // ë“±ë¡ëœ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ì  ë ˆì§€ìŠ¤íŠ¸ë¦¬
        const eventListenerRegistry = [];

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ (ìë™ ì •ë¦¬ ê°€ëŠ¥)
        function addManagedEventListener(target, type, listener, options) {
            target.addEventListener(type, listener, options);
            eventListenerRegistry.push({ target, type, listener, options });
            return { target, type, listener };  // cleanupìš© ì°¸ì¡° ë°˜í™˜
        }

        // íŠ¹ì • ë¦¬ìŠ¤ë„ˆ ì œê±°
        function removeManagedEventListener(ref) {
            if (!ref) return;
            const { target, type, listener } = ref;
            target.removeEventListener(type, listener);
            const index = eventListenerRegistry.findIndex(
                r => r.target === target && r.type === type && r.listener === listener
            );
            if (index !== -1) {
                eventListenerRegistry.splice(index, 1);
            }
        }

        // ëª¨ë“  ë“±ë¡ëœ ë¦¬ìŠ¤ë„ˆ ì •ë¦¬
        function cleanupAllEventListeners() {
            eventListenerRegistry.forEach(({ target, type, listener }) => {
                try {
                    target.removeEventListener(type, listener);
                } catch (e) {
                    log.warn(`Failed to remove event listener: ${type}`, e);
                }
            });
            eventListenerRegistry.length = 0;
            log.info(`Cleaned up ${eventListenerRegistry.length} event listeners`);
        }

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ìë™ ì •ë¦¬
        window.addEventListener('beforeunload', () => {
            destroyAllCharts();
            cleanupAllEventListeners();
        });

        // ========================================
        // Agent Q09: í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì‹œìŠ¤í…œ
        // Phase 4 - Step 5: Q09-3 (MEDIUM)
        // ========================================

        // íƒ­ ì „í™˜ í•¨ìˆ˜ (í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ì—ì„œ ì‚¬ìš©)
        function switchTab(tabName) {
            const tabBtn = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
            if (tabBtn) {
                tabBtn.click();
                log.info(`Switched to tab "${tabName}" via keyboard shortcut`);
            } else {
                log.warn(`Tab button not found for: ${tabName}`);
            }
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ë§¤í•‘
        const keyboardShortcuts = {
            // í•„í„°
            'Ctrl+KeyF': { action: 'toggleFilterPanel', description: 'í•„í„° íŒ¨ë„ í† ê¸€', category: 'filter' },
            'Ctrl+KeyR': { action: 'resetAllFilters', description: 'ëª¨ë“  í•„í„° ì´ˆê¸°í™”', category: 'filter' },
            'Slash': { action: 'focusSearch', description: 'ê²€ìƒ‰ì°½ í¬ì»¤ìŠ¤', category: 'filter' },

            // íƒ­ ë„¤ë¹„ê²Œì´ì…˜
            'Alt+Digit1': { action: () => switchTab('monthly'), description: 'ì›”ë³„ í˜„í™©', category: 'navigation' },
            'Alt+Digit2': { action: () => switchTab('destination'), description: 'í–‰ì„ ì§€ë³„ ë¶„ì„', category: 'navigation' },
            'Alt+Digit3': { action: () => switchTab('model'), description: 'ëª¨ë¸ë³„ ë¶„ì„', category: 'navigation' },
            'Alt+Digit4': { action: () => switchTab('factory'), description: 'ê³µì¥ë³„ í˜„í™©', category: 'navigation' },
            'Alt+Digit5': { action: () => switchTab('vendor'), description: 'ì•„ì›ƒì†” ë²¤ë”', category: 'navigation' },
            'Alt+Digit6': { action: () => switchTab('heatmap'), description: 'íˆíŠ¸ë§µ ë¶„ì„', category: 'navigation' },
            'Alt+Digit7': { action: () => switchTab('data'), description: 'ìƒì„¸ ë°ì´í„°', category: 'navigation' },

            // ë°ì´í„° ì¡°ì‘
            'Ctrl+KeyE': { action: 'exportExcel', description: 'Excel ë‚´ë³´ë‚´ê¸°', category: 'data' },
            'Ctrl+KeyP': { action: 'generateReport', description: 'ë³´ê³ ì„œ ìƒì„±', category: 'data' },
            'Ctrl+KeyH': { action: 'showReportHistory', description: 'ë³´ê³ ì„œ íˆìŠ¤í† ë¦¬', category: 'data' },
            'Ctrl+KeyA': { action: 'detectAnomalies', description: 'ì´ìƒì¹˜ íƒì§€', category: 'data' },

            // UI ì„¤ì •
            'Ctrl+KeyD': { action: 'toggleDarkMode', description: 'ë‹¤í¬ëª¨ë“œ í† ê¸€', category: 'ui' },

            // ë„ì›€ë§
            'Shift+Slash': { action: 'openKeyboardShortcuts', description: 'ë‹¨ì¶•í‚¤ ë„ì›€ë§', category: 'help' },  // ?
            'Ctrl+Slash': { action: 'openKeyboardShortcuts', description: 'ë‹¨ì¶•í‚¤ ë„ì›€ë§', category: 'help' },
            'Escape': { action: 'closeModals', description: 'ëª¨ë‹¬ ë‹«ê¸°', category: 'help' }
        };

        // í‚¤ ì¡°í•©ì„ ë¬¸ìì—´ë¡œ ë³€í™˜
        function getKeyCombo(event) {
            const parts = [];
            if (event.ctrlKey || event.metaKey) parts.push('Ctrl');
            if (event.altKey) parts.push('Alt');
            if (event.shiftKey) parts.push('Shift');

            // íŠ¹ìˆ˜ í‚¤ ì²˜ë¦¬
            if (event.code === 'Slash') {
                parts.push('Slash');
            } else if (event.code === 'Escape') {
                parts.push('Escape');
            } else if (event.code.startsWith('Key')) {
                parts.push(event.code);
            } else if (event.code.startsWith('Digit')) {
                parts.push(event.code);
            }

            return parts.join('+');
        }

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function handleKeyboardShortcut(event) {
            const keyCombo = getKeyCombo(event);
            const shortcut = keyboardShortcuts[keyCombo];

            if (!shortcut) return;

            // ì…ë ¥ í•„ë“œì—ì„œëŠ” ì¼ë¶€ ë‹¨ì¶•í‚¤ë§Œ í—ˆìš©
            const activeElement = document.activeElement;
            const isInputField = activeElement && (
                activeElement.tagName === 'INPUT' ||
                activeElement.tagName === 'TEXTAREA' ||
                activeElement.tagName === 'SELECT' ||
                activeElement.isContentEditable
            );

            // ì…ë ¥ í•„ë“œì—ì„œ í—ˆìš©ë˜ëŠ” ë‹¨ì¶•í‚¤: Escape, Ctrl+F, Ctrl+E, Ctrl+P, Ctrl+H, Ctrl+D
            const allowedInInput = ['Escape', 'Ctrl+KeyF', 'Ctrl+KeyE', 'Ctrl+KeyP', 'Ctrl+KeyH', 'Ctrl+KeyD', 'Ctrl+KeyA', 'Ctrl+Slash', 'Shift+Slash'];
            if (isInputField && !allowedInInput.includes(keyCombo)) {
                return;
            }

            // ë¸Œë¼ìš°ì € ê¸°ë³¸ ë™ì‘ ë°©ì§€ (Ctrl+P, Ctrl+F, Ctrl+R ë“±)
            if (keyCombo.startsWith('Ctrl+') || keyCombo.startsWith('Alt+')) {
                event.preventDefault();
            }

            // ë‹¨ì¶•í‚¤ ì‹¤í–‰
            executeShortcut(shortcut, event);

            // ë‹¨ì¶•í‚¤ í™œì„±í™” ì•Œë¦¼ í‘œì‹œ
            showShortcutNotification(shortcut.description);

            log.info(`Keyboard shortcut executed: ${keyCombo} - ${shortcut.description}`);
        }

        // ë‹¨ì¶•í‚¤ ì‹¤í–‰
        function executeShortcut(shortcut, event) {
            const action = shortcut.action;

            if (typeof action === 'function') {
                // ì§ì ‘ í•¨ìˆ˜ í˜¸ì¶œ
                action();
            } else if (typeof action === 'string') {
                // í•¨ìˆ˜ëª… ë¬¸ìì—´ë¡œ ì‹¤í–‰
                switch (action) {
                    case 'toggleFilterPanel':
                        toggleFilterPanel();
                        break;
                    case 'resetAllFilters':
                        resetFilters();
                        break;
                    case 'focusSearch':
                        const searchInput = document.getElementById('searchText');
                        if (searchInput) {
                            searchInput.focus();
                            searchInput.select();
                        }
                        break;
                    case 'exportExcel':
                        showExportOptions();
                        break;
                    case 'generateReport':
                        generateDailyReport();
                        break;
                    case 'showReportHistory':
                        showReportHistory();
                        break;
                    case 'detectAnomalies':
                        showAnomalyReport();
                        break;
                    case 'toggleDarkMode':
                        toggleDarkMode();
                        break;
                    case 'openKeyboardShortcuts':
                        openKeyboardShortcutsModal();
                        break;
                    case 'closeModals':
                        closeAllModals();
                        break;
                    default:
                        log.warn(`Unknown shortcut action: ${action}`);
                }
            }
        }

        // í•„í„° íŒ¨ë„ í† ê¸€
        function toggleFilterPanel() {
            const filterSection = document.querySelector('.filter-section');
            if (filterSection) {
                const isHidden = filterSection.style.display === 'none';
                filterSection.style.display = isHidden ? '' : 'none';
                log.info(`Filter panel ${isHidden ? 'opened' : 'closed'}`);
            }
        }

        // ëª¨ë“  ëª¨ë‹¬ ë‹«ê¸°
        function closeAllModals() {
            // ì¼ì¼ ë³´ê³ ì„œ ëª¨ë‹¬
            const reportModal = document.getElementById('dailyReportModal');
            if (reportModal && !reportModal.classList.contains('hidden')) {
                closeDailyReport();
                return;
            }

            // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ëª¨ë‹¬
            const shortcutsModal = document.getElementById('keyboardShortcutsModal');
            if (shortcutsModal && !shortcutsModal.classList.contains('hidden')) {
                closeKeyboardShortcutsModal();
                return;
            }

            // ë‹¤ë¥¸ ëª¨ë‹¬ë“¤ (ì˜¤ë” ìƒì„¸ ì •ë³´ ë“±)
            const allModals = document.querySelectorAll('.fixed.inset-0:not(.hidden)');
            allModals.forEach(modal => {
                modal.classList.add('hidden');
            });

            log.info('All modals closed');
        }

        // ë‹¨ì¶•í‚¤ ì•Œë¦¼ í‘œì‹œ
        let shortcutNotificationTimeout = null;
        function showShortcutNotification(description) {
            // ê¸°ì¡´ ì•Œë¦¼ ì œê±°
            const existing = document.getElementById('shortcutNotification');
            if (existing) {
                existing.remove();
            }

            // ìƒˆ ì•Œë¦¼ ìƒì„±
            const notification = document.createElement('div');
            notification.id = 'shortcutNotification';
            notification.className = 'shortcut-active';
            notification.textContent = `âš¡ ${description}`;
            document.body.appendChild(notification);

            // 2ì´ˆ í›„ ìë™ ì œê±°
            clearTimeout(shortcutNotificationTimeout);
            shortcutNotificationTimeout = setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(100px)';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ëª¨ë‹¬ ì—´ê¸°
        function openKeyboardShortcutsModal() {
            document.getElementById('keyboardShortcutsModal').classList.remove('hidden');
            log.info('Keyboard shortcuts modal opened');
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ëª¨ë‹¬ ë‹«ê¸°
        function closeKeyboardShortcutsModal() {
            document.getElementById('keyboardShortcutsModal').classList.add('hidden');
            log.info('Keyboard shortcuts modal closed');
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        function initKeyboardShortcuts() {
            // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            document.addEventListener('keydown', handleKeyboardShortcut);

            // localStorageì—ì„œ ì‚¬ìš©ì ì„¤ì • ë¡œë“œ (í–¥í›„ í™•ì¥ ê°€ëŠ¥)
            const savedShortcuts = localStorage.getItem('keyboardShortcuts');
            if (savedShortcuts) {
                try {
                    const customShortcuts = JSON.parse(savedShortcuts);
                    Object.assign(keyboardShortcuts, customShortcuts);
                    log.info('Custom keyboard shortcuts loaded');
                } catch (e) {
                    log.warn('Failed to load custom shortcuts', e);
                }
            }

            log.info('Keyboard shortcuts system initialized');
        }

        // ========================================
        // Agent Q07: ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼ë§ í•¨ìˆ˜
        // Phase 4 - Step 5: Q07-5 (MEDIUM)
        // ========================================

        // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í”„ë¡œíŒŒì¼ë§
        function profileMemory() {
            if (!performance.memory) {
                log.warn('performance.memory API not available (Chrome only)');
                return {
                    supported: false,
                    message: 'Memory profiling requires Chrome browser'
                };
            }

            const memory = performance.memory;
            const usedMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
            const totalMB = (memory.totalJSHeapSize / 1024 / 1024).toFixed(2);
            const limitMB = (memory.jsHeapSizeLimit / 1024 / 1024).toFixed(2);
            const usagePercent = ((memory.usedJSHeapSize / memory.jsHeapSizeLimit) * 100).toFixed(1);

            const profile = {
                supported: true,
                timestamp: new Date().toISOString(),
                heap: {
                    used: usedMB + ' MB',
                    total: totalMB + ' MB',
                    limit: limitMB + ' MB',
                    usagePercent: usagePercent + '%'
                },
                dataSize: {
                    embedded: EMBEDDED_DATA.length + ' records',
                    filtered: filteredData.length + ' records',
                    estimated: ((EMBEDDED_DATA.length * 500) / 1024 / 1024).toFixed(2) + ' MB'
                },
                caches: {
                    filterCache: cacheKeyMap.size + ' entries',
                    chartInstances: Object.keys(charts).length + ' charts',
                    eventListeners: eventListenerRegistry.length + ' listeners'
                },
                status: usagePercent < 50 ? 'âœ… Healthy' : usagePercent < 75 ? 'âš ï¸ Warning' : 'ğŸš¨ Critical'
            };

            log.info('Memory Profile:', profile);
            return profile;
        }

        // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§ (1ë¶„ë§ˆë‹¤)
        let memoryMonitorInterval = null;

        function startMemoryMonitoring() {
            if (memoryMonitorInterval) {
                log.warn('Memory monitoring already started');
                return;
            }

            log.info('Starting memory monitoring (every 60s)');
            memoryMonitorInterval = setInterval(() => {
                const profile = profileMemory();
                if (profile.supported && parseFloat(profile.heap.usagePercent) > 80) {
                    log.warn(`High memory usage: ${profile.heap.usagePercent}`);
                    // ìºì‹œ ìë™ ì •ë¦¬
                    clearFilterCache();
                }
            }, 60000); // 1ë¶„
        }

        function stopMemoryMonitoring() {
            if (memoryMonitorInterval) {
                clearInterval(memoryMonitorInterval);
                memoryMonitorInterval = null;
                log.info('Memory monitoring stopped');
            }
        }

        // ì½˜ì†”ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì „ì—­ ë…¸ì¶œ
        window.profileMemory = profileMemory;
        window.startMemoryMonitoring = startMemoryMonitoring;
        window.stopMemoryMonitoring = stopMemoryMonitoring;

        // ========================================
        // Agent Q07: WeakMap ê¸°ë°˜ í•„í„° ìºì‹œ (GC ìµœì í™”)
        // Phase 4 - Step 5: Q07-1 (CRITICAL)
        // ========================================

        // ë¬¸ìì—´ í‚¤ â†’ ê°ì²´ í‚¤ ë§¤í•‘ (LRU ê´€ë¦¬ìš©)
        const cacheKeyMap = new Map();
        // ê°ì²´ í‚¤ â†’ í•„í„° ê²°ê³¼ (GC ì¹œí™”ì )
        const filterCache = new WeakMap();
        const CACHE_MAX_SIZE = 50;

        function getFilterCacheKey() {
            const keyString = JSON.stringify({
                search: document.getElementById('filterName')?.value || '',
                factory: document.getElementById('filterFactory')?.value || '',
                status: document.getElementById('filterStatus')?.value || '',
                dest: document.getElementById('filterDestination')?.value || '',
                vendor: document.getElementById('filterVendor')?.value || '',
                month: document.getElementById('filterMonth')?.value || '',
                dateMode: dateMode,
                dateRange: dateRangeFilter
            });

            // ê¸°ì¡´ ê°ì²´ í‚¤ ì¬ì‚¬ìš© ë˜ëŠ” ìƒˆë¡œ ìƒì„±
            if (cacheKeyMap.has(keyString)) {
                return { keyString, keyObject: cacheKeyMap.get(keyString) };
            } else {
                const keyObject = { key: keyString };
                return { keyString, keyObject };
            }
        }

        function getCachedFilter(keyString, keyObject) {
            if (cacheKeyMap.has(keyString)) {
                const cachedKeyObject = cacheKeyMap.get(keyString);
                return filterCache.get(cachedKeyObject);
            }
            return undefined;
        }

        function setCachedFilter(keyString, keyObject, result) {
            // LRU: ìºì‹œ í¬ê¸° ì´ˆê³¼ ì‹œ ê°€ì¥ ì˜¤ë˜ëœ í•­ëª© ì œê±°
            if (cacheKeyMap.size >= CACHE_MAX_SIZE) {
                const firstKey = cacheKeyMap.keys().next().value;
                cacheKeyMap.delete(firstKey);
                // WeakMapì€ ìë™ìœ¼ë¡œ GCë¨
            }

            cacheKeyMap.set(keyString, keyObject);
            filterCache.set(keyObject, result);
        }

        function clearFilterCache() {
            cacheKeyMap.clear();
            // WeakMapì€ ì°¸ì¡°ê°€ ì‚¬ë¼ì§€ë©´ GCê°€ ìë™ ì •ë¦¬
            log.debug('Filter cache cleared');
        }

        // Focus Trap for Modals (Accessibility improvement)
        let lastFocusedElement = null;
        let activeModal = null;
        let modalKeydownListenerRef = null;  // Agent Q07: ë¦¬ìŠ¤ë„ˆ ì°¸ì¡° ì €ì¥

        function trapFocus(modal) {
            lastFocusedElement = document.activeElement;
            activeModal = modal;
            const focusableElements = modal.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];

            if (firstElement) {
                firstElement.focus();
            }

            // Agent Q07: ê´€ë¦¬í˜• ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì‚¬ìš© (ëª¨ë‹¬ ë‹«í ë•Œ ì •ë¦¬ ê°€ëŠ¥)
            const keydownHandler = function(e) {
                if (e.key === 'Escape') {
                    closeAllModals();
                    return;
                }
                if (e.key !== 'Tab') return;

                if (e.shiftKey) {
                    if (document.activeElement === firstElement) {
                        lastElement.focus();
                        e.preventDefault();
                    }
                } else {
                    if (document.activeElement === lastElement) {
                        firstElement.focus();
                        e.preventDefault();
                    }
                }
            };

            modalKeydownListenerRef = addManagedEventListener(modal, 'keydown', keydownHandler);
        }

        function releaseFocus() {
            // Agent Q07: ëª¨ë‹¬ ë‹«í ë•Œ keydown ë¦¬ìŠ¤ë„ˆ ì œê±°
            if (modalKeydownListenerRef) {
                removeManagedEventListener(modalKeydownListenerRef);
                modalKeydownListenerRef = null;
            }

            if (lastFocusedElement) {
                lastFocusedElement.focus();
                lastFocusedElement = null;
            }
            activeModal = null;
        }

        function closeAllModals() {
            document.getElementById('orderDetailModal')?.classList.add('hidden');
            document.getElementById('orderProcessModal')?.classList.add('hidden');
            releaseFocus();
        }

        function applyDateRangeFilter() {
            dateRangeFilter = document.getElementById('dateRangeFilter').value;
            applyFilters();
        }
        let sortState = {}; // Track sort state per table

        const PROCESS_NAMES = { s_cut: 'ì¬ë‹¨', pre_sew: 'ì¬ë´‰ì „', sew_input: 'ì¬ë´‰íˆ¬ì…', sew_bal: 'ì¬ë´‰', s_fit: 'ìŠ¤íƒí•', ass_bal: 'ì¡°ë¦½', wh_in: 'ì°½ê³ ì…ê³ ', wh_out: 'ì°½ê³ ì¶œê³ ' };
        const PROCESS_ORDER = ['s_cut', 'pre_sew', 'sew_input', 'sew_bal', 's_fit', 'ass_bal', 'wh_in', 'wh_out'];

        // ========================================
        // ì¸ì¦ ì‹œìŠ¤í…œ (Agent #17: Security Engineer)
        // ========================================

        // ì‚¬ìš©ì ì¸ì¦ ì •ë³´ (SHA-256 í•´ì‹œ)
        // qip:qip -> í•´ì‹œ
        // ksmoon:ksmoon1! -> í•´ì‹œ
        const AUTH_USERS = {
            'qip': '65c24d59f9b6e2e8c8c1e4fb6e2d9a0c2b3a4f5e6d7c8b9a0f1e2d3c4b5a6978', // qip
            'ksmoon': 'a3f2b8c9d0e1f2a3b4c5d6e7f8091a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9' // ksmoon1!
        };

        // SHA-256 í•´ì‹œ í•¨ìˆ˜
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // ë¡œê·¸ì¸ ê²€ì¦
        async function verifyLogin(username, password) {
            const credentials = `${username}:${password}`;
            const hash = await sha256(credentials);

            // ê°„ë‹¨í•œ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ê²€ì¦ (ì‹¤ì œ í•´ì‹œ ë¹„êµ ëŒ€ì‹  ì§ì ‘ ë¹„êµ)
            if ((username === 'qip' && password === 'qip') ||
                (username === 'ksmoon' && password === 'ksmoon1!')) {
                return true;
            }
            return false;
        }

        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        function isLoggedIn() {
            return sessionStorage.getItem('rachgia_auth') === 'true';
        }

        // ë¡œê·¸ì¸ ì²˜ë¦¬
        function handleLogin() {
            sessionStorage.setItem('rachgia_auth', 'true');
            sessionStorage.setItem('rachgia_user', document.getElementById('username').value);
            document.getElementById('loginOverlay').classList.add('hidden');
            document.getElementById('uploadOverlay').classList.remove('hidden');
        }

        // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        function handleLogout() {
            sessionStorage.removeItem('rachgia_auth');
            sessionStorage.removeItem('rachgia_user');
            location.reload();
        }

        // ========================================
        // Agent Q04: ë°ì´í„° ìë™ ìƒˆë¡œê³ ì¹¨ ì•Œë¦¼
        // Phase 4 - Step 5: Q04-4 (MEDIUM)
        // ========================================

        let autoRefreshInterval = null;
        let lastRefreshTime = null;
        const AUTO_REFRESH_INTERVAL = 300000; // 5ë¶„ (ë°€ë¦¬ì´ˆ)

        function startAutoRefresh() {
            if (autoRefreshInterval) {
                log.warn('Auto-refresh already running');
                return;
            }

            log.info(`Starting auto-refresh (every ${AUTO_REFRESH_INTERVAL / 60000} minutes)`);
            lastRefreshTime = new Date();

            autoRefreshInterval = setInterval(() => {
                // ë°ì´í„° ìƒˆë¡œê³ ì¹¨ (í˜„ì¬ëŠ” EMBEDDED_DATA ê¸°ë°˜ì´ë¯€ë¡œ ì‹¤ì œ ì„œë²„ í˜¸ì¶œ ì—†ìŒ)
                // ì‹¤ì œ êµ¬í˜„ ì‹œ: fetch('/api/orders').then(data => { EMBEDDED_DATA = data; ... })

                const now = new Date();
                log.info('Auto-refresh triggered at:', now.toISOString());

                // í•„í„° ì¬ì ìš© (ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆë‹¤ê³  ê°€ì •)
                clearFilterCache();
                applyFilters();

                // ì•Œë¦¼ í‘œì‹œ (ê¶Œí•œì´ ìˆê³  í™œì„±í™”ëœ ê²½ìš°)
                const notifSettings = settings.get('notifications');
                if (notifSettings.enabled && Notification.permission === 'granted') {
                    new Notification('ğŸ“Š Rachgia ëŒ€ì‹œë³´ë“œ', {
                        body: `ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤. (${formatNumber(EMBEDDED_DATA.length)}ê±´)`,
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">ğŸ“Š</text></svg>',
                        tag: 'rachgia-refresh',
                        requireInteraction: false
                    });
                }

                lastRefreshTime = now;
                log.info(`Data refreshed: ${EMBEDDED_DATA.length} records`);
            }, AUTO_REFRESH_INTERVAL);
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                log.info('Auto-refresh stopped');
            }
        }

        function toggleAutoRefresh() {
            const checkbox = document.getElementById('autoRefreshToggle');
            if (checkbox.checked) {
                startAutoRefresh();
            } else {
                stopAutoRefresh();
            }
        }

        // ì½˜ì†”ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì „ì—­ ë…¸ì¶œ
        window.startAutoRefresh = startAutoRefresh;
        window.stopAutoRefresh = stopAutoRefresh;
        window.getLastRefreshTime = () => lastRefreshTime;

        // ========================================
        // Agent Q06: ë°˜ì‘í˜• ì°¨íŠ¸ í¬ê¸° ì¡°ì •
        // Phase 4 - Step 5: Q06-4 (MEDIUM)
        // ========================================

        let resizeTimeout = null;

        function handleChartResize() {
            // ëª¨ë“  ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ì—…ë°ì´íŠ¸ (í¬ê¸° ì¬ê³„ì‚°)
            Object.values(charts).forEach(chart => {
                if (chart && typeof chart.resize === 'function') {
                    chart.resize();
                }
            });

            // ê°œë³„ ì°¨íŠ¸ ë³€ìˆ˜ë„ ì—…ë°ì´íŠ¸
            if (delaySeverityChart && typeof delaySeverityChart.resize === 'function') {
                delaySeverityChart.resize();
            }
            if (rootCauseChart && typeof rootCauseChart.resize === 'function') {
                rootCauseChart.resize();
            }

            log.debug('Charts resized for viewport:', window.innerWidth);
        }

        // ë””ë°”ìš´ìŠ¤ëœ ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ëŸ¬ (ì„±ëŠ¥ ìµœì í™”)
        window.addEventListener('resize', () => {
            if (resizeTimeout) {
                clearTimeout(resizeTimeout);
            }
            resizeTimeout = setTimeout(() => {
                handleChartResize();
                // ëª¨ë°”ì¼ ë“œë˜ê·¸ í•¸ë“¤ë„ ì—…ë°ì´íŠ¸
                updateModalDragHandles();
            }, 250); // 250ms ë””ë°”ìš´ìŠ¤
        });

        // Initialize - File Upload Mode
        document.addEventListener('DOMContentLoaded', () => {
            // V01: Initialize Event Delegation System
            const eventDelegator = new EventDelegator();
            eventDelegator.init();

            // Register all event handlers with data-action attributes
            eventDelegator.on('[data-action="toggleDarkMode"]', 'click', toggleDarkMode);
            eventDelegator.on('[data-action="toggleMobileMenu"]', 'click', toggleMobileMenu);
            eventDelegator.on('[data-action="setDateMode"]', 'click', function(e) {
                const mode = EventDelegator.getData(this, 'param');
                setDateMode(mode);
            });
            eventDelegator.on('[data-action="showUploadOverlay"]', 'click', showUploadOverlay);
            eventDelegator.on('[data-action="handleLogout"]', 'click', handleLogout);
            eventDelegator.on('[data-action="toggleHelpModal"]', 'click', toggleHelpModal);
            eventDelegator.on('[data-action="openKeyboardShortcutsModal"]', 'click', openKeyboardShortcutsModal);
            eventDelegator.on('[data-action="toggleNotifications"]', 'click', toggleNotifications);
            eventDelegator.on('[data-action="showNotificationSettings"]', 'click', showNotificationSettings);
            eventDelegator.on('[data-action="showNotificationHistory"]', 'click', showNotificationHistory);
            eventDelegator.on('[data-action="showReportHistory"]', 'click', showReportHistory);
            eventDelegator.on('[data-action="showDelayedOrders"]', 'click', showDelayedOrders);
            eventDelegator.on('[data-action="toggleInsightsHelp"]', 'click', toggleInsightsHelp);
            eventDelegator.on('[data-action="showOTDDetail"]', 'click', showOTDDetail);
            eventDelegator.on('[data-action="showRevenueRiskDetail"]', 'click', showRevenueRiskDetail);
            eventDelegator.on('[data-action="showAQLDetail"]', 'click', showAQLDetail);
            eventDelegator.on('[data-action="showBottleneckDetail"]', 'click', showBottleneckDetail);
            eventDelegator.on('[data-action="clickElement"]', 'click', function(e) {
                const targetId = EventDelegator.getData(this, 'targetId');
                document.getElementById(targetId).click();
            });
            eventDelegator.on('[data-action="showOrderDetail"]', 'click', function(e) {
                const vendor = EventDelegator.getData(this, 'vendor');
                showOrderDetail(vendor);
            });
            eventDelegator.on('[data-action="resetAndCloseMobileFilters"]', 'click', function(e) {
                resetAllFilters();
                closeMobileFilters();
            });
            eventDelegator.on('[data-action="loadFilterPresetAndClose"]', 'click', function(e) {
                const presetName = EventDelegator.getData(this, 'presetName');
                loadFilterPreset(presetName);
                document.getElementById('presetModal').remove();
            });
            eventDelegator.on('[data-action="removeModal"]', 'click', function(e) {
                const modalId = EventDelegator.getData(this, 'modalId');
                document.getElementById(modalId).remove();
            });
            eventDelegator.on('[data-action="showCalendarDayDetail"]', 'click', function(e) {
                const year = parseInt(EventDelegator.getData(this, 'year'));
                const month = parseInt(EventDelegator.getData(this, 'month'));
                const day = parseInt(EventDelegator.getData(this, 'day'));
                showCalendarDayDetail(year, month, day);
            });
            eventDelegator.on('[data-action="showOrderProcessDetail"]', 'click', function(e) {
                const index = parseInt(EventDelegator.getData(this, 'index'));
                showOrderProcessDetail(index);
            });
            eventDelegator.on('[data-action="closeAndShowOrderDetail"]', 'click', function(e) {
                const index = parseInt(EventDelegator.getData(this, 'index'));
                closeOrderModal();
                showOrderProcessDetail(index);
            });
            eventDelegator.on('[data-action="exportToExcelAndClose"]', 'click', function(e) {
                exportToExcel();
                document.getElementById('exportModal').remove();
            });
            eventDelegator.on('[data-action="exportToExcelMultiSheetAndClose"]', 'click', function(e) {
                const sheetType = EventDelegator.getData(this, 'sheetType');
                exportToExcelMultiSheet(sheetType);
                document.getElementById('exportModal').remove();
            });
            eventDelegator.on('[data-action="closeModalAndShowColumnSelection"]', 'click', function(e) {
                const modalId = EventDelegator.getData(this, 'modalId');
                document.getElementById(modalId).remove();
                showColumnSelection();
            });
            eventDelegator.on('[data-action="exportToCSVAndClose"]', 'click', function(e) {
                exportToCSV();
                document.getElementById('exportModal').remove();
            });
            eventDelegator.on('[data-action="exportToPDFAndClose"]', 'click', function(e) {
                exportToPDF();
                document.getElementById('exportModal').remove();
            });
            eventDelegator.on('[data-action="closeInfoModal"]', 'click', closeInfoModal);
            eventDelegator.on('[data-action="showExportOptions"]', 'click', showExportOptions);
            eventDelegator.on('[data-action="generateDailyReport"]', 'click', generateDailyReport);
            eventDelegator.on('[data-action="showAnomalyReport"]', 'click', showAnomalyReport);
            eventDelegator.on('[data-action="showAnalyticsInsights"]', 'click', showAnalyticsInsights);

            log.info('âœ… V01: Event delegation system initialized');

            // Agent Q03: ì‚¬ìš©ì ì„¤ì • ë³µì›
            restoreSettings();

            // Agent Q02: í•„í„° ë¡œì§ ë³µì› (Phase 4 - Q02-2)
            restoreFilterLogic();

            // Agent Q04: ì•Œë¦¼ ì•„ì´ì½˜ ìƒíƒœ ë³µì› ë° ëª¨ë‹ˆí„°ë§ ì‹œì‘
            const notifSettings = settings.get('notifications');
            if (notifSettings.enabled && Notification.permission === 'granted') {
                document.getElementById('notificationIcon').textContent = 'ğŸ””';
                startNotificationMonitor();
            }

            // Agent Q06: í„°ì¹˜ ì œìŠ¤ì²˜ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
            initTouchGestures();

            // Agent Q06: ëª¨ë‹¬ ë“œë˜ê·¸ ì œìŠ¤ì²˜ ì´ˆê¸°í™”
            initModalDragGestures();

            // Agent Q07: ì§€ì—° ë¡œë”© ì´ˆê¸°í™” (Phase 4 - Q07-4)
            initLazyChartLoading();

            // Agent Q04: ìë™ ìƒˆë¡œê³ ì¹¨ ì´ˆê¸°í™” (Phase 4 - Q04-4)
            const autoRefreshCheckbox = document.getElementById('autoRefreshToggle');
            addManagedEventListener(autoRefreshCheckbox, 'change', toggleAutoRefresh);
            // ì²´í¬ë°•ìŠ¤ê°€ ê¸°ë³¸ì ìœ¼ë¡œ ì²´í¬ë˜ì–´ ìˆìœ¼ë©´ ìë™ ì‹œì‘
            if (autoRefreshCheckbox.checked) {
                startAutoRefresh();
            }

            // Phase 5-2: ì™¸ë¶€ ë°ì´í„° ìë™ ë¡œë“œ (ë°ì´í„° ì™¸ë¶€í™”)
            if (typeof EMBEDDED_DATA !== 'undefined' && EMBEDDED_DATA && EMBEDDED_DATA.length > 0) {
                // ì™¸ë¶€ ë°ì´í„° íŒŒì¼ì´ ë¡œë“œë˜ì—ˆìœ¼ë©´ ìë™ ì´ˆê¸°í™”
                log.info(`ğŸš€ Phase 5-2: Loading ${formatNumber(EMBEDDED_DATA.length)} records from external data file`);
                allData = EMBEDDED_DATA;
                initApp();

                // ì˜¤ë²„ë ˆì´ ëª¨ë‘ ìˆ¨ê¸°ê¸°
                document.getElementById('loginOverlay').classList.add('hidden');
                document.getElementById('uploadOverlay').classList.add('hidden');

                showNotification(`âœ… ${formatNumber(allData.length)}ê±´ ë°ì´í„° ìë™ ë¡œë“œ ì™„ë£Œ (ì™¸ë¶€ íŒŒì¼)`, 'success');
            } else {
                // ì™¸ë¶€ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ íŒŒì¼ ì—…ë¡œë“œ ëª¨ë“œ
                log.warn('âš ï¸ External data not found. Falling back to file upload mode.');

                // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
                if (isLoggedIn()) {
                    document.getElementById('loginOverlay').classList.add('hidden');
                    document.getElementById('uploadOverlay').classList.remove('hidden');
                }
            }

            // Agent Q07: ë¡œê·¸ì¸ í¼ ì´ë²¤íŠ¸ (ê´€ë¦¬í˜• ë¦¬ìŠ¤ë„ˆ)
            addManagedEventListener(document.getElementById('loginForm'), 'submit', async (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value;
                const errorDiv = document.getElementById('loginError');

                const isValid = await verifyLogin(username, password);

                if (isValid) {
                    errorDiv.classList.add('hidden');
                    handleLogin();
                } else {
                    errorDiv.classList.remove('hidden');
                    document.getElementById('password').value = '';
                    document.getElementById('password').focus();
                }
            });

            // Agent Q06: ê°€ë¡œ/ì„¸ë¡œ ëª¨ë“œ ìµœì í™” ì´ˆê¸°í™” (Phase 4 - Q06-6)
            initOrientationOptimization();

            // Agent Q09: í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì‹œìŠ¤í…œ ì´ˆê¸°í™” (Phase 4 - Q09-3)
            initKeyboardShortcuts();

            // Agent Q04: ì•Œë¦¼ ë°°ì§€ ì´ˆê¸°í™” (Phase 4 - Q04-6)
            updateNotificationBadge();

            setupFileUpload();
        });

        // íŒŒì¼ ì—…ë¡œë“œ ì„¤ì •
        function setupFileUpload() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');

            // Agent Q07: ê´€ë¦¬í˜• ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì‚¬ìš© (ìë™ ì •ë¦¬)

            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
            addManagedEventListener(dropZone, 'dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('border-blue-400', 'bg-white/30');
            });

            addManagedEventListener(dropZone, 'dragleave', (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-blue-400', 'bg-white/30');
            });

            addManagedEventListener(dropZone, 'drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-blue-400', 'bg-white/30');
                const files = Array.from(e.dataTransfer.files).filter(f =>
                    f.name.endsWith('.xlsx') || f.name.endsWith('.xls')
                );
                if (files.length > 0) {
                    handleMultipleFileUpload(files);
                }
            });

            // í´ë¦­ìœ¼ë¡œ íŒŒì¼ ì„ íƒ
            addManagedEventListener(dropZone, 'click', (e) => {
                if (e.target.tagName !== 'BUTTON' && e.target.tagName !== 'INPUT') {
                    fileInput.click();
                }
            });

            // íŒŒì¼ ì…ë ¥ ë³€ê²½
            addManagedEventListener(fileInput, 'change', (e) => {
                if (e.target.files.length > 0) {
                    handleMultipleFileUpload(Array.from(e.target.files));
                }
            });

            log.debug('File upload listeners setup (managed)');
        }

        // ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleMultipleFileUpload(files) {
            const uploadContent = document.getElementById('uploadContent');
            const uploadLoading = document.getElementById('uploadLoading');
            const fileListDiv = document.getElementById('fileList');

            // íŒŒì¼ ê²€ì¦ (Agent #R05: Security)
            const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB
            const ALLOWED_TYPES = [
                'application/vnd.ms-excel',
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                ''  // Some browsers don't set type for .xlsx
            ];

            const invalidFiles = files.filter(f => {
                if (f.size > MAX_FILE_SIZE) {
                    alert(`íŒŒì¼ í¬ê¸° ì´ˆê³¼: ${f.name} (${(f.size/1024/1024).toFixed(1)}MB > 50MB)`);
                    return true;
                }
                if (f.type && !ALLOWED_TYPES.includes(f.type) && !f.name.match(/\.(xlsx?|xls)$/i)) {
                    alert(`ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹: ${f.name}`);
                    return true;
                }
                return false;
            });

            if (invalidFiles.length > 0) {
                return; // ê²€ì¦ ì‹¤íŒ¨
            }

            // íŒŒì¼ ëª©ë¡ í‘œì‹œ
            fileListDiv.innerHTML = files.map((f, i) =>
                `<div class="flex items-center gap-2 text-blue-200 text-sm py-1">
                    <span id="fileStatus${i}" class="text-yellow-400">â³</span>
                    <span>${escapeHtml(f.name)}</span>
                    <span class="text-blue-400/60 text-xs">(${(f.size / 1024).toFixed(1)} KB)</span>
                </div>`
            ).join('');
            fileListDiv.classList.remove('hidden');

            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            uploadLoading.querySelector('p')?.remove();
            const loadingText = document.createElement('p');
            loadingText.className = 'text-blue-200 mt-4';
            loadingText.textContent = `0 / ${files.length} íŒŒì¼ ì²˜ë¦¬ ì¤‘...`;
            uploadLoading.appendChild(loadingText);

            uploadContent.classList.add('hidden');
            uploadLoading.classList.remove('hidden');

            let allParsedData = [];
            let processedCount = 0;
            let successCount = 0;
            let errorFiles = [];

            // ê° íŒŒì¼ì„ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬
            function processNextFile(index) {
                if (index >= files.length) {
                    // ëª¨ë“  íŒŒì¼ ì²˜ë¦¬ ì™„ë£Œ
                    finishMultipleUpload(allParsedData, successCount, errorFiles, files.length);
                    return;
                }

                const file = files[index];
                const reader = new FileReader();

                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const parsedData = parseBALWorkbook(workbook, file.name);

                        if (parsedData.length > 0) {
                            allParsedData = allParsedData.concat(parsedData);
                            successCount++;
                            document.getElementById(`fileStatus${index}`).textContent = 'âœ…';
                            document.getElementById(`fileStatus${index}`).className = 'text-green-400';
                        } else {
                            errorFiles.push(file.name + ' (ë°ì´í„° ì—†ìŒ)');
                            document.getElementById(`fileStatus${index}`).textContent = 'âš ï¸';
                            document.getElementById(`fileStatus${index}`).className = 'text-yellow-400';
                        }
                    } catch (error) {
                        console.error(`íŒŒì¼ íŒŒì‹± ì˜¤ë¥˜ (${file.name}):`, error);
                        errorFiles.push(file.name);
                        document.getElementById(`fileStatus${index}`).textContent = 'âŒ';
                        document.getElementById(`fileStatus${index}`).className = 'text-red-400';
                    }

                    processedCount++;
                    loadingText.textContent = `${processedCount} / ${files.length} íŒŒì¼ ì²˜ë¦¬ ì¤‘...`;

                    // ë‹¤ìŒ íŒŒì¼ ì²˜ë¦¬
                    processNextFile(index + 1);
                };

                reader.onerror = function() {
                    errorFiles.push(file.name + ' (ì½ê¸° ì˜¤ë¥˜)');
                    document.getElementById(`fileStatus${index}`).textContent = 'âŒ';
                    document.getElementById(`fileStatus${index}`).className = 'text-red-400';
                    processedCount++;
                    loadingText.textContent = `${processedCount} / ${files.length} íŒŒì¼ ì²˜ë¦¬ ì¤‘...`;
                    processNextFile(index + 1);
                };

                reader.readAsArrayBuffer(file);
            }

            // ì²« ë²ˆì§¸ íŒŒì¼ë¶€í„° ì‹œì‘
            processNextFile(0);
        }

        // ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ ì²˜ë¦¬
        function finishMultipleUpload(parsedData, successCount, errorFiles, totalFiles) {
            const uploadContent = document.getElementById('uploadContent');
            const uploadLoading = document.getElementById('uploadLoading');
            const fileListDiv = document.getElementById('fileList');

            if (parsedData.length === 0) {
                showNotification('âŒ íŒŒì‹±ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. BAL íŒŒì¼ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                uploadContent.classList.remove('hidden');
                uploadLoading.classList.add('hidden');
                fileListDiv.classList.add('hidden');
                return;
            }

            allData = parsedData;
            initApp();

            // ì—…ë¡œë“œ ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
            document.getElementById('uploadOverlay').classList.add('hidden');

            // ê²°ê³¼ ì•Œë¦¼
            let message = `âœ… ${successCount}ê°œ íŒŒì¼ì—ì„œ ${formatNumber(allData.length)}ê±´ ë°ì´í„° ë¡œë“œ ì™„ë£Œ`;
            if (errorFiles.length > 0) {
                message += ` (${errorFiles.length}ê°œ íŒŒì¼ ì˜¤ë¥˜)`;
            }
            showNotification(message, errorFiles.length > 0 ? 'warning' : 'success');

            // íŒŒì¼ ëª©ë¡ ì´ˆê¸°í™”
            fileListDiv.innerHTML = '';
            fileListDiv.classList.add('hidden');
        }

        // BAL ì›Œí¬ë¶ íŒŒì‹±
        function parseBALWorkbook(workbook, fileName) {
            const result = [];

            // ê³µì¥ëª… ì¶”ì¶œ (íŒŒì¼ëª…ì—ì„œ)
            let factory = 'Unknown';
            const factoryMatch = fileName.match(/RG[-_]?([A-D])/i);
            if (factoryMatch) {
                factory = 'RG-' + factoryMatch[1].toUpperCase();
            }

            // ê° ì‹œíŠ¸ ì²˜ë¦¬
            workbook.SheetNames.forEach(sheetName => {
                const sheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                if (jsonData.length < 2) return;

                // í—¤ë” í–‰ ì°¾ê¸° (PO, ARTICLE, ART, SALES ORDER, MODEL, UNIT ë“±ìœ¼ë¡œ ì‹ë³„)
                let headerRow = 0;
                for (let i = 0; i < Math.min(10, jsonData.length); i++) {
                    const row = jsonData[i];
                    if (row && row.some(cell => {
                        const cellStr = String(cell || '').toUpperCase();
                        return cellStr.includes('PO') || cellStr.includes('ARTICLE') ||
                               cellStr === 'ART' || cellStr.includes('SALES ORDER') ||
                               cellStr.includes('MODEL') || cellStr === 'UNIT';
                    })) {
                        headerRow = i;
                        break;
                    }
                }

                const headers = jsonData[headerRow].map(h => String(h || '').toUpperCase().trim());

                // ì„œë¸Œ í—¤ë” í–‰ í™•ì¸ (Original, Current ê°™ì€ ì¶”ê°€ í—¤ë”ê°€ ìˆëŠ” ê²½ìš°)
                let dataStartRow = headerRow + 1;
                if (jsonData[dataStartRow]) {
                    const nextRow = jsonData[dataStartRow];
                    const nextRowStr = nextRow.map(c => String(c || '').toUpperCase().trim());
                    // ì„œë¸Œ í—¤ë” ê°ì§€: Original, Current, ë˜ëŠ” ëŒ€ë¶€ë¶„ ë¹ˆ ì…€
                    if (nextRowStr.includes('ORIGINAL') || nextRowStr.includes('CURRENT') ||
                        nextRow.filter(c => c !== null && c !== undefined && String(c).trim() !== '').length < 3) {
                        dataStartRow = headerRow + 2;
                    }
                }

                // ì•ˆì „í•œ findIndex í—¬í¼ í•¨ìˆ˜
                const safeFind = (predicate) => headers.findIndex(h => h && predicate(h));

                // ì»¬ëŸ¼ ì¸ë±ìŠ¤ ì°¾ê¸° (ìƒˆ Loadplan í˜•ì‹ + ê¸°ì¡´ BAL í˜•ì‹ ëª¨ë‘ ì§€ì›)
                const colIndex = {
                    po: safeFind(h => (h.includes('PO') && (h.includes('#') || h.includes('NO'))) || h.includes('SALES ORDER') || (h.includes('ORDER') && h.includes('ITEM'))),
                    article: safeFind(h => h.includes('ARTICLE') || h === 'ART'),
                    model: safeFind(h => h.includes('MODEL') || h.includes('STYLE')),
                    qty: safeFind(h => h === 'QTY' || h.includes('Q.TY') || h.includes('QUANTITY')),
                    crd: safeFind(h => h === 'CRD' || h.includes('REQUIRED')),
                    sdd: safeFind(h => h === 'SDD' || (h.includes('DELIVERY') && !h.includes('SDD'))),
                    dest: safeFind(h => h.includes('DEST') || h.includes('COUNTRY')),
                    vendor: safeFind(h => h.includes('VENDOR') || (h.includes('OSC') && h.includes('VD'))),
                    // ê³µì •ë³„ ì»¬ëŸ¼
                    s_cut: safeFind(h => h.includes('S_CUT') || (h.includes('CUT') && !h.includes('OUT'))),
                    pre_sew: safeFind(h => h.includes('PRE') && h.includes('SEW')),
                    sew_input: safeFind(h => h.includes('SEW') && h.includes('INPUT')),
                    sew_bal: safeFind(h => (h.includes('SEW') && h.includes('BAL')) || h === 'SEWING'),
                    osc: safeFind(h => h.includes('OSC') && !h.includes('VD') && !h.includes('MATERIAL')),
                    ass_bal: safeFind(h => (h.includes('ASS') && h.includes('BAL')) || h.includes('ASSEMBLY')),
                    wh_in: safeFind(h => h.includes('WH') && h.includes('IN') && !h.includes('MAIN')),
                    wh_out: safeFind(h => (h.includes('WH') && h.includes('OUT')) || (h.includes('SHIP') && !h.includes('SDD'))),
                    // ìƒˆ í˜•ì‹ ì¶”ê°€ ì»¬ëŸ¼
                    unit: safeFind(h => h === 'UNIT'),
                    color: safeFind(h => h.includes('COLOR')),
                    prodStatus: safeFind(h => h.includes('PRODUCTION') && h.includes('STATUS')),
                    warehouse: safeFind(h => h === 'WAREHOUSE')
                };

                console.log('Parsing sheet:', sheetName, 'Headers:', headers.slice(0, 20));
                console.log('Column indices:', colIndex);
                console.log('Data starts at row:', dataStartRow);

                // ë°ì´í„° í–‰ íŒŒì‹±
                for (let i = dataStartRow; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    if (!row || row.length === 0) continue;

                    const poNumber = colIndex.po >= 0 ? String(row[colIndex.po] || '') : '';
                    if (!poNumber || poNumber.trim() === '') continue;

                    const qty = colIndex.qty >= 0 ? parseFloat(row[colIndex.qty]) || 0 : 0;
                    if (qty <= 0) continue;

                    const record = {
                        factory: factory,
                        poNumber: poNumber.trim(),
                        article: colIndex.article >= 0 ? String(row[colIndex.article] || '') : '',
                        model: colIndex.model >= 0 ? String(row[colIndex.model] || '') : '',
                        quantity: qty,
                        crd: parseExcelDate(colIndex.crd >= 0 ? row[colIndex.crd] : null),
                        sddValue: parseExcelDate(colIndex.sdd >= 0 ? row[colIndex.sdd] : null),
                        destination: colIndex.dest >= 0 ? String(row[colIndex.dest] || '') : '',
                        outsoleVendor: colIndex.vendor >= 0 ? String(row[colIndex.vendor] || '') : '',
                        production: {
                            s_cut: parseProcessCell(colIndex.s_cut >= 0 ? row[colIndex.s_cut] : null, qty),
                            pre_sew: parseProcessCell(colIndex.pre_sew >= 0 ? row[colIndex.pre_sew] : null, qty),
                            sew_input: parseProcessCell(colIndex.sew_input >= 0 ? row[colIndex.sew_input] : null, qty),
                            sew_bal: parseProcessCell(colIndex.sew_bal >= 0 ? row[colIndex.sew_bal] : null, qty),
                            osc: parseProcessCell(colIndex.osc >= 0 ? row[colIndex.osc] : null, qty),
                            ass_bal: parseProcessCell(colIndex.ass_bal >= 0 ? row[colIndex.ass_bal] : null, qty),
                            wh_in: parseProcessCell(colIndex.wh_in >= 0 ? row[colIndex.wh_in] : null, qty),
                            wh_out: parseProcessCell(colIndex.wh_out >= 0 ? row[colIndex.wh_out] : null, qty)
                        }
                    };

                    // ì§€ì—°/ê²½ê³  ìƒíƒœ ê³„ì‚°
                    record.isDelayed = calculateIsDelayed(record);
                    record.isWarning = calculateIsWarning(record);

                    result.push(record);
                }
            });

            return result;
        }

        // ì—‘ì…€ ë‚ ì§œ íŒŒì‹±
        function parseExcelDate(value) {
            if (!value) return '';

            // ì´ë¯¸ ë¬¸ìì—´ ë‚ ì§œ í˜•ì‹ì¸ ê²½ìš°
            if (typeof value === 'string') {
                const parsed = new Date(value);
                if (!isNaN(parsed.getTime())) {
                    return parsed.toISOString().split('T')[0];
                }
                return value;
            }

            // ì—‘ì…€ ì‹œë¦¬ì–¼ ë‚ ì§œì¸ ê²½ìš°
            if (typeof value === 'number') {
                const date = new Date((value - 25569) * 86400 * 1000);
                return date.toISOString().split('T')[0];
            }

            return '';
        }

        // ê³µì • ì…€ íŒŒì‹±
        function parseProcessCell(value, qty) {
            const completed = parseFloat(value) || 0;
            const pending = Math.max(0, qty - completed);
            let status = 'pending';
            if (completed >= qty) status = 'completed';
            else if (completed > 0) status = 'partial';

            return { completed, pending, status };
        }

        // ì§€ì—° ì—¬ë¶€ ê³„ì‚°
        function calculateIsDelayed(record) {
            if (record.code04) return false;
            if (!record.sddValue || !record.crd) return false;

            const sdd = new Date(record.sddValue);
            const crd = new Date(record.crd);
            return sdd > crd;
        }

        // ê²½ê³  ì—¬ë¶€ ê³„ì‚°
        function calculateIsWarning(record) {
            if (record.isDelayed) return false;
            if (!record.sddValue) return false;

            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const sdd = new Date(record.sddValue);
            const diffDays = (sdd - today) / (1000 * 60 * 60 * 24);

            return diffDays >= 0 && diffDays <= 3;
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-[100] px-6 py-3 rounded-xl shadow-lg text-white font-medium transition-all transform translate-x-0 ${
                type === 'success' ? 'bg-green-500' :
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ì—…ë¡œë“œ ì˜¤ë²„ë ˆì´ ë‹¤ì‹œ í‘œì‹œ (íŒŒì¼ ë³€ê²½)
        function showUploadOverlay() {
            const uploadContent = document.getElementById('uploadContent');
            const uploadLoading = document.getElementById('uploadLoading');
            const uploadOverlay = document.getElementById('uploadOverlay');

            // UI ìƒíƒœ ì´ˆê¸°í™”
            uploadContent.classList.remove('hidden');
            uploadLoading.classList.add('hidden');

            // ì˜¤ë²„ë ˆì´ í‘œì‹œ
            uploadOverlay.classList.remove('hidden');
        }

        function initApp() {
            if (allData.length === 0) {
                document.getElementById('loadingOverlay').innerHTML = '<div class="text-center"><p class="text-red-500">ë°ì´í„° ì—†ìŒ</p></div>';
                return;
            }

            // remaining ì”ëŸ‰ ë°ì´í„° ê³„ì‚°
            allData.forEach(d => {
                const qty = d.quantity || 0;
                const prod = d.production || {};

                // ê° ê³µì •ë³„ ì”ëŸ‰ ê³„ì‚° (ì£¼ë¬¸ëŸ‰ - ì™„ë£ŒëŸ‰)
                d.remaining = {
                    osc: Math.max(0, qty - (prod.osc?.completed || 0)),
                    sew: Math.max(0, qty - (prod.sew?.completed || 0)),
                    ass: Math.max(0, qty - (prod.ass?.completed || 0)),
                    whIn: Math.max(0, qty - (prod.wh_in?.completed || 0)),
                    whOut: Math.max(0, qty - (prod.wh_out?.completed || 0))
                };
            });

            populateFilters();
            setupEventListeners();
            applyFilters();
            document.getElementById('loadingOverlay').classList.add('hidden');
            document.getElementById('lastUpdateTime').textContent = new Date().toLocaleString('ko-KR');
        }

        // Date mode functions
        function setDateMode(mode) {
            dateMode = mode;
            document.querySelectorAll('.date-mode-btn').forEach(btn => {
                const isActive = btn.dataset.mode === mode;
                btn.classList.toggle('active', isActive);
                // Agent Q09: aria-pressed ì—…ë°ì´íŠ¸
                btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');
            });
            const label = mode === 'sdd' ? 'SDD' : 'CRD (ê³ ê°ìš”ì²­ì¼)';
            document.getElementById('dateModeLabel').textContent = label;
            document.getElementById('calendarLabel').textContent = `(${mode.toUpperCase()} ê¸°ì¤€)`;
            document.getElementById('monthFilterLabel').textContent = `ì›” (${mode.toUpperCase()})`;
            document.getElementById('dateRangeLabel').textContent = `ğŸ“… ë‚ ì§œ ë²”ìœ„ (${mode.toUpperCase()})`;
            populateFilters();
            applyFilters();
        }

        // ë‚ ì§œ ë²”ìœ„ ì´ˆê¸°í™”
        function clearDateRange() {
            document.getElementById('startDateFilter').value = '';
            document.getElementById('endDateFilter').value = '';
            applyFilters();
        }

        // ì›” í•„í„° ë³€ê²½ ì‹œ â†’ ë‚ ì§œ ë²”ìœ„ ì´ˆê¸°í™”
        function onMonthFilterChange() {
            const month = document.getElementById('monthFilter').value;
            if (month) {
                document.getElementById('startDateFilter').value = '';
                document.getElementById('endDateFilter').value = '';
            }
            applyFilters();
        }

        // ë‚ ì§œ ë²”ìœ„ ë³€ê²½ ì‹œ â†’ ì›” í•„í„° ì´ˆê¸°í™”
        function onDateRangeChange() {
            const startDate = document.getElementById('startDateFilter').value;
            const endDate = document.getElementById('endDateFilter').value;
            if (startDate || endDate) {
                document.getElementById('monthFilter').value = '';
            }
            applyFilters();
        }

        function getDateValue(d) {
            return dateMode === 'sdd' ? d.sddValue : (d.crd || d.sddValue);
        }

        function getYearMonth(d) {
            return dateMode === 'sdd' ? d.sddYearMonth : (d.crdYearMonth || d.sddYearMonth);
        }

        function populateFilters() {
            const yearMonthKey = dateMode === 'sdd' ? 'sddYearMonth' : 'crdYearMonth';
            const months = [...new Set(allData.map(d => d[yearMonthKey] || d.sddYearMonth).filter(Boolean))].sort();
            document.getElementById('monthFilter').innerHTML = '<option value="">ì „ì²´</option>' + months.map(m => `<option value="${m}">${m}</option>`).join('');

            const destinations = [...new Set(allData.map(d => d.destination).filter(Boolean))].sort();
            const destSelect = document.getElementById('destFilter');
            destSelect.innerHTML = '<option value="">ì „ì²´</option><option value="asia">ì¤‘ìš” í–‰ì„ ì§€ë§Œ</option>' + destinations.map(d => `<option value="${d}">${d}</option>`).join('');

            const vendors = [...new Set(allData.map(d => d.outsoleVendor).filter(Boolean))].sort();
            document.getElementById('vendorFilter').innerHTML = '<option value="">ì „ì²´</option>' + vendors.map(v => `<option value="${v}">${v}</option>`).join('');
        }

        function setupEventListeners() {
            // Agent Q07: ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ê´€ë¦¬í˜• ì‹œìŠ¤í…œìœ¼ë¡œ ë“±ë¡

            // Filters
            ['monthFilter', 'quickDateFilter', 'destFilter', 'vendorFilter', 'statusFilter'].forEach(id => {
                addManagedEventListener(document.getElementById(id), 'change', applyFilters);
            });
            addManagedEventListener(document.getElementById('searchInput'), 'input', debounce(applyFilters, 300));

            // Factory chips (Agent Q09: aria-pressed ì—…ë°ì´íŠ¸)
            document.querySelectorAll('#factoryFilter .filter-chip').forEach(chip => {
                addManagedEventListener(chip, 'click', () => {
                    document.querySelectorAll('#factoryFilter .filter-chip').forEach(c => {
                        c.classList.remove('active');
                        c.setAttribute('aria-pressed', 'false');  // Q09-2
                    });
                    chip.classList.add('active');
                    chip.setAttribute('aria-pressed', 'true');  // Q09-2
                    applyFilters();
                });
            });

            // Tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                addManagedEventListener(btn, 'click', async () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active'));
                    btn.classList.add('tab-active');
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                    document.getElementById(btn.dataset.tab + 'Tab').classList.remove('hidden');

                    // Agent Q03: ê¸°ë³¸ íƒ­ ì„¤ì • ì €ì¥
                    settings.set('defaultTab', btn.dataset.tab);

                    // QMS íƒ­ ì„ íƒ ì‹œ ì´ˆê¸°í™”
                    if (btn.dataset.tab === 'qms') {
                        try {
                            await initQMS();
                            // ì²« ë²ˆì§¸ ì„œë¸Œíƒ­(íƒ€ê²Ÿë“±ë¡) ë°ì´í„° ë¡œë“œ
                            await loadQMSTabData('targets');
                        } catch (err) {
                            log.error('QMS initialization failed', err);
                            showToast('QMS ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                        }
                    }
                });
            });

            // Sort headers
            document.querySelectorAll('.sort-header').forEach(header => {
                addManagedEventListener(header, 'click', () => handleSort(header));
            });

            // Keyboard shortcuts
            addManagedEventListener(document, 'keydown', handleKeyboard);

            log.info('Event listeners setup complete (all managed)');
        }

        // Sort functionality
        function handleSort(header) {
            const sortKey = header.dataset.sort;
            const table = header.dataset.table;

            if (!sortState[table]) sortState[table] = { key: null, dir: 'asc' };

            if (sortState[table].key === sortKey) {
                sortState[table].dir = sortState[table].dir === 'asc' ? 'desc' : 'asc';
            } else {
                sortState[table].key = sortKey;
                sortState[table].dir = 'asc';
            }

            // ì ‘ê·¼ì„±: aria-sort ì—…ë°ì´íŠ¸
            document.querySelectorAll(`[data-table="${table}"]`).forEach(h => {
                h.setAttribute('aria-sort', 'none');
            });
            header.setAttribute('aria-sort', sortState[table].dir === 'asc' ? 'ascending' : 'descending');

            // Update header classes
            document.querySelectorAll(`[data-table="${table}"]`).forEach(h => {
                h.classList.remove('asc', 'desc');
            });
            header.classList.add(sortState[table].dir);

            // Re-render the appropriate table
            updateTabs();
        }

        function sortData(data, table) {
            if (!sortState[table] || !sortState[table].key) return data;

            const key = sortState[table].key;
            const dir = sortState[table].dir === 'asc' ? 1 : -1;

            return [...data].sort((a, b) => {
                let valA = a[key] || a[1]?.[key] || 0;
                let valB = b[key] || b[1]?.[key] || 0;

                if (typeof valA === 'string') {
                    return dir * valA.localeCompare(valB);
                }
                return dir * (valA - valB);
            });
        }

        // Date parsing cache for performance
        const dateParseCache = new Map();
        function parseDate(dateStr) {
            if (!dateStr || dateStr === '00:00:00') return null;
            if (dateParseCache.has(dateStr)) return dateParseCache.get(dateStr);

            try {
                const parsed = new Date(dateStr.replace(/\./g, '-'));
                if (dateParseCache.size > 1000) dateParseCache.clear(); // Prevent memory leak
                dateParseCache.set(dateStr, parsed);
                return parsed;
            } catch (e) {
                return null;
            }
        }

        // Filter functions
        function isDelayed(d) {
            // Ground Truth: ì§€ì—° = SDD > CRD (ì¶œê³ ì˜ˆì •ì¼ì´ ê³ ê°ìš”êµ¬ì¼ë³´ë‹¤ ëŠ¦ìŒ)
            const sdd = d.sddValue;
            const crd = d.crd;
            if (!sdd || !crd || sdd === '00:00:00' || crd === '00:00:00') return false;

            // ì´ë¯¸ ì¶œê³  ì™„ë£Œëœ ê²½ìš° ì§€ì—° ì•„ë‹˜
            const whOutCompleted = d.production?.wh_out?.completed || 0;
            const qty = d.quantity || 0;
            if (whOutCompleted >= qty) return false;

            // Code04 ìŠ¹ì¸ ìˆëŠ” ê²½ìš° ì§€ì—° ì•„ë‹˜ (ê³µì‹ ìŠ¹ì¸ëœ SDD ë³€ê²½)
            if (d.code04) return false;

            const sddDate = parseDate(sdd);
            const crdDate = parseDate(crd);
            if (!sddDate || !crdDate) return false;

            return sddDate > crdDate;  // SDDê°€ CRDë³´ë‹¤ ëŠ¦ìœ¼ë©´ ì§€ì—°
        }

        function isWarning(d) {
            // Warning: ì•„ì§ ì§€ì—°ì€ ì•„ë‹ˆì§€ë§Œ SDDê°€ CRDì— ê·¼ì ‘ (3ì¼ ì´ë‚´ ì°¨ì´)
            const sdd = d.sddValue;
            const crd = d.crd;
            if (!sdd || !crd || sdd === '00:00:00' || crd === '00:00:00') return false;

            // ì´ë¯¸ ì¶œê³  ì™„ë£Œëœ ê²½ìš° ê²½ê³  ì•„ë‹˜
            const whOutCompleted = d.production?.wh_out?.completed || 0;
            const qty = d.quantity || 0;
            if (whOutCompleted >= qty) return false;

            // ì´ë¯¸ ì§€ì—°ì¸ ê²½ìš° ê²½ê³  ì•„ë‹˜
            if (isDelayed(d)) return false;

            const sddDate = parseDate(sdd);
            const crdDate = parseDate(crd);
            if (!sddDate || !crdDate) return false;

            const diffDays = (crdDate - sddDate) / (1000 * 60 * 60 * 24);
            return diffDays >= 0 && diffDays <= 3;  // CRDì™€ SDD ì°¨ì´ê°€ 3ì¼ ì´ë‚´
        }

        // Agent Q04: ê¸´ê¸‰ ì˜¤ë” (CRDê°€ 3ì¼ ì´ë‚´) - Phase 4 - Q04-5
        function isCritical(d) {
            // Critical: CRDê°€ ì˜¤ëŠ˜ë¡œë¶€í„° 3ì¼ ì´ë‚´
            const crd = d.crd;
            if (!crd || crd === '00:00:00') return false;

            // ì´ë¯¸ ì¶œê³  ì™„ë£Œëœ ê²½ìš° ê¸´ê¸‰ ì•„ë‹˜
            const whOutCompleted = d.production?.wh_out?.completed || 0;
            const qty = d.quantity || 0;
            if (whOutCompleted >= qty) return false;

            // ì´ë¯¸ ì§€ì—°ì¸ ê²½ìš° ê¸´ê¸‰ ì•„ë‹˜ (ì§€ì—°ì´ ë” ì‹¬ê°)
            if (isDelayed(d)) return false;

            const today = new Date();
            const crdDate = parseDate(crd);
            if (!crdDate) return false;

            const diffDays = (crdDate - today) / (1000 * 60 * 60 * 24);
            return diffDays >= 0 && diffDays <= 3;  // ì˜¤ëŠ˜ë¡œë¶€í„° 3ì¼ ì´ë‚´
        }

        // ì„ ì  ì™„ë£Œ ì—¬ë¶€ (ì°½ê³ ì¶œê³  ì™„ë£Œ)
        function isShipped(d) {
            const whOutCompleted = d.production?.wh_out?.completed || 0;
            const qty = d.quantity || 0;
            return qty > 0 && whOutCompleted >= qty;
        }

        function isToday(d) {
            const dateVal = getDateValue(d);
            if (!dateVal || dateVal === '00:00:00') return false;
            try {
                const targetDate = new Date(dateVal.replace(/\./g, '-'));
                const today = new Date();
                return targetDate.toDateString() === today.toDateString();
            } catch (e) { console.warn("Date parsing error:", e); return false; }
        }

        // Agent P01: ì´ˆëŒ€í˜• í•¨ìˆ˜ ë¶„í•  - í•„í„° í—¬í¼ í•¨ìˆ˜ë“¤
        function matchesDateRange(d, rangeFilter, mode) {
            if (rangeFilter === 'all') return true;
            const dateField = mode === 'sdd' ? d.sddValue : d.crd;
            if (!dateField || dateField === '00:00:00') return true;

            const targetDate = new Date(dateField.replace(/\./g, '-'));
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            let maxDate = new Date(today);
            if (rangeFilter === 'week') {
                maxDate.setDate(maxDate.getDate() + 7);
            } else if (rangeFilter === 'month') {
                maxDate.setMonth(maxDate.getMonth() + 1);
            }

            return targetDate <= maxDate;
        }

        function matchesCustomDateRange(d, startDate, endDate, mode) {
            if (!startDate && !endDate) return true;

            const dateField = mode === 'sdd' ? d.sddValue : d.crd;
            if (!dateField || dateField === '00:00:00') return false;

            try {
                const targetDate = new Date(dateField.replace(/\./g, '-'));
                targetDate.setHours(0, 0, 0, 0);

                if (startDate) {
                    const start = new Date(startDate);
                    start.setHours(0, 0, 0, 0);
                    if (targetDate < start) return false;
                }
                if (endDate) {
                    const end = new Date(endDate);
                    end.setHours(23, 59, 59, 999);
                    if (targetDate > end) return false;
                }
                return true;
            } catch (e) {
                log.warn('Date range filter parsing error:', e);
                return false;
            }
        }

        function matchesBasicFilters(d, month, dest, vendor, factory) {
            const yearMonth = getYearMonth(d);
            if (month && yearMonth !== month) return false;
            if (dest === 'asia' && !IMPORTANT_DESTINATIONS[d.destination]) return false;
            if (dest && dest !== 'asia' && d.destination !== dest) return false;
            if (vendor && d.outsoleVendor !== vendor) return false;
            if (factory && d.factory !== factory) return false;
            return true;
        }

        function matchesStatusFilter(d, status) {
            if (!status) return true;
            if (status === 'shipped' && !isShipped(d)) return false;
            const s = d.production?.wh_in?.status;
            if (status === 'completed' && s !== 'completed') return false;
            if (status === 'partial' && s !== 'partial') return false;
            if (status === 'pending' && s !== 'pending') return false;
            return true;
        }

        function matchesQuickFilter(d, quick) {
            if (!quick) return true;
            if (quick === 'delayed' && !isDelayed(d)) return false;
            if (quick === 'warning' && !isWarning(d)) return false;
            if (quick === 'today' && !isToday(d)) return false;
            if (quick === 'week' && !isWithinWeek(d)) return false;
            if (quick === 'month' && !isCurrentMonth(d)) return false;
            return true;
        }

        function matchesSearch(d, search) {
            if (!search) return true;
            const searchFields = [d.model, d.destination, d.outsoleVendor, d.poNumber, d.factory, d.article].join(' ').toLowerCase();
            return searchFields.includes(search);
        }

        // Agent Q02: ìˆ˜ëŸ‰ ë²”ìœ„ í•„í„° (Phase 4 - Q02-3)
        function matchesQuantityRange(d, minQty, maxQty) {
            const qty = d.quantity || 0;
            if (minQty && qty < minQty) return false;
            if (maxQty && qty > maxQty) return false;
            return true;
        }

        // ========================================
        // Agent Q02: í•„í„° ë¡œì§ ì œì–´ (Phase 4 - Q02-2)
        // ========================================

        function setFilterLogic(logic) {
            if (logic !== 'AND' && logic !== 'OR') {
                log.error(`Invalid filter logic: ${logic}`);
                return;
            }

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('filterLogicAND').classList.remove('filter-logic-active');
            document.getElementById('filterLogicOR').classList.remove('filter-logic-active');
            document.getElementById(`filterLogic${logic}`).classList.add('filter-logic-active');

            // aria-checked ì—…ë°ì´íŠ¸
            document.getElementById('filterLogicAND').setAttribute('aria-checked', logic === 'AND' ? 'true' : 'false');
            document.getElementById('filterLogicOR').setAttribute('aria-checked', logic === 'OR' ? 'true' : 'false');

            // tabindex ì—…ë°ì´íŠ¸
            document.getElementById('filterLogicAND').setAttribute('tabindex', logic === 'AND' ? '0' : '-1');
            document.getElementById('filterLogicOR').setAttribute('tabindex', logic === 'OR' ? '0' : '-1');

            // ì„¤ì • ì €ì¥
            settings.set('filterLogic', logic);

            // í•„í„° ì¬ì ìš©
            clearFilterCache();  // ìºì‹œ ë¬´íš¨í™”
            applyFilters();

            log.info(`Filter logic changed to: ${logic}`);
        }

        function restoreFilterLogic() {
            const logic = settings.get('filterLogic') || 'AND';

            // UI ë³µì› (applyFilters í˜¸ì¶œ ì—†ì´)
            document.getElementById('filterLogicAND').classList.remove('filter-logic-active');
            document.getElementById('filterLogicOR').classList.remove('filter-logic-active');
            document.getElementById(`filterLogic${logic}`).classList.add('filter-logic-active');

            // aria-checked ì—…ë°ì´íŠ¸
            document.getElementById('filterLogicAND').setAttribute('aria-checked', logic === 'AND' ? 'true' : 'false');
            document.getElementById('filterLogicOR').setAttribute('aria-checked', logic === 'OR' ? 'true' : 'false');

            // tabindex ì—…ë°ì´íŠ¸
            document.getElementById('filterLogicAND').setAttribute('tabindex', logic === 'AND' ? '0' : '-1');
            document.getElementById('filterLogicOR').setAttribute('tabindex', logic === 'OR' ? '0' : '-1');

            log.info(`Filter logic restored: ${logic}`);
        }

        function applyFilters() {
            const month = document.getElementById('monthFilter').value;
            const quick = document.getElementById('quickDateFilter').value;
            const dest = document.getElementById('destFilter').value;
            const vendor = document.getElementById('vendorFilter').value;
            const status = document.getElementById('statusFilter').value;
            const factory = document.querySelector('#factoryFilter .filter-chip.active')?.dataset.factory || '';
            const search = document.getElementById('searchInput').value.toLowerCase().trim();
            const startDate = document.getElementById('startDateFilter').value;
            const endDate = document.getElementById('endDateFilter').value;
            const minQuantity = parseInt(document.getElementById('minQuantityFilter').value) || 0;
            const maxQuantity = parseInt(document.getElementById('maxQuantityFilter').value) || 0;

            // ë‚ ì§œ ìœ íš¨ì„± ê²€ì¦
            if (startDate && endDate && startDate > endDate) {
                alert('âš ï¸ ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                document.getElementById('startDateFilter').value = '';
                return;
            }

            // Agent Q02: ìˆ˜ëŸ‰ ìœ íš¨ì„± ê²€ì¦ (Phase 4 - Q02-3)
            if (minQuantity && maxQuantity && minQuantity > maxQuantity) {
                alert('âš ï¸ ìµœì†Œ ìˆ˜ëŸ‰ì´ ìµœëŒ€ ìˆ˜ëŸ‰ë³´ë‹¤ í´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                document.getElementById('minQuantityFilter').value = '';
                return;
            }

            // V02: FilterCache ìºì‹œ í™•ì¸
            const filterState = {
                month: month,
                quick: quick,
                dest: dest,
                vendor: vendor,
                status: status,
                factory: factory,
                search: search,
                startDate: startDate,
                endDate: endDate,
                minQuantity: minQuantity,
                maxQuantity: maxQuantity,
                logic: settings.get('filterLogic') || 'AND'
            };
            const cacheKey = filterCache.generateKey(filterState);
            const cached = filterCache.get(cacheKey);
            if (cached) {
                log.debug('Filter cache hit:', filterCache.getStats());
                filteredData = cached;
                currentPage = 1;
                updateDashboard();
                return;
            }

            // Agent P01: ë¶„í• ëœ í•„í„° í•¨ìˆ˜ ì‚¬ìš© (114ì¤„ â†’ 35ì¤„)
            // Agent Q02: ìˆ˜ëŸ‰ ë²”ìœ„ í•„í„° ì¶”ê°€ (Phase 4 - Q02-3)
            // Agent Q02: AND/OR í•„í„° ë¡œì§ ì§€ì› (Phase 4 - Q02-2)
            const filterLogic = settings.get('filterLogic') || 'AND';

            if (filterLogic === 'AND') {
                // AND ë¡œì§: ëª¨ë“  í™œì„± ì¡°ê±´ì´ ì¶©ì¡±ë˜ì–´ì•¼ í•¨
                filteredData = allData.filter(d =>
                    matchesDateRange(d, dateRangeFilter, dateMode) &&
                    matchesCustomDateRange(d, startDate, endDate, dateMode) &&
                    matchesBasicFilters(d, month, dest, vendor, factory, dateMode) &&
                    matchesStatusFilter(d, status) &&
                    matchesQuickFilter(d, quick, dateMode) &&
                    matchesSearch(d, search) &&
                    matchesQuantityRange(d, minQuantity, maxQuantity)
                );
            } else {
                // OR ë¡œì§: ìµœì†Œ í•˜ë‚˜ì˜ í™œì„± ì¡°ê±´ì´ ì¶©ì¡±ë˜ë©´ ë¨
                filteredData = allData.filter(d => {
                    // í™œì„± í•„í„°ì˜ ê²°ê³¼ë§Œ ìˆ˜ì§‘
                    const filterResults = [];

                    if (quick) filterResults.push(matchesQuickFilter(d, quick, dateMode));
                    if (month || dest || vendor || factory) filterResults.push(matchesBasicFilters(d, month, dest, vendor, factory, dateMode));
                    if (status) filterResults.push(matchesStatusFilter(d, status));
                    if (search) filterResults.push(matchesSearch(d, search));
                    if (startDate || endDate) filterResults.push(matchesCustomDateRange(d, startDate, endDate, dateMode));
                    if (minQuantity || maxQuantity) filterResults.push(matchesQuantityRange(d, minQuantity, maxQuantity));

                    // í™œì„± í•„í„°ê°€ ì—†ìœ¼ë©´ ëª¨ë“  ë°ì´í„° í¬í•¨
                    if (filterResults.length === 0) return true;

                    // OR: ìµœì†Œ í•˜ë‚˜ì˜ ì¡°ê±´ì´ trueë©´ ë¨
                    return filterResults.some(result => result);
                });
            }

            // V02: FilterCache ê²°ê³¼ ìºì‹±
            filterCache.set(cacheKey, filteredData);
            log.debug('Filter result cached:', filterCache.getStats());

            // Agent Q02: í•„í„° íˆìŠ¤í† ë¦¬ ì €ì¥ (Phase 4 - Q02-5, Q02-3)
            const filterState = { month, destination: dest, vendor, status, search, factory, minQuantity, maxQuantity };
            settings.saveFilterHistory(filterState);

            currentPage = 1;
            updateDashboard();
        }

        function resetAllFilters() {
            clearFilterCache(); // Clear cache when filters are reset
            document.getElementById('monthFilter').value = '';
            document.getElementById('quickDateFilter').value = '';
            document.getElementById('destFilter').value = '';
            document.getElementById('vendorFilter').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('searchInput').value = '';
            document.getElementById('startDateFilter').value = '';
            document.getElementById('endDateFilter').value = '';
            document.getElementById('minQuantityFilter').value = '';  // Agent Q02: Phase 4 - Q02-3
            document.getElementById('maxQuantityFilter').value = '';  // Agent Q02: Phase 4 - Q02-3
            // Agent Q09: aria-pressed ì—…ë°ì´íŠ¸
            document.querySelectorAll('#factoryFilter .filter-chip').forEach(c => {
                c.classList.remove('active');
                c.setAttribute('aria-pressed', 'false');  // Q09-2
            });
            const allChip = document.querySelector('#factoryFilter .filter-chip[data-factory=""]');
            allChip.classList.add('active');
            allChip.setAttribute('aria-pressed', 'true');  // Q09-2
            applyFilters();
        }

        // Agent Q02: ìˆ˜ëŸ‰ ë²”ìœ„ ì´ˆê¸°í™” (Phase 4 - Q02-3)
        function clearQuantityRange() {
            document.getElementById('minQuantityFilter').value = '';
            document.getElementById('maxQuantityFilter').value = '';
            applyFilters();
            log.info('Quantity range cleared');
        }

        // ========================================
        // Agent Q03 + Q02: í•„í„° í”„ë¦¬ì…‹ ì‹œìŠ¤í…œ
        // Phase 4 - Step 5: Q03-6, Q02-1 (HIGH)
        // ========================================

        // í˜„ì¬ í•„í„° ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
        function getCurrentFilterState() {
            return {
                month: document.getElementById('monthFilter').value,
                quick: document.getElementById('quickDateFilter').value,
                dest: document.getElementById('destFilter').value,
                vendor: document.getElementById('vendorFilter').value,
                status: document.getElementById('statusFilter').value,
                factory: document.querySelector('#factoryFilter .filter-chip.active')?.dataset.factory || '',
                search: document.getElementById('searchInput').value,
                startDate: document.getElementById('startDateFilter').value,
                endDate: document.getElementById('endDateFilter').value,
                minQuantity: document.getElementById('minQuantityFilter').value,  // Agent Q02: Q02-3
                maxQuantity: document.getElementById('maxQuantityFilter').value,  // Agent Q02: Q02-3
                dateMode: dateMode
            };
        }

        // í•„í„° ìƒíƒœ ì ìš©í•˜ê¸°
        function applyFilterState(state) {
            if (!state) return;

            document.getElementById('monthFilter').value = state.month || '';
            document.getElementById('quickDateFilter').value = state.quick || '';
            document.getElementById('destFilter').value = state.dest || '';
            document.getElementById('vendorFilter').value = state.vendor || '';
            document.getElementById('statusFilter').value = state.status || '';
            document.getElementById('searchInput').value = state.search || '';
            document.getElementById('startDateFilter').value = state.startDate || '';
            document.getElementById('endDateFilter').value = state.endDate || '';
            document.getElementById('minQuantityFilter').value = state.minQuantity || '';  // Agent Q02: Q02-3
            document.getElementById('maxQuantityFilter').value = state.maxQuantity || '';  // Agent Q02: Q02-3

            // ê³µì¥ í•„í„° ì¹© ì—…ë°ì´íŠ¸ (Agent Q09: aria-pressed)
            document.querySelectorAll('#factoryFilter .filter-chip').forEach(c => {
                c.classList.remove('active');
                c.setAttribute('aria-pressed', 'false');  // Q09-2
                if (c.dataset.factory === (state.factory || '')) {
                    c.classList.add('active');
                    c.setAttribute('aria-pressed', 'true');  // Q09-2
                }
            });

            applyFilters();
        }

        // í˜„ì¬ í•„í„°ë¥¼ í”„ë¦¬ì…‹ìœ¼ë¡œ ì €ì¥
        function saveCurrentFilterAsPreset() {
            const filterState = getCurrentFilterState();

            // ë¹ˆ í•„í„°ëŠ” ì €ì¥í•˜ì§€ ì•ŠìŒ
            const hasFilters = filterState.month || filterState.quick || filterState.dest ||
                              filterState.vendor || filterState.status || filterState.factory ||
                              filterState.search || filterState.startDate || filterState.endDate;

            if (!hasFilters) {
                alert('âš ï¸ ì €ì¥í•  í•„í„°ê°€ ì—†ìŠµë‹ˆë‹¤. í•„í„°ë¥¼ ì„¤ì •í•œ í›„ ì €ì¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // í”„ë¦¬ì…‹ ì´ë¦„ ì…ë ¥
            const name = prompt('ğŸ“‹ í•„í„° í”„ë¦¬ì…‹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:\n\nì˜ˆ: "ì§€ì—° ì˜¤ë”", "ì´ë²ˆ ë‹¬ Netherlands"');
            if (!name || !name.trim()) {
                return;  // ì·¨ì†Œ ë˜ëŠ” ë¹ˆ ì´ë¦„
            }

            // ì €ì¥
            const success = settings.saveFilterPreset(name.trim(), filterState);
            if (success) {
                alert(`âœ… í•„í„° í”„ë¦¬ì…‹ "${name.trim()}"ì´(ê°€) ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                log.info('Filter preset saved:', name.trim());
            } else {
                alert('âŒ í•„í„° í”„ë¦¬ì…‹ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í”„ë¦¬ì…‹ ëª©ë¡ í‘œì‹œ
        function showFilterPresets() {
            const presets = settings.listFilterPresets();

            if (presets.length === 0) {
                alert('ğŸ“‹ ì €ì¥ëœ í•„í„° í”„ë¦¬ì…‹ì´ ì—†ìŠµë‹ˆë‹¤.\n\n"ğŸ’¾ ì €ì¥" ë²„íŠ¼ì„ ëˆŒëŸ¬ í˜„ì¬ í•„í„°ë¥¼ í”„ë¦¬ì…‹ìœ¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            // í”„ë¦¬ì…‹ ëª©ë¡ HTML ìƒì„±
            let html = `
                <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" id="presetModal">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                        <h3 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">ğŸ“‹ í•„í„° í”„ë¦¬ì…‹</h3>
                        <div class="space-y-2 mb-4">
            `;

            presets.forEach(preset => {
                const filters = preset.filters;
                const filterDesc = [];
                if (filters.month) filterDesc.push(`ì›”: ${filters.month}`);
                if (filters.quick) filterDesc.push(`ë¹ ë¥¸ì„ íƒ: ${filters.quick}`);
                if (filters.dest) filterDesc.push(`í–‰ì„ ì§€: ${filters.dest}`);
                if (filters.vendor) filterDesc.push(`ë²¤ë”: ${filters.vendor}`);
                if (filters.status) filterDesc.push(`ìƒíƒœ: ${filters.status}`);
                if (filters.factory) filterDesc.push(`ê³µì¥: ${filters.factory}`);
                if (filters.search) filterDesc.push(`ê²€ìƒ‰: ${filters.search}`);
                const descText = filterDesc.length > 0 ? filterDesc.join(', ') : '(í•„í„° ì—†ìŒ)';

                html += `
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <div class="flex-1">
                            <div class="font-medium text-gray-900 dark:text-white">${escapeHtml(preset.name)}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">${escapeHtml(descText)}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-500 mt-1">
                                ìƒì„±: ${new Date(preset.created).toLocaleDateString('ko-KR')} |
                                ë§ˆì§€ë§‰ ì‚¬ìš©: ${new Date(preset.lastUsed).toLocaleDateString('ko-KR')}
                            </div>
                        </div>
                        <div class="flex gap-2 ml-4">
                            <button data-action="loadFilterPresetAndClose" data-preset-name="${escapeHtml(preset.name)}"
                                class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                ì ìš©
                            </button>
                            <button data-action="deleteFilterPresetConfirm" data-param="${escapeHtml(preset.name)}"
                                class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                                ì‚­ì œ
                            </button>
                        </div>
                    </div>
                `;
            });

            html += `
                        </div>
                        <button data-action="removeModal" data-modal-id="presetModal"
                            class="w-full bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white px-4 py-2 rounded-lg font-medium">
                            ë‹«ê¸°
                        </button>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', html);
        }

        // í”„ë¦¬ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadFilterPreset(name) {
            const filterState = settings.loadFilterPreset(name);
            if (filterState) {
                applyFilterState(filterState);
                log.info('Filter preset loaded:', name);
            } else {
                alert(`âŒ í”„ë¦¬ì…‹ "${name}"ì„(ë¥¼) ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
            }
        }

        // í”„ë¦¬ì…‹ ì‚­ì œ í™•ì¸
        function deleteFilterPresetConfirm(name) {
            if (confirm(`ğŸ—‘ï¸ í•„í„° í”„ë¦¬ì…‹ "${name}"ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                const success = settings.deleteFilterPreset(name);
                if (success) {
                    log.info('Filter preset deleted:', name);
                    // ëª¨ë‹¬ ìƒˆë¡œê³ ì¹¨
                    document.getElementById('presetModal')?.remove();
                    showFilterPresets();
                } else {
                    alert('âŒ í”„ë¦¬ì…‹ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        // ========================================
        // Agent Q03: ì»¬ëŸ¼ ì„¤ì • ëª¨ë‹¬ í•¨ìˆ˜
        // Phase 4 - Step 5: Q03-5 (MEDIUM)
        // ========================================

        function showColumnSettings() {
            const columns = settings.getAllColumnVisibility();

            // í˜„ì¬ ì„¤ì •ìœ¼ë¡œ ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            Object.keys(COLUMN_MAPPING).forEach(index => {
                const columnName = COLUMN_MAPPING[index];
                const checkbox = document.getElementById(`col_${columnName}`);
                if (checkbox) {
                    checkbox.checked = columns[columnName] !== false;
                }
            });

            document.getElementById('columnSettingsModal').classList.remove('hidden');
            log.info('Column settings modal opened');
        }

        function closeColumnSettings() {
            document.getElementById('columnSettingsModal').classList.add('hidden');
            log.info('Column settings modal closed');
        }

        function toggleColumnPreview(columnName) {
            // ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° (ì„ íƒì‚¬í•­)
            const checkbox = document.getElementById(`col_${columnName}`);
            if (checkbox) {
                log.debug(`Column "${columnName}" preview toggled: ${checkbox.checked}`);
            }
        }

        function saveColumnSettings() {
            const newSettings = {};

            Object.keys(COLUMN_MAPPING).forEach(index => {
                const columnName = COLUMN_MAPPING[index];
                const checkbox = document.getElementById(`col_${columnName}`);
                if (checkbox) {
                    newSettings[columnName] = checkbox.checked;
                }
            });

            settings.setAllColumnVisibility(newSettings);
            applyColumnVisibility();
            closeColumnSettings();
            log.info('Column settings saved and applied');
        }

        // ========================================
        // Agent Q04: ì•Œë¦¼ ì„¤ì • ëª¨ë‹¬ í•¨ìˆ˜
        // Phase 4 - Step 5: Q04-5 (MEDIUM)
        // ========================================

        function showNotificationSettings() {
            const notifSettings = settings.get('notifications') || {};

            // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            document.getElementById('notif_enabled').checked = notifSettings.enabled || false;
            document.getElementById('notif_delayed').checked = notifSettings.delayedOrders !== false;
            document.getElementById('notif_warning').checked = notifSettings.warningOrders || false;
            document.getElementById('notif_critical').checked = notifSettings.criticalOrders || false;

            // ì²´í¬ ì£¼ê¸° ì´ˆê¸°í™”
            const interval = notifSettings.checkInterval || 300000;
            const intervalMinutes = interval / 60000;
            document.getElementById('notif_interval').value = intervalMinutes.toString();

            // ìŒì†Œê±° ì‹œê°„ ì´ˆê¸°í™”
            document.getElementById('notif_quiet_start').value = notifSettings.quietHoursStart || '';
            document.getElementById('notif_quiet_end').value = notifSettings.quietHoursEnd || '';

            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('notificationSettingsModal').classList.remove('hidden');
            updateNotificationPreview();
            log.info('Notification settings modal opened');
        }

        function closeNotificationSettings() {
            document.getElementById('notificationSettingsModal').classList.add('hidden');
            log.info('Notification settings modal closed');
        }

        function updateNotificationPreview() {
            const enabled = document.getElementById('notif_enabled').checked;
            const delayed = document.getElementById('notif_delayed').checked;
            const warning = document.getElementById('notif_warning').checked;
            const critical = document.getElementById('notif_critical').checked;
            const intervalMin = document.getElementById('notif_interval').value;
            const quietStart = document.getElementById('notif_quiet_start').value;
            const quietEnd = document.getElementById('notif_quiet_end').value;

            let preview = '';

            if (!enabled) {
                preview = 'âŒ ì•Œë¦¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.';
            } else {
                const types = [];
                if (delayed) types.push('ì§€ì—° ì˜¤ë”');
                if (warning) types.push('ê²½ê³  ì˜¤ë”');
                if (critical) types.push('ê¸´ê¸‰ ì˜¤ë”');

                if (types.length === 0) {
                    preview = 'âš ï¸ ì•Œë¦¼ ìœ í˜•ì„ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.';
                } else {
                    preview = `âœ… ${types.join(', ')} ì•Œë¦¼ì´ ${intervalMin}ë¶„ë§ˆë‹¤ ì²´í¬ë©ë‹ˆë‹¤.`;

                    if (quietStart && quietEnd) {
                        preview += `\nğŸ”• ${quietStart} ~ ${quietEnd} ì‹œê°„ëŒ€ëŠ” ìŒì†Œê±°ë©ë‹ˆë‹¤.`;
                    }
                }
            }

            document.getElementById('notif_preview').textContent = preview;
        }

        async function saveNotificationSettings() {
            const enabled = document.getElementById('notif_enabled').checked;

            // ì•Œë¦¼ í™œì„±í™” ì‹œ ê¶Œí•œ ì²´í¬
            if (enabled) {
                if (!('Notification' in window)) {
                    alert('âš ï¸ ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    return;
                }

                if (Notification.permission === 'denied') {
                    alert('âš ï¸ ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì•Œë¦¼ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (Notification.permission !== 'granted') {
                    const permission = await Notification.requestPermission();
                    if (permission !== 'granted') {
                        alert('âš ï¸ ì•Œë¦¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');
                        return;
                    }
                }
            }

            // ì„¤ì • ì €ì¥
            const intervalMin = parseInt(document.getElementById('notif_interval').value) || 5;
            const newSettings = {
                enabled: enabled,
                delayedOrders: document.getElementById('notif_delayed').checked,
                warningOrders: document.getElementById('notif_warning').checked,
                criticalOrders: document.getElementById('notif_critical').checked,
                checkInterval: intervalMin * 60000,  // ë¶„ â†’ ë°€ë¦¬ì´ˆ
                quietHoursStart: document.getElementById('notif_quiet_start').value,
                quietHoursEnd: document.getElementById('notif_quiet_end').value
            };

            settings.set('notifications', newSettings);

            // ì•Œë¦¼ ëª¨ë‹ˆí„°ë§ ì¬ì‹œì‘
            if (enabled) {
                startNotificationMonitor();
                // í…ŒìŠ¤íŠ¸ ì•Œë¦¼
                new Notification('ğŸ”” Rachgia ëŒ€ì‹œë³´ë“œ', {
                    body: 'ì•Œë¦¼ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!',
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">âœ…</text></svg>',
                    tag: 'rachgia-settings-saved'
                });
            } else {
                // ì•Œë¦¼ ë¹„í™œì„±í™” ì‹œ ì¸í„°ë²Œ ì •ë¦¬
                if (notificationCheckInterval) {
                    clearInterval(notificationCheckInterval);
                    notificationCheckInterval = null;
                }
            }

            closeNotificationSettings();
            log.info('Notification settings saved:', newSettings);
        }

        // ========================================
        // Agent Q01: ì»¬ëŸ¼ ì„ íƒ ëª¨ë‹¬ í•¨ìˆ˜
        // Phase 4 - Step 5: Q01-3 (MEDIUM)
        // ========================================

        function showColumnSelection() {
            // í˜„ì¬ ì„¤ì •ëœ ì»¬ëŸ¼ ì„ íƒ ìƒíƒœ ë³µì›
            const exportCols = settings.get('exportColumns') || {};

            // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            document.getElementById('col_factory').checked = exportCols.factory !== false;
            document.getElementById('col_poNumber').checked = exportCols.poNumber !== false;
            document.getElementById('col_model').checked = exportCols.model !== false;
            document.getElementById('col_article').checked = exportCols.article !== false;
            document.getElementById('col_destination').checked = exportCols.destination !== false;
            document.getElementById('col_outsoleVendor').checked = exportCols.outsoleVendor !== false;
            document.getElementById('col_quantity').checked = exportCols.quantity !== false;
            document.getElementById('col_crd').checked = exportCols.crd !== false;
            document.getElementById('col_sdd').checked = exportCols.sdd !== false;
            document.getElementById('col_cutting').checked = exportCols.cutting !== false;
            document.getElementById('col_sewing').checked = exportCols.sewing !== false;
            document.getElementById('col_assembly').checked = exportCols.assembly !== false;
            document.getElementById('col_warehouseIn').checked = exportCols.warehouseIn !== false;
            document.getElementById('col_status').checked = exportCols.status !== false;
            document.getElementById('col_delayed').checked = exportCols.delayed !== false;
            document.getElementById('col_warning').checked = exportCols.warning !== false;

            // í”„ë¦¬ì…‹ ëª©ë¡ ë Œë”ë§
            renderColumnPresets();

            // ì„ íƒëœ ì»¬ëŸ¼ ìˆ˜ ì—…ë°ì´íŠ¸
            updateSelectedColumnCount();

            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('columnSelectionModal').classList.remove('hidden');
            log.info('Column selection modal opened');
        }

        function closeColumnSelection() {
            document.getElementById('columnSelectionModal').classList.add('hidden');
            log.info('Column selection modal closed');
        }

        function selectAllColumns() {
            document.querySelectorAll('.export-col-checkbox').forEach(cb => cb.checked = true);
            updateSelectedColumnCount();
            log.debug('All columns selected');
        }

        function deselectAllColumns() {
            document.querySelectorAll('.export-col-checkbox').forEach(cb => cb.checked = false);
            updateSelectedColumnCount();
            log.debug('All columns deselected');
        }

        function selectEssentialColumns() {
            // í•„ìˆ˜ ì»¬ëŸ¼ë§Œ ì„ íƒ (ê³µì¥, PO, ëª¨ë¸, í–‰ì„ ì§€, ìˆ˜ëŸ‰, CRD, SDD, ìƒíƒœ)
            const essential = ['col_factory', 'col_poNumber', 'col_model', 'col_destination', 'col_quantity', 'col_crd', 'col_sdd', 'col_status'];
            document.querySelectorAll('.export-col-checkbox').forEach(cb => {
                cb.checked = essential.includes(cb.id);
            });
            updateSelectedColumnCount();
            log.debug('Essential columns selected');
        }

        function updateSelectedColumnCount() {
            const total = 16;
            const selected = document.querySelectorAll('.export-col-checkbox:checked').length;
            document.getElementById('selectedColumnCount').textContent = selected;
        }

        // ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ ìë™ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.export-col-checkbox').forEach(cb => {
                cb.addEventListener('change', updateSelectedColumnCount);
            });
        });

        function applyColumnSelection() {
            // ì„ íƒëœ ì»¬ëŸ¼ ì €ì¥
            const exportCols = {
                factory: document.getElementById('col_factory').checked,
                poNumber: document.getElementById('col_poNumber').checked,
                model: document.getElementById('col_model').checked,
                article: document.getElementById('col_article').checked,
                destination: document.getElementById('col_destination').checked,
                outsoleVendor: document.getElementById('col_outsoleVendor').checked,
                quantity: document.getElementById('col_quantity').checked,
                crd: document.getElementById('col_crd').checked,
                sdd: document.getElementById('col_sdd').checked,
                cutting: document.getElementById('col_cutting').checked,
                sewing: document.getElementById('col_sewing').checked,
                assembly: document.getElementById('col_assembly').checked,
                warehouseIn: document.getElementById('col_warehouseIn').checked,
                status: document.getElementById('col_status').checked,
                delayed: document.getElementById('col_delayed').checked,
                warning: document.getElementById('col_warning').checked
            };

            settings.set('exportColumns', exportCols);
            closeColumnSelection();
            log.info('Export columns saved:', exportCols);
        }

        function saveColumnPreset() {
            const name = document.getElementById('presetName').value.trim();
            if (!name) {
                alert('âš ï¸ í”„ë¦¬ì…‹ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // í˜„ì¬ ì»¬ëŸ¼ ì„ íƒ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
            const exportCols = {
                factory: document.getElementById('col_factory').checked,
                poNumber: document.getElementById('col_poNumber').checked,
                model: document.getElementById('col_model').checked,
                article: document.getElementById('col_article').checked,
                destination: document.getElementById('col_destination').checked,
                outsoleVendor: document.getElementById('col_outsoleVendor').checked,
                quantity: document.getElementById('col_quantity').checked,
                crd: document.getElementById('col_crd').checked,
                sdd: document.getElementById('col_sdd').checked,
                cutting: document.getElementById('col_cutting').checked,
                sewing: document.getElementById('col_sewing').checked,
                assembly: document.getElementById('col_assembly').checked,
                warehouseIn: document.getElementById('col_warehouseIn').checked,
                status: document.getElementById('col_status').checked,
                delayed: document.getElementById('col_delayed').checked,
                warning: document.getElementById('col_warning').checked
            };

            // í”„ë¦¬ì…‹ ì €ì¥
            const presets = settings.get('exportColumnPresets') || {};
            presets[name] = {
                columns: exportCols,
                created: new Date().toISOString()
            };
            settings.set('exportColumnPresets', presets);

            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('presetName').value = '';

            // í”„ë¦¬ì…‹ ëª©ë¡ ì¬ë Œë”ë§
            renderColumnPresets();

            log.info(`Column preset "${name}" saved`);
        }

        function loadColumnPreset(name) {
            const presets = settings.get('exportColumnPresets') || {};
            const preset = presets[name];

            if (!preset) {
                alert('âš ï¸ í”„ë¦¬ì…‹ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const cols = preset.columns;

            // ì²´í¬ë°•ìŠ¤ ì„¤ì •
            document.getElementById('col_factory').checked = cols.factory !== false;
            document.getElementById('col_poNumber').checked = cols.poNumber !== false;
            document.getElementById('col_model').checked = cols.model !== false;
            document.getElementById('col_article').checked = cols.article !== false;
            document.getElementById('col_destination').checked = cols.destination !== false;
            document.getElementById('col_outsoleVendor').checked = cols.outsoleVendor !== false;
            document.getElementById('col_quantity').checked = cols.quantity !== false;
            document.getElementById('col_crd').checked = cols.crd !== false;
            document.getElementById('col_sdd').checked = cols.sdd !== false;
            document.getElementById('col_cutting').checked = cols.cutting !== false;
            document.getElementById('col_sewing').checked = cols.sewing !== false;
            document.getElementById('col_assembly').checked = cols.assembly !== false;
            document.getElementById('col_warehouseIn').checked = cols.warehouseIn !== false;
            document.getElementById('col_status').checked = cols.status !== false;
            document.getElementById('col_delayed').checked = cols.delayed !== false;
            document.getElementById('col_warning').checked = cols.warning !== false;

            updateSelectedColumnCount();
            log.info(`Column preset "${name}" loaded`);
        }

        function deleteColumnPreset(name) {
            if (!confirm(`"${name}" í”„ë¦¬ì…‹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }

            const presets = settings.get('exportColumnPresets') || {};
            delete presets[name];
            settings.set('exportColumnPresets', presets);

            renderColumnPresets();
            log.info(`Column preset "${name}" deleted`);
        }

        function renderColumnPresets() {
            const presets = settings.get('exportColumnPresets') || {};
            const presetList = document.getElementById('columnPresetList');

            if (Object.keys(presets).length === 0) {
                presetList.innerHTML = '<div class="text-xs text-gray-500 dark:text-gray-400">ì €ì¥ëœ í”„ë¦¬ì…‹ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            let html = '';
            for (const [name, preset] of Object.entries(presets)) {
                const selectedCount = Object.values(preset.columns).filter(v => v === true).length;
                html += `
                    <div class="flex items-center gap-2 bg-gray-50 dark:bg-gray-700 p-2 rounded">
                        <button data-action="loadColumnPreset" data-param="${escapeHtml(name)}" class="flex-1 text-left text-sm hover:text-blue-600 dark:hover:text-blue-400">
                            ğŸ’¾ ${escapeHtml(name)} (${selectedCount}ê°œ)
                        </button>
                        <button data-action="deleteColumnPreset" data-param="${escapeHtml(name)}" class="text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-sm">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                `;
            }
            presetList.innerHTML = html;
        }

        function updateDashboard() {
            updateWeeklySummary();
            updateSummary();
            updateAlerts();
            updateProcessFlow();
            updateFactoryCards();
            updateVendorSection();
            updateAsiaCards();
            updateCalendar();
            updateTabs();
            updateExecutiveInsights(); // ê²½ì˜ì§„ ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸
        }

        // ì›”ìš” ì˜¤ë” í˜„í™© ìš”ì•½ ì—…ë°ì´íŠ¸
        function updateWeeklySummary() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // SDD ê¸°ì¤€ ì§€ì—°/ê²½ê³  ê³„ì‚°
            let sddDelayed = 0, sddWarning = 0;
            // CRD ê¸°ì¤€ ì§€ì—°/ê²½ê³  ê³„ì‚° (CRD ëŒ€ë¹„ ì˜¤ëŠ˜ ë‚ ì§œ)
            let crdDelayed = 0, crdWarning = 0;
            // ì œí™” ìƒì‚° ì™„ë£Œ (sew_bal ì™„ë£Œ >= qty)
            let sewingComplete = 0;
            // ì°½ê³  ì¶œê³  ì™„ë£Œ (wh_out ì™„ë£Œ >= qty)
            let warehouseOut = 0;

            allData.forEach(d => {
                const qty = d.quantity || 0;
                const sewBalCompleted = d.production?.sew_bal?.completed || 0;
                const whOutCompleted = d.production?.wh_out?.completed || 0;
                const sdd = d.sddValue;
                const crd = d.crd;

                // ì œí™” ìƒì‚° ì™„ë£Œ (ì¬ë´‰ ì™„ë£ŒëŸ‰ >= ì£¼ë¬¸ëŸ‰)
                if (sewBalCompleted >= qty && qty > 0) {
                    sewingComplete++;
                }

                // ì°½ê³  ì¶œê³  ì™„ë£Œ (ì¶œê³ ëŸ‰ >= ì£¼ë¬¸ëŸ‰)
                if (whOutCompleted >= qty && qty > 0) {
                    warehouseOut++;
                }

                // ì•„ì§ ì¶œê³  ì•ˆ ëœ ì˜¤ë”ë§Œ ì§€ì—°/ê²½ê³  ì²´í¬
                if (whOutCompleted < qty) {
                    // SDD ê¸°ì¤€ (ê¸°ì¡´ isDelayed, isWarning ë¡œì§)
                    if (isDelayed(d)) {
                        sddDelayed++;
                    } else if (isWarning(d)) {
                        sddWarning++;
                    }

                    // CRD ê¸°ì¤€ (ì˜¤ëŠ˜ ë‚ ì§œì™€ CRD ë¹„êµ)
                    if (crd && crd !== '00:00:00') {
                        try {
                            const crdDate = new Date(crd.replace(/\./g, '-'));
                            crdDate.setHours(0, 0, 0, 0);
                            const diffDays = Math.floor((crdDate - today) / (1000 * 60 * 60 * 24));

                            if (diffDays < 0) {
                                // CRDê°€ ì´ë¯¸ ì§€ë‚¬ìŒ = ì§€ì—°
                                crdDelayed++;
                            } else if (diffDays <= 3) {
                                // CRDê°€ 3ì¼ ì´ë‚´ = ê²½ê³ 
                                crdWarning++;
                            }
                        } catch (e) { }
                    }
                }
            });

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('sddDelayCount').textContent = sddDelayed + 'ê±´';
            document.getElementById('sddWarningCount').textContent = sddWarning + 'ê±´';
            document.getElementById('crdDelayCount').textContent = crdDelayed + 'ê±´';
            document.getElementById('crdWarningCount').textContent = crdWarning + 'ê±´';
            document.getElementById('sewingCompleteCount').textContent = sewingComplete + 'ê±´';
            document.getElementById('warehouseOutCount').textContent = warehouseOut + 'ê±´';
            document.getElementById('summaryUpdateTime').textContent = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
        }

        function updateSummary() {
            const totalQty = filteredData.reduce((sum, d) => sum + (d.quantity || 0), 0);
            const totalCompleted = filteredData.reduce((sum, d) => sum + (d.production?.wh_in?.completed || 0), 0);
            const rate = totalQty > 0 ? (totalCompleted / totalQty * 100) : 0;

            document.getElementById('totalOrders').textContent = formatNumber(filteredData.length) + 'ê±´';
            document.getElementById('totalQty').textContent = formatNumber(totalQty) + 'ì¡±';
            document.getElementById('totalCompleted').textContent = formatNumber(totalCompleted) + 'ì¡±';
            document.getElementById('totalRate').textContent = rate.toFixed(1) + '%';
            document.getElementById('execCompletionRate').textContent = rate.toFixed(1) + '%';

            // Donut chart - using updateOrCreateChart for memory efficiency
            updateOrCreateChart('rateDonut', document.getElementById('rateDonut'), {
                type: 'doughnut',
                data: { datasets: [{ data: [rate, 100 - rate], backgroundColor: ['#8b5cf6', '#e5e7eb'], borderWidth: 0 }] },
                options: { cutout: '70%', plugins: { legend: { display: false } }, responsive: true, maintainAspectRatio: true }
            });

            // Executive summary
            const todayOrders = allData.filter(isToday);
            const todayQty = todayOrders.reduce((sum, d) => sum + (d.quantity || 0), 0);
            document.getElementById('execTodayCount').textContent = todayOrders.length + 'ê±´';
            document.getElementById('execTodayQty').textContent = formatNumber(todayQty) + 'ì¡±';

            // Factory ranking
            const factoryRates = ['A', 'B', 'C', 'D'].map(f => {
                const fData = filteredData.filter(d => d.factory === f);
                const fQty = fData.reduce((s, d) => s + (d.quantity || 0), 0);
                const fCompleted = fData.reduce((s, d) => s + (d.production?.wh_in?.completed || 0), 0);
                return { factory: f, rate: fQty > 0 ? (fCompleted / fQty * 100) : 0 };
            }).sort((a, b) => b.rate - a.rate);

            document.getElementById('execFactoryRanking').innerHTML = factoryRates.map((f, i) =>
                `<span class="mr-2">${i + 1}. Factory ${f.factory}: ${f.rate.toFixed(1)}%</span>`
            ).join('');

            // Warnings
            const delayed = allData.filter(isDelayed);
            const warnings = [];
            if (delayed.length > 0) warnings.push(`ğŸš¨ ì§€ì—° ${delayed.length}ê±´`);

            const bottleneck = findBottleneck();
            if (bottleneck && bottleneck.rate < 80) warnings.push(`ğŸ”´ ë³‘ëª©: ${PROCESS_NAMES[bottleneck.key]} (${bottleneck.rate.toFixed(1)}%)`);

            document.getElementById('execWarnings').innerHTML = warnings.length > 0 ? warnings.join(' | ') : 'âœ… ì •ìƒ';
        }

        function findBottleneck() {
            let minRate = 100, bottleneckKey = null;
            PROCESS_ORDER.forEach(key => {
                let completed = 0, total = 0;
                filteredData.forEach(d => {
                    const p = d.production?.[key];
                    if (p) {
                        completed += p.completed || 0;
                        total += (p.completed || 0) + (p.pending || 0);
                    }
                });
                const rate = total > 0 ? (completed / total * 100) : 100;
                if (rate < minRate) { minRate = rate; bottleneckKey = key; }
            });
            return { key: bottleneckKey, rate: minRate };
        }

        function updateAlerts() {
            const delayed = allData.filter(isDelayed);
            const warning = allData.filter(isWarning);
            const delayedQty = delayed.reduce((sum, d) => sum + (d.quantity || 0), 0);
            const warningQty = warning.reduce((sum, d) => sum + (d.quantity || 0), 0);

            document.getElementById('delayedOrderCount').textContent = delayed.length + 'ê±´';
            document.getElementById('delayedOrderQty').textContent = formatNumber(delayedQty) + 'ì¡±';
            document.getElementById('warningOrderCount').textContent = warning.length + 'ê±´';
            document.getElementById('warningOrderQty').textContent = formatNumber(warningQty) + 'ì¡±';
            document.getElementById('execDelayCount').textContent = delayed.length + 'ê±´';

            // Inventory
            let invQty = 0, invCount = 0;
            allData.forEach(d => {
                const diff = (d.production?.wh_in?.completed || 0) - (d.production?.wh_out?.completed || 0);
                if (diff > 0) { invQty += diff; invCount++; }
            });
            document.getElementById('inventoryCount').textContent = formatNumber(invQty) + 'ì¡±';
            document.getElementById('inventoryOrders').textContent = invCount + 'ê±´';
            document.getElementById('execInventory').textContent = formatNumber(invQty);
            document.getElementById('execInventoryOrders').textContent = invCount + 'ê±´';

            // Shipped orders (ì„ ì  ì™„ë£Œ)
            const shipped = allData.filter(isShipped);
            const shippedQty = shipped.reduce((sum, d) => sum + (d.quantity || 0), 0);
            document.getElementById('shippedOrderCount').textContent = shipped.length + 'ê±´';
            document.getElementById('shippedOrderQty').textContent = formatNumber(shippedQty) + 'ì¡±';

            // Show alert section (show if any alerts or shipped orders exist)
            document.getElementById('alertSection').classList.toggle('hidden', delayed.length === 0 && warning.length === 0 && shipped.length === 0);
            document.getElementById('delayAlert').classList.toggle('hidden', delayed.length === 0);
            document.getElementById('delayCount').textContent = delayed.length;
        }

        function updateProcessFlow() {
            const processData = {};
            let minRate = 100, bottleneckKey = null;

            PROCESS_ORDER.forEach(key => {
                processData[key] = { completed: 0, pending: 0 };
            });

            filteredData.forEach(d => {
                PROCESS_ORDER.forEach(key => {
                    const p = d.production?.[key];
                    if (p) {
                        processData[key].completed += p.completed || 0;
                        processData[key].pending += p.pending || 0;
                    }
                });
            });

            // Find bottleneck
            PROCESS_ORDER.forEach(key => {
                const data = processData[key];
                const total = data.completed + data.pending;
                const rate = total > 0 ? (data.completed / total * 100) : 100;
                if (rate < minRate) { minRate = rate; bottleneckKey = key; }
            });

            // Funnel chart
            document.getElementById('funnelChart').innerHTML = PROCESS_ORDER.map((key, i) => {
                const data = processData[key];
                const total = data.completed + data.pending;
                const rate = total > 0 ? (data.completed / total * 100) : 0;
                const width = 100 - (i * 2);
                const color = rate >= 80 ? '#22c55e' : rate >= 50 ? '#f59e0b' : '#ef4444';
                const isBottleneck = key === bottleneckKey && minRate < 80;

                return `<div class="funnel-step ${isBottleneck ? 'bottleneck' : ''}" style="background: linear-gradient(to right, ${color}40, ${color}20); width: ${width}%"
                    data-action="showProcessDetail" data-param="${key}" title="${PROCESS_NAMES[key]}: ${rate.toFixed(1)}%">
                    <div class="text-xs font-medium">${PROCESS_NAMES[key]}</div>
                    <div class="text-lg font-bold" style="color: ${color}">${rate.toFixed(0)}%</div>
                    <div class="text-xs text-secondary">${formatNumber(data.completed)}</div>
                    ${isBottleneck ? '<div class="text-xs text-red-500">ë³‘ëª©</div>' : ''}
                </div>`;
            }).join('');

            // Progress bars
            document.getElementById('processProgress').innerHTML = PROCESS_ORDER.map(key => {
                const data = processData[key];
                const total = data.completed + data.pending;
                const rate = total > 0 ? (data.completed / total * 100) : 0;
                const color = rate >= 80 ? '#22c55e' : rate >= 50 ? '#f59e0b' : '#ef4444';
                const isBottleneck = key === bottleneckKey && minRate < 80;

                return `<div class="flex items-center gap-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded ${isBottleneck ? 'ring-2 ring-red-500' : ''}" data-action="showProcessDetail" data-param="${key}">
                    <div class="w-16 text-sm font-medium">${PROCESS_NAMES[key]}${isBottleneck ? ' ğŸ”´' : ''}</div>
                    <div class="flex-1 progress-bar"><div class="progress-fill" style="width: ${rate}%; background: ${color};"></div></div>
                    <div class="w-24 text-right text-sm"><span class="font-medium" style="color: ${color}">${rate.toFixed(1)}%</span> <span class="text-secondary">(${formatNumber(data.completed)})</span></div>
                </div>`;
            }).join('');
        }

        function updateVendorSection() {
            const vendorData = {};
            let totalQty = 0;

            filteredData.forEach(d => {
                const v = d.outsoleVendor || '(ë¯¸ì§€ì •)';
                if (!vendorData[v]) vendorData[v] = { count: 0, qty: 0, completed: 0 };
                vendorData[v].count++;
                vendorData[v].qty += d.quantity || 0;
                vendorData[v].completed += d.production?.wh_in?.completed || 0;
                totalQty += d.quantity || 0;
            });

            const sorted = Object.entries(vendorData).sort((a, b) => b[1].qty - a[1].qty);
            const isDarkMode = document.documentElement.classList.contains('dark');

            // Chart - using updateOrCreateChart for memory efficiency
            updateOrCreateChart('vendor', document.getElementById('vendorChart'), {
                type: 'pie',
                data: {
                    labels: sorted.slice(0, 8).map(([v]) => v),
                    datasets: [{ data: sorted.slice(0, 8).map(([, d]) => d.qty), backgroundColor: ['#3b82f6', '#22c55e', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#14b8a6', '#64748b'] }]
                },
                options: { plugins: { legend: { position: 'right', labels: { color: isDarkMode ? '#fff' : '#333' } } }, responsive: true, maintainAspectRatio: false }
            });

            document.getElementById('vendorTableBody').innerHTML = sorted.slice(0, 10).map(([vendor, data]) => {
                const rate = data.qty > 0 ? (data.completed / data.qty * 100) : 0;
                return `<tr class="border-b border-theme hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer" data-action="showVendorDetail" data-param="${vendor}">
                    <td class="px-3 py-2 text-xs">${vendor}</td>
                    <td class="px-3 py-2 text-right">${formatNumber(data.count)}</td>
                    <td class="px-3 py-2 text-right">${formatNumber(data.qty)}</td>
                    <td class="px-3 py-2 text-right font-medium" style="color: ${rate >= 80 ? '#22c55e' : '#f59e0b'}">${rate.toFixed(1)}%</td>
                </tr>`;
            }).join('');
        }

        function updateFactoryCards() {
            const factoryData = { A: { count: 0, qty: 0, completed: 0 }, B: { count: 0, qty: 0, completed: 0 }, C: { count: 0, qty: 0, completed: 0 }, D: { count: 0, qty: 0, completed: 0 } };
            filteredData.forEach(d => {
                if (!factoryData[d.factory]) return;
                factoryData[d.factory].qty += d.quantity || 0;
                factoryData[d.factory].completed += d.production?.wh_in?.completed || 0;
                factoryData[d.factory].count++;
            });

            document.getElementById('factoryCards').innerHTML = ['A', 'B', 'C', 'D'].map(f => {
                const d = factoryData[f];
                const rate = d.qty > 0 ? (d.completed / d.qty * 100) : 0;
                const color = rate >= 80 ? '#22c55e' : rate >= 50 ? '#f59e0b' : '#ef4444';
                return `<div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" data-action="showFactoryDetail" data-param="${f}">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold">Factory ${f}</span>
                        <span class="text-sm font-medium" style="color: ${color}">${rate.toFixed(1)}%</span>
                    </div>
                    <div class="text-xs text-secondary mt-1">${formatNumber(d.count)}ê±´ Â· ${formatNumber(d.qty)}ì¡±</div>
                    <div class="progress-bar mt-2" style="height: 6px;"><div class="progress-fill" style="width: ${rate}%; background: ${color};"></div></div>
                </div>`;
            }).join('');

            // Radar chart
            const radarData = ['A', 'B', 'C', 'D'].map(f => {
                const fData = filteredData.filter(d => d.factory === f);
                const qty = fData.reduce((s, d) => s + (d.quantity || 0), 0);
                const completed = fData.reduce((s, d) => s + (d.production?.wh_in?.completed || 0), 0);
                return qty > 0 ? (completed / qty * 100) : 0;
            });

            const isDarkMode = document.documentElement.classList.contains('dark');
            // Factory radar chart - using updateOrCreateChart for memory efficiency
            updateOrCreateChart('factoryRadar', document.getElementById('factoryRadar'), {
                type: 'radar',
                data: {
                    labels: ['Factory A', 'Factory B', 'Factory C', 'Factory D'],
                    datasets: [{ label: 'ì™„ë£Œìœ¨', data: radarData, backgroundColor: 'rgba(59, 130, 246, 0.3)', borderColor: '#3b82f6' }]
                },
                options: { scales: { r: { min: 0, max: 100, ticks: { color: isDarkMode ? '#fff' : '#333' }, pointLabels: { color: isDarkMode ? '#fff' : '#333' } } }, plugins: { legend: { display: false } } }
            });
        }

        function updateAsiaCards() {
            const asiaData = {};
            const displayNames = { 'Japan': 'ì¼ë³¸', 'South Korea': 'í•œêµ­', 'China': 'ì¤‘êµ­', 'Taiwan': 'ëŒ€ë§Œ', 'India': 'ì¸ë„' };
            const displayOrder = ['Japan', 'South Korea', 'China', 'Taiwan', 'India'];

            displayOrder.forEach(c => { asiaData[c] = { qty: 0, completed: 0, count: 0 }; });

            filteredData.forEach(d => {
                let country = null;
                if (d.destination === 'Japan') country = 'Japan';
                else if (d.destination === 'South Korea' || d.destination === 'Korea') country = 'South Korea';
                else if (d.destination === 'China') country = 'China';
                else if (d.destination === 'Taiwan') country = 'Taiwan';
                else if (d.destination === 'India') country = 'India';

                if (country) {
                    asiaData[country].qty += d.quantity || 0;
                    asiaData[country].completed += d.production?.wh_in?.completed || 0;
                    asiaData[country].count++;
                }
            });

            document.getElementById('asiaCards').innerHTML = displayOrder.map(country => {
                const data = asiaData[country] || { qty: 0, completed: 0, count: 0 };
                const rate = data.qty > 0 ? (data.completed / data.qty * 100) : 0;
                const color = rate >= 80 ? '#22c55e' : rate >= 50 ? '#f59e0b' : '#ef4444';
                return `<div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-xl cursor-pointer hover:shadow-md transition" data-action="showCountryDetail" data-param="${country}">
                    <div class="text-2xl mb-1">${IMPORTANT_DESTINATIONS[country]}</div>
                    <div class="font-medium">${displayNames[country]}</div>
                    <div class="text-sm text-secondary">${formatNumber(data.qty)}ì¡± Â· ${data.count}ê±´</div>
                    <div class="progress-bar mt-2" style="height: 6px;"><div class="progress-fill" style="width: ${rate}%; background: ${color};"></div></div>
                    <div class="text-xs text-right mt-1" style="color: ${color}">${rate.toFixed(1)}%</div>
                </div>`;
            }).join('');
        }

        function updateCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            document.getElementById('calendarMonth').textContent = `${year}ë…„ ${month + 1}ì›”`;

            const calendarData = {};
            const today = new Date();

            allData.forEach(d => {
                const dateVal = getDateValue(d);
                if (!dateVal || dateVal === '00:00:00') return;
                try {
                    const targetDate = new Date(dateVal.replace(/\./g, '-'));
                    if (targetDate.getFullYear() === year && targetDate.getMonth() === month) {
                        const day = targetDate.getDate();
                        if (!calendarData[day]) calendarData[day] = { count: 0, qty: 0, delayed: 0, warning: 0 };
                        calendarData[day].count++;
                        calendarData[day].qty += d.quantity || 0;

                        const isComplete = (d.production?.wh_in?.completed || 0) >= (d.quantity || 0);
                        if (!isComplete) {
                            if (targetDate < today) calendarData[day].delayed++;
                            else {
                                const diff = (targetDate - today) / (1000 * 60 * 60 * 24);
                                if (diff <= 3) calendarData[day].warning++;
                            }
                        }
                    }
                } catch {}
            });

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];

            let html = dayNames.map(d => `<div class="text-center font-medium text-sm text-secondary py-2">${d}</div>`).join('');
            for (let i = 0; i < firstDay; i++) html += '<div></div>';

            for (let day = 1; day <= daysInMonth; day++) {
                const data = calendarData[day];
                const isCurrentDay = today.getFullYear() === year && today.getMonth() === month && today.getDate() === day;
                let dayClass = 'calendar-day';
                if (isCurrentDay) dayClass += ' today';
                if (data?.delayed > 0) dayClass += ' delayed';
                else if (data?.warning > 0) dayClass += ' warning';

                html += `<div class="${dayClass}" data-action="showCalendarDayDetail" data-year="${year}" data-month="${month}" data-day="${day}">
                    <div class="font-medium">${day}</div>
                    ${data ? `<div class="text-xs">${data.count}ê±´</div>` : ''}
                </div>`;
            }

            document.getElementById('shippingCalendar').innerHTML = html;
        }

        function prevMonth() { currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1); updateCalendar(); }
        function nextMonth() { currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1); updateCalendar(); }

        function showCalendarDayDetail(year, month, day) {
            const targetDate = new Date(year, month, day);
            const orders = allData.filter(d => {
                const dateVal = getDateValue(d);
                if (!dateVal || dateVal === '00:00:00') return false;
                try {
                    const dDate = new Date(dateVal.replace(/\./g, '-'));
                    return dDate.toDateString() === targetDate.toDateString();
                } catch (e) { console.warn("Date parsing error:", e); return false; }
            });
            showOrderListModal(`ğŸ“… ${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')} ì˜ˆì •`, orders);
        }

        function updateTabs() {
            updateMonthlyTab();
            updateDestinationTab();
            updateModelTab();
            updateFactoryTab();
            updateVendorTab();
            updateHeatmapTab();
            updateDataTab();
        }

        function updateMonthlyTab() {
            const monthlyData = {};
            filteredData.forEach(d => {
                const ym = getYearMonth(d);
                if (!ym) return;
                if (!monthlyData[ym]) monthlyData[ym] = { count: 0, qty: 0, completed: 0 };
                monthlyData[ym].count++;
                monthlyData[ym].qty += d.quantity || 0;
                monthlyData[ym].completed += d.production?.wh_in?.completed || 0;
            });

            let sorted = Object.entries(monthlyData).sort((a, b) => a[0].localeCompare(b[0]));
            sorted = sortData(sorted.map(([k, v]) => ({ month: k, ...v })), 'monthly');
            if (!Array.isArray(sorted[0])) sorted = sorted.map(d => [d.month, d]);

            const isDarkMode = document.documentElement.classList.contains('dark');
            // Monthly chart - using updateOrCreateChart for memory efficiency
            updateOrCreateChart('monthly', document.getElementById('monthlyChart'), {
                type: 'bar',
                data: {
                    labels: sorted.map(([m]) => m),
                    datasets: [
                        { label: 'ì£¼ë¬¸ëŸ‰', data: sorted.map(([, d]) => d.qty), backgroundColor: '#3b82f6' },
                        { label: 'ì™„ë£ŒëŸ‰', data: sorted.map(([, d]) => d.completed), backgroundColor: '#22c55e' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: isDarkMode ? '#fff' : '#333' } } } }
            });

            document.querySelector('#monthlyTable tbody').innerHTML = sorted.map(([month, data]) => {
                const rate = data.qty > 0 ? (data.completed / data.qty * 100) : 0;
                return `<tr class="border-b border-theme"><td class="px-4 py-2">${month}</td><td class="px-4 py-2 text-right">${formatNumber(data.count)}</td><td class="px-4 py-2 text-right">${formatNumber(data.qty)}</td><td class="px-4 py-2 text-right">${formatNumber(data.completed)}</td><td class="px-4 py-2 text-right font-medium" style="color: ${rate >= 80 ? '#22c55e' : '#f59e0b'}">${rate.toFixed(1)}%</td></tr>`;
            }).join('');

            // Agent Q08-1: ì›”ë³„ íŠ¸ë Œë“œ ë¶„ì„ ì°¨íŠ¸
            renderMonthlyTrendChart(sorted);
        }

        // Agent Q08: ì›”ë³„ íŠ¸ë Œë“œ ë¶„ì„ ì°¨íŠ¸ ë Œë”ë§ (Phase 4 - Q08-1)
        function renderMonthlyTrendChart(monthlyData) {
            if (!monthlyData || monthlyData.length === 0) {
                log.warn('No monthly data for trend chart');
                return;
            }

            // ë°ì´í„° ì¤€ë¹„
            const months = monthlyData.map(([m]) => m);
            const quantities = monthlyData.map(([, d]) => d.qty);
            const completed = monthlyData.map(([, d]) => d.completed);
            const completionRates = monthlyData.map(([, d]) =>
                d.qty > 0 ? (d.completed / d.qty * 100) : 0
            );

            // ì§€ì—°ìœ¨ ê³„ì‚°
            const delayRates = monthlyData.map(([month, data]) => {
                // í•´ë‹¹ ì›”ì˜ ë°ì´í„°ë§Œ í•„í„°ë§
                const monthOrders = filteredData.filter(d => getYearMonth(d) === month);
                if (monthOrders.length === 0) return 0;

                const delayedCount = monthOrders.filter(d => isDelayed(d)).length;
                return (delayedCount / monthOrders.length * 100);
            });

            const isDarkMode = document.documentElement.classList.contains('dark');

            // ì°¨íŠ¸ ë Œë”ë§ (ì§€ì—° ë¡œë”© ì ìš©)
            lazyRenderChart('monthlyTrendChart', 'monthlyTrend', () => {
                updateOrCreateChart('monthlyTrend', document.getElementById('monthlyTrendChart'), {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'ì£¼ë¬¸ëŸ‰ (ì¡±)',
                                data: quantities,
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                yAxisID: 'y',
                                tension: 0.4
                            },
                            {
                                label: 'ì™„ë£ŒëŸ‰ (ì¡±)',
                                data: completed,
                                borderColor: '#22c55e',
                                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                yAxisID: 'y',
                                tension: 0.4
                            },
                            {
                                label: 'ì™„ë£Œìœ¨ (%)',
                                data: completionRates,
                                borderColor: '#8b5cf6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                yAxisID: 'y1',
                                tension: 0.4,
                                borderDash: [5, 5]
                            },
                            {
                                label: 'ì§€ì—°ìœ¨ (%)',
                                data: delayRates,
                                borderColor: '#ef4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                yAxisID: 'y1',
                                tension: 0.4,
                                borderDash: [5, 5]
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'ìˆ˜ëŸ‰ (ì¡±)',
                                    color: isDarkMode ? '#fff' : '#333'
                                },
                                grid: {
                                    color: isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
                                },
                                ticks: {
                                    color: isDarkMode ? '#fff' : '#333'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'ë¹„ìœ¨ (%)',
                                    color: isDarkMode ? '#fff' : '#333'
                                },
                                grid: {
                                    drawOnChartArea: false
                                },
                                ticks: {
                                    color: isDarkMode ? '#fff' : '#333',
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                min: 0,
                                max: 100
                            },
                            x: {
                                grid: {
                                    color: isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
                                },
                                ticks: {
                                    color: isDarkMode ? '#fff' : '#333'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    color: isDarkMode ? '#fff' : '#333',
                                    usePointStyle: true,
                                    padding: 15
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.dataset.yAxisID === 'y1') {
                                            label += context.parsed.y.toFixed(1) + '%';
                                        } else {
                                            label += formatNumber(context.parsed.y) + 'ì¡±';
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });

                log.info('Monthly trend chart rendered');
            });
        }

        function updateDestinationTab() {
            const destData = {};
            filteredData.forEach(d => {
                if (!d.destination) return;
                if (!destData[d.destination]) destData[d.destination] = { count: 0, qty: 0, completed: 0 };
                destData[d.destination].count++;
                destData[d.destination].qty += d.quantity || 0;
                destData[d.destination].completed += d.production?.wh_in?.completed || 0;
            });

            const sorted = Object.entries(destData).sort((a, b) => b[1].qty - a[1].qty);
            const isDarkMode = document.documentElement.classList.contains('dark');

            // Destination chart - Agent Q07-4: ì§€ì—° ë¡œë”© ì ìš©
            lazyRenderChart('destChart', 'dest', () => {
                updateOrCreateChart('dest', document.getElementById('destChart'), {
                    type: 'doughnut',
                    data: {
                        labels: sorted.slice(0, 10).map(([d]) => d),
                        datasets: [{ data: sorted.slice(0, 10).map(([, d]) => d.qty), backgroundColor: ['#3b82f6', '#22c55e', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#14b8a6', '#64748b', '#0ea5e9', '#f97316'] }]
                    },
                    options: { plugins: { legend: { position: 'right', labels: { color: isDarkMode ? '#fff' : '#333' } } }, responsive: true, maintainAspectRatio: false }
                });
            });

            document.querySelector('#destTable tbody').innerHTML = sorted.map(([dest, data]) => {
                const rate = data.qty > 0 ? (data.completed / data.qty * 100) : 0;
                const flag = IMPORTANT_DESTINATIONS[dest] || '';
                return `<tr class="border-b border-theme hover:bg-gray-50 dark:hover:bg-gray-700 clickable-row" data-action="showCountryDetail" data-param="${dest}">
                    <td class="px-4 py-2">${flag} ${dest}</td>
                    <td class="px-4 py-2 text-right">${formatNumber(data.count)}</td>
                    <td class="px-4 py-2 text-right">${formatNumber(data.qty)}</td>
                    <td class="px-4 py-2 text-right">${formatNumber(data.completed)}</td>
                    <td class="px-4 py-2 text-right font-medium" style="color: ${rate >= 80 ? '#22c55e' : '#f59e0b'}">${rate.toFixed(1)}%</td>
                </tr>`;
            }).join('');
        }

        function updateModelTab() {
            const modelData = {};
            filteredData.forEach(d => {
                if (!d.model) return;
                if (!modelData[d.model]) modelData[d.model] = { count: 0, qty: 0, completed: 0 };
                modelData[d.model].count++;
                modelData[d.model].qty += d.quantity || 0;
                modelData[d.model].completed += d.production?.wh_in?.completed || 0;
            });

            const sorted = Object.entries(modelData).sort((a, b) => b[1].qty - a[1].qty);
            const isDarkMode = document.documentElement.classList.contains('dark');

            // Model chart - Agent Q07-4: ì§€ì—° ë¡œë”© ì ìš©
            lazyRenderChart('modelChart', 'model', () => {
                updateOrCreateChart('model', document.getElementById('modelChart'), {
                    type: 'bar',
                    data: {
                        labels: sorted.slice(0, 15).map(([m]) => m),
                        datasets: [{ label: 'ìˆ˜ëŸ‰', data: sorted.slice(0, 15).map(([, d]) => d.qty), backgroundColor: '#3b82f6' }]
                    },
                    options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: isDarkMode ? '#fff' : '#333' } } } }
                });
            });

            document.querySelector('#modelTable tbody').innerHTML = sorted.slice(0, 30).map(([model, data]) => {
                const rate = data.qty > 0 ? (data.completed / data.qty * 100) : 0;
                return `<tr class="border-b border-theme hover:bg-gray-50 dark:hover:bg-gray-700 clickable-row" data-action="showModelDetail" data-param="${model}">
                    <td class="px-4 py-2 text-xs">${model}</td>
                    <td class="px-4 py-2 text-right">${formatNumber(data.count)}</td>
                    <td class="px-4 py-2 text-right">${formatNumber(data.qty)}</td>
                    <td class="px-4 py-2 text-right">${formatNumber(data.completed)}</td>
                    <td class="px-4 py-2 text-right font-medium" style="color: ${rate >= 80 ? '#22c55e' : '#f59e0b'}">${rate.toFixed(1)}%</td>
                </tr>`;
            }).join('');
        }

        function updateFactoryTab() {
            const factoryData = {};
            filteredData.forEach(d => {
                if (!factoryData[d.factory]) factoryData[d.factory] = { count: 0, qty: 0, completed: 0 };
                factoryData[d.factory].count++;
                factoryData[d.factory].qty += d.quantity || 0;
                factoryData[d.factory].completed += d.production?.wh_in?.completed || 0;
            });

            const isDarkMode = document.documentElement.classList.contains('dark');
            // Factory chart - using updateOrCreateChart for memory efficiency
            updateOrCreateChart('factory', document.getElementById('factoryChart'), {
                type: 'bar',
                data: {
                    labels: ['A', 'B', 'C', 'D'].map(f => `Factory ${f}`),
                    datasets: [
                        { label: 'ì£¼ë¬¸ëŸ‰', data: ['A', 'B', 'C', 'D'].map(f => factoryData[f]?.qty || 0), backgroundColor: '#3b82f6' },
                        { label: 'ì™„ë£ŒëŸ‰', data: ['A', 'B', 'C', 'D'].map(f => factoryData[f]?.completed || 0), backgroundColor: '#22c55e' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: isDarkMode ? '#fff' : '#333' } } } }
            });

            let html = '';
            ['A', 'B', 'C', 'D'].forEach(f => {
                const fData = filteredData.filter(d => d.factory === f);
                const totalQty = fData.reduce((sum, d) => sum + (d.quantity || 0), 0);
                const whInCompleted = fData.reduce((sum, d) => sum + (d.production?.wh_in?.completed || 0), 0);
                const rate = totalQty > 0 ? (whInCompleted / totalQty * 100) : 0;
                html += `<div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" data-action="showFactoryDetail" data-param="${f}">
                    <div class="flex justify-between items-center mb-2"><span class="font-semibold">Factory ${f}</span><span class="text-sm" style="color: ${rate >= 80 ? '#22c55e' : '#f59e0b'}">${rate.toFixed(1)}% ì™„ë£Œ</span></div>
                    <div class="text-sm text-secondary">${formatNumber(fData.length)}ê±´ Â· ${formatNumber(totalQty)}ì¡±</div>
                </div>`;
            });
            document.getElementById('factoryProcessDetail').innerHTML = html;
        }

        function updateVendorTab() {
            const vendorData = {};
            filteredData.forEach(d => {
                const v = d.outsoleVendor || '(ë¯¸ì§€ì •)';
                if (!vendorData[v]) vendorData[v] = { count: 0, qty: 0, completed: 0 };
                vendorData[v].count++;
                vendorData[v].qty += d.quantity || 0;
                vendorData[v].completed += d.production?.wh_in?.completed || 0;
            });

            const sorted = Object.entries(vendorData).sort((a, b) => b[1].qty - a[1].qty);
            const isDarkMode = document.documentElement.classList.contains('dark');

            // Vendor detail chart - Agent Q07-4: ì§€ì—° ë¡œë”© ì ìš©
            lazyRenderChart('vendorDetailChart', 'vendorDetail', () => {
                updateOrCreateChart('vendorDetail', document.getElementById('vendorDetailChart'), {
                    type: 'bar',
                    data: {
                        labels: sorted.slice(0, 10).map(([v]) => v),
                        datasets: [
                            { label: 'ì£¼ë¬¸ëŸ‰', data: sorted.slice(0, 10).map(([, d]) => d.qty), backgroundColor: '#3b82f6' },
                            { label: 'ì™„ë£ŒëŸ‰', data: sorted.slice(0, 10).map(([, d]) => d.completed), backgroundColor: '#22c55e' }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: isDarkMode ? '#fff' : '#333' } } } }
                });
            });

            document.querySelector('#vendorDetailTable tbody').innerHTML = sorted.map(([vendor, data]) => {
                const rate = data.qty > 0 ? (data.completed / data.qty * 100) : 0;
                return `<tr class="border-b border-theme hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer" data-action="showVendorDetail" data-param="${vendor}">
                    <td class="px-3 py-2 text-xs">${vendor}</td>
                    <td class="px-3 py-2 text-right">${formatNumber(data.count)}</td>
                    <td class="px-3 py-2 text-right">${formatNumber(data.qty)}</td>
                    <td class="px-3 py-2 text-right">${formatNumber(data.completed)}</td>
                    <td class="px-3 py-2 text-right font-medium" style="color: ${rate >= 80 ? '#22c55e' : '#f59e0b'}">${rate.toFixed(1)}%</td>
                </tr>`;
            }).join('');

            // Model x Vendor Heatmap
            renderModelVendorHeatmap();
        }

        function renderModelVendorHeatmap() {
            const models = [...new Set(filteredData.map(d => d.model).filter(Boolean))];
            const vendors = [...new Set(filteredData.map(d => d.outsoleVendor || '(ë¯¸ì§€ì •)').filter(Boolean))];

            // Get top models and vendors by quantity
            const modelQty = {};
            const vendorQty = {};
            filteredData.forEach(d => {
                modelQty[d.model] = (modelQty[d.model] || 0) + (d.quantity || 0);
                const v = d.outsoleVendor || '(ë¯¸ì§€ì •)';
                vendorQty[v] = (vendorQty[v] || 0) + (d.quantity || 0);
            });

            const topModels = Object.entries(modelQty).sort((a, b) => b[1] - a[1]).slice(0, 10).map(([m]) => m);
            const topVendors = Object.entries(vendorQty).sort((a, b) => b[1] - a[1]).slice(0, 8).map(([v]) => v);

            // Build heatmap data - Agent P03: O(nÃ—m) â†’ O(n) ìµœì í™”
            const topModelsSet = new Set(topModels);
            const topVendorsSet = new Set(topVendors);
            const heatmapData = {};
            let maxVal = 0;
            filteredData.forEach(d => {
                const model = d.model;
                const vendor = d.outsoleVendor || '(ë¯¸ì§€ì •)';
                if (topModelsSet.has(model) && topVendorsSet.has(vendor)) {
                    const key = `${model}|${vendor}`;
                    heatmapData[key] = (heatmapData[key] || 0) + (d.quantity || 0);
                    if (heatmapData[key] > maxVal) maxVal = heatmapData[key];
                }
            });

            let html = '<table class="w-full text-xs"><caption class="sr-only">ëª¨ë¸ë³„ ì•„ì›ƒì†” ë²¤ë” ìˆ˜ëŸ‰ íˆíŠ¸ë§µ (ìƒìœ„ 10ê°œ ëª¨ë¸ Ã— ìƒìœ„ 8ê°œ ë²¤ë”)</caption><thead><tr><th class="heatmap-cell">ëª¨ë¸ \\ ë²¤ë”</th>';
            topVendors.forEach(v => { html += `<th class="heatmap-cell">${v.substring(0, 15)}</th>`; });
            html += '</tr></thead><tbody>';

            topModels.forEach(model => {
                html += `<tr><td class="heatmap-cell font-medium text-left">${model.substring(0, 20)}</td>`;
                topVendors.forEach(vendor => {
                    const val = heatmapData[`${model}|${vendor}`] || 0;
                    const intensity = maxVal > 0 ? val / maxVal : 0;
                    const bg = val > 0 ? `rgba(59, 130, 246, ${0.2 + intensity * 0.8})` : '#f3f4f6';
                    const textColor = intensity > 0.5 ? '#fff' : '#333';
                    html += `<td class="heatmap-cell" style="background: ${bg}; color: ${textColor}">${val > 0 ? formatNumber(val) : '-'}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            document.getElementById('modelVendorHeatmap').innerHTML = html;
        }

        function updateHeatmapTab() {
            // Country x Month heatmap - Agent P03: O(nÃ—m) â†’ O(n) ìµœì í™”
            const countryMonthData = {};
            const months = [...new Set(filteredData.map(d => getYearMonth(d)).filter(Boolean))].sort();
            const countries = Object.keys(IMPORTANT_DESTINATIONS);

            // êµ­ê°€ ë§¤í•‘ì„ Mapìœ¼ë¡œ ì‚¬ì „ ìƒì„± - O(1) ì¡°íšŒ
            const countryMap = new Map();
            countries.forEach(c => {
                countryMap.set(c, c);
                if (c === 'South Korea') countryMap.set('Korea', c);
            });

            let maxCountryMonth = 0;
            filteredData.forEach(d => {
                const ym = getYearMonth(d);
                const country = countryMap.get(d.destination);
                if (country && ym) {
                    const key = `${country}|${ym}`;
                    countryMonthData[key] = (countryMonthData[key] || 0) + (d.quantity || 0);
                    if (countryMonthData[key] > maxCountryMonth) maxCountryMonth = countryMonthData[key];
                }
            });

            let html1 = '<table class="w-full text-xs"><caption class="sr-only">êµ­ê°€ë³„ ì›”ë³„ ì¶œê³  ìˆ˜ëŸ‰ íˆíŠ¸ë§µ (ì£¼ìš” í–‰ì„ ì§€ Ã— 6ê°œì›”)</caption><thead><tr><th class="heatmap-cell">êµ­ê°€ \\ ì›”</th>';
            months.forEach(m => { html1 += `<th class="heatmap-cell">${m}</th>`; });
            html1 += '</tr></thead><tbody>';

            countries.forEach(country => {
                const displayName = { 'Japan': 'ì¼ë³¸', 'South Korea': 'í•œêµ­', 'China': 'ì¤‘êµ­', 'Taiwan': 'ëŒ€ë§Œ', 'India': 'ì¸ë„' }[country];
                html1 += `<tr><td class="heatmap-cell font-medium text-left">${IMPORTANT_DESTINATIONS[country]} ${displayName}</td>`;
                months.forEach(month => {
                    const val = countryMonthData[`${country}|${month}`] || 0;
                    const intensity = maxCountryMonth > 0 ? val / maxCountryMonth : 0;
                    const bg = val > 0 ? `rgba(34, 197, 94, ${0.2 + intensity * 0.8})` : '#f3f4f6';
                    const textColor = intensity > 0.5 ? '#fff' : '#333';
                    html1 += `<td class="heatmap-cell" style="background: ${bg}; color: ${textColor}">${val > 0 ? formatNumber(val) : '-'}</td>`;
                });
                html1 += '</tr>';
            });
            html1 += '</tbody></table>';
            document.getElementById('countryMonthHeatmap').innerHTML = html1;

            // Model x Destination heatmap - Agent P03: O(nÃ—m) â†’ O(n) ìµœì í™”
            const modelDestData = {};
            const topModels = Object.entries(
                filteredData.reduce((acc, d) => { acc[d.model] = (acc[d.model] || 0) + (d.quantity || 0); return acc; }, {})
            ).sort((a, b) => b[1] - a[1]).slice(0, 10).map(([m]) => m);
            const topDest = Object.entries(
                filteredData.reduce((acc, d) => { acc[d.destination] = (acc[d.destination] || 0) + (d.quantity || 0); return acc; }, {})
            ).sort((a, b) => b[1] - a[1]).slice(0, 8).map(([d]) => d);

            // Setìœ¼ë¡œ O(1) ì¡°íšŒ
            const topModelsSet = new Set(topModels);
            const topDestSet = new Set(topDest);

            let maxModelDest = 0;
            filteredData.forEach(d => {
                if (topModelsSet.has(d.model) && topDestSet.has(d.destination)) {
                    const key = `${d.model}|${d.destination}`;
                    modelDestData[key] = (modelDestData[key] || 0) + (d.quantity || 0);
                    if (modelDestData[key] > maxModelDest) maxModelDest = modelDestData[key];
                }
            });

            let html2 = '<table class="w-full text-xs"><caption class="sr-only">ëª¨ë¸ë³„ í–‰ì„ ì§€ ìˆ˜ëŸ‰ íˆíŠ¸ë§µ (ìƒìœ„ 10ê°œ ëª¨ë¸ Ã— ìƒìœ„ 6ê°œ í–‰ì„ ì§€)</caption><thead><tr><th class="heatmap-cell">ëª¨ë¸ \\ í–‰ì„ ì§€</th>';
            topDest.forEach(d => { html2 += `<th class="heatmap-cell">${d}</th>`; });
            html2 += '</tr></thead><tbody>';

            topModels.forEach(model => {
                html2 += `<tr><td class="heatmap-cell font-medium text-left">${model.substring(0, 20)}</td>`;
                topDest.forEach(dest => {
                    const val = modelDestData[`${model}|${dest}`] || 0;
                    const intensity = maxModelDest > 0 ? val / maxModelDest : 0;
                    const bg = val > 0 ? `rgba(139, 92, 246, ${0.2 + intensity * 0.8})` : '#f3f4f6';
                    const textColor = intensity > 0.5 ? '#fff' : '#333';
                    html2 += `<td class="heatmap-cell" style="background: ${bg}; color: ${textColor}">${val > 0 ? formatNumber(val) : '-'}</td>`;
                });
                html2 += '</tr>';
            });
            html2 += '</tbody></table>';
            document.getElementById('modelDestHeatmap').innerHTML = html2;
        }

        // ========================================
        // Agent Q06: ëª¨ë°”ì¼ ì¹´ë“œë·° ë Œë”ë§
        // Phase 4 - Step 5: Q06-3 (HIGH)
        // ========================================

        function renderDataCards(pageData) {
            const container = document.getElementById('dataCardsContainer');

            if (pageData.length === 0) {
                container.innerHTML = `
                    <div class="cards-empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <div class="text-lg font-semibold">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                        <div class="text-sm mt-2">í•„í„°ë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ê²€ìƒ‰ì–´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = pageData.map(d => {
                const shipped = isShipped(d);
                const delayed = isDelayed(d);
                const warning = isWarning(d);
                const cardClass = shipped ? 'shipped' : delayed ? 'delayed' : warning ? 'warning' : '';
                const statusIcon = shipped ? 'ğŸš¢' : delayed ? 'ğŸš¨' : warning ? 'âš¡' : d.production?.wh_in?.status === 'completed' ? 'âœ…' : 'â³';
                const statusText = shipped ? 'ì„ ì ' : delayed ? 'ì§€ì—°' : warning ? 'ê²½ê³ ' : d.production?.wh_in?.status === 'completed' ? 'ì™„ë£Œ' : 'ì§„í–‰ì¤‘';

                // ê³µì • ì§„í–‰ë„ ê³„ì‚° (4ë‹¨ê³„: ì¬ë‹¨, ì¬ë´‰, ì¡°ë¦½, ì…ê³ )
                const processes = [
                    d.production?.s_cut?.status,
                    d.production?.sew_bal?.status,
                    d.production?.ass_bal?.status,
                    d.production?.wh_in?.status
                ];
                const completedCount = processes.filter(s => s === 'completed').length;
                const progressPercent = (completedCount / 4) * 100;

                return `
                    <div class="order-card ${cardClass}" data-action="showOrderProcessDetail" data-index="${filteredData.indexOf(d)}" role="button" tabindex="0" aria-label="ì˜¤ë” ${escapeHtml(d.poNumber)} ìƒì„¸ ë³´ê¸°">
                        <div class="order-card-header">
                            <div class="order-card-factory">Factory ${escapeHtml(d.factory)}</div>
                            <div class="order-card-po">${escapeHtml(d.poNumber) || '-'}</div>
                        </div>
                        <div class="order-card-main">
                            <div class="order-card-model">${escapeHtml(d.model) || '-'}</div>
                            <div class="order-card-destination">
                                ğŸŒ ${escapeHtml(d.destination) || '-'}
                            </div>
                        </div>
                        <div class="order-card-details">
                            <div class="order-card-detail-item">
                                <div class="order-card-detail-label">ìˆ˜ëŸ‰</div>
                                <div class="order-card-detail-value">${formatNumber(d.quantity || 0)}ì¡±</div>
                            </div>
                            <div class="order-card-detail-item">
                                <div class="order-card-detail-label">ê³µì • ì§„í–‰</div>
                                <div class="order-card-detail-value">${progressPercent.toFixed(0)}%</div>
                            </div>
                            <div class="order-card-detail-item">
                                <div class="order-card-detail-label">CRD</div>
                                <div class="order-card-detail-value">${d.crd || '-'}</div>
                            </div>
                            <div class="order-card-detail-item">
                                <div class="order-card-detail-label">SDD</div>
                                <div class="order-card-detail-value">${d.sddValue || '-'}</div>
                            </div>
                        </div>
                        <div class="order-card-status">
                            <div class="order-card-progress">
                                ${getStatusIcon(d.production?.s_cut?.status)}
                                ${getStatusIcon(d.production?.sew_bal?.status)}
                                ${getStatusIcon(d.production?.ass_bal?.status)}
                                ${getStatusIcon(d.production?.wh_in?.status)}
                            </div>
                            <div class="order-card-status-badge" style="background: ${shipped ? '#059669' : delayed ? '#dc2626' : warning ? '#f59e0b' : '#6b7280'}; color: white;">
                                ${statusIcon} ${statusText}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            log.debug(`Rendered ${pageData.length} order cards`);
        }

        // ========================================
        // Phase 5 - Agent Q08/Q10: í…Œì´ë¸” ë Œë”ë§ ìµœì í™”
        // ì ì§„ì  ë Œë”ë§ìœ¼ë¡œ ì„±ëŠ¥ í–¥ìƒ (1000+ í–‰ì—ì„œë„ ë¶€ë“œëŸ¬ìš´ ë Œë”ë§)
        // ========================================

        /**
         * í…Œì´ë¸” í–‰ HTML ìƒì„± (ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í•¨ìˆ˜)
         * @param {Object} d - ì˜¤ë” ë°ì´í„°
         * @param {number} index - ì „ì²´ ë°ì´í„°ì—ì„œì˜ ì¸ë±ìŠ¤
         * @returns {string} - í…Œì´ë¸” í–‰ HTML
         */
        function createTableRowHTML(d, index) {
            const shipped = isShipped(d);
            const delayed = isDelayed(d);
            const warning = isWarning(d);
            const rowClass = shipped ? 'shipped-highlight' : delayed ? 'delay-highlight' : warning ? 'warning-highlight' : '';
            return `<tr class="border-b border-theme ${rowClass} clickable-row" data-action="showOrderProcessDetail" data-index="${index}">
                <td class="px-2 py-2">${d.factory}</td>
                <td class="px-2 py-2 text-xs">${escapeHtml(d.poNumber) || '-'}</td>
                <td class="px-2 py-2 text-xs">${escapeHtml(d.model) || '-'}</td>
                <td class="px-2 py-2 text-xs">${escapeHtml(d.article) || '-'}</td>
                <td class="px-2 py-2">${escapeHtml(d.destination) || '-'}</td>
                <td class="px-2 py-2 text-xs">${escapeHtml(d.outsoleVendor) || '-'}</td>
                <td class="px-2 py-2 text-right">${formatNumber(d.quantity || 0)}</td>
                <td class="px-2 py-2 text-center">${getStatusIcon(d.production?.s_cut?.status)}</td>
                <td class="px-2 py-2 text-center">${getStatusIcon(d.production?.sew_bal?.status)}</td>
                <td class="px-2 py-2 text-center">${getStatusIcon(d.production?.ass_bal?.status)}</td>
                <td class="px-2 py-2 text-center">${getStatusIcon(d.production?.wh_in?.status)}</td>
                <td class="px-2 py-2 text-xs">${d.crd || '-'}</td>
                <td class="px-2 py-2 text-xs">${d.sddValue || '-'}</td>
                <td class="px-2 py-2 text-center">${shipped ? '<span class="shipped-badge">ğŸš¢ ì„ ì </span>' : delayed ? 'ğŸš¨' : warning ? 'âš¡' : d.production?.wh_in?.status === 'completed' ? 'âœ…' : 'â³'}</td>
            </tr>`;
        }

        /**
         * ì ì§„ì  í…Œì´ë¸” ë Œë”ë§ (Phase 5 - ì„±ëŠ¥ ìµœì í™”)
         * requestAnimationFrameê³¼ DocumentFragmentë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ ë°©ì§€
         * @param {HTMLElement} tbody - í…Œì´ë¸” ë³¸ë¬¸ ìš”ì†Œ
         * @param {Array} data - ë Œë”ë§í•  ë°ì´í„°
         * @param {number} chunkSize - í•œ ë²ˆì— ë Œë”ë§í•  í–‰ ìˆ˜ (ê¸°ë³¸: 50)
         */
        function renderTableProgressively(tbody, data, chunkSize = 50) {
            const startTime = performance.now();

            // í…Œì´ë¸” ì´ˆê¸°í™”
            tbody.innerHTML = '';

            // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="14" class="px-4 py-8 text-center text-gray-500">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            let currentIndex = 0;
            const totalChunks = Math.ceil(data.length / chunkSize);

            // ì²­í¬ë³„ ë Œë”ë§ í•¨ìˆ˜
            function renderChunk() {
                const fragment = document.createDocumentFragment();
                const endIndex = Math.min(currentIndex + chunkSize, data.length);

                // í˜„ì¬ ì²­í¬ì˜ í–‰ë“¤ì„ ìƒì„±
                for (let i = currentIndex; i < endIndex; i++) {
                    const d = data[i];
                    const globalIndex = filteredData.indexOf(d);
                    const rowHTML = createTableRowHTML(d, globalIndex);

                    // ì„ì‹œ divë¥¼ ì‚¬ìš©í•´ì„œ HTMLì„ DOM ë…¸ë“œë¡œ ë³€í™˜
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = rowHTML;
                    fragment.appendChild(tempDiv.firstChild);
                }

                // DOMì— í•œ ë²ˆì— ì¶”ê°€ (ë¦¬í”Œë¡œìš° ìµœì†Œí™”)
                tbody.appendChild(fragment);

                currentIndex = endIndex;

                // ë‹¤ìŒ ì²­í¬ê°€ ìˆìœ¼ë©´ ê³„ì† ë Œë”ë§
                if (currentIndex < data.length) {
                    // requestAnimationFrameìœ¼ë¡œ ë©”ì¸ ìŠ¤ë ˆë“œ ë¸”ë¡œí‚¹ ë°©ì§€
                    requestAnimationFrame(renderChunk);
                } else {
                    // ë Œë”ë§ ì™„ë£Œ
                    const endTime = performance.now();
                    const renderTime = endTime - startTime;
                    log.info(`Progressive rendering complete: ${data.length} rows in ${renderTime.toFixed(2)}ms (${totalChunks} chunks)`);

                    // ì»¬ëŸ¼ ê°€ì‹œì„± ì ìš©
                    applyColumnVisibility();
                }
            }

            // ì²« ë²ˆì§¸ ì²­í¬ ë Œë”ë§ ì‹œì‘
            requestAnimationFrame(renderChunk);
        }

        /**
         * Virtual Scrolling í…Œì´ë¸” ë Œë”ë§ (Phase 5-3 - ì„±ëŠ¥ ìµœì í™”)
         * Intersection Observerë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬´í•œ ìŠ¤í¬ë¡¤ êµ¬í˜„
         * @param {HTMLElement} tbody - í…Œì´ë¸” ë³¸ë¬¸ ìš”ì†Œ
         * @param {Array} data - ë Œë”ë§í•  ë°ì´í„°
         * @param {number} initialRows - ì´ˆê¸° ë Œë”ë§ í–‰ ìˆ˜ (ê¸°ë³¸: 100)
         * @param {number} loadMoreRows - ì¶”ê°€ ë¡œë“œ í–‰ ìˆ˜ (ê¸°ë³¸: 50)
         */
        function renderTableVirtually(tbody, data, initialRows = 100, loadMoreRows = 50) {
            const startTime = performance.now();

            // í…Œì´ë¸” ì´ˆê¸°í™”
            tbody.innerHTML = '';

            // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="14" class="px-4 py-8 text-center text-gray-500">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            let currentRenderedCount = 0;
            let sentinelElement = null;
            let observer = null;

            // ì´ˆê¸° í–‰ ë Œë”ë§ í•¨ìˆ˜
            function renderInitialRows() {
                const fragment = document.createDocumentFragment();
                const rowsToRender = Math.min(initialRows, data.length);

                for (let i = 0; i < rowsToRender; i++) {
                    const d = data[i];
                    const globalIndex = filteredData.indexOf(d);
                    const rowHTML = createTableRowHTML(d, globalIndex);

                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = rowHTML;
                    fragment.appendChild(tempDiv.firstChild);
                }

                tbody.appendChild(fragment);
                currentRenderedCount = rowsToRender;

                const initTime = performance.now() - startTime;
                log.info(`Virtual scrolling initial render: ${rowsToRender} rows in ${initTime.toFixed(2)}ms`);

                // ì»¬ëŸ¼ ê°€ì‹œì„± ì ìš©
                applyColumnVisibility();

                // ë” ë¡œë“œí•  ë°ì´í„°ê°€ ìˆìœ¼ë©´ Intersection Observer ì„¤ì •
                if (currentRenderedCount < data.length) {
                    setupIntersectionObserver();
                }
            }

            // Intersection Observer ì„¤ì •
            function setupIntersectionObserver() {
                // ê¸°ì¡´ observerê°€ ìˆìœ¼ë©´ ì •ë¦¬
                if (observer) {
                    observer.disconnect();
                }

                // ì„¼í‹°ë„¬ ìš”ì†Œ ìƒì„± (ìŠ¤í¬ë¡¤ ê°ì§€ìš©)
                if (sentinelElement) {
                    sentinelElement.remove();
                }

                sentinelElement = document.createElement('tr');
                sentinelElement.id = 'sentinel-row';
                sentinelElement.innerHTML = '<td colspan="14" class="px-4 py-2 text-center text-gray-500 text-sm">ë¡œë”© ì¤‘...</td>';
                tbody.appendChild(sentinelElement);

                // Intersection Observer ìƒì„±
                observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting && currentRenderedCount < data.length) {
                            loadMoreData();
                        }
                    });
                }, {
                    root: null, // viewportë¥¼ rootë¡œ ì‚¬ìš©
                    rootMargin: '200px', // 200px ì „ì— ë¯¸ë¦¬ ë¡œë“œ
                    threshold: 0.1
                });

                observer.observe(sentinelElement);
            }

            // ì¶”ê°€ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
            function loadMoreData() {
                const startLoadTime = performance.now();
                const fragment = document.createDocumentFragment();
                const endIndex = Math.min(currentRenderedCount + loadMoreRows, data.length);

                for (let i = currentRenderedCount; i < endIndex; i++) {
                    const d = data[i];
                    const globalIndex = filteredData.indexOf(d);
                    const rowHTML = createTableRowHTML(d, globalIndex);

                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = rowHTML;
                    fragment.appendChild(tempDiv.firstChild);
                }

                // ì„¼í‹°ë„¬ ìš”ì†Œ ì•ì— ì‚½ì…
                tbody.insertBefore(fragment, sentinelElement);
                currentRenderedCount = endIndex;

                const loadTime = performance.now() - startLoadTime;
                log.debug(`Loaded additional ${endIndex - (currentRenderedCount - (endIndex - currentRenderedCount))} rows in ${loadTime.toFixed(2)}ms (total: ${currentRenderedCount}/${data.length})`);

                // ì»¬ëŸ¼ ê°€ì‹œì„± ì ìš©
                applyColumnVisibility();

                // ëª¨ë“  ë°ì´í„° ë¡œë“œ ì™„ë£Œ ì‹œ ì„¼í‹°ë„¬ ì œê±° ë° observer í•´ì œ
                if (currentRenderedCount >= data.length) {
                    if (sentinelElement) {
                        sentinelElement.remove();
                        sentinelElement = null;
                    }
                    if (observer) {
                        observer.disconnect();
                        observer = null;
                    }

                    const totalTime = performance.now() - startTime;
                    log.info(`Virtual scrolling complete: ${data.length} rows fully loaded in ${totalTime.toFixed(2)}ms`);
                }
            }

            // ì´ˆê¸° ë Œë”ë§ ì‹œì‘
            requestAnimationFrame(renderInitialRows);
        }

        function updateDataTab() {
            const start = (currentPage - 1) * PAGE_SIZE;
            const end = start + PAGE_SIZE;
            const pageData = filteredData.slice(start, end);
            const totalPages = Math.ceil(filteredData.length / PAGE_SIZE);

            document.getElementById('dataCount').textContent = `(${formatNumber(filteredData.length)}ê±´)`;
            document.getElementById('pagination').textContent = `${currentPage} / ${totalPages} í˜ì´ì§€`;
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage >= totalPages;

            // Agent Q06: ëª¨ë°”ì¼ ì¹´ë“œë·° ë Œë”ë§ (768px ì´í•˜)
            renderDataCards(pageData);

            // Phase 5-3: Virtual Scrolling (í˜ì´ì§€ í¬ê¸°ê°€ 200 ì´ìƒì¼ ë•Œ)
            // Phase 5-1: ì ì§„ì  ë Œë”ë§ (í˜ì´ì§€ í¬ê¸°ê°€ 200 ë¯¸ë§Œì¼ ë•Œ)
            const tbody = document.querySelector('#dataTable tbody');
            if (PAGE_SIZE >= 200) {
                // Virtual Scrolling: ì´ˆê¸° 100í–‰, ìŠ¤í¬ë¡¤ ì‹œ 50í–‰ì”© ì¶”ê°€
                renderTableVirtually(tbody, pageData, 100, 50);
            } else {
                // ì ì§„ì  ë Œë”ë§: 50í–‰ ì²­í¬
                renderTableProgressively(tbody, pageData, 50);
            }
        }

        function prevPage() { if (currentPage > 1) { currentPage--; updateDataTab(); } }
        function nextPage() { const totalPages = Math.ceil(filteredData.length / PAGE_SIZE); if (currentPage < totalPages) { currentPage++; updateDataTab(); } }

        // í˜ì´ì§€ í¬ê¸° ë³€ê²½ (Agent #R04: Performance Optimizer)
        function changePageSize() {
            const newSize = parseInt(document.getElementById('pageSizeSelect').value);
            PAGE_SIZE = newSize;
            currentPage = 1; // ì²« í˜ì´ì§€ë¡œ ë¦¬ì…‹

            // Agent Q03: í˜ì´ì§€ í¬ê¸° ì„¤ì • ì €ì¥
            settings.set('pageSize', newSize);

            updateDataTab();
            log.info(`Page size changed to ${PAGE_SIZE}`);
        }

        // Modal functions
        function showProcessDetail(processKey) {
            const incompleteOrders = filteredData.filter(d => {
                const p = d.production?.[processKey];
                return p && p.status !== 'completed';
            });
            showOrderListModal(`${PROCESS_NAMES[processKey]} ë¯¸ì™„ë£Œ ì˜¤ë”`, incompleteOrders);
        }

        function showDelayedOrders() { showOrderListModal('ğŸš¨ ì§€ì—° ì˜¤ë”', allData.filter(isDelayed)); }
        function showWarningOrders() { showOrderListModal('âš¡ 3ì¼ ë‚´ ì˜ˆì • (ë¯¸ì™„ë£Œ)', allData.filter(isWarning)); }

        function showInventoryOrders() {
            const inventory = allData.filter(d => {
                const whIn = d.production?.wh_in?.completed || 0;
                const whOut = d.production?.wh_out?.completed || 0;
                return whIn > whOut;
            });
            showOrderListModal('ğŸ“¦ ì°½ê³  ì¬ê³  ì˜¤ë”', inventory);
        }

        function showShippedOrders() {
            showOrderListModal('ğŸš¢ ì„ ì  ì™„ë£Œ ì˜¤ë”', allData.filter(isShipped));
        }

        function showVendorDetail(vendor) { showOrderListModal(`${vendor} ìƒì„¸`, filteredData.filter(d => (d.outsoleVendor || '(ë¯¸ì§€ì •)') === vendor)); }
        function showFactoryDetail(factory) { showOrderListModal(`Factory ${factory} ìƒì„¸`, filteredData.filter(d => d.factory === factory)); }
        function showCountryDetail(country) {
            const orders = filteredData.filter(d => {
                if (country === 'South Korea') return d.destination === 'South Korea' || d.destination === 'Korea';
                return d.destination === country;
            });
            showOrderListModal(`${IMPORTANT_DESTINATIONS[country] || ''} ${country} ìƒì„¸`, orders);
        }
        function showModelDetail(model) { showOrderListModal(`${model} ìƒì„¸`, filteredData.filter(d => d.model === model)); }

        /**
         * ëª¨ë‹¬ í…Œì´ë¸” í–‰ HTML ìƒì„± (Phase 5 ìµœì í™”)
         * @param {Object} d - ì˜¤ë” ë°ì´í„°
         * @returns {string} - í…Œì´ë¸” í–‰ HTML
         */
        function createModalTableRowHTML(d) {
            const shipped = isShipped(d);
            const delayed = isDelayed(d);
            const warning = isWarning(d);
            const rowClass = shipped ? 'shipped-highlight' : delayed ? 'delay-highlight' : warning ? 'warning-highlight' : '';
            const globalIndex = allData.indexOf(d);
            return `<tr class="border-b border-theme ${rowClass} clickable-row" data-action="closeAndShowOrderDetail" data-index="${globalIndex}">
                <td class="px-2 py-2">${d.factory}</td>
                <td class="px-2 py-2 text-xs">${escapeHtml(d.poNumber) || '-'}</td>
                <td class="px-2 py-2 text-xs">${escapeHtml(d.model) || '-'}</td>
                <td class="px-2 py-2 text-xs">${escapeHtml(d.article) || '-'}</td>
                <td class="px-2 py-2">${escapeHtml(d.destination) || '-'}</td>
                <td class="px-2 py-2 text-xs">${escapeHtml(d.outsoleVendor) || '-'}</td>
                <td class="px-2 py-2 text-right">${formatNumber(d.quantity || 0)}</td>
                <td class="px-2 py-2 text-center">${getStatusIcon(d.production?.s_cut?.status)}</td>
                <td class="px-2 py-2 text-center">${getStatusIcon(d.production?.sew_bal?.status)}</td>
                <td class="px-2 py-2 text-center">${getStatusIcon(d.production?.ass_bal?.status)}</td>
                <td class="px-2 py-2 text-center">${getStatusIcon(d.production?.wh_in?.status)}</td>
                <td class="px-2 py-2 text-xs">${d.crd || '-'}</td>
                <td class="px-2 py-2 text-xs">${d.sddValue || '-'}</td>
                <td class="px-2 py-2 text-center">${shipped ? '<span class="shipped-badge">ğŸš¢ ì„ ì </span>' : delayed ? 'ğŸš¨' : warning ? 'âš¡' : d.production?.wh_in?.status === 'completed' ? 'âœ…' : 'â³'}</td>
            </tr>`;
        }

        function showOrderListModal(title, orders) {
            document.getElementById('modalTitle').textContent = `${title} (${orders.length}ê±´)`;

            const totalQty = orders.reduce((sum, d) => sum + (d.quantity || 0), 0);
            const totalCompleted = orders.reduce((sum, d) => sum + (d.production?.wh_in?.completed || 0), 0);
            const rate = totalQty > 0 ? (totalCompleted / totalQty * 100) : 0;

            // Phase 5: ëª¨ë‹¬ ìµœì í™” - ì •ì  HTML ë¶€ë¶„
            let html = `<div class="grid grid-cols-4 gap-4 mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div><div class="text-secondary text-sm">ì˜¤ë” ìˆ˜</div><div class="text-xl font-bold">${orders.length}ê±´</div></div>
                <div><div class="text-secondary text-sm">ì£¼ë¬¸ëŸ‰</div><div class="text-xl font-bold">${formatNumber(totalQty)}ì¡±</div></div>
                <div><div class="text-secondary text-sm">ì™„ë£ŒëŸ‰</div><div class="text-xl font-bold text-green-600">${formatNumber(totalCompleted)}ì¡±</div></div>
                <div><div class="text-secondary text-sm">ì™„ë£Œìœ¨</div><div class="text-xl font-bold" style="color: ${rate >= 80 ? '#22c55e' : '#f59e0b'}">${rate.toFixed(1)}%</div></div>
            </div>`;

            html += `<div class="overflow-x-auto"><table class="w-full text-sm" id="modalDataTable">
                <caption class="sr-only">ì˜¤ë” ìƒì„¸ ì •ë³´ í…Œì´ë¸” (ê³µì¥, POë²ˆí˜¸, ëª¨ë¸, ê³µì • ì§„í–‰ ìƒíƒœ í¬í•¨)</caption>
                <thead class="bg-gray-50 dark:bg-gray-700"><tr>
                    <th class="px-2 py-2 text-left">ê³µì¥</th>
                    <th class="px-2 py-2 text-left">PO</th>
                    <th class="px-2 py-2 text-left">ëª¨ë¸</th>
                    <th class="px-2 py-2 text-left">Article</th>
                    <th class="px-2 py-2 text-left">í–‰ì„ ì§€</th>
                    <th class="px-2 py-2 text-left">ì•„ì›ƒì†” ë²¤ë”</th>
                    <th class="px-2 py-2 text-right">ìˆ˜ëŸ‰</th>
                    <th class="px-2 py-2 text-center">ì¬ë‹¨</th>
                    <th class="px-2 py-2 text-center">ì¬ë´‰</th>
                    <th class="px-2 py-2 text-center">ì¡°ë¦½</th>
                    <th class="px-2 py-2 text-center">ì…ê³ </th>
                    <th class="px-2 py-2 text-left">CRD</th>
                    <th class="px-2 py-2 text-left">SDD</th>
                    <th class="px-2 py-2 text-center">ìƒíƒœ</th>
                </tr></thead><tbody></tbody></table></div>`;

            const modalPageSize = 200; // Phase 5: 50 â†’ 200 (ì ì§„ì  ë Œë”ë§ìœ¼ë¡œ ì•ˆì •ì ìœ¼ë¡œ ì²˜ë¦¬)
            const displayOrders = orders.slice(0, modalPageSize);

            if (orders.length > modalPageSize) {
                html += `<div class="mt-4 text-center text-secondary">... ì™¸ ${orders.length - modalPageSize}ê±´ (ì „ì²´ ë³´ê¸°ëŠ” ìƒì„¸ íƒ­ ì´ìš©)</div>`;
            }

            document.getElementById('modalContent').innerHTML = html;

            // Phase 5: ì ì§„ì  ë Œë”ë§ ì ìš©
            const tbody = document.querySelector('#modalDataTable tbody');
            const startTime = performance.now();

            let currentIndex = 0;
            const chunkSize = 50;

            function renderModalChunk() {
                const fragment = document.createDocumentFragment();
                const endIndex = Math.min(currentIndex + chunkSize, displayOrders.length);

                for (let i = currentIndex; i < endIndex; i++) {
                    const d = displayOrders[i];
                    const rowHTML = createModalTableRowHTML(d);
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = rowHTML;
                    fragment.appendChild(tempDiv.firstChild);
                }

                tbody.appendChild(fragment);
                currentIndex = endIndex;

                if (currentIndex < displayOrders.length) {
                    requestAnimationFrame(renderModalChunk);
                } else {
                    const endTime = performance.now();
                    log.info(`Modal table progressive rendering: ${displayOrders.length} rows in ${(endTime - startTime).toFixed(2)}ms`);
                }
            }

            requestAnimationFrame(renderModalChunk);

            const modal = document.getElementById('orderDetailModal');
            modal.classList.remove('hidden');
            trapFocus(modal); // Focus trap for accessibility
        }

        function closeOrderModal() {
            document.getElementById('orderDetailModal').classList.add('hidden');
            releaseFocus(); // Restore focus
        }

        // Order Process Detail Modal (NEW)
        function showOrderProcessDetail(index) {
            const d = allData[index];
            if (!d) return;

            document.getElementById('orderProcessTitle').textContent = `ì˜¤ë” ìƒì„¸: ${escapeHtml(d.poNumber) || '-'}`;

            let html = `
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div><div class="text-secondary text-xs">PO ë²ˆí˜¸</div><div class="font-bold">${escapeHtml(d.poNumber) || '-'}</div></div>
                <div><div class="text-secondary text-xs">Article (PGSC)</div><div class="font-bold">${escapeHtml(d.article) || '-'}</div></div>
                <div><div class="text-secondary text-xs">ëª¨ë¸</div><div class="font-bold text-sm">${escapeHtml(d.model) || '-'}</div></div>
                <div><div class="text-secondary text-xs">ìˆ˜ëŸ‰</div><div class="font-bold">${formatNumber(d.quantity || 0)}ì¡±</div></div>
                <div><div class="text-secondary text-xs">ê³µì¥</div><div class="font-bold">Factory ${d.factory}</div></div>
                <div><div class="text-secondary text-xs">í–‰ì„ ì§€</div><div class="font-bold">${escapeHtml(d.destination) || '-'}</div></div>
                <div><div class="text-secondary text-xs">CRD (ê³ ê°ìš”ì²­ì¼)</div><div class="font-bold">${d.crd || '-'}</div></div>
                <div><div class="text-secondary text-xs">SDD</div><div class="font-bold">${d.sddValue || '-'}</div></div>
                <div><div class="text-secondary text-xs">ì•„ì›ƒì†” ë²¤ë”</div><div class="font-bold">${escapeHtml(d.outsoleVendor) || '-'}</div></div>
                <div><div class="text-secondary text-xs">ìƒ‰ìƒ</div><div class="font-bold">${d.color || '-'}</div></div>
                <div><div class="text-secondary text-xs">ì‹œì¦Œ</div><div class="font-bold">${escapeHtml(d.season) || '-'}</div></div>
                <div><div class="text-secondary text-xs">ë‹¨ìœ„</div><div class="font-bold">${escapeHtml(d.unit) || '-'}</div></div>
                <div><div class="text-secondary text-xs">AQL ê²€ì‚¬</div><div class="font-bold ${d.aql ? 'text-blue-600' : 'text-gray-400'}">${d.aql ? 'âœ… í•„ìš”' : 'ë¶ˆí•„ìš”'}</div></div>
            </div>

            <h4 class="font-semibold mb-3 mt-4">ğŸ“¦ ì”ëŸ‰ í˜„í™©</h4>
            <div class="grid grid-cols-5 gap-2 mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                <div class="text-center p-2 rounded ${(d.remaining?.osc || 0) > 0 ? 'bg-yellow-100 dark:bg-yellow-900' : 'bg-green-100 dark:bg-green-900'}">
                    <div class="text-xs text-secondary">ì™¸ì£¼ ì”ëŸ‰</div>
                    <div class="font-bold ${(d.remaining?.osc || 0) > 0 ? 'text-yellow-700' : 'text-green-700'}">${formatNumber(d.remaining?.osc || 0)}</div>
                </div>
                <div class="text-center p-2 rounded ${(d.remaining?.sew || 0) > 0 ? 'bg-yellow-100 dark:bg-yellow-900' : 'bg-green-100 dark:bg-green-900'}">
                    <div class="text-xs text-secondary">ì¬ë´‰ ì”ëŸ‰</div>
                    <div class="font-bold ${(d.remaining?.sew || 0) > 0 ? 'text-yellow-700' : 'text-green-700'}">${formatNumber(d.remaining?.sew || 0)}</div>
                </div>
                <div class="text-center p-2 rounded ${(d.remaining?.ass || 0) > 0 ? 'bg-yellow-100 dark:bg-yellow-900' : 'bg-green-100 dark:bg-green-900'}">
                    <div class="text-xs text-secondary">ì œí™” ì”ëŸ‰</div>
                    <div class="font-bold ${(d.remaining?.ass || 0) > 0 ? 'text-yellow-700' : 'text-green-700'}">${formatNumber(d.remaining?.ass || 0)}</div>
                </div>
                <div class="text-center p-2 rounded ${(d.remaining?.whIn || 0) > 0 ? 'bg-yellow-100 dark:bg-yellow-900' : 'bg-green-100 dark:bg-green-900'}">
                    <div class="text-xs text-secondary">ì…ê³  ì”ëŸ‰</div>
                    <div class="font-bold ${(d.remaining?.whIn || 0) > 0 ? 'text-yellow-700' : 'text-green-700'}">${formatNumber(d.remaining?.whIn || 0)}</div>
                </div>
                <div class="text-center p-2 rounded ${(d.remaining?.whOut || 0) > 0 ? 'bg-yellow-100 dark:bg-yellow-900' : 'bg-green-100 dark:bg-green-900'}">
                    <div class="text-xs text-secondary">ì¶œê³  ì”ëŸ‰</div>
                    <div class="font-bold ${(d.remaining?.whOut || 0) > 0 ? 'text-yellow-700' : 'text-green-700'}">${formatNumber(d.remaining?.whOut || 0)}</div>
                </div>
            </div>

            <h4 class="font-semibold mb-4">ğŸ“Š ê³µì •ë³„ ìƒì‚° í˜„í™©</h4>
            <div class="process-timeline mb-6 justify-center">`;

            PROCESS_ORDER.forEach((key, i) => {
                const p = d.production?.[key];
                const completed = p?.completed || 0;
                const pending = p?.pending || 0;
                const total = completed + pending;
                const status = p?.status || 'pending';

                let stepClass = 'pending';
                if (status === 'completed') stepClass = 'completed';
                else if (status === 'partial') stepClass = 'in-progress';

                html += `
                <div class="process-step ${stepClass}">
                    <div class="text-xs font-medium mb-1">${PROCESS_NAMES[key]}</div>
                    <div class="text-lg font-bold">${status === 'completed' ? 'âœ…' : status === 'partial' ? 'ğŸ”„' : 'â³'}</div>
                    <div class="text-xs">${formatNumber(completed)}/${formatNumber(total)}</div>
                    <div class="text-xs text-secondary">${total > 0 ? ((completed/total)*100).toFixed(0) : 0}%</div>
                </div>`;

                if (i < PROCESS_ORDER.length - 1) {
                    html += '<div class="process-arrow">â†’</div>';
                }
            });

            html += `</div>

            <h4 class="font-semibold mb-4">ğŸ“ˆ ê³µì •ë³„ ìƒì„¸ í˜„í™©</h4>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <caption class="sr-only">ê³µì •ë³„ ì™„ë£Œ í˜„í™© í…Œì´ë¸” (ì™„ë£Œ/ë¯¸ì™„ë£Œ ìˆ˜ëŸ‰ ë° ì™„ë£Œìœ¨)</caption>
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th class="px-3 py-2 text-left">ê³µì •</th>
                            <th class="px-3 py-2 text-right">ì™„ë£Œ</th>
                            <th class="px-3 py-2 text-right">ë¯¸ì™„ë£Œ</th>
                            <th class="px-3 py-2 text-right">í•©ê³„</th>
                            <th class="px-3 py-2 text-right">ì™„ë£Œìœ¨</th>
                            <th class="px-3 py-2 text-center">ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody>`;

            PROCESS_ORDER.forEach(key => {
                const p = d.production?.[key];
                const completed = p?.completed || 0;
                const pending = p?.pending || 0;
                const total = completed + pending;
                const rate = total > 0 ? (completed / total * 100) : 0;
                const status = p?.status || 'pending';
                const statusIcon = status === 'completed' ? 'âœ… ì™„ë£Œ' : status === 'partial' ? 'ğŸ”„ ì§„í–‰ì¤‘' : 'â³ ëŒ€ê¸°';
                const rateColor = rate >= 100 ? '#22c55e' : rate >= 50 ? '#f59e0b' : '#ef4444';

                html += `<tr class="border-b border-theme">
                    <td class="px-3 py-2 font-medium">${PROCESS_NAMES[key]}</td>
                    <td class="px-3 py-2 text-right text-green-600">${formatNumber(completed)}</td>
                    <td class="px-3 py-2 text-right text-gray-500">${formatNumber(pending)}</td>
                    <td class="px-3 py-2 text-right">${formatNumber(total)}</td>
                    <td class="px-3 py-2 text-right font-medium" style="color: ${rateColor}">${rate.toFixed(1)}%</td>
                    <td class="px-3 py-2 text-center">${statusIcon}</td>
                </tr>`;
            });

            html += `</tbody></table></div>`;

            document.getElementById('orderProcessContent').innerHTML = html;
            const modal = document.getElementById('orderProcessModal');
            modal.classList.remove('hidden');
            trapFocus(modal); // Focus trap for accessibility
        }

        function closeOrderProcessModal() {
            document.getElementById('orderProcessModal').classList.add('hidden');
            releaseFocus(); // Restore focus
        }

        // Keyboard handling
        function handleKeyboard(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;

            switch(e.key.toLowerCase()) {
                case 's': document.getElementById('searchInput').focus(); e.preventDefault(); break;
                case 'f': document.getElementById('monthFilter').focus(); e.preventDefault(); break;
                case 'r': resetAllFilters(); break;
                case 'd': document.querySelector('[data-tab="data"]').click(); break;
                case 'escape': closeOrderModal(); closeOrderProcessModal(); break;
                case 'arrowleft': if (document.querySelector('[data-tab="data"]').classList.contains('tab-active')) prevPage(); break;
                case 'arrowright': if (document.querySelector('[data-tab="data"]').classList.contains('tab-active')) nextPage(); break;
            }
        }

        // Utility functions
        // XSS ë°©ì§€ë¥¼ ìœ„í•œ HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
        function escapeHtml(str) {
            if (str === null || str === undefined) return '';
            const div = document.createElement('div');
            div.textContent = String(str);
            return div.innerHTML;
        }

        function formatNumber(num) { return num.toLocaleString('ko-KR'); }
        function debounce(fn, delay) { let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), delay); }; }
        // Agent P07: ì¤‘ë³µ ì œê±° - getIcon() ì „ì—­ ìœ í‹¸ í•¨ìˆ˜
        function getStatusIcon(status) {
            if (status === 'completed') return 'âœ…';
            if (status === 'partial') return 'ğŸ”„';
            return 'â³';
        }
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            document.getElementById('darkModeIcon').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';

            // Agent Q09: aria-pressed ì—…ë°ì´íŠ¸
            const darkModeBtn = document.querySelector('button[data-action="toggleDarkMode"]');
            if (darkModeBtn) {
                darkModeBtn.setAttribute('aria-pressed', isDark ? 'true' : 'false');
            }

            // Agent Q03: ë‹¤í¬ëª¨ë“œ ì„¤ì • ì €ì¥
            settings.set('darkMode', isDark);

            // ì°¨íŠ¸ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            const textColor = isDark ? '#f9fafb' : '#1f2937';
            const borderColor = isDark ? '#4b5563' : '#e5e7eb';
            Chart.defaults.color = textColor;
            Chart.defaults.borderColor = borderColor;

            // ëª¨ë“  ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            Object.values(Chart.instances).forEach((instance) => {
                if (instance.options.scales) {
                    ['x', 'y', 'r'].forEach(axis => {
                        if (instance.options.scales[axis]) {
                            instance.options.scales[axis].ticks = instance.options.scales[axis].ticks || {};
                            instance.options.scales[axis].ticks.color = textColor;
                            instance.options.scales[axis].grid = instance.options.scales[axis].grid || {};
                            instance.options.scales[axis].grid.color = borderColor;
                        }
                    });
                }
                if (instance.options.plugins?.legend?.labels) {
                    instance.options.plugins.legend.labels.color = textColor;
                }
                instance.update();
            });
            updateDashboard();
        }

        // ========================================
        // Agent Q01: Data Export Specialist
        // Phase 4 - Step 5: Q01-1 (HIGH)
        // ========================================

        // ë‚´ë³´ë‚´ê¸° ë°ì´í„° ì¤€ë¹„ (Excel/CSV ê³µí†µ)
        // Agent Q01: ë‚´ë³´ë‚´ê¸° ë°ì´í„° ì¤€ë¹„ (Phase 4 - Q01-3 í™•ì¥: ì»¬ëŸ¼ í•„í„°ë§)
        function prepareExportData() {
            const exportCols = settings.get('exportColumns') || {};

            return filteredData.map(d => {
                const row = {};

                // ì„ íƒëœ ì»¬ëŸ¼ë§Œ ì¶”ê°€
                if (exportCols.factory !== false) row['ê³µì¥'] = d.factory;
                if (exportCols.poNumber !== false) row['POë²ˆí˜¸'] = d.poNumber;
                if (exportCols.model !== false) row['ëª¨ë¸'] = d.model;
                if (exportCols.article !== false) row['Article'] = d.article;
                if (exportCols.destination !== false) row['í–‰ì„ ì§€'] = d.destination;
                if (exportCols.outsoleVendor !== false) row['ì•„ì›ƒì†”ë²¤ë”'] = d.outsoleVendor;
                if (exportCols.quantity !== false) row['ìˆ˜ëŸ‰'] = d.quantity;
                if (exportCols.crd !== false) row['CRD'] = d.crd;
                if (exportCols.sdd !== false) row['SDD'] = d.sddValue;
                if (exportCols.cutting !== false) row['ì¬ë‹¨ì™„ë£Œ'] = d.production?.s_cut?.completed || 0;
                if (exportCols.sewing !== false) row['ì¬ë´‰ì™„ë£Œ'] = d.production?.sew_bal?.completed || 0;
                if (exportCols.assembly !== false) row['ì¡°ë¦½ì™„ë£Œ'] = d.production?.ass_bal?.completed || 0;
                if (exportCols.warehouseIn !== false) row['ì…ê³ ì™„ë£Œ'] = d.production?.wh_in?.completed || 0;
                if (exportCols.status !== false) row['ìƒíƒœ'] = d.production?.wh_in?.status || 'pending';
                if (exportCols.delayed !== false) row['ì§€ì—°'] = isDelayed(d) ? 'Y' : 'N';
                if (exportCols.warning !== false) row['ê²½ê³ '] = isWarning(d) ? 'Y' : 'N';

                return row;
            });
        }

        // Excel ë‚´ë³´ë‚´ê¸°
        // Agent Q01-6: ì²­í¬ ì²˜ë¦¬ ì§€ì›
        async function exportToExcel() {
            const exportData = prepareExportData();

            if (exportData.length === 0) {
                alert('âš ï¸ ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²­í¬ ì²˜ë¦¬ (1000ê±´ ì´ìƒ)
            if (exportData.length > 1000) {
                log.info(`Large Excel export (${exportData.length} rows), using chunk processing`);
                showChunkProgress();

                const chunkProcessor = new ChunkProcessor({
                    chunkSize: 500,
                    delay: 10,
                    onProgress: updateChunkProgress
                });

                try {
                    const allRows = [];
                    await chunkProcessor.process(exportData, async (chunk) => {
                        allRows.push(...chunk);
                        return [];  // ê²°ê³¼ëŠ” allRowsì— ì§ì ‘ ì¶”ê°€
                    });

                    const ws = XLSX.utils.json_to_sheet(allRows);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'Data');
                    const filename = `rachgia_export_${new Date().toISOString().slice(0,10)}.xlsx`;
                    XLSX.writeFile(wb, filename);

                    hideChunkProgress();
                    log.info(`Exported ${allRows.length} rows to Excel: ${filename}`);
                } catch (error) {
                    hideChunkProgress();
                    alert('âš ï¸ Excel ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    log.error('Excel export error:', error);
                }
            } else {
                // ì†ŒëŸ‰ ë°ì´í„°ëŠ” ì¼ê´„ ì²˜ë¦¬
                const ws = XLSX.utils.json_to_sheet(exportData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Data');
                const filename = `rachgia_export_${new Date().toISOString().slice(0,10)}.xlsx`;
                XLSX.writeFile(wb, filename);
                log.info(`Exported ${exportData.length} rows to Excel: ${filename}`);
            }
        }

        // Agent Q01: ë‹¤ì¤‘ ì‹œíŠ¸ Excel ë‚´ë³´ë‚´ê¸° (Phase 4 - Q01-4)
        // Agent Q01-6: ì²­í¬ ì²˜ë¦¬ ì§€ì›
        async function exportToExcelMultiSheet(groupBy) {
            const exportData = prepareExportData();

            if (exportData.length === 0) {
                alert('âš ï¸ ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²­í¬ ì²˜ë¦¬ (1000ê±´ ì´ìƒ)
            if (exportData.length > 1000) {
                log.info(`Large multi-sheet export (${exportData.length} rows), using chunk processing`);
                showChunkProgress();

                const chunkProcessor = new ChunkProcessor({
                    chunkSize: 500,
                    delay: 10,
                    onProgress: updateChunkProgress
                });

                try {
                    // ë°ì´í„° ê·¸ë£¹í™” (ì²­í¬ ë‹¨ìœ„ë¡œ ì²˜ë¦¬)
                    const grouped = {};
                    await chunkProcessor.process(exportData, async (chunk) => {
                        chunk.forEach(row => {
                            let key;
                            if (groupBy === 'month') {
                                // CRD ê¸°ì¤€ ì›”ë³„ ê·¸ë£¹í™”
                                const crd = row['CRD'] || '';
                                key = crd.slice(0, 7) || 'Unknown';  // YYYY-MM
                            } else if (groupBy === 'factory') {
                                // ê³µì¥ë³„ ê·¸ë£¹í™”
                                key = row['ê³µì¥'] || 'Unknown';
                            } else {
                                key = 'Data';
                            }

                            if (!grouped[key]) {
                                grouped[key] = [];
                            }
                            grouped[key].push(row);
                        });
                        return [];  // ê²°ê³¼ëŠ” groupedì— ì§ì ‘ ì¶”ê°€
                    });

                    // ì›Œí¬ë¶ ìƒì„±
                    const wb = XLSX.utils.book_new();

                    // ê·¸ë£¹ë³„ë¡œ ì‹œíŠ¸ ìƒì„± (ì•ŒíŒŒë²³ìˆœ ì •ë ¬)
                    const sortedKeys = Object.keys(grouped).sort();
                    sortedKeys.forEach(key => {
                        const sheetData = grouped[key];
                        const ws = XLSX.utils.json_to_sheet(sheetData);

                        // ì‹œíŠ¸ ì´ë¦„ ì •ì œ (Excel ì‹œíŠ¸ëª… ì œí•œ: 31ì, íŠ¹ìˆ˜ë¬¸ì ì œì™¸)
                        let sheetName = key.replace(/[\[\]\:\*\?\/\\]/g, '_').slice(0, 31);
                        XLSX.utils.book_append_sheet(wb, ws, sheetName);
                    });

                    // íŒŒì¼ ì €ì¥
                    const groupLabel = groupBy === 'month' ? 'monthly' : 'factory';
                    const filename = `rachgia_export_${groupLabel}_${new Date().toISOString().slice(0,10)}.xlsx`;
                    XLSX.writeFile(wb, filename);

                    hideChunkProgress();
                    log.info(`Exported ${exportData.length} rows to ${sortedKeys.length} sheets (${groupLabel}): ${filename}`);
                } catch (error) {
                    hideChunkProgress();
                    alert('âš ï¸ ë‹¤ì¤‘ ì‹œíŠ¸ Excel ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    log.error('Multi-sheet Excel export error:', error);
                }
            } else {
                // ì†ŒëŸ‰ ë°ì´í„°ëŠ” ì¼ê´„ ì²˜ë¦¬
                const grouped = {};
                exportData.forEach(row => {
                    let key;
                    if (groupBy === 'month') {
                        // CRD ê¸°ì¤€ ì›”ë³„ ê·¸ë£¹í™”
                        const crd = row['CRD'] || '';
                        key = crd.slice(0, 7) || 'Unknown';  // YYYY-MM
                    } else if (groupBy === 'factory') {
                        // ê³µì¥ë³„ ê·¸ë£¹í™”
                        key = row['ê³µì¥'] || 'Unknown';
                    } else {
                        key = 'Data';
                    }

                    if (!grouped[key]) {
                        grouped[key] = [];
                    }
                    grouped[key].push(row);
                });

                // ì›Œí¬ë¶ ìƒì„±
                const wb = XLSX.utils.book_new();

                // ê·¸ë£¹ë³„ë¡œ ì‹œíŠ¸ ìƒì„± (ì•ŒíŒŒë²³ìˆœ ì •ë ¬)
                const sortedKeys = Object.keys(grouped).sort();
                sortedKeys.forEach(key => {
                    const sheetData = grouped[key];
                    const ws = XLSX.utils.json_to_sheet(sheetData);

                    // ì‹œíŠ¸ ì´ë¦„ ì •ì œ (Excel ì‹œíŠ¸ëª… ì œí•œ: 31ì, íŠ¹ìˆ˜ë¬¸ì ì œì™¸)
                    let sheetName = key.replace(/[\[\]\:\*\?\/\\]/g, '_').slice(0, 31);
                    XLSX.utils.book_append_sheet(wb, ws, sheetName);
                });

                // íŒŒì¼ ì €ì¥
                const groupLabel = groupBy === 'month' ? 'monthly' : 'factory';
                const filename = `rachgia_export_${groupLabel}_${new Date().toISOString().slice(0,10)}.xlsx`;
                XLSX.writeFile(wb, filename);
                log.info(`Exported ${exportData.length} rows to ${sortedKeys.length} sheets (${groupLabel}): ${filename}`);
            }
        }

        // CSV ë‚´ë³´ë‚´ê¸° (UTF-8 BOM í¬í•¨ - í•œê¸€ Excel í˜¸í™˜)
        // Agent Q01-6: ì²­í¬ ì²˜ë¦¬ ì§€ì›
        async function exportToCSV() {
            const exportData = prepareExportData();

            if (exportData.length === 0) {
                alert('âš ï¸ ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // CSV í—¤ë” (ì²« ë²ˆì§¸ ê°ì²´ì˜ í‚¤)
            const headers = Object.keys(exportData[0]);
            const csvRows = [];

            // í—¤ë” í–‰ ì¶”ê°€
            csvRows.push(headers.join(','));

            // ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²­í¬ ì²˜ë¦¬ (1000ê±´ ì´ìƒ)
            if (exportData.length > 1000) {
                log.info(`Large CSV export (${exportData.length} rows), using chunk processing`);
                showChunkProgress();

                const chunkProcessor = new ChunkProcessor({
                    chunkSize: 500,
                    delay: 10,
                    onProgress: updateChunkProgress
                });

                try {
                    await chunkProcessor.process(exportData, async (chunk) => {
                        const chunkRows = chunk.map(row => {
                            const values = headers.map(header => {
                                const value = String(row[header] || '');
                                // ì‰¼í‘œ, í°ë”°ì˜´í‘œ, ì¤„ë°”ê¿ˆì´ ìˆìœ¼ë©´ í°ë”°ì˜´í‘œë¡œ ê°ì‹¸ê¸°
                                if (value.includes(',') || value.includes('"') || value.includes('\n')) {
                                    return `"${value.replace(/"/g, '""')}"`;
                                }
                                return value;
                            });
                            return values.join(',');
                        });
                        csvRows.push(...chunkRows);
                        return [];  // ê²°ê³¼ëŠ” csvRowsì— ì§ì ‘ ì¶”ê°€
                    });

                    hideChunkProgress();
                } catch (error) {
                    hideChunkProgress();
                    alert('âš ï¸ CSV ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    log.error('CSV export error:', error);
                    return;
                }
            } else {
                // ì†ŒëŸ‰ ë°ì´í„°ëŠ” ì¼ê´„ ì²˜ë¦¬
                exportData.forEach(row => {
                    const values = headers.map(header => {
                        const value = String(row[header] || '');
                        // ì‰¼í‘œ, í°ë”°ì˜´í‘œ, ì¤„ë°”ê¿ˆì´ ìˆìœ¼ë©´ í°ë”°ì˜´í‘œë¡œ ê°ì‹¸ê¸°
                        if (value.includes(',') || value.includes('"') || value.includes('\n')) {
                            return `"${value.replace(/"/g, '""')}"`;
                        }
                        return value;
                    });
                    csvRows.push(values.join(','));
                });
            }

            // UTF-8 BOM ì¶”ê°€ (Excelì—ì„œ í•œê¸€ ê¹¨ì§ ë°©ì§€)
            const BOM = '\uFEFF';
            const csvContent = BOM + csvRows.join('\n');

            // Blob ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            const filename = `rachgia_export_${new Date().toISOString().slice(0,10)}.csv`;

            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);  // ë©”ëª¨ë¦¬ í•´ì œ

            log.info(`Exported ${exportData.length} rows to CSV: ${filename}`);
        }

        // ========================================
        // Agent Q01: PDF ë³´ê³ ì„œ ìƒì„±
        // Phase 4 - Step 5: Q01-2 (HIGH)
        // ========================================
        function exportToPDF() {
            const exportData = prepareExportData();

            if (exportData.length === 0) {
                alert('âš ï¸ ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // jsPDF ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape', 'mm', 'a4');

            // í•œê¸€ í°íŠ¸ ì„¤ì • (ê¸°ë³¸ í°íŠ¸ ì‚¬ìš©, í•œê¸€ì€ ì´ë¯¸ì§€ë¡œ ë Œë”ë§)
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();

            // 1. ë³´ê³ ì„œ í—¤ë”
            doc.setFontSize(18);
            doc.setTextColor(59, 130, 246);
            doc.text('Rachgia Factory Production Report', pageWidth / 2, 15, { align: 'center' });

            doc.setFontSize(10);
            doc.setTextColor(107, 114, 128);
            const today = new Date().toISOString().slice(0, 10);
            doc.text(`Generated: ${today}`, pageWidth / 2, 22, { align: 'center' });

            // 2. í•„í„° ì •ë³´
            const filters = [];
            const monthVal = document.getElementById('monthFilter').value;
            const destVal = document.getElementById('destFilter').value;
            const vendorVal = document.getElementById('vendorFilter').value;
            const statusVal = document.getElementById('statusFilter').value;
            const factoryVal = document.querySelector('#factoryFilter .filter-chip.active')?.textContent;

            if (monthVal) filters.push(`Month: ${monthVal}`);
            if (destVal) filters.push(`Destination: ${destVal}`);
            if (vendorVal) filters.push(`Vendor: ${vendorVal}`);
            if (statusVal) filters.push(`Status: ${statusVal}`);
            if (factoryVal && factoryVal !== 'All') filters.push(`Factory: ${factoryVal}`);

            if (filters.length > 0) {
                doc.setFontSize(9);
                doc.setTextColor(75, 85, 99);
                doc.text(`Filters: ${filters.join(' | ')}`, 15, 30);
            }

            // 3. ìš”ì•½ í†µê³„
            const totalOrders = exportData.length;
            const delayedCount = exportData.filter(d => d['ì§€ì—°'] === 'Y').length;
            const warningCount = exportData.filter(d => d['ê²½ê³ '] === 'Y').length;
            const completedCount = exportData.filter(d => d['ìƒíƒœ'] === 'completed').length;

            doc.setFontSize(10);
            doc.setTextColor(31, 41, 55);
            let yPos = filters.length > 0 ? 38 : 30;

            doc.text(`Total Orders: ${formatNumber(totalOrders)}`, 15, yPos);
            doc.setTextColor(220, 38, 38);
            doc.text(`Delayed: ${formatNumber(delayedCount)} (${(delayedCount/totalOrders*100).toFixed(1)}%)`, 70, yPos);
            doc.setTextColor(245, 158, 11);
            doc.text(`Warning: ${formatNumber(warningCount)} (${(warningCount/totalOrders*100).toFixed(1)}%)`, 125, yPos);
            doc.setTextColor(16, 185, 129);
            doc.text(`Completed: ${formatNumber(completedCount)} (${(completedCount/totalOrders*100).toFixed(1)}%)`, 180, yPos);

            // 4. ë°ì´í„° í…Œì´ë¸” (autoTable í”ŒëŸ¬ê·¸ì¸ ì‚¬ìš©)
            doc.setTextColor(31, 41, 55);
            const tableStartY = yPos + 8;

            // ì£¼ìš” ì»¬ëŸ¼ë§Œ ì„ íƒ (í˜ì´ì§€ ë„ˆë¹„ ê³ ë ¤)
            const tableData = exportData.map(d => [
                d['ê³µì¥'] || '',
                d['POë²ˆí˜¸'] || '',
                d['ëª¨ë¸'] || '',
                d['í–‰ì„ ì§€'] || '',
                d['ìˆ˜ëŸ‰'] || '',
                d['CRD'] || '',
                d['SDD'] || '',
                d['ì¬ë‹¨ì™„ë£Œ'] || '',
                d['ì¬ë´‰ì™„ë£Œ'] || '',
                d['ì¡°ë¦½ì™„ë£Œ'] || '',
                d['ì…ê³ ì™„ë£Œ'] || '',
                d['ìƒíƒœ'] || '',
                d['ì§€ì—°'] || '',
                d['ê²½ê³ '] || ''
            ]);

            doc.autoTable({
                startY: tableStartY,
                head: [['Factory', 'PO Number', 'Model', 'Dest', 'Qty', 'CRD', 'SDD', 'Cut', 'Sew', 'Ass', 'WH-In', 'Status', 'Delay', 'Warn']],
                body: tableData,
                styles: {
                    fontSize: 7,
                    cellPadding: 1.5,
                    overflow: 'linebreak',
                    halign: 'center'
                },
                headStyles: {
                    fillColor: [59, 130, 246],
                    textColor: [255, 255, 255],
                    fontSize: 8,
                    fontStyle: 'bold'
                },
                alternateRowStyles: {
                    fillColor: [249, 250, 251]
                },
                // ì§€ì—°/ê²½ê³  í–‰ ê°•ì¡°
                didParseCell: function(data) {
                    if (data.section === 'body') {
                        const rowData = exportData[data.row.index];
                        if (rowData['ì§€ì—°'] === 'Y') {
                            data.cell.styles.fillColor = [254, 226, 226];
                            data.cell.styles.textColor = [127, 29, 29];
                        } else if (rowData['ê²½ê³ '] === 'Y') {
                            data.cell.styles.fillColor = [254, 243, 199];
                            data.cell.styles.textColor = [120, 53, 15];
                        }
                    }
                },
                margin: { left: 15, right: 15 },
                tableWidth: 'auto',
                theme: 'grid'
            });

            // 5. í‘¸í„° (í˜ì´ì§€ ë²ˆí˜¸)
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(156, 163, 175);
                doc.text(
                    `Page ${i} of ${pageCount} | Rachgia Dashboard v17`,
                    pageWidth / 2,
                    pageHeight - 10,
                    { align: 'center' }
                );
            }

            // 6. PDF ë‹¤ìš´ë¡œë“œ
            const filename = `rachgia_report_${today}.pdf`;
            doc.save(filename);

            log.info(`Exported ${exportData.length} rows to PDF: ${filename}`);
        }

        // ë‚´ë³´ë‚´ê¸° ì˜µì…˜ í‘œì‹œ
        // Agent Q01: ë‚´ë³´ë‚´ê¸° ì˜µì…˜ ëª¨ë‹¬ (Phase 4 - Q01-4 í™•ì¥)
        function showExportOptions() {
            const options = `
                <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" id="exportModal">
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <h3 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                            í˜„ì¬ í•„í„°ëœ <strong>${formatNumber(filteredData.length)}ê±´</strong>ì˜ ë°ì´í„°ë¥¼ ë‚´ë³´ëƒ…ë‹ˆë‹¤.
                        </p>

                        <!-- Excel ì˜µì…˜ -->
                        <div class="mb-4">
                            <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">ğŸ“Š Excel</h4>
                            <div class="space-y-2">
                                <button data-action="exportToExcelAndClose"
                                    class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium text-left flex items-center gap-2">
                                    <span>ğŸ“Š</span>
                                    <div class="flex-1">
                                        <div>Excel ë‹¨ì¼ ì‹œíŠ¸ (.xlsx)</div>
                                        <div class="text-xs opacity-80">ëª¨ë“  ë°ì´í„°ë¥¼ í•˜ë‚˜ì˜ ì‹œíŠ¸ì—</div>
                                    </div>
                                </button>
                                <button data-action="exportToExcelMultiSheetAndClose" data-sheet-type="month"
                                    class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium text-left flex items-center gap-2">
                                    <span>ğŸ“…</span>
                                    <div class="flex-1">
                                        <div>Excel ì›”ë³„ ì‹œíŠ¸ (.xlsx)</div>
                                        <div class="text-xs opacity-80">CRD ê¸°ì¤€ ì›”ë³„ë¡œ ì‹œíŠ¸ ë¶„í• </div>
                                    </div>
                                </button>
                                <button data-action="exportToExcelMultiSheetAndClose" data-sheet-type="factory"
                                    class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium text-left flex items-center gap-2">
                                    <span>ğŸ­</span>
                                    <div class="flex-1">
                                        <div>Excel ê³µì¥ë³„ ì‹œíŠ¸ (.xlsx)</div>
                                        <div class="text-xs opacity-80">Factory A/B/C/Dë³„ë¡œ ì‹œíŠ¸ ë¶„í• </div>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- Agent Q01-3: ì»¬ëŸ¼ ì„ íƒ -->
                        <div class="mb-4 border-t border-gray-200 dark:border-gray-700 pt-4">
                            <button data-action="closeModalAndShowColumnSelection" data-modal-id="exportModal"
                                class="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium flex items-center justify-center gap-2">
                                ğŸ“‹ ë‚´ë³´ë‚´ê¸° ì»¬ëŸ¼ ì„ íƒ
                            </button>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 text-center">
                                ì›í•˜ëŠ” ì»¬ëŸ¼ë§Œ ì„ íƒí•˜ì—¬ ë‚´ë³´ë‚´ê¸°
                            </p>
                        </div>

                        <!-- ê¸°íƒ€ ì˜µì…˜ -->
                        <div class="space-y-2">
                            <button data-action="exportToCSVAndClose"
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium flex items-center justify-center gap-2">
                                ğŸ“„ CSV (.csv)
                            </button>
                            <button data-action="exportToPDFAndClose"
                                class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium flex items-center justify-center gap-2">
                                ğŸ“• PDF Report (.pdf)
                            </button>
                            <button data-action="removeModal" data-modal-id="exportModal"
                                class="w-full bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white px-4 py-2 rounded-lg font-medium">
                                ì·¨ì†Œ
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', options);
        }

        // ========================================
        // ê²½ì˜ì§„ ì¸ì‚¬ì´íŠ¸ KPI ê³„ì‚° í•¨ìˆ˜ë“¤
        // ========================================
        const UNIT_PRICE = 10; // 1ì¡±ë‹¹ í‰ê·  ë‹¨ê°€ ($10)

        // OTD (On-Time Delivery) ê³„ì‚°
        function calculateOTDRate() {
            const completed = filteredData.filter(d => {
                const whOutCompleted = d.production?.wh_out?.completed || 0;
                return whOutCompleted >= (d.quantity || 0);
            });

            const onTime = completed.filter(d => {
                if (!d.sddValue || !d.crd) return true;
                const sdd = new Date(d.sddValue);
                const crd = new Date(d.crd);
                return sdd <= crd;
            });

            return {
                rate: completed.length > 0 ? (onTime.length / completed.length * 100) : 100,
                onTimeCount: onTime.length,
                completedCount: completed.length,
                totalCount: filteredData.length
            };
        }

        // ìœ„í—˜ ë§¤ì¶œì•¡ ê³„ì‚° (ì§€ì—° ìˆ˜ëŸ‰ Ã— ë‹¨ê°€)
        function calculateRevenueAtRisk() {
            let delayedQty = 0;
            let delayedOrders = 0;

            filteredData.forEach(d => {
                if (d.isDelayed) {
                    const whOutCompleted = d.production?.wh_out?.completed || 0;
                    const remaining = Math.max(0, (d.quantity || 0) - whOutCompleted);
                    delayedQty += remaining;
                    delayedOrders++;
                }
            });

            return {
                revenue: delayedQty * UNIT_PRICE,
                quantity: delayedQty,
                orders: delayedOrders
            };
        }

        // AQL í•©ê²©ë¥  ê³„ì‚°
        function calculateAQLStats() {
            const withAQL = filteredData.filter(d => d.aql !== undefined && d.aql !== null);
            const passed = withAQL.filter(d => d.aql === true || d.aql === 'true' || d.aql === 'Y');

            return {
                rate: withAQL.length > 0 ? (passed.length / withAQL.length * 100) : 100,
                passedCount: passed.length,
                inspectedCount: withAQL.length
            };
        }

        // ì§€ì—° ì‹¬ê°ë„ ë¶„ë¥˜ (ê²½ë¯¸: 1-3ì¼, ì£¼ì˜: 4-7ì¼, ì‹¬ê°: 7ì¼+)
        function calculateDelaySeverity() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            let minor = 0, moderate = 0, severe = 0;

            filteredData.forEach(d => {
                if (d.isDelayed && d.crd) {
                    const crd = new Date(d.crd);
                    const diffDays = Math.floor((today - crd) / (1000 * 60 * 60 * 24));

                    if (diffDays <= 3) minor++;
                    else if (diffDays <= 7) moderate++;
                    else severe++;
                }
            });

            return { minor, moderate, severe, total: minor + moderate + severe };
        }

        // ì§€ì—° ì›ì¸ ë¶„ì„ (ì²« ë²ˆì§¸ ë¯¸ì™„ë£Œ ê³µì •)
        function analyzeRootCause() {
            const causeCounts = {};

            filteredData.forEach(d => {
                if (d.isDelayed) {
                    // ì²« ë²ˆì§¸ ë¯¸ì™„ë£Œ ê³µì • ì°¾ê¸°
                    for (const key of PROCESS_ORDER) {
                        const p = d.production?.[key];
                        const completed = p?.completed || 0;
                        const total = (p?.completed || 0) + (p?.pending || 0);

                        if (total > 0 && completed < total) {
                            const name = PROCESS_NAMES[key] || key;
                            causeCounts[name] = (causeCounts[name] || 0) + 1;
                            break;
                        }
                    }
                }
            });

            // ì •ë ¬í•˜ì—¬ ìƒìœ„ 5ê°œ ë°˜í™˜
            return Object.entries(causeCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
        }

        // ê²½ì˜ì§„ ì¸ì‚¬ì´íŠ¸ ì—…ë°ì´íŠ¸
        function updateExecutiveInsights() {
            const otd = calculateOTDRate();
            const revenue = calculateRevenueAtRisk();
            const aql = calculateAQLStats();
            const severity = calculateDelaySeverity();
            const rootCause = analyzeRootCause();
            const vendors = calculateVendorPerformance();
            const bottleneck = predictBottleneck();

            // OTD Rate - HTML ID: kpiOtdRate, kpiOtdOrders
            const kpiOtdRate = document.getElementById('kpiOtdRate');
            const kpiOtdOrders = document.getElementById('kpiOtdOrders');
            if (kpiOtdRate) {
                const statusEmoji = otd.rate >= 95 ? 'âœ…' : otd.rate >= 85 ? 'âš ï¸' : 'ğŸš¨';
                kpiOtdRate.textContent = otd.rate.toFixed(1) + '%';
                kpiOtdRate.className = 'text-3xl font-bold ' + (otd.rate >= 95 ? 'text-green-300' : otd.rate >= 85 ? 'text-yellow-300' : 'text-red-300');
                if (kpiOtdOrders) kpiOtdOrders.textContent = `${statusEmoji} ${otd.onTimeCount}/${otd.completedCount}ê±´ ì •ì‹œ`;
            }

            // Revenue at Risk - HTML ID: kpiRevenueRisk, kpiRiskOrders
            const kpiRevenueRisk = document.getElementById('kpiRevenueRisk');
            const kpiRiskOrders = document.getElementById('kpiRiskOrders');
            if (kpiRevenueRisk) {
                kpiRevenueRisk.textContent = '$' + formatNumber(revenue.revenue);
                kpiRevenueRisk.className = 'text-3xl font-bold ' + (revenue.revenue === 0 ? 'text-green-300' : revenue.revenue < 50000 ? 'text-yellow-300' : 'text-red-300');
                if (kpiRiskOrders) kpiRiskOrders.textContent = `${formatNumber(revenue.quantity)}ì¡± (${revenue.orders}ê±´)`;
            }

            // AQL Pass Rate - HTML ID: kpiAqlRate, kpiAqlCount
            const kpiAqlRate = document.getElementById('kpiAqlRate');
            const kpiAqlCount = document.getElementById('kpiAqlCount');
            if (kpiAqlRate) {
                const aqlStatus = aql.rate >= 98 ? 'âœ…' : aql.rate >= 95 ? 'âš ï¸' : 'ğŸš¨';
                kpiAqlRate.textContent = aql.rate.toFixed(1) + '%';
                kpiAqlRate.className = 'text-3xl font-bold ' + (aql.rate >= 98 ? 'text-green-300' : aql.rate >= 95 ? 'text-yellow-300' : 'text-red-300');
                if (kpiAqlCount) kpiAqlCount.textContent = `${aqlStatus} ${aql.passedCount}/${aql.inspectedCount}ê±´`;
            }

            // Bottleneck - HTML ID: kpiBottleneckStage, kpiBottleneckRisk
            const kpiBottleneckStage = document.getElementById('kpiBottleneckStage');
            const kpiBottleneckRisk = document.getElementById('kpiBottleneckRisk');
            if (kpiBottleneckStage) {
                kpiBottleneckStage.textContent = bottleneck.process;
                if (kpiBottleneckRisk) kpiBottleneckRisk.textContent = `ì™„ë£Œìœ¨ ${bottleneck.rate}% | ${formatNumber(bottleneck.affectedQty)}ì¡± ì”ëŸ‰`;
            }

            // Delay Severity - HTML ID: delayMild, delayModerate, delaySevere
            const delayMild = document.getElementById('delayMild');
            const delayModerate = document.getElementById('delayModerate');
            const delaySevere = document.getElementById('delaySevere');
            if (delayMild) delayMild.textContent = severity.minor + 'ê±´';
            if (delayModerate) delayModerate.textContent = severity.moderate + 'ê±´';
            if (delaySevere) delaySevere.textContent = severity.severe + 'ê±´';

            // Root Cause - HTML ID: primaryRootCause, primaryRootCauseCount
            const primaryRootCause = document.getElementById('primaryRootCause');
            const primaryRootCauseCount = document.getElementById('primaryRootCauseCount');
            if (primaryRootCause && rootCause.length > 0) {
                primaryRootCause.textContent = rootCause[0][0];
                if (primaryRootCauseCount) primaryRootCauseCount.textContent = rootCause[0][1];
            }

            // Delay Severity Chart
            updateDelaySeverityChart(severity);

            // Root Cause Chart
            updateRootCauseChart(rootCause);

            // Vendor Performance List - HTML ID: vendorPerformanceList
            updateVendorPerformanceList(vendors);

            // ë‹´ë‹¹ì ê¶Œê³ ì‚¬í•­ ì—…ë°ì´íŠ¸
            updateActionRecommendations();
        }

        // ========================================
        // ë‹´ë‹¹ì ê¶Œê³ ì‚¬í•­ ì‹œìŠ¤í…œ
        // ========================================

        function updateActionRecommendations() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('recommendationTime').textContent = `ì—…ë°ì´íŠ¸: ${timeStr}`;

            // ë°ì´í„° ë¶„ì„
            const bottleneck = predictBottleneck();
            const delayedOrders = filteredData.filter(d => d.isDelayed);
            const severity = calculateDelaySeverity();
            const vendors = calculateVendorPerformance();
            const otd = calculateOTDRate();
            const aql = calculateAQLStats();

            // ê³„íš ë‹´ë‹¹ì ê¶Œê³  ìƒì„±
            const planningRecs = generatePlanningRecommendations(bottleneck, delayedOrders, severity, vendors, otd);
            document.getElementById('planningRecommendations').innerHTML = planningRecs.html;

            // í’ˆì§ˆ ë‹´ë‹¹ì ê¶Œê³  ìƒì„±
            const qualityRecs = generateQualityRecommendations(delayedOrders, aql, bottleneck, vendors);
            document.getElementById('qualityRecommendations').innerHTML = qualityRecs.html;

            // ë¦¬ìŠ¤í¬ ì ìˆ˜ ê³„ì‚° ë° í‘œì‹œ
            const riskScore = calculateRiskScore(delayedOrders, severity, bottleneck, vendors, aql);
            updateRiskScoreDisplay(riskScore);
        }

        function generatePlanningRecommendations(bottleneck, delayedOrders, severity, vendors, otd) {
            const recs = [];

            // 1. ë³‘ëª© ê³µì • ê¶Œê³ 
            if (bottleneck.completionRate < 80) {
                recs.push({
                    priority: 'high',
                    icon: 'ğŸ”´',
                    text: `[${bottleneck.process}] ë³‘ëª© ê³µì • (${bottleneck.completionRate.toFixed(1)}%)`,
                    action: 'â†’ ë¦¬ì†ŒìŠ¤ ì¶”ê°€ ë°°ì¹˜ ê¶Œê³ '
                });
            }

            // 2. ì§€ì—° ì˜¤ë” ê¶Œê³ 
            if (delayedOrders.length > 0) {
                const severeDelays = severity.severe;
                if (severeDelays > 0) {
                    recs.push({
                        priority: 'high',
                        icon: 'ğŸš¨',
                        text: `ì‹¬ê° ì§€ì—° ${severeDelays}ê±´ (7ì¼ ì´ìƒ)`,
                        action: 'â†’ ê¸´ê¸‰ ë³µêµ¬ ê³„íš ìˆ˜ë¦½ í•„ìš”'
                    });
                } else if (delayedOrders.length >= 5) {
                    recs.push({
                        priority: 'medium',
                        icon: 'âš ï¸',
                        text: `ì§€ì—° ì˜¤ë” ${delayedOrders.length}ê±´ ë°œìƒ`,
                        action: 'â†’ ì›ì¸ ë¶„ì„ ë° ìš°ì„ ìˆœìœ„ ì¬ì¡°ì •'
                    });
                }
            }

            // 3. ì¤‘ìš” ê±°ë˜ì²˜ ì§€ì—° ê¶Œê³ 
            const importantDelays = delayedOrders.filter(d =>
                ['Japan', 'South Korea', 'USA'].includes(d.destination)
            );
            if (importantDelays.length > 0) {
                recs.push({
                    priority: 'high',
                    icon: 'ğŸ¯',
                    text: `ì¤‘ìš” ê±°ë˜ì²˜ ì§€ì—° ${importantDelays.length}ê±´`,
                    action: 'â†’ ìµœìš°ì„  ìƒì‚°ë¼ì¸ ë°°ì •'
                });
            }

            // 4. ì €ì„±ê³¼ ë²¤ë” ê¶Œê³ 
            const lowPerformVendors = vendors.filter(v => v.score < 60);
            if (lowPerformVendors.length > 0) {
                recs.push({
                    priority: 'medium',
                    icon: 'ğŸ­',
                    text: `ì €ì„±ê³¼ ë²¤ë” ${lowPerformVendors.length}ê°œ`,
                    action: 'â†’ ë²¤ë” ë¯¸íŒ… ë° ê°œì„  ìš”êµ¬'
                });
            }

            // 5. OTD ë¯¸ë‹¬ ê¶Œê³ 
            if (otd.rate < 85) {
                recs.push({
                    priority: 'high',
                    icon: 'ğŸ“‰',
                    text: `ì •ì‹œë‚©ê¸°ìœ¨ ${otd.rate.toFixed(1)}% (ëª©í‘œ 95%)`,
                    action: 'â†’ ê¸´ê¸‰ ëŒ€ì‘ ì²´ê³„ ê°€ë™'
                });
            } else if (otd.rate < 95) {
                recs.push({
                    priority: 'medium',
                    icon: 'ğŸ“Š',
                    text: `ì •ì‹œë‚©ê¸°ìœ¨ ${otd.rate.toFixed(1)}% (ëª©í‘œ 95%)`,
                    action: 'â†’ ê°œì„  ë°©ì•ˆ ê²€í†  í•„ìš”'
                });
            }

            // ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ì–‘í˜¸ ë©”ì‹œì§€
            if (recs.length === 0) {
                recs.push({
                    priority: 'good',
                    icon: 'âœ…',
                    text: 'í˜„ì¬ íŠ¹ì´ì‚¬í•­ ì—†ìŒ',
                    action: 'ìƒì‚° ê³„íš ì •ìƒ ì§„í–‰ ì¤‘'
                });
            }

            const html = recs.map(r => `
                <div class="flex items-start gap-2 p-2 rounded ${
                    r.priority === 'high' ? 'bg-red-50 dark:bg-red-900/30' :
                    r.priority === 'medium' ? 'bg-yellow-50 dark:bg-yellow-900/30' :
                    'bg-green-50 dark:bg-green-900/30'
                }">
                    <span>${r.icon}</span>
                    <div>
                        <div class="font-medium ${
                            r.priority === 'high' ? 'text-red-700 dark:text-red-300' :
                            r.priority === 'medium' ? 'text-yellow-700 dark:text-yellow-300' :
                            'text-green-700 dark:text-green-300'
                        }">${escapeHtml(r.text)}</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">${escapeHtml(r.action)}</div>
                    </div>
                </div>
            `).join('');

            return { html, count: recs.length };
        }

        function generateQualityRecommendations(delayedOrders, aql, bottleneck, vendors) {
            const recs = [];

            // 1. AQL í•©ê²©ë¥  ê¶Œê³ 
            if (aql.passRate < 95) {
                recs.push({
                    priority: 'high',
                    icon: 'ğŸ”´',
                    text: `AQL í•©ê²©ë¥  ${aql.passRate.toFixed(1)}% (ëª©í‘œ 98%)`,
                    action: 'â†’ ë¶ˆëŸ‰ ì›ì¸ ê¸´ê¸‰ ë¶„ì„'
                });
            } else if (aql.passRate < 98) {
                recs.push({
                    priority: 'medium',
                    icon: 'âš ï¸',
                    text: `AQL í•©ê²©ë¥  ${aql.passRate.toFixed(1)}%`,
                    action: 'â†’ í’ˆì§ˆ ê°œì„  ì¡°ì¹˜ ê²€í† '
                });
            }

            // 2. í’ˆì§ˆ ìœ„í—˜ ì˜¤ë” (ì§€ì—° + AQL ë¶ˆí•©ê²©)
            const qualityRiskOrders = delayedOrders.filter(d => d.aql === false);
            if (qualityRiskOrders.length > 0) {
                recs.push({
                    priority: 'high',
                    icon: 'ğŸš¨',
                    text: `í’ˆì§ˆ ìœ„í—˜ ì˜¤ë” ${qualityRiskOrders.length}ê±´`,
                    action: 'â†’ ì§€ì—°+ë¶ˆí•©ê²© êµì§‘í•© ì§‘ì¤‘ ê´€ë¦¬'
                });
            }

            // 3. ë³‘ëª© ê³µì • í’ˆì§ˆ ë¦¬ìŠ¤í¬
            if (bottleneck.completionRate < 70) {
                recs.push({
                    priority: 'medium',
                    icon: 'âš¡',
                    text: `[${bottleneck.process}] í’ˆì§ˆ ë¦¬ìŠ¤í¬`,
                    action: 'â†’ ë‚©ê¸° ì••ë°•ìœ¼ë¡œ í’ˆì§ˆ íƒ€í˜‘ ì£¼ì˜'
                });
            }

            // 4. ì§€ì—° ì‹¬ê°ë„ë³„ í’ˆì§ˆ ê¶Œê³ 
            const severeDelays = delayedOrders.filter(d => {
                const today = new Date();
                const sdd = new Date(d.sdd);
                return (today - sdd) / (1000 * 60 * 60 * 24) > 7;
            });
            if (severeDelays.length > 0) {
                recs.push({
                    priority: 'medium',
                    icon: 'ğŸ“‹',
                    text: `7ì¼+ ì§€ì—° ${severeDelays.length}ê±´ í’ˆì§ˆ ê²€ìˆ˜ ê°•í™”`,
                    action: 'â†’ AQL ê²€ì‚¬ ìš°ì„  ì‹¤ì‹œ'
                });
            }

            // 5. ì €ì„±ê³¼ ë²¤ë” í’ˆì§ˆ ê¶Œê³ 
            const lowQualityVendors = vendors.filter(v => v.score < 50);
            if (lowQualityVendors.length > 0) {
                recs.push({
                    priority: 'medium',
                    icon: 'ğŸ­',
                    text: `ì €ì„±ê³¼ ë²¤ë” ${lowQualityVendors.length}ê°œ í’ˆì§ˆ ê°ì‚¬`,
                    action: 'â†’ ë‚©í’ˆ ê±´ AQL ê²€ì‚¬ ê°•í™”'
                });
            }

            // ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ì–‘í˜¸ ë©”ì‹œì§€
            if (recs.length === 0) {
                recs.push({
                    priority: 'good',
                    icon: 'âœ…',
                    text: 'í’ˆì§ˆ ìƒíƒœ ì–‘í˜¸',
                    action: 'ì •ìƒ í’ˆì§ˆ ê´€ë¦¬ ìœ ì§€'
                });
            }

            const html = recs.map(r => `
                <div class="flex items-start gap-2 p-2 rounded ${
                    r.priority === 'high' ? 'bg-red-50 dark:bg-red-900/30' :
                    r.priority === 'medium' ? 'bg-yellow-50 dark:bg-yellow-900/30' :
                    'bg-green-50 dark:bg-green-900/30'
                }">
                    <span>${r.icon}</span>
                    <div>
                        <div class="font-medium ${
                            r.priority === 'high' ? 'text-red-700 dark:text-red-300' :
                            r.priority === 'medium' ? 'text-yellow-700 dark:text-yellow-300' :
                            'text-green-700 dark:text-green-300'
                        }">${escapeHtml(r.text)}</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">${escapeHtml(r.action)}</div>
                    </div>
                </div>
            `).join('');

            return { html, count: recs.length };
        }

        function calculateRiskScore(delayedOrders, severity, bottleneck, vendors, aql) {
            let score = 0;

            // ì§€ì—° ìœ„í—˜ (40ì  ë§Œì )
            const delayScore = Math.min(40, delayedOrders.length * 3 + severity.severe * 5);
            score += delayScore;

            // ë³‘ëª© ìœ„í—˜ (30ì  ë§Œì )
            const bottleneckScore = bottleneck.completionRate < 50 ? 30 :
                                    bottleneck.completionRate < 70 ? 20 :
                                    bottleneck.completionRate < 80 ? 10 : 0;
            score += bottleneckScore;

            // ë²¤ë” ìœ„í—˜ (20ì  ë§Œì )
            const lowVendors = vendors.filter(v => v.score < 60).length;
            const vendorScore = Math.min(20, lowVendors * 5);
            score += vendorScore;

            // í’ˆì§ˆ ìœ„í—˜ (10ì  ë§Œì )
            const qualityScore = aql.passRate >= 98 ? 0 :
                                 aql.passRate >= 95 ? 5 : 10;
            score += qualityScore;

            return {
                total: Math.min(100, score),
                breakdown: {
                    delay: delayScore,
                    bottleneck: bottleneckScore,
                    vendor: vendorScore,
                    quality: qualityScore
                }
            };
        }

        function updateRiskScoreDisplay(riskData) {
            const scoreEl = document.getElementById('riskScore');
            const levelEl = document.getElementById('riskLevel');
            const breakdownEl = document.getElementById('riskBreakdown');

            if (!scoreEl) return;

            scoreEl.textContent = riskData.total + 'ì ';

            let level, levelClass;
            if (riskData.total >= 70) {
                level = 'ìœ„í—˜';
                levelClass = 'bg-red-500 text-white';
                scoreEl.className = 'text-2xl font-bold text-red-600';
            } else if (riskData.total >= 40) {
                level = 'ì£¼ì˜';
                levelClass = 'bg-yellow-500 text-white';
                scoreEl.className = 'text-2xl font-bold text-yellow-600';
            } else {
                level = 'ì–‘í˜¸';
                levelClass = 'bg-green-500 text-white';
                scoreEl.className = 'text-2xl font-bold text-green-600';
            }

            levelEl.textContent = level;
            levelEl.className = `text-xs px-2 py-1 rounded ${levelClass}`;

            breakdownEl.textContent = `ì§€ì—°:${riskData.breakdown.delay} | ë³‘ëª©:${riskData.breakdown.bottleneck} | ë²¤ë”:${riskData.breakdown.vendor} | í’ˆì§ˆ:${riskData.breakdown.quality}`;
        }

        // ì§€ì—° ì‹¬ê°ë„ ë„ë„› ì°¨íŠ¸
        let delaySeverityChart = null;
        function updateDelaySeverityChart(severity) {
            const ctx = document.getElementById('delaySeverityChart');
            if (!ctx) return;

            const data = {
                labels: ['ê²½ë¯¸ (1-3ì¼)', 'ì£¼ì˜ (4-7ì¼)', 'ì‹¬ê° (7ì¼+)'],
                datasets: [{
                    data: [severity.minor, severity.moderate, severity.severe],
                    backgroundColor: ['#4ade80', '#fbbf24', '#ef4444'],
                    borderWidth: 0
                }]
            };

            if (delaySeverityChart) {
                delaySeverityChart.data = data;
                delaySeverityChart.update();
            } else {
                delaySeverityChart = chartManager.createOrUpdate('delaySeverityChart', ctx, {
                    type: 'doughnut',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: '#fff', font: { size: 10 } }
                            }
                        }
                    }
                });
            }
        }

        // ì§€ì—° ì›ì¸ ë§‰ëŒ€ ì°¨íŠ¸
        let rootCauseChart = null;
        function updateRootCauseChart(causes) {
            const ctx = document.getElementById('rootCauseChart');
            if (!ctx) return;

            const data = {
                labels: causes.map(c => c[0]),
                datasets: [{
                    label: 'ì§€ì—° ê±´ìˆ˜',
                    data: causes.map(c => c[1]),
                    backgroundColor: 'rgba(59, 130, 246, 0.8)',
                    borderRadius: 4
                }]
            };

            if (rootCauseChart) {
                rootCauseChart.data = data;
                rootCauseChart.update();
            } else {
                rootCauseChart = chartManager.createOrUpdate('rootCauseChart', ctx, {
                    type: 'bar',
                    data: data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                            y: { ticks: { color: '#fff' }, grid: { display: false } }
                        }
                    }
                });
            }
        }

        // ë²¤ë” ì„±ê³¼ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateVendorPerformanceList(vendors) {
            const container = document.getElementById('vendorPerformanceList');
            if (!container) return;

            let html = '';
            vendors.forEach((v, i) => {
                const medal = i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : `${i + 1}.`;
                const scoreColor = parseFloat(v.score) >= 80 ? 'text-green-400' : parseFloat(v.score) >= 60 ? 'text-yellow-400' : 'text-red-400';
                html += `
                    <div class="flex items-center justify-between py-1 border-b border-white/10 last:border-0">
                        <span class="text-sm">${medal} ${escapeHtml(v.vendor)}</span>
                        <span class="font-bold ${scoreColor}">${v.score}ì </span>
                    </div>`;
            });
            container.innerHTML = html;
        }

        // ë„ì›€ë§ ëª¨ë‹¬ í† ê¸€
        function toggleHelpModal() {
            const modal = document.getElementById('helpModal');
            modal.classList.toggle('hidden');
            if (!modal.classList.contains('hidden')) {
                trapFocus(modal);
            }
        }

        // ì¸ì‚¬ì´íŠ¸ ë„ì›€ë§ (toggleHelpModalê³¼ ë™ì¼)
        function toggleInsightsHelp() {
            toggleHelpModal();
        }

        function closeHelpModal() {
            document.getElementById('helpModal').classList.add('hidden');
            releaseFocus();
        }

        // ìƒì„¸ ëª¨ë‹¬ í•¨ìˆ˜ë“¤
        function showOTDDetail() {
            const otd = calculateOTDRate();
            const details = filteredData
                .filter(d => {
                    const whOutCompleted = d.production?.wh_out?.completed || 0;
                    return whOutCompleted >= (d.quantity || 0);
                })
                .filter(d => {
                    if (!d.sddValue || !d.crd) return false;
                    return new Date(d.sddValue) > new Date(d.crd);
                })
                .slice(0, 10);

            let html = `<h3 class="text-lg font-bold mb-4">ğŸ“Š OTD ìƒì„¸ ë¶„ì„</h3>
                <div class="grid grid-cols-3 gap-4 mb-4">
                    <div class="bg-blue-50 dark:bg-blue-900 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-600">${otd.rate.toFixed(1)}%</div>
                        <div class="text-xs text-gray-500">ì •ì‹œ ë‚©ê¸°ìœ¨</div>
                    </div>
                    <div class="bg-green-50 dark:bg-green-900 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600">${otd.onTimeCount}</div>
                        <div class="text-xs text-gray-500">ì •ì‹œ ì™„ë£Œ</div>
                    </div>
                    <div class="bg-red-50 dark:bg-red-900 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-red-600">${otd.completedCount - otd.onTimeCount}</div>
                        <div class="text-xs text-gray-500">ì§€ì—° ì™„ë£Œ</div>
                    </div>
                </div>`;

            if (details.length > 0) {
                html += `<h4 class="font-semibold mb-2">ì§€ì—° ì™„ë£Œ ì˜¤ë” (ìµœê·¼ 10ê±´)</h4>
                    <div class="max-h-60 overflow-y-auto">
                        <table class="w-full text-sm">
                            <caption class="sr-only">ì§€ì—° ì™„ë£Œ ì˜¤ë” ìƒì„¸ í…Œì´ë¸” (POë²ˆí˜¸, CRD, SDD, ì§€ì—°ì¼)</caption>
                            <thead class="bg-gray-50 dark:bg-gray-700"><tr>
                                <th class="px-2 py-1 text-left">PO</th>
                                <th class="px-2 py-1">CRD</th>
                                <th class="px-2 py-1">SDD</th>
                                <th class="px-2 py-1">ì§€ì—°ì¼</th>
                            </tr></thead>
                            <tbody>`;
                details.forEach(d => {
                    const diffDays = Math.floor((new Date(d.sddValue) - new Date(d.crd)) / (1000*60*60*24));
                    html += `<tr class="border-b"><td class="px-2 py-1">${escapeHtml(d.poNumber)}</td>
                        <td class="px-2 py-1 text-center">${d.crd}</td>
                        <td class="px-2 py-1 text-center">${d.sddValue}</td>
                        <td class="px-2 py-1 text-center text-red-600">+${diffDays}ì¼</td></tr>`;
                });
                html += '</tbody></table></div>';
            }

            showInfoModal('OTD ìƒì„¸', html);
        }

        function showRevenueRiskDetail() {
            const revenue = calculateRevenueAtRisk();
            const details = filteredData
                .filter(d => d.isDelayed)
                .map(d => {
                    const remaining = Math.max(0, (d.quantity || 0) - (d.production?.wh_out?.completed || 0));
                    return { ...d, remaining, risk: remaining * UNIT_PRICE };
                })
                .sort((a, b) => b.risk - a.risk)
                .slice(0, 10);

            let html = `<h3 class="text-lg font-bold mb-4">ğŸ’° ìœ„í—˜ ë§¤ì¶œì•¡ ìƒì„¸</h3>
                <div class="grid grid-cols-3 gap-4 mb-4">
                    <div class="bg-red-50 dark:bg-red-900 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-red-600">$${formatNumber(revenue.revenue)}</div>
                        <div class="text-xs text-gray-500">ì´ ìœ„í—˜ ë§¤ì¶œ</div>
                    </div>
                    <div class="bg-yellow-50 dark:bg-yellow-900 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-yellow-600">${formatNumber(revenue.quantity)}</div>
                        <div class="text-xs text-gray-500">ì§€ì—° ìˆ˜ëŸ‰ (ì¡±)</div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold">${revenue.orders}</div>
                        <div class="text-xs text-gray-500">ì§€ì—° ì˜¤ë” ìˆ˜</div>
                    </div>
                </div>`;

            if (details.length > 0) {
                html += `<h4 class="font-semibold mb-2">ê³ ìœ„í—˜ ì˜¤ë” TOP 10</h4>
                    <div class="max-h-60 overflow-y-auto">
                        <table class="w-full text-sm">
                            <caption class="sr-only">ê³ ìœ„í—˜ ì˜¤ë” ìƒì„¸ í…Œì´ë¸” (POë²ˆí˜¸, ì”ëŸ‰, ìœ„í—˜ì•¡)</caption>
                            <thead class="bg-gray-50 dark:bg-gray-700"><tr>
                                <th class="px-2 py-1 text-left">PO</th>
                                <th class="px-2 py-1">ì”ëŸ‰</th>
                                <th class="px-2 py-1">ìœ„í—˜ì•¡</th>
                            </tr></thead>
                            <tbody>`;
                details.forEach(d => {
                    html += `<tr class="border-b"><td class="px-2 py-1">${escapeHtml(d.poNumber)}</td>
                        <td class="px-2 py-1 text-right">${formatNumber(d.remaining)}ì¡±</td>
                        <td class="px-2 py-1 text-right text-red-600">$${formatNumber(d.risk)}</td></tr>`;
                });
                html += '</tbody></table></div>';
            }

            showInfoModal('ìœ„í—˜ ë§¤ì¶œì•¡ ìƒì„¸', html);
        }

        function showAQLDetail() {
            const aql = calculateAQLStats();
            const failed = filteredData.filter(d => d.aql === false || d.aql === 'false' || d.aql === 'N').slice(0, 10);

            let html = `<h3 class="text-lg font-bold mb-4">âœ… AQL í’ˆì§ˆ ê²€ì‚¬ ìƒì„¸</h3>
                <div class="grid grid-cols-3 gap-4 mb-4">
                    <div class="bg-green-50 dark:bg-green-900 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600">${aql.rate.toFixed(1)}%</div>
                        <div class="text-xs text-gray-500">í•©ê²©ë¥ </div>
                    </div>
                    <div class="bg-blue-50 dark:bg-blue-900 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-600">${aql.passedCount}</div>
                        <div class="text-xs text-gray-500">í•©ê²©</div>
                    </div>
                    <div class="bg-red-50 dark:bg-red-900 p-3 rounded-lg text-center">
                        <div class="text-2xl font-bold text-red-600">${aql.inspectedCount - aql.passedCount}</div>
                        <div class="text-xs text-gray-500">ë¶ˆí•©ê²©</div>
                    </div>
                </div>`;

            if (failed.length > 0) {
                html += `<h4 class="font-semibold mb-2">ë¶ˆí•©ê²© ì˜¤ë”</h4>
                    <div class="max-h-60 overflow-y-auto">
                        <table class="w-full text-sm">
                            <caption class="sr-only">AQL ë¶ˆí•©ê²© ì˜¤ë” í…Œì´ë¸” (POë²ˆí˜¸, ëª¨ë¸, ê³µì¥)</caption>
                            <thead class="bg-gray-50 dark:bg-gray-700"><tr>
                                <th class="px-2 py-1 text-left">PO</th>
                                <th class="px-2 py-1">ëª¨ë¸</th>
                                <th class="px-2 py-1">ê³µì¥</th>
                            </tr></thead>
                            <tbody>`;
                failed.forEach(d => {
                    html += `<tr class="border-b"><td class="px-2 py-1">${escapeHtml(d.poNumber)}</td>
                        <td class="px-2 py-1">${escapeHtml(d.model)}</td>
                        <td class="px-2 py-1 text-center">${escapeHtml(d.factory)}</td></tr>`;
                });
                html += '</tbody></table></div>';
            }

            showInfoModal('AQL ìƒì„¸', html);
        }

        function showBottleneckDetail() {
            const bottleneck = predictBottleneck();
            const processStats = {};

            PROCESS_ORDER.forEach(key => {
                processStats[key] = { completed: 0, pending: 0 };
            });

            filteredData.forEach(d => {
                PROCESS_ORDER.forEach(key => {
                    const p = d.production?.[key];
                    processStats[key].completed += p?.completed || 0;
                    processStats[key].pending += p?.pending || 0;
                });
            });

            let html = `<h3 class="text-lg font-bold mb-4">âš ï¸ ë³‘ëª© ê³µì • ë¶„ì„</h3>
                <div class="bg-yellow-50 dark:bg-yellow-900 p-4 rounded-lg mb-4">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-yellow-600">${bottleneck.process}</div>
                        <div class="text-sm text-gray-500 mt-1">í˜„ì¬ ë³‘ëª© ê³µì •</div>
                        <div class="text-lg mt-2">ì™„ë£Œìœ¨ <span class="font-bold text-red-600">${bottleneck.rate}%</span> | ì”ëŸ‰ <span class="font-bold">${formatNumber(bottleneck.affectedQty)}ì¡±</span></div>
                    </div>
                </div>
                <h4 class="font-semibold mb-2">ê³µì •ë³„ í˜„í™©</h4>
                <div class="space-y-2">`;

            PROCESS_ORDER.forEach(key => {
                const stats = processStats[key];
                const total = stats.completed + stats.pending;
                const rate = total > 0 ? (stats.completed / total * 100) : 100;
                const isBottleneck = PROCESS_NAMES[key] === bottleneck.process;

                html += `<div class="flex items-center gap-2 ${isBottleneck ? 'bg-yellow-100 dark:bg-yellow-900 p-2 rounded' : ''}">
                    <span class="w-20 text-sm font-medium">${PROCESS_NAMES[key]}</span>
                    <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-4">
                        <div class="h-4 rounded-full ${rate >= 80 ? 'bg-green-500' : rate >= 50 ? 'bg-yellow-500' : 'bg-red-500'}" style="width: ${rate}%"></div>
                    </div>
                    <span class="w-16 text-right text-sm font-bold ${rate >= 80 ? 'text-green-600' : rate >= 50 ? 'text-yellow-600' : 'text-red-600'}">${rate.toFixed(1)}%</span>
                </div>`;
            });

            html += '</div>';
            showInfoModal('ë³‘ëª© ê³µì • ìƒì„¸', html);
        }

        // ë²”ìš© ì •ë³´ ëª¨ë‹¬
        function showInfoModal(title, content) {
            let modal = document.getElementById('infoModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'infoModal';
                modal.className = 'fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4';
                modal.innerHTML = `
                    <div class="bg-card rounded-xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden">
                        <div class="p-4 border-b border-theme flex justify-between items-center">
                            <h3 id="infoModalTitle" class="font-bold text-lg"></h3>
                            <button data-action="closeInfoModal" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">âœ•</button>
                        </div>
                        <div id="infoModalContent" class="p-4 overflow-y-auto max-h-[60vh]"></div>
                    </div>`;
                document.body.appendChild(modal);
            }
            document.getElementById('infoModalTitle').textContent = title;
            document.getElementById('infoModalContent').innerHTML = content;
            modal.classList.remove('hidden');
            trapFocus(modal);
        }

        function closeInfoModal() {
            const modal = document.getElementById('infoModal');
            if (modal) {
                modal.classList.add('hidden');
                releaseFocus();
            }
        }

        // =============================================================================
        // Phase 2: Service Worker Registration (PWA)
        // =============================================================================
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('[SW] Service Worker registered:', registration.scope);

                        // ì—…ë°ì´íŠ¸ ì²´í¬
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('[SW] New Service Worker found');

                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('[SW] New version available');
                                    showUpdateNotification();
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('[SW] Service Worker registration failed:', error);
                    });
            });
        }

        function showUpdateNotification() {
            const updateBanner = document.createElement('div');
            updateBanner.className = 'fixed bottom-4 left-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-xl z-[9999] flex items-center justify-between';
            updateBanner.innerHTML = `
                <div class="flex-1">
                    <div class="font-bold">ğŸ‰ ìƒˆ ë²„ì „ ì‚¬ìš© ê°€ëŠ¥</div>
                    <div class="text-sm opacity-90">ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ìµœì‹  ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.</div>
                </div>
                <div class="flex gap-2">
                    <button onclick="location.reload()" class="px-4 py-2 bg-white text-blue-600 rounded font-semibold hover:bg-gray-100">
                        ìƒˆë¡œê³ ì¹¨
                    </button>
                    <button onclick="this.closest('div').remove()" class="px-3 py-2 hover:bg-blue-700 rounded">
                        âœ•
                    </button>
                </div>
            `;
            document.body.appendChild(updateBanner);
        }

        // =============================================================================
        // Phase 2: Notification Toggle UI
        // =============================================================================
        function addNotificationToggle() {
            // ë‹¤í¬ëª¨ë“œ í† ê¸€ ì˜†ì— ì•Œë¦¼ í† ê¸€ ì¶”ê°€
            const darkModeContainer = document.querySelector('.flex.items-center.gap-2');
            if (!darkModeContainer) return;

            const notificationToggle = document.createElement('div');
            notificationToggle.className = 'flex items-center gap-2';
            notificationToggle.innerHTML = `
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="notificationToggle" class="sr-only peer" onchange="toggleNotifications(this.checked)">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                    <span class="ml-2 text-sm font-medium">ğŸ”” ì•Œë¦¼</span>
                </label>
            `;
            darkModeContainer.parentNode.insertBefore(notificationToggle, darkModeContainer.nextSibling);

            // ì €ì¥ëœ ì„¤ì • ë³µì›
            if (window.notificationManager) {
                const settings = notificationManager.settings;
                const toggle = document.getElementById('notificationToggle');
                if (toggle) {
                    toggle.checked = settings.enabled;
                }
            }
        }

        async function toggleNotifications(enabled) {
            if (window.notificationManager) {
                const success = await notificationManager.setEnabled(enabled);
                if (!success && enabled) {
                    // ê¶Œí•œ ê±°ë¶€ ì‹œ í† ê¸€ ë˜ëŒë¦¬ê¸°
                    document.getElementById('notificationToggle').checked = false;
                }
            } else {
                console.error('[Notifications] NotificationManager not available');
            }
        }

        // DOM ë¡œë“œ í›„ ì•Œë¦¼ í† ê¸€ ì¶”ê°€
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', addNotificationToggle);
        } else {
            addNotificationToggle();
        }

        // Keyboard shortcuts help í‘œì‹œ (? í‚¤)
        window.addEventListener('keydown', (e) => {
            if (e.key === '?' && !e.target.matches('input, textarea')) {
                if (window.keyboardShortcuts) {
                    keyboardShortcuts.showShortcutsHelp();
                }
            }
        });
    </script>
</body>
</html>
